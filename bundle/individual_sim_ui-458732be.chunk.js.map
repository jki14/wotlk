{"version":3,"file":"individual_sim_ui-458732be.chunk.js","sources":["../../../ui/core/target.ts","../../../ui/core/encounter.ts","../../../ui/core/raid.ts","../../../ui/core/worker_pool.ts","../../../ui/core/sim.ts","../../../ui/core/components/number_picker.ts","../../../ui/core/components/bonus_stats_picker.ts","../../../ui/core/components/boolean_picker.ts","../../../ui/core/components/character_stats.ts","../../../ui/core/components/icon_enum_picker.ts","../../../ui/core/components/number_list_picker.ts","../../../ui/core/components/cooldowns_picker.ts","../../../ui/core/components/detailed_results.ts","../../../ui/core/components/list_picker.ts","../../../ui/core/components/custom_rotation_picker.ts","../../../ui/core/components/enum_picker.ts","../../../ui/core/components/encounter_picker.ts","../../../ui/core/proto_utils/enchants.ts","../../../ui/core/components/other_inputs.ts","../../../ui/core/components/gear_picker.ts","../../../ui/core/components/saved_data_manager.ts","../../../ui/core/components/input_helpers.ts","../../../ui/core/talents/hunter_pet.ts","../../../ui/core/components/icon_picker.ts","../../../ui/core/components/log_runner.ts","../../../ui/core/components/multi_icon_picker.ts","../../../ui/core/components/settings_menu.ts","../../../ui/core/components/results_viewer.ts","../../../ui/core/launched_sims.ts","../../../ui/core/components/title.ts","../../../ui/core/sim_ui.ts","../../../ui/core/components/stat_weights_action.ts","../../../ui/core/components/exporters.ts","../../../ui/core/components/importers.ts","../../../ui/core/components/icon_inputs.ts","../../../ui/core/constants/tooltips.ts","../../../ui/core/individual_sim_ui.ts"],"sourcesContent":["import { MobType } from './proto/common.js';\nimport { SpellSchool } from './proto/common.js';\nimport { Stat } from './proto/common.js';\nimport { Target as TargetProto } from './proto/common.js';\nimport { PresetTarget } from './proto/api.js';\nimport { Stats } from './proto_utils/stats.js';\n\nimport * as Mechanics from './constants/mechanics.js';\n\nimport { Listener } from './typed_event.js';\nimport { Sim } from './sim.js';\nimport { EventID, TypedEvent } from './typed_event.js';\nimport { sum } from './utils.js';\nimport { wait } from './utils.js';\n\n// Manages all the settings for a single Target.\nexport class Target {\n\treadonly sim: Sim;\n\n\tprivate id: number = 0;\n\tprivate name: string = '';\n\tprivate level: number = Mechanics.BOSS_LEVEL;\n\tprivate mobType: MobType = MobType.MobTypeDemon;\n\tprivate tankIndex: number = 0;\n\tprivate stats: Stats = new Stats();\n\n\tprivate swingSpeed: number = 0;\n\tprivate minBaseDamage: number = 0;\n\tprivate dualWield: boolean = false;\n\tprivate dualWieldPenalty: boolean = false;\n\tprivate suppressDodge: boolean = false;\n\tprivate parryHaste: boolean = true;\n\tprivate spellSchool: SpellSchool = SpellSchool.SpellSchoolPhysical;\n\n\treadonly idChangeEmitter = new TypedEvent<void>();\n\treadonly nameChangeEmitter = new TypedEvent<void>();\n\treadonly levelChangeEmitter = new TypedEvent<void>();\n\treadonly mobTypeChangeEmitter = new TypedEvent<void>();\n\treadonly propChangeEmitter = new TypedEvent<void>();\n\treadonly statsChangeEmitter = new TypedEvent<void>();\n\n\t// Emits when any of the above emitters emit.\n\treadonly changeEmitter = new TypedEvent<void>();\n\n\tconstructor(sim: Sim) {\n\t\tthis.sim = sim;\n\n\t\t[\n\t\t\tthis.idChangeEmitter,\n\t\t\tthis.nameChangeEmitter,\n\t\t\tthis.levelChangeEmitter,\n\t\t\tthis.mobTypeChangeEmitter,\n\t\t\tthis.propChangeEmitter,\n\t\t\tthis.statsChangeEmitter,\n\t\t].forEach(emitter => emitter.on(eventID => this.changeEmitter.emit(eventID)));\n\n\t\tthis.changeEmitter.on(eventID => this.sim.encounter?.changeEmitter.emit(eventID));\n\t}\n\n\tgetId(): number {\n\t\treturn this.id;\n\t}\n\n\tsetId(eventID: EventID, newId: number) {\n\t\tif (newId == this.id)\n\t\t\treturn;\n\n\t\tthis.id = newId;\n\t\tthis.idChangeEmitter.emit(eventID);\n\t}\n\n\tgetName(): string {\n\t\treturn this.name;\n\t}\n\n\tsetName(eventID: EventID, newName: string) {\n\t\tif (newName == this.name)\n\t\t\treturn;\n\n\t\tthis.name = newName;\n\t\tthis.nameChangeEmitter.emit(eventID);\n\t}\n\n\tgetLevel(): number {\n\t\treturn this.level;\n\t}\n\n\tsetLevel(eventID: EventID, newLevel: number) {\n\t\tif (newLevel == this.level)\n\t\t\treturn;\n\n\t\tthis.level = newLevel;\n\t\tthis.levelChangeEmitter.emit(eventID);\n\t}\n\n\tgetMobType(): MobType {\n\t\treturn this.mobType;\n\t}\n\n\tsetMobType(eventID: EventID, newMobType: MobType) {\n\t\tif (newMobType == this.mobType)\n\t\t\treturn;\n\n\t\tthis.mobType = newMobType;\n\t\tthis.mobTypeChangeEmitter.emit(eventID);\n\t}\n\n\tgetTankIndex(): number {\n\t\treturn this.tankIndex;\n\t}\n\n\tsetTankIndex(eventID: EventID, newTankIndex: number) {\n\t\tif (newTankIndex == this.tankIndex)\n\t\t\treturn;\n\n\t\tthis.tankIndex = newTankIndex;\n\t\tthis.propChangeEmitter.emit(eventID);\n\t}\n\n\tgetSwingSpeed(): number {\n\t\treturn this.swingSpeed;\n\t}\n\n\tsetSwingSpeed(eventID: EventID, newSwingSpeed: number) {\n\t\tif (newSwingSpeed == this.swingSpeed)\n\t\t\treturn;\n\n\t\tthis.swingSpeed = newSwingSpeed;\n\t\tthis.propChangeEmitter.emit(eventID);\n\t}\n\n\tgetMinBaseDamage(): number {\n\t\treturn this.minBaseDamage;\n\t}\n\n\tsetMinBaseDamage(eventID: EventID, newMinBaseDamage: number) {\n\t\tif (newMinBaseDamage == this.minBaseDamage)\n\t\t\treturn;\n\n\t\tthis.minBaseDamage = newMinBaseDamage;\n\t\tthis.propChangeEmitter.emit(eventID);\n\t}\n\n\tgetDualWield(): boolean {\n\t\treturn this.dualWield;\n\t}\n\n\tsetDualWield(eventID: EventID, newDualWield: boolean) {\n\t\tif (newDualWield == this.dualWield)\n\t\t\treturn;\n\n\t\tthis.dualWield = newDualWield;\n\t\tthis.propChangeEmitter.emit(eventID);\n\t}\n\n\tgetDualWieldPenalty(): boolean {\n\t\treturn this.dualWieldPenalty;\n\t}\n\n\tsetDualWieldPenalty(eventID: EventID, newDualWieldPenalty: boolean) {\n\t\tif (newDualWieldPenalty == this.dualWieldPenalty)\n\t\t\treturn;\n\n\t\tthis.dualWieldPenalty = newDualWieldPenalty;\n\t\tthis.propChangeEmitter.emit(eventID);\n\t}\n\n\tgetSuppressDodge(): boolean {\n\t\treturn this.suppressDodge;\n\t}\n\n\tsetSuppressDodge(eventID: EventID, newSuppressDodge: boolean) {\n\t\tif (newSuppressDodge == this.suppressDodge)\n\t\t\treturn;\n\n\t\tthis.suppressDodge = newSuppressDodge;\n\t\tthis.propChangeEmitter.emit(eventID);\n\t}\n\n\tgetParryHaste(): boolean {\n\t\treturn this.parryHaste;\n\t}\n\n\tsetParryHaste(eventID: EventID, newParryHaste: boolean) {\n\t\tif (newParryHaste == this.parryHaste)\n\t\t\treturn;\n\n\t\tthis.parryHaste = newParryHaste;\n\t\tthis.propChangeEmitter.emit(eventID);\n\t}\n\n\tgetSpellSchool(): SpellSchool {\n\t\treturn this.spellSchool;\n\t}\n\n\tsetSpellSchool(eventID: EventID, newSpellSchool: SpellSchool) {\n\t\tif (newSpellSchool == this.spellSchool)\n\t\t\treturn;\n\n\t\tthis.spellSchool = newSpellSchool;\n\t\tthis.propChangeEmitter.emit(eventID);\n\t}\n\n\tgetStats(): Stats {\n\t\treturn this.stats;\n\t}\n\n\tsetStats(eventID: EventID, newStats: Stats) {\n\t\tif (newStats.equals(this.stats))\n\t\t\treturn;\n\n\t\tthis.stats = newStats;\n\t\tthis.statsChangeEmitter.emit(eventID);\n\t}\n\n\tmatchesPreset(preset: PresetTarget): boolean {\n\t\treturn TargetProto.equals(this.toProto(), preset.target);\n\t}\n\n\tapplyPreset(eventID: EventID, preset: PresetTarget) {\n\t\tthis.fromProto(eventID, preset.target || TargetProto.create());\n\t}\n\n\ttoProto(): TargetProto {\n\t\treturn TargetProto.create({\n\t\t\tid: this.getId(),\n\t\t\tname: this.getName(),\n\t\t\tlevel: this.getLevel(),\n\t\t\tmobType: this.getMobType(),\n\t\t\ttankIndex: this.getTankIndex(),\n\t\t\tswingSpeed: this.getSwingSpeed(),\n\t\t\tminBaseDamage: this.getMinBaseDamage(),\n\t\t\tdualWield: this.getDualWield(),\n\t\t\tdualWieldPenalty: this.getDualWieldPenalty(),\n\t\t\tsuppressDodge: this.getSuppressDodge(),\n\t\t\tparryHaste: this.getParryHaste(),\n\t\t\tspellSchool: this.getSpellSchool(),\n\t\t\tstats: this.stats.asArray(),\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: TargetProto) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setId(eventID, proto.id);\n\t\t\tthis.setName(eventID, proto.name);\n\t\t\tthis.setLevel(eventID, proto.level);\n\t\t\tthis.setMobType(eventID, proto.mobType);\n\t\t\tthis.setTankIndex(eventID, proto.tankIndex);\n\t\t\tthis.setSwingSpeed(eventID, proto.swingSpeed);\n\t\t\tthis.setMinBaseDamage(eventID, proto.minBaseDamage);\n\t\t\tthis.setDualWield(eventID, proto.dualWield);\n\t\t\tthis.setDualWieldPenalty(eventID, proto.dualWieldPenalty);\n\t\t\tthis.setSuppressDodge(eventID, proto.suppressDodge);\n\t\t\tthis.setParryHaste(eventID, proto.parryHaste);\n\t\t\tthis.setSpellSchool(eventID, proto.spellSchool);\n\t\t\tthis.setStats(eventID, new Stats(proto.stats));\n\t\t});\n\t}\n\n\tclone(eventID: EventID): Target {\n\t\tconst newTarget = new Target(this.sim);\n\t\tnewTarget.fromProto(eventID, this.toProto());\n\t\treturn newTarget;\n\t}\n\n\tstatic defaultProto(): TargetProto {\n\t\treturn TargetProto.create({\n\t\t\tlevel: Mechanics.BOSS_LEVEL,\n\t\t\tmobType: MobType.MobTypeUndead,\n\t\t\ttankIndex: 0,\n\t\t\tswingSpeed: 1.5,\n\t\t\tminBaseDamage: 30000,\n\t\t\tdualWield: true,\n\t\t\tdualWieldPenalty: false,\n\t\t\tsuppressDodge: false,\n\t\t\tparryHaste: true,\n\t\t\tspellSchool: SpellSchool.SpellSchoolPhysical,\n\t\t\tstats: Stats.fromMap({\n\t\t\t\t[Stat.StatArmor]: 10643,\n\t\t\t\t[Stat.StatAttackPower]: 640,\n\t\t\t}).asArray(),\n\t\t});\n\t}\n\n\tstatic fromDefaults(eventID: EventID, sim: Sim): Target {\n\t\tconst target = new Target(sim);\n\t\ttarget.fromProto(eventID, Target.defaultProto());\n\t\treturn target;\n\t}\n}\n","import { Encounter as EncounterProto } from './proto/common.js';\nimport { MobType } from './proto/common.js';\nimport { Stat } from './proto/common.js';\nimport { Target as TargetProto } from './proto/common.js';\nimport { PresetEncounter } from './proto/api.js';\nimport { PresetTarget } from './proto/api.js';\nimport { Target } from './target.js';\nimport { Stats } from './proto_utils/stats.js';\n\nimport { Sim } from './sim.js';\nimport { EventID, TypedEvent } from './typed_event.js';\n\n// Manages all the settings for an Encounter.\nexport class Encounter {\n\treadonly sim: Sim;\n\n\tprivate duration: number = 180;\n\tprivate durationVariation: number = 5;\n\tprivate executeProportion20: number = 0.2;\n\tprivate executeProportion25: number = 0.25;\n\tprivate executeProportion35: number = 0.35;\n\tprivate useHealth: boolean = false;\n\tprivate targets: Array<Target>;\n\n\treadonly targetsChangeEmitter = new TypedEvent<void>();\n\treadonly durationChangeEmitter = new TypedEvent<void>();\n\treadonly executeProportionChangeEmitter = new TypedEvent<void>();\n\n\t// Emits when any of the above emitters emit.\n\treadonly changeEmitter = new TypedEvent<void>();\n\n\tconstructor(sim: Sim) {\n\t\tthis.sim = sim;\n\t\tthis.targets = [Target.fromDefaults(TypedEvent.nextEventID(), sim)];\n\n\t\t[\n\t\t\tthis.targetsChangeEmitter,\n\t\t\tthis.durationChangeEmitter,\n\t\t\tthis.executeProportionChangeEmitter,\n\t\t].forEach(emitter => emitter.on(eventID => this.changeEmitter.emit(eventID)));\n\t}\n\n\tget primaryTarget(): Target {\n\t\treturn this.targets[0];\n\t}\n\n\tgetDurationVariation(): number {\n\t\treturn this.durationVariation;\n\t}\n\tsetDurationVariation(eventID: EventID, newDuration: number) {\n\t\tif (newDuration == this.durationVariation)\n\t\t\treturn;\n\n\t\tthis.durationVariation = newDuration;\n\t\tthis.durationChangeEmitter.emit(eventID);\n\t}\n\n\tgetDuration(): number {\n\t\treturn this.duration;\n\t}\n\tsetDuration(eventID: EventID, newDuration: number) {\n\t\tif (newDuration == this.duration)\n\t\t\treturn;\n\n\t\tthis.duration = newDuration;\n\t\tthis.durationChangeEmitter.emit(eventID);\n\t}\n\n\tgetExecuteProportion20(): number {\n\t\treturn this.executeProportion20;\n\t}\n\tsetExecuteProportion20(eventID: EventID, newExecuteProportion20: number) {\n\t\tif (newExecuteProportion20 == this.executeProportion20)\n\t\t\treturn;\n\n\t\tthis.executeProportion20 = newExecuteProportion20;\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\tgetExecuteProportion25(): number {\n\t\treturn this.executeProportion25;\n\t}\n\tsetExecuteProportion25(eventID: EventID, newExecuteProportion25: number) {\n\t\tif (newExecuteProportion25 == this.executeProportion25)\n\t\t\treturn;\n\n\t\tthis.executeProportion25 = newExecuteProportion25;\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\tgetExecuteProportion35(): number {\n\t\treturn this.executeProportion35;\n\t}\n\tsetExecuteProportion35(eventID: EventID, newExecuteProportion35: number) {\n\t\tif (newExecuteProportion35 == this.executeProportion35)\n\t\t\treturn;\n\n\t\tthis.executeProportion35 = newExecuteProportion35;\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\n\tgetUseHealth(): boolean {\n\t\treturn this.useHealth;\n\t}\n\tsetUseHealth(eventID: EventID, newUseHealth: boolean) {\n\t\tif (newUseHealth == this.useHealth)\n\t\t\treturn;\n\n\t\tthis.useHealth = newUseHealth;\n\t\tthis.durationChangeEmitter.emit(eventID);\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\n\tgetNumTargets(): number {\n\t\treturn this.targets.length;\n\t}\n\n\tgetTargets(): Array<Target> {\n\t\treturn this.targets.slice();\n\t}\n\tsetTargets(eventID: EventID, newTargets: Array<Target>) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tif (newTargets.length == 0) {\n\t\t\t\tnewTargets = [Target.fromDefaults(eventID, this.sim)];\n\t\t\t}\n\t\t\tif (newTargets.length == this.targets.length && newTargets.every((target, i) => TargetProto.equals(target.toProto(), this.targets[i].toProto()))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.targets = newTargets;\n\t\t\tthis.targetsChangeEmitter.emit(eventID);\n\t\t});\n\t}\n\n\tmatchesPreset(preset: PresetEncounter): boolean {\n\t\treturn preset.targets.length == this.targets.length && this.targets.every((t, i) => t.matchesPreset(preset.targets[i]));\n\t}\n\n\tapplyPreset(eventID: EventID, preset: PresetEncounter) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tlet newTargets = this.targets.slice(0, preset.targets.length);\n\t\t\twhile (newTargets.length < preset.targets.length) {\n\t\t\t\tnewTargets.push(new Target(this.sim));\n\t\t\t}\n\n\t\t\tnewTargets.forEach((nt, i) => nt.applyPreset(eventID, preset.targets[i]));\n\t\t\tthis.setTargets(eventID, newTargets);\n\t\t});\n\t}\n\n\ttoProto(): EncounterProto {\n\t\treturn EncounterProto.create({\n\t\t\tduration: this.duration,\n\t\t\tdurationVariation: this.durationVariation,\n\t\t\texecuteProportion20: this.executeProportion20,\n\t\t\texecuteProportion25: this.executeProportion25,\n\t\t\texecuteProportion35: this.executeProportion35,\n\t\t\tuseHealth: this.useHealth,\n\t\t\ttargets: this.targets.map(target => target.toProto()),\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: EncounterProto) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setDuration(eventID, proto.duration);\n\t\t\tthis.setDurationVariation(eventID, proto.durationVariation);\n\t\t\tthis.setExecuteProportion20(eventID, proto.executeProportion20);\n\t\t\tthis.setExecuteProportion25(eventID, proto.executeProportion25);\n\t\t\tthis.setExecuteProportion35(eventID, proto.executeProportion35);\n\t\t\tthis.setUseHealth(eventID, proto.useHealth);\n\n\t\t\tif (proto.targets.length > 0) {\n\t\t\t\tthis.setTargets(eventID, proto.targets.map(targetProto => {\n\t\t\t\t\tconst target = new Target(this.sim);\n\t\t\t\t\ttarget.fromProto(eventID, targetProto);\n\t\t\t\t\treturn target;\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tthis.setTargets(eventID, [Target.fromDefaults(eventID, this.sim)]);\n\t\t\t}\n\t\t});\n\t}\n\n\tapplyDefaults(eventID: EventID) {\n\t\tthis.fromProto(eventID, EncounterProto.create({\n\t\t\tduration: 180,\n\t\t\tdurationVariation: 5,\n\t\t\texecuteProportion20: 0.2,\n\t\t\texecuteProportion25: 0.25,\n\t\t\texecuteProportion35: 0.35,\n\t\t\ttargets: [Target.defaultProto()],\n\t\t}));\n\t}\n}\n","import { Class } from './proto/common.js';\nimport { Debuffs } from './proto/common.js';\nimport { RaidTarget } from './proto/common.js';\nimport { Raid as RaidProto } from './proto/api.js';\nimport { RaidStats as RaidStatsProto } from './proto/api.js';\nimport { RaidBuffs } from './proto/common.js';\nimport { Spec } from './proto/common.js';\nimport { NO_TARGET } from './proto_utils/utils.js';\n\nimport { Party, MAX_PARTY_SIZE } from './party.js';\nimport { Player } from './player.js';\nimport { EventID, TypedEvent } from './typed_event.js';\nimport { Sim } from './sim.js';\nimport { sum } from './utils.js';\n\nexport const MAX_NUM_PARTIES = 5;\n\n// Manages all the settings for a single Raid.\nexport class Raid {\n\tprivate buffs: RaidBuffs = RaidBuffs.create();\n\tprivate debuffs: Debuffs = Debuffs.create();\n\tprivate tanks: Array<RaidTarget> = [];\n\tprivate targetDummies: number = 0;\n\n\t// Emits when a raid member is added/removed/moved.\n\treadonly compChangeEmitter = new TypedEvent<void>();\n\n\treadonly buffsChangeEmitter = new TypedEvent<void>();\n\treadonly debuffsChangeEmitter = new TypedEvent<void>();\n\treadonly tanksChangeEmitter = new TypedEvent<void>();\n\treadonly targetDummiesChangeEmitter = new TypedEvent<void>();\n\n\t// Emits when anything in the raid changes.\n\treadonly changeEmitter: TypedEvent<void>;\n\n\t// Should always hold exactly MAX_NUM_PARTIES elements.\n\tprivate parties: Array<Party>;\n\n\treadonly sim: Sim;\n\n\tconstructor(sim: Sim) {\n\t\tthis.sim = sim;\n\n\t\tthis.parties = [...Array(MAX_NUM_PARTIES).keys()].map(i => {\n\t\t\tconst newParty = new Party(this, sim);\n\t\t\tnewParty.compChangeEmitter.on(eventID => this.compChangeEmitter.emit(eventID));\n\t\t\tnewParty.changeEmitter.on(eventID => this.changeEmitter.emit(eventID));\n\t\t\treturn newParty;\n\t\t});\n\n\t\tthis.changeEmitter = TypedEvent.onAny([\n\t\t\tthis.compChangeEmitter,\n\t\t\tthis.buffsChangeEmitter,\n\t\t\tthis.debuffsChangeEmitter,\n\t\t\tthis.tanksChangeEmitter,\n\t\t\tthis.targetDummiesChangeEmitter,\n\t\t], 'RaidChange');\n\t}\n\n\tsize(): number {\n\t\treturn sum(this.parties.map(party => party.size()));\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this.size() == 0;\n\t}\n\n\tgetParties(): Array<Party> {\n\t\t// Make defensive copy.\n\t\treturn this.parties.slice();\n\t}\n\n\tgetParty(index: number): Party {\n\t\treturn this.parties[index];\n\t}\n\n\tgetPlayers(): Array<Player<any> | null> {\n\t\treturn this.parties.map(party => party.getPlayers()).flat();\n\t}\n\n\tgetPlayer(index: number): Player<any> | null {\n\t\tconst party = this.parties[Math.floor(index / MAX_PARTY_SIZE)];\n\t\treturn party.getPlayer(index % MAX_PARTY_SIZE);\n\t}\n\n\tgetPlayerFromRaidTarget(raidTarget: RaidTarget): Player<any> | null {\n\t\tif (raidTarget.targetIndex == NO_TARGET) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn this.getPlayer(raidTarget.targetIndex);\n\t\t}\n\t}\n\n\tsetPlayer(eventID: EventID, index: number, newPlayer: Player<any> | null) {\n\t\tconst party = this.parties[Math.floor(index / MAX_PARTY_SIZE)];\n\t\tparty.setPlayer(eventID, index % MAX_PARTY_SIZE, newPlayer);\n\t}\n\n\tgetClassCount(playerClass: Class) {\n\t\treturn this.getPlayers().filter(player => player != null && player.getClass() == playerClass).length;\n\t}\n\n\tgetBuffs(): RaidBuffs {\n\t\t// Make a defensive copy\n\t\treturn RaidBuffs.clone(this.buffs);\n\t}\n\n\tsetBuffs(eventID: EventID, newBuffs: RaidBuffs) {\n\t\tif (RaidBuffs.equals(this.buffs, newBuffs))\n\t\t\treturn;\n\n\t\t// Make a defensive copy\n\t\tthis.buffs = RaidBuffs.clone(newBuffs);\n\n\t\t// Special handle ToW since it crosses buffs/debuffs.\n\t\tif (!this.debuffs.totemOfWrath && this.buffs.totemOfWrath) {\n\t\t\tvar newDebuff = Debuffs.clone(this.debuffs);\n\t\t\tnewDebuff.totemOfWrath = this.buffs.totemOfWrath;\n\t\t\tthis.setDebuffs(eventID, newDebuff);\n\t\t}\n\t\tthis.buffsChangeEmitter.emit(eventID);\n\t}\n\n\tgetDebuffs(): Debuffs {\n\t\t// Make a defensive copy\n\t\treturn Debuffs.clone(this.debuffs);\n\t}\n\n\tsetDebuffs(eventID: EventID, newDebuffs: Debuffs) {\n\t\tif (Debuffs.equals(this.debuffs, newDebuffs))\n\t\t\treturn;\n\n\t\t// Make a defensive copy\n\t\tthis.debuffs = Debuffs.clone(newDebuffs);\n\n\t\t// Special handle ToW since it crosses buffs/debuffs.\n\t\tif (this.debuffs.totemOfWrath && !this.buffs.totemOfWrath) {\n\t\t\tvar newBuffs = RaidBuffs.clone(this.buffs);\n\t\t\tnewBuffs.totemOfWrath = this.debuffs.totemOfWrath;\n\t\t\tthis.setBuffs(eventID, newBuffs);\n\t\t}\n\t\tthis.debuffsChangeEmitter.emit(eventID);\n\t}\n\n\tgetTanks(): Array<RaidTarget> {\n\t\t// Make a defensive copy\n\t\treturn this.tanks.map(tank => RaidTarget.clone(tank));\n\t}\n\n\tsetTanks(eventID: EventID, newTanks: Array<RaidTarget>) {\n\t\tif (this.tanks.length == newTanks.length && this.tanks.every((tank, i) => RaidTarget.equals(tank, newTanks[i])))\n\t\t\treturn;\n\n\t\t// Make a defensive copy\n\t\tthis.tanks = newTanks.map(tank => RaidTarget.clone(tank));\n\t\tthis.tanksChangeEmitter.emit(eventID);\n\t}\n\n\tgetTargetDummies(): number {\n\t\treturn this.targetDummies;\n\t}\n\n\tsetTargetDummies(eventID: EventID, newTargetDummies: number) {\n\t\tif (this.targetDummies == newTargetDummies)\n\t\t\treturn;\n\n\t\tthis.targetDummies = newTargetDummies;\n\t\tthis.targetDummiesChangeEmitter.emit(eventID);\n\t}\n\n\ttoProto(forExport?: boolean): RaidProto {\n\t\treturn RaidProto.create({\n\t\t\tparties: this.parties.map(party => party.toProto(forExport)),\n\t\t\tbuffs: this.getBuffs(),\n\t\t\tdebuffs: this.getDebuffs(),\n\t\t\ttanks: this.getTanks(),\n\t\t\ttargetDummies: this.getTargetDummies(),\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: RaidProto) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setBuffs(eventID, proto.buffs || RaidBuffs.create());\n\t\t\tthis.setDebuffs(eventID, proto.debuffs || Debuffs.create());\n\t\t\tthis.setTanks(eventID, proto.tanks);\n\t\t\tthis.setTargetDummies(eventID, proto.targetDummies);\n\n\t\t\tfor (let i = 0; i < MAX_NUM_PARTIES; i++) {\n\t\t\t\tif (proto.parties[i]) {\n\t\t\t\t\tthis.parties[i].fromProto(eventID, proto.parties[i]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.parties[i].clear(eventID);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tclear(eventID: EventID) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tfor (let i = 0; i < MAX_NUM_PARTIES; i++) {\n\t\t\t\tthis.parties[i].clear(eventID);\n\t\t\t}\n\t\t});\n\t}\n}\n","import { REPO_NAME } from './constants/other.js'\nimport { Enchant } from './proto/common.js';\nimport { Gem } from './proto/common.js';\nimport { GemColor } from './proto/common.js';\nimport { Item } from './proto/common.js';\nimport { ItemQuality } from './proto/common.js';\nimport { ItemSlot } from './proto/common.js';\nimport { ItemSpec } from './proto/common.js';\nimport { ItemType } from './proto/common.js';\nimport { Stat } from './proto/common.js';\n\nimport { ComputeStatsRequest, ComputeStatsResult } from './proto/api.js';\nimport { GearListRequest, GearListResult } from './proto/api.js';\nimport { RaidSimRequest, RaidSimResult, ProgressMetrics } from './proto/api.js';\nimport { StatWeightsRequest, StatWeightsResult } from './proto/api.js';\n\nimport { wait } from './utils.js';\n\nconst SIM_WORKER_URL = `/${REPO_NAME}/sim_worker.js`;\n\nexport class WorkerPool {\n\tprivate workers: Array<SimWorker>;\n\n\tconstructor(numWorkers: number) {\n\t\tthis.workers = [];\n\t\tfor (let i = 0; i < numWorkers; i++) {\n\t\t\tthis.workers.push(new SimWorker());\n\t\t}\n\t}\n\n\tprivate getLeastBusyWorker(): SimWorker {\n\t\treturn this.workers.reduce(\n\t\t\t(curMinWorker, nextWorker) => curMinWorker.numTasksRunning < nextWorker.numTasksRunning ?\n\t\t\t\tcurMinWorker : nextWorker);\n\t}\n\n\tasync makeApiCall(requestName: string, request: Uint8Array): Promise<Uint8Array> {\n\t\treturn await this.getLeastBusyWorker().doApiCall(requestName, request, \"\");\n\t}\n\n\tasync getGearList(request: GearListRequest): Promise<GearListResult> {\n\t\tconst result = await this.makeApiCall('gearList', GearListRequest.toBinary(request));\n\t\treturn GearListResult.fromBinary(result);\n\t}\n\n\tasync computeStats(request: ComputeStatsRequest): Promise<ComputeStatsResult> {\n\t\tconst result = await this.makeApiCall('computeStats', ComputeStatsRequest.toBinary(request));\n\t\treturn ComputeStatsResult.fromBinary(result);\n\t}\n\n\tasync statWeightsAsync(request: StatWeightsRequest, onProgress: Function): Promise<StatWeightsResult> {\n\t\tconsole.log('Stat weights request: ' + StatWeightsRequest.toJsonString(request));\n\t\tconst worker = this.getLeastBusyWorker();\n\t\tconst id = worker.makeTaskId();\n\t\t// Add handler for the progress events\n\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { })\n\n\t\t// Now start the async sim\n\t\tconst resultData = await worker.doApiCall('statWeightsAsync', StatWeightsRequest.toBinary(request), id);\n\t\tconst result = ProgressMetrics.fromBinary(resultData)\n\t\tconsole.log('Stat weights result: ' + StatWeightsResult.toJsonString(result.finalWeightResult!));\n\t\treturn result.finalWeightResult!;\n\t}\n\n\tasync raidSimAsync(request: RaidSimRequest, onProgress: Function): Promise<RaidSimResult> {\n\t\tconsole.log('Raid sim request: ' + RaidSimRequest.toJsonString(request));\n\t\tconst worker = this.getLeastBusyWorker();\n\t\tconst id = worker.makeTaskId();\n\t\t// Add handler for the progress events\n\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { })\n\n\t\t// Now start the async sim\n\t\tconst resultData = await worker.doApiCall('raidSimAsync', RaidSimRequest.toBinary(request), id);\n\t\tconst result = ProgressMetrics.fromBinary(resultData)\n\n\t\t// Don't print the logs because it just clogs the console.\n\t\tconst resultJson = RaidSimResult.toJson(result.finalRaidResult!) as any;\n\t\tdelete resultJson!['logs'];\n\t\tconsole.log('Raid sim result: ' + JSON.stringify(resultJson));\n\t\treturn result.finalRaidResult!;\n\t}\n\n\tnewProgressHandler(id: string, worker: SimWorker, onProgress: Function): (progressData: any) => void {\n\t\treturn (progressData: any) => {\n\t\t\tvar progress = ProgressMetrics.fromBinary(progressData);\n\t\t\tonProgress(progress);\n\t\t\t// If we are done, stop adding the handler.\n\t\t\tif (progress.finalRaidResult != null || progress.finalWeightResult != null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { });\n\t\t};\n\t}\n}\n\nclass SimWorker {\n\tnumTasksRunning: number;\n\tprivate taskIdsToPromiseFuncs: Record<string, [(result: any) => void, (error: any) => void]>;\n\tprivate worker: Worker;\n\tprivate onReady: Promise<void>;\n\n\tconstructor() {\n\t\tthis.numTasksRunning = 0;\n\t\tthis.taskIdsToPromiseFuncs = {};\n\t\tthis.worker = new window.Worker(SIM_WORKER_URL);\n\n\t\tlet resolveReady: (() => void) | null = null;\n\t\tthis.onReady = new Promise((_resolve, _reject) => {\n\t\t\tresolveReady = _resolve;\n\t\t});\n\n\t\tthis.worker.onmessage = event => {\n\t\t\tif (event.data.msg == 'ready') {\n\t\t\t\tthis.worker.postMessage({ msg: 'setID', id: '1' });\n\t\t\t\tresolveReady!();\n\t\t\t} else if (event.data.msg == 'idconfirm') {\n\t\t\t\t// Do nothing\n\t\t\t} else {\n\t\t\t\tconst id = event.data.id;\n\t\t\t\tif (!this.taskIdsToPromiseFuncs[id]) {\n\t\t\t\t\tconsole.warn('Unrecognized result id: ' + id);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst promiseFuncs = this.taskIdsToPromiseFuncs[id];\n\t\t\t\tdelete this.taskIdsToPromiseFuncs[id];\n\t\t\t\tthis.numTasksRunning--;\n\n\t\t\t\tpromiseFuncs[0](event.data.outputData);\n\t\t\t}\n\t\t};\n\t}\n\n\taddPromiseFunc(id: string, callback: (result: any) => void, onError: (error: any) => void) {\n\t\tthis.taskIdsToPromiseFuncs[id] = [callback, onError];\n\t}\n\n\tmakeTaskId(): string {\n\t\tlet id = '';\n\t\tconst characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\t\tfor (let i = 0; i < 16; i++) {\n\t\t\tid += characters.charAt(Math.floor(Math.random() * characters.length));\n\t\t}\n\t\treturn id;\n\t}\n\n\tasync doApiCall(requestName: string, request: Uint8Array, id: string): Promise<Uint8Array> {\n\t\tthis.numTasksRunning++;\n\t\tawait this.onReady;\n\n\t\tconst taskPromise = new Promise<Uint8Array>((resolve, reject) => {\n\t\t\tif (!id) {\n\t\t\t\tid = this.makeTaskId();\n\t\t\t}\n\t\t\tthis.taskIdsToPromiseFuncs[id] = [resolve, reject];\n\n\t\t\tthis.worker.postMessage({\n\t\t\t\tmsg: requestName,\n\t\t\t\tid: id,\n\t\t\t\tinputData: request,\n\t\t\t});\n\t\t});\n\t\treturn await taskPromise;\n\t}\n}\n","import { Class, Faction } from './proto/common.js';\nimport { Consumes } from './proto/common.js';\nimport { Enchant } from './proto/common.js';\nimport { Encounter as EncounterProto } from './proto/common.js';\nimport { EquipmentSpec } from './proto/common.js';\nimport { Gem } from './proto/common.js';\nimport { GemColor } from './proto/common.js';\nimport { ItemQuality } from './proto/common.js';\nimport { ItemSlot } from './proto/common.js';\nimport { ItemSpec } from './proto/common.js';\nimport { ItemType } from './proto/common.js';\nimport { Item } from './proto/common.js';\nimport { Profession } from './proto/common.js';\nimport { Race } from './proto/common.js';\nimport { RaidTarget } from './proto/common.js';\nimport { Spec } from './proto/common.js';\nimport { Stat } from './proto/common.js';\nimport { Raid as RaidProto } from './proto/api.js';\nimport { PresetEncounter, PresetTarget } from './proto/api.js';\nimport { ComputeStatsRequest, ComputeStatsResult } from './proto/api.js';\nimport { GearListRequest, GearListResult } from './proto/api.js';\nimport { RaidSimRequest, RaidSimResult } from './proto/api.js';\nimport { SimOptions } from './proto/api.js';\nimport { StatWeightsRequest, StatWeightsResult } from './proto/api.js';\nimport { SimSettings as SimSettingsProto } from './proto/ui.js';\n\nimport { EquippedItem } from './proto_utils/equipped_item.js';\nimport { Gear } from './proto_utils/gear.js';\nimport { SimResult } from './proto_utils/sim_result.js';\nimport { Stats } from './proto_utils/stats.js';\nimport { gemEligibleForSocket } from './proto_utils/gems.js';\nimport { gemMatchesSocket } from './proto_utils/gems.js';\nimport { SpecRotation } from './proto_utils/utils.js';\nimport { SpecTalents } from './proto_utils/utils.js';\nimport { SpecTypeFunctions } from './proto_utils/utils.js';\nimport { specTypeFunctions } from './proto_utils/utils.js';\nimport { SpecOptions } from './proto_utils/utils.js';\nimport { specToClass } from './proto_utils/utils.js';\nimport { specToEligibleRaces } from './proto_utils/utils.js';\nimport { getEligibleItemSlots } from './proto_utils/utils.js';\nimport { getEligibleEnchantSlots } from './proto_utils/utils.js';\nimport { playerToSpec } from './proto_utils/utils.js';\n\nimport { Encounter } from './encounter.js';\nimport { Player } from './player.js';\nimport { Raid } from './raid.js';\nimport { Listener } from './typed_event.js';\nimport { EventID, TypedEvent } from './typed_event.js';\nimport { sum } from './utils.js';\nimport { wait } from './utils.js';\nimport { WorkerPool } from './worker_pool.js';\n\nimport * as OtherConstants from './constants/other.js';\n\nexport type RaidSimData = {\n\trequest: RaidSimRequest,\n\tresult: RaidSimResult,\n};\n\nexport type StatWeightsData = {\n\trequest: StatWeightsRequest,\n\tresult: StatWeightsResult,\n};\n\n// Core Sim module which deals only with api types, no UI-related stuff.\nexport class Sim {\n\tprivate readonly workerPool: WorkerPool;\n\n\tprivate iterations: number = 3000;\n\tprivate phase: number = OtherConstants.CURRENT_PHASE;\n\tprivate faction: Faction = Faction.Alliance;\n\tprivate fixedRngSeed: number = 0;\n\tprivate show1hWeapons: boolean = true;\n\tprivate show2hWeapons: boolean = true;\n\tprivate showMatchingGems: boolean = true;\n\tprivate showDamageMetrics: boolean = true;\n\tprivate showThreatMetrics: boolean = false;\n\tprivate showHealingMetrics: boolean = false;\n\tprivate showExperimental: boolean = false;\n\n\treadonly raid: Raid;\n\treadonly encounter: Encounter;\n\n\t// Database\n\tprivate items: Record<number, Item> = {};\n\tprivate enchants: Enchant[] = [];\n\tprivate gems: Record<number, Gem> = {};\n\tprivate presetEncounters: Record<string, PresetEncounter> = {};\n\tprivate presetTargets: Record<string, PresetTarget> = {};\n\n\treadonly iterationsChangeEmitter = new TypedEvent<void>();\n\treadonly phaseChangeEmitter = new TypedEvent<void>();\n\treadonly factionChangeEmitter = new TypedEvent<void>();\n\treadonly fixedRngSeedChangeEmitter = new TypedEvent<void>();\n\treadonly lastUsedRngSeedChangeEmitter = new TypedEvent<void>();\n\treadonly show1hWeaponsChangeEmitter = new TypedEvent<void>();\n\treadonly show2hWeaponsChangeEmitter = new TypedEvent<void>();\n\treadonly showMatchingGemsChangeEmitter = new TypedEvent<void>();\n\treadonly showDamageMetricsChangeEmitter = new TypedEvent<void>();\n\treadonly showThreatMetricsChangeEmitter = new TypedEvent<void>();\n\treadonly showHealingMetricsChangeEmitter = new TypedEvent<void>();\n\treadonly showExperimentalChangeEmitter = new TypedEvent<void>();\n\treadonly crashEmitter = new TypedEvent<SimError>();\n\n\t// Emits when any of the settings change (but not the raid / encounter).\n\treadonly settingsChangeEmitter: TypedEvent<void>;\n\n\t// Emits when any of the above emitters emit.\n\treadonly changeEmitter: TypedEvent<void>;\n\n\t// Fires when a raid sim API call completes.\n\treadonly simResultEmitter = new TypedEvent<SimResult>();\n\n\tprivate readonly _initPromise: Promise<void>;\n\tprivate lastUsedRngSeed: number = 0;\n\n\t// These callbacks are needed so we can apply BuffBot modifications automatically before sending requests.\n\tprivate modifyRaidProto: ((raidProto: RaidProto) => void) = () => { };\n\n\tconstructor() {\n\t\tthis.workerPool = new WorkerPool(3);\n\n\t\tthis._initPromise = this.workerPool.getGearList(GearListRequest.create()).then(result => {\n\t\t\tresult.items.forEach(item => this.items[item.id] = item);\n\t\t\t// result.enchants.forEach(enchant => this.enchants[enchant.id] = enchant);\n\t\t\tthis.enchants = result.enchants;\n\t\t\tresult.gems.forEach(gem => this.gems[gem.id] = gem);\n\t\t\tresult.encounters.forEach(encounter => this.presetEncounters[encounter.path] = encounter);\n\t\t\tresult.encounters.map(e => e.targets).flat().forEach(target => this.presetTargets[target.path] = target);\n\t\t});\n\n\t\tthis.raid = new Raid(this);\n\t\tthis.encounter = new Encounter(this);\n\n\t\tthis.settingsChangeEmitter = TypedEvent.onAny([\n\t\t\tthis.iterationsChangeEmitter,\n\t\t\tthis.phaseChangeEmitter,\n\t\t\tthis.fixedRngSeedChangeEmitter,\n\t\t\tthis.show1hWeaponsChangeEmitter,\n\t\t\tthis.show2hWeaponsChangeEmitter,\n\t\t\tthis.showMatchingGemsChangeEmitter,\n\t\t\tthis.showDamageMetricsChangeEmitter,\n\t\t\tthis.showThreatMetricsChangeEmitter,\n\t\t\tthis.showHealingMetricsChangeEmitter,\n\t\t\tthis.showExperimentalChangeEmitter,\n\t\t]);\n\n\t\tthis.changeEmitter = TypedEvent.onAny([\n\t\t\tthis.settingsChangeEmitter,\n\t\t\tthis.raid.changeEmitter,\n\t\t\tthis.encounter.changeEmitter,\n\t\t]);\n\n\t\tthis.raid.changeEmitter.on(eventID => this.updateCharacterStats(eventID));\n\t}\n\n\twaitForInit(): Promise<void> {\n\t\treturn this._initPromise;\n\t}\n\n\tsetModifyRaidProto(newModFn: (raidProto: RaidProto) => void) {\n\t\tthis.modifyRaidProto = newModFn;\n\t}\n\tgetModifiedRaidProto(): RaidProto {\n\t\tconst raidProto = this.raid.toProto();\n\t\tthis.modifyRaidProto(raidProto);\n\n\t\t// Remove any inactive meta gems, since the backend doesn't have its own validation.\n\t\traidProto.parties.forEach(party => {\n\t\t\tparty.players.forEach(player => {\n\t\t\t\tif (!player.equipment) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet gear = this.lookupEquipmentSpec(player.equipment);\n\t\t\t\tlet gearChanged = false;\n\n\t\t\t\tconst isBlacksmith = [player.profession1, player.profession2].includes(Profession.Blacksmithing);\n\n\t\t\t\t// Disable meta gem if inactive.\n\t\t\t\tif (gear.hasInactiveMetaGem(isBlacksmith)) {\n\t\t\t\t\tgear = gear.withoutMetaGem();\n\t\t\t\t\tgearChanged = true;\n\t\t\t\t}\n\n\t\t\t\t// Remove bonus sockets if not blacksmith.\n\t\t\t\tif (!isBlacksmith) {\n\t\t\t\t\tgear = gear.withoutBlacksmithSockets();\n\t\t\t\t\tgearChanged = true;\n\t\t\t\t}\n\n\t\t\t\tif (gearChanged) {\n\t\t\t\t\tplayer.equipment = gear.asSpec();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn raidProto;\n\t}\n\n\tprivate makeRaidSimRequest(debug: boolean): RaidSimRequest {\n\t\tconst raid = this.getModifiedRaidProto();\n\t\tconst encounter = this.encounter.toProto();\n\n\t\t// TODO: remove any replenishment from sim request here? probably makes more sense to do it inside the sim to protect against accidents\n\n\t\treturn RaidSimRequest.create({\n\t\t\traid: raid,\n\t\t\tencounter: encounter,\n\t\t\tsimOptions: SimOptions.create({\n\t\t\t\titerations: debug ? 1 : this.getIterations(),\n\t\t\t\trandomSeed: BigInt(this.nextRngSeed()),\n\t\t\t\tdebugFirstIteration: true,\n\t\t\t}),\n\t\t});\n\t}\n\n\tasync runRaidSim(eventID: EventID, onProgress: Function) {\n\t\tif (this.raid.isEmpty()) {\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\n\t\t} else if (this.encounter.getNumTargets() < 1) {\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\n\t\t}\n\n\t\tawait this.waitForInit();\n\n\t\tconst request = this.makeRaidSimRequest(false);\n\n\t\tvar result = await this.workerPool.raidSimAsync(request, onProgress);\n\t\tif (result.errorResult != \"\") {\n\t\t\tthrow new SimError(result.errorResult);\n\t\t}\n\t\tconst simResult = await SimResult.makeNew(request, result);\n\t\tthis.simResultEmitter.emit(eventID, simResult);\n\t}\n\n\tasync runRaidSimWithLogs(eventID: EventID): Promise<SimResult> {\n\t\tif (this.raid.isEmpty()) {\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\n\t\t} else if (this.encounter.getNumTargets() < 1) {\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\n\t\t}\n\n\t\tawait this.waitForInit();\n\n\t\tconst request = this.makeRaidSimRequest(true);\n\t\tconst result = await this.workerPool.raidSimAsync(request, () => { });\n\t\tif (result.errorResult != \"\") {\n\t\t\tthrow new SimError(result.errorResult);\n\t\t}\n\t\tconst simResult = await SimResult.makeNew(request, result);\n\t\tthis.simResultEmitter.emit(eventID, simResult);\n\t\treturn simResult;\n\t}\n\n\t// This should be invoked internally whenever stats might have changed.\n\tprivate async updateCharacterStats(eventID: EventID) {\n\t\tif (eventID == 0) {\n\t\t\t// Skip the first event ID because it interferes with the loaded stats.\n\t\t\treturn;\n\t\t}\n\t\teventID = TypedEvent.nextEventID();\n\n\t\tawait this.waitForInit();\n\n\t\t// Capture the current players so we avoid issues if something changes while\n\t\t// request is in-flight.\n\t\tconst players = this.raid.getPlayers();\n\n\t\tconst req = ComputeStatsRequest.create({ raid: this.getModifiedRaidProto() });\n\t\tconst result = await this.workerPool.computeStats(req);\n\n\t\tif (result.errorResult != \"\") {\n\t\t\tthis.crashEmitter.emit(eventID, new SimError(result.errorResult));\n\t\t\treturn;\n\t\t}\n\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tresult.raidStats!.parties\n\t\t\t\t.forEach((partyStats, partyIndex) =>\n\t\t\t\t\tpartyStats.players.forEach((playerStats, playerIndex) =>\n\t\t\t\t\t\tplayers[partyIndex * 5 + playerIndex]?.setCurrentStats(eventID, playerStats)));\n\t\t});\n\t}\n\n\tasync statWeights(player: Player<any>, epStats: Array<Stat>, epReferenceStat: Stat, onProgress: Function): Promise<StatWeightsResult> {\n\t\tif (this.raid.isEmpty()) {\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\n\t\t} else if (this.encounter.getNumTargets() < 1) {\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\n\t\t}\n\n\t\tawait this.waitForInit();\n\n\t\tif (player.getParty() == null) {\n\t\t\tconsole.warn('Trying to get stat weights without a party!');\n\t\t\treturn StatWeightsResult.create();\n\t\t} else {\n\t\t\tconst tanks = this.raid.getTanks().map(tank => tank.targetIndex).includes(player.getRaidIndex())\n\t\t\t\t? [RaidTarget.create({ targetIndex: 0 })]\n\t\t\t\t: [];\n\t\t\tconst request = StatWeightsRequest.create({\n\t\t\t\tplayer: player.toProto(),\n\t\t\t\traidBuffs: this.raid.getBuffs(),\n\t\t\t\tpartyBuffs: player.getParty()!.getBuffs(),\n\t\t\t\tdebuffs: this.raid.getDebuffs(),\n\t\t\t\tencounter: this.encounter.toProto(),\n\t\t\t\tsimOptions: SimOptions.create({\n\t\t\t\t\titerations: this.getIterations(),\n\t\t\t\t\trandomSeed: BigInt(this.nextRngSeed()),\n\t\t\t\t\tdebug: false,\n\t\t\t\t}),\n\t\t\t\ttanks: tanks,\n\n\t\t\t\tstatsToWeigh: epStats,\n\t\t\t\tepReferenceStat: epReferenceStat,\n\t\t\t});\n\t\t\tvar result = await this.workerPool.statWeightsAsync(request, onProgress);\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tgetItems(slot: ItemSlot | undefined): Array<Item> {\n\t\tlet items = Object.values(this.items);\n\t\tif (slot != undefined) {\n\t\t\titems = items.filter(item => getEligibleItemSlots(item).includes(slot));\n\t\t}\n\t\treturn items;\n\t}\n\n\tgetEnchants(slot: ItemSlot | undefined): Array<Enchant> {\n\t\tlet enchants = Object.values(this.enchants);\n\t\tif (slot != undefined) {\n\t\t\tenchants = enchants.filter(enchant => getEligibleEnchantSlots(enchant).includes(slot));\n\t\t}\n\t\treturn enchants;\n\t}\n\n\t// ID can be the formula ID OR the effect ID.\n\tgetEnchantFlexible(id: number): Enchant | null {\n\t\treturn Object.values(this.enchants).find(enchant => enchant.id == id || enchant.effectId == id) || null;\n\t}\n\n\tgetGems(socketColor?: GemColor): Array<Gem> {\n\t\tlet gems = Object.values(this.gems);\n\t\tif (socketColor) {\n\t\t\tgems = gems.filter(gem => gemEligibleForSocket(gem, socketColor));\n\t\t}\n\t\treturn gems;\n\t}\n\n\tgetMatchingGems(socketColor: GemColor): Array<Gem> {\n\t\treturn Object.values(this.gems).filter(gem => gemMatchesSocket(gem, socketColor));\n\t}\n\n\tgetPresetEncounter(path: string): PresetEncounter | null {\n\t\treturn this.presetEncounters[path] || null;\n\t}\n\tgetPresetTarget(path: string): PresetTarget | null {\n\t\treturn this.presetTargets[path] || null;\n\t}\n\tgetAllPresetEncounters(): Array<PresetEncounter> {\n\t\treturn Object.values(this.presetEncounters);\n\t}\n\tgetAllPresetTargets(): Array<PresetTarget> {\n\t\treturn Object.values(this.presetTargets);\n\t}\n\n\tgetPhase(): number {\n\t\treturn this.phase;\n\t}\n\tsetPhase(eventID: EventID, newPhase: number) {\n\t\tif (newPhase != this.phase && newPhase > 0) {\n\t\t\tthis.phase = newPhase;\n\t\t\tthis.phaseChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetFaction(): Faction {\n\t\treturn this.faction;\n\t}\n\tsetFaction(eventID: EventID, newFaction: Faction) {\n\t\tif (newFaction != this.faction && !!newFaction) {\n\t\t\tthis.faction = newFaction;\n\t\t\tthis.factionChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetFixedRngSeed(): number {\n\t\treturn this.fixedRngSeed;\n\t}\n\tsetFixedRngSeed(eventID: EventID, newFixedRngSeed: number) {\n\t\tif (newFixedRngSeed != this.fixedRngSeed) {\n\t\t\tthis.fixedRngSeed = newFixedRngSeed;\n\t\t\tthis.fixedRngSeedChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tstatic MAX_RNG_SEED = Math.pow(2, 32) - 1;\n\tprivate nextRngSeed(): number {\n\t\tlet rngSeed = 0;\n\t\tif (this.fixedRngSeed) {\n\t\t\trngSeed = this.fixedRngSeed;\n\t\t} else {\n\t\t\trngSeed = Math.floor(Math.random() * Sim.MAX_RNG_SEED);\n\t\t}\n\n\t\tthis.lastUsedRngSeed = rngSeed;\n\t\tthis.lastUsedRngSeedChangeEmitter.emit(TypedEvent.nextEventID());\n\t\treturn rngSeed;\n\t}\n\tgetLastUsedRngSeed(): number {\n\t\treturn this.lastUsedRngSeed;\n\t}\n\n\n\tgetShow1hWeapons(): boolean {\n\t\treturn this.show1hWeapons;\n\t}\n\tsetShow1hWeapons(eventID: EventID, newShow1hWeapons: boolean) {\n\t\tif (newShow1hWeapons != this.show1hWeapons) {\n\t\t\tthis.show1hWeapons = newShow1hWeapons;\n\t\t\tthis.show1hWeaponsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShow2hWeapons(): boolean {\n\t\treturn this.show2hWeapons;\n\t}\n\tsetShow2hWeapons(eventID: EventID, newShow2hWeapons: boolean) {\n\t\tif (newShow2hWeapons != this.show2hWeapons) {\n\t\t\tthis.show2hWeapons = newShow2hWeapons;\n\t\t\tthis.show2hWeaponsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowMatchingGems(): boolean {\n\t\treturn this.showMatchingGems;\n\t}\n\tsetShowMatchingGems(eventID: EventID, newShowMatchingGems: boolean) {\n\t\tif (newShowMatchingGems != this.showMatchingGems) {\n\t\t\tthis.showMatchingGems = newShowMatchingGems;\n\t\t\tthis.showMatchingGemsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowDamageMetrics(): boolean {\n\t\treturn this.showDamageMetrics;\n\t}\n\tsetShowDamageMetrics(eventID: EventID, newShowDamageMetrics: boolean) {\n\t\tif (newShowDamageMetrics != this.showDamageMetrics) {\n\t\t\tthis.showDamageMetrics = newShowDamageMetrics;\n\t\t\tthis.showDamageMetricsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowThreatMetrics(): boolean {\n\t\treturn this.showThreatMetrics;\n\t}\n\tsetShowThreatMetrics(eventID: EventID, newShowThreatMetrics: boolean) {\n\t\tif (newShowThreatMetrics != this.showThreatMetrics) {\n\t\t\tthis.showThreatMetrics = newShowThreatMetrics;\n\t\t\tthis.showThreatMetricsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowHealingMetrics(): boolean {\n\t\treturn this.showHealingMetrics;\n\t}\n\tsetShowHealingMetrics(eventID: EventID, newShowHealingMetrics: boolean) {\n\t\tif (newShowHealingMetrics != this.showHealingMetrics) {\n\t\t\tthis.showHealingMetrics = newShowHealingMetrics;\n\t\t\tthis.showHealingMetricsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowExperimental(): boolean {\n\t\treturn this.showExperimental;\n\t}\n\tsetShowExperimental(eventID: EventID, newShowExperimental: boolean) {\n\t\tif (newShowExperimental != this.showExperimental) {\n\t\t\tthis.showExperimental = newShowExperimental;\n\t\t\tthis.showExperimentalChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetIterations(): number {\n\t\treturn this.iterations;\n\t}\n\tsetIterations(eventID: EventID, newIterations: number) {\n\t\tif (newIterations != this.iterations) {\n\t\t\tthis.iterations = newIterations;\n\t\t\tthis.iterationsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tlookupItemSpec(itemSpec: ItemSpec): EquippedItem | null {\n\t\tconst item = this.items[itemSpec.id];\n\t\tif (!item)\n\t\t\treturn null;\n\n\t\tconst enchant = itemSpec.enchant > 0 ? this.enchants.find(e => (e.id == itemSpec.enchant && e.type == item.type)) : null;\n\t\tconst gems = itemSpec.gems.map(gemId => this.gems[gemId] || null);\n\n\t\treturn new EquippedItem(item, enchant, gems);\n\t}\n\n\tlookupEquipmentSpec(equipSpec: EquipmentSpec): Gear {\n\t\t// EquipmentSpec is supposed to be indexed by slot, but here we assume\n\t\t// it isn't just in case.\n\t\tconst gearMap: Partial<Record<ItemSlot, EquippedItem | null>> = {};\n\n\t\tequipSpec.items.forEach(itemSpec => {\n\t\t\tconst item = this.lookupItemSpec(itemSpec);\n\t\t\tif (!item)\n\t\t\t\treturn;\n\n\t\t\tconst itemSlots = getEligibleItemSlots(item.item);\n\n\t\t\tconst assignedSlot = itemSlots.find(slot => !gearMap[slot]);\n\t\t\tif (assignedSlot == null)\n\t\t\t\tthrow new Error('No slots left to equip ' + Item.toJsonString(item.item));\n\n\t\t\tgearMap[assignedSlot] = item;\n\t\t});\n\n\t\treturn new Gear(gearMap);\n\t}\n\n\ttoProto(): SimSettingsProto {\n\t\treturn SimSettingsProto.create({\n\t\t\titerations: this.getIterations(),\n\t\t\tphase: this.getPhase(),\n\t\t\tfixedRngSeed: BigInt(this.getFixedRngSeed()),\n\t\t\tshowDamageMetrics: this.getShowDamageMetrics(),\n\t\t\tshowThreatMetrics: this.getShowThreatMetrics(),\n\t\t\tshowHealingMetrics: this.getShowHealingMetrics(),\n\t\t\tshowExperimental: this.getShowExperimental(),\n\t\t\tfaction: this.getFaction(),\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: SimSettingsProto) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setIterations(eventID, proto.iterations || 3000);\n\t\t\tthis.setPhase(eventID, proto.phase || OtherConstants.CURRENT_PHASE);\n\t\t\tthis.setFixedRngSeed(eventID, Number(proto.fixedRngSeed));\n\t\t\tthis.setShowDamageMetrics(eventID, proto.showDamageMetrics);\n\t\t\tthis.setShowThreatMetrics(eventID, proto.showThreatMetrics);\n\t\t\tthis.setShowHealingMetrics(eventID, proto.showHealingMetrics);\n\t\t\tthis.setShowExperimental(eventID, proto.showExperimental);\n\t\t\tthis.setFaction(eventID, proto.faction || Faction.Alliance)\n\t\t});\n\t}\n\n\tapplyDefaults(eventID: EventID, isTankSim: boolean, isHealingSim: boolean) {\n\t\tthis.fromProto(eventID, SimSettingsProto.create({\n\t\t\titerations: 3000,\n\t\t\tphase: OtherConstants.CURRENT_PHASE,\n\t\t\tfaction: Faction.Alliance,\n\t\t\tshowDamageMetrics: !isHealingSim,\n\t\t\tshowThreatMetrics: isTankSim,\n\t\t\tshowHealingMetrics: isHealingSim,\n\t\t}));\n\t}\n}\n\nexport class SimError extends Error {\n\treadonly errorStr: string;\n\n\tconstructor(errorStr: string) {\n\t\tsuper(errorStr);\n\t\tthis.errorStr = errorStr;\n\t}\n}\n","import { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Input, InputConfig } from './input.js';\n\n/**\n * Data for creating a number picker.\n */\nexport interface NumberPickerConfig<ModObject> extends InputConfig<ModObject, number> {\n\tfloat?: boolean,\n\tpositive?: boolean,\n}\n\n// UI element for picking an arbitrary number field.\nexport class NumberPicker<ModObject> extends Input<ModObject, number> {\n\tprivate readonly inputElem: HTMLInputElement;\n\tprivate float: boolean;\n\tprivate positive: boolean;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: NumberPickerConfig<ModObject>) {\n\t\tsuper(parent, 'number-picker-root', modObject, config);\n\t\tthis.float = config.float || false;\n\t\tthis.positive = config.positive || false;\n\n\t\tthis.inputElem = document.createElement('input');\n\t\tif (this.float) {\n\t\t\tthis.inputElem.type = 'text';\n\t\t\tthis.inputElem.inputMode = 'numeric';\n\t\t} else {\n\t\t\tthis.inputElem.type = 'number';\n\t\t\tif (this.positive) {\n\t\t\t\tthis.inputElem.min = \"0\"\n\t\t\t\tthis.inputElem.onchange = e => {\n\t\t\t\t\tthis.inputElem.value = Math.abs(parseInt(this.inputElem.value)).toString()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.inputElem.classList.add('number-picker-input');\n\t\tthis.rootElem.appendChild(this.inputElem);\n\n\t\tthis.init();\n\n\t\tthis.inputElem.addEventListener('change', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.inputElem;\n\t}\n\n\tgetInputValue(): number {\n\t\tif (this.float) {\n\t\t\treturn parseFloat(this.inputElem.value || '') || 0;\n\t\t} else {\n\t\t\treturn parseInt(this.inputElem.value || '') || 0;\n\t\t}\n\t}\n\n\tsetInputValue(newValue: number) {\n\t\tthis.inputElem.value = String(newValue);\n\t}\n}\n","import { Stat } from '../proto/common.js';\nimport { statNames, statOrder } from '../proto_utils/names.js';\nimport { Stats } from '../proto_utils/stats.js';\nimport { Player } from '../player.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Component } from './component.js';\nimport { NumberPicker } from './number_picker.js';\n\ndeclare var tippy: any;\n\nexport class BonusStatsPicker extends Component {\n\treadonly stats: Array<Stat>;\n\treadonly statPickers: Array<NumberPicker<Player<any>>>;\n\n\tconstructor(parent: HTMLElement, player: Player<any>, stats: Array<Stat>) {\n\t\tsuper(parent, 'bonus-stats-root');\n\t\tthis.stats = stats;\n\n\t\tconst label = document.createElement('span');\n\t\tlabel.classList.add('bonus-stats-label');\n\t\tlabel.textContent = 'Bonus Stats';\n\t\ttippy(label, {\n\t\t\t'content': 'Extra stats to add on top of gear, buffs, etc.',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\tthis.rootElem.appendChild(label);\n\n\t\tthis.statPickers = statOrder.filter(stat => this.stats.includes(stat)).map(stat => new NumberPicker(this.rootElem, player, {\n\t\t\tlabel: statNames[stat],\n\t\t\tchangedEvent: (player: Player<any>) => player.bonusStatsChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getBonusStats().getStat(stat),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\tconst bonusStats = player.getBonusStats().withStat(stat, newValue);\n\t\t\t\tplayer.setBonusStats(eventID, bonusStats);\n\t\t\t},\n\t\t}));\n\n\t\tplayer.bonusStatsChangeEmitter.on(() => {\n\t\t\tthis.statPickers.forEach(statPicker => {\n\t\t\t\tif (statPicker.getInputValue() > 0) {\n\t\t\t\t\tstatPicker.rootElem.classList.remove('negative');\n\t\t\t\t\tstatPicker.rootElem.classList.add('positive');\n\t\t\t\t} else if (statPicker.getInputValue() < 0) {\n\t\t\t\t\tstatPicker.rootElem.classList.remove('positive');\n\t\t\t\t\tstatPicker.rootElem.classList.add('negative');\n\t\t\t\t} else {\n\t\t\t\t\tstatPicker.rootElem.classList.remove('negative');\n\t\t\t\t\tstatPicker.rootElem.classList.remove('positive');\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n","import { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Input, InputConfig } from './input.js';\n\n/**\n * Data for creating a boolean picker (checkbox).\n */\nexport interface BooleanPickerConfig<ModObject> extends InputConfig<ModObject, boolean> {\n}\n\n// UI element for picking an arbitrary number field.\nexport class BooleanPicker<ModObject> extends Input<ModObject, boolean> {\n\tprivate readonly inputElem: HTMLInputElement;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: BooleanPickerConfig<ModObject>) {\n\t\tsuper(parent, 'boolean-picker-root', modObject, config);\n\n\t\tthis.inputElem = document.createElement('input');\n\t\tthis.inputElem.type = 'checkbox';\n\t\tthis.inputElem.classList.add('boolean-picker-input');\n\t\tthis.rootElem.appendChild(this.inputElem);\n\n\t\tthis.init();\n\n\t\tthis.inputElem.addEventListener('change', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.inputElem;\n\t}\n\n\tgetInputValue(): boolean {\n\t\treturn Boolean(this.inputElem.checked);\n\t}\n\n\tsetInputValue(newValue: boolean) {\n\t\tthis.inputElem.checked = newValue;\n\t}\n}\n","import { PlayerStats } from '..//proto/api.js';\nimport { Stat, Class } from '..//proto/common.js';\nimport { TristateEffect } from '..//proto/common.js'\nimport { statNames, statOrder } from '..//proto_utils/names.js';\nimport { Stats } from '..//proto_utils/stats.js';\nimport { Player } from '..//player.js';\nimport { EventID, TypedEvent } from '..//typed_event.js';\n\nimport * as Mechanics from '../constants/mechanics.js';\n\nimport { Component } from './component.js';\n\ndeclare var tippy: any;\n\nexport type StatMods = { talents: Stats };\n\nexport class CharacterStats extends Component {\n\treadonly stats: Array<Stat>;\n\treadonly valueElems: Array<HTMLTableCellElement>;\n\treadonly tooltipElems: Array<HTMLElement>;\n\n\tprivate readonly player: Player<any>;\n\tprivate readonly modifyDisplayStats?: (player: Player<any>) => StatMods;\n\n\tconstructor(parent: HTMLElement, player: Player<any>, stats: Array<Stat>, modifyDisplayStats?: (player: Player<any>) => StatMods) {\n\t\tsuper(parent, 'character-stats-root');\n\t\tthis.stats = statOrder.filter(stat => stats.includes(stat));\n\t\tthis.player = player;\n\t\tthis.modifyDisplayStats = modifyDisplayStats;\n\n\t\tconst table = document.createElement('table');\n\t\ttable.classList.add('character-stats-table');\n\t\tthis.rootElem.appendChild(table);\n\n\t\tthis.valueElems = [];\n\t\tthis.tooltipElems = [];\n\t\tthis.stats.forEach(stat => {\n\t\t\tconst row = document.createElement('tr');\n\t\t\trow.classList.add('character-stats-table-row');\n\t\t\trow.innerHTML = `\n\t\t\t\t<td class=\"character-stats-table-label\">\n\t\t\t\t\t<span>${statNames[stat].toUpperCase()}<span>\n\t\t\t\t\t<span class=\"character-stats-table-tooltip fas fa-search\"></span>\n\t\t\t\t</td>\n\t\t\t\t<td class=\"character-stats-table-value\"></td>\n\t\t\t`;\n\t\t\ttable.appendChild(row);\n\n\t\t\tconst valueElem = row.getElementsByClassName('character-stats-table-value')[0] as HTMLTableCellElement;\n\t\t\tthis.valueElems.push(valueElem);\n\n\t\t\tconst tooltipElem = row.getElementsByClassName('character-stats-table-tooltip')[0] as HTMLElement;\n\t\t\tthis.tooltipElems.push(tooltipElem);\n\t\t});\n\n\t\tthis.updateStats(player);\n\t\tTypedEvent.onAny([player.currentStatsEmitter, player.sim.changeEmitter]).on(() => {\n\t\t\tthis.updateStats(player);\n\t\t});\n\t}\n\n\tprivate updateStats(player: Player<any>) {\n\t\tconst playerStats = player.getCurrentStats();\n\n\t\tconst statMods = this.modifyDisplayStats ? this.modifyDisplayStats(this.player) : {\n\t\t\ttalents: new Stats(),\n\t\t};\n\n\t\tconst baseStats = new Stats(playerStats.baseStats);\n\t\tconst gearStats = new Stats(playerStats.gearStats);\n\t\tconst talentsStats = new Stats(playerStats.talentsStats);\n\t\tconst buffsStats = new Stats(playerStats.buffsStats);\n\t\tconst consumesStats = new Stats(playerStats.consumesStats);\n\t\tconst debuffStats = CharacterStats.getDebuffStats(player);\n\t\tconst finalStats = new Stats(playerStats.finalStats).add(statMods.talents).add(debuffStats);\n\n\t\tconst gearDelta = gearStats.subtract(baseStats);\n\t\tconst talentsDelta = talentsStats.subtract(gearStats).add(statMods.talents);\n\t\tconst buffsDelta = buffsStats.subtract(talentsStats);\n\t\tconst consumesDelta = consumesStats.subtract(buffsStats);\n\n\t\tthis.stats.forEach((stat, idx) => {\n\t\t\tthis.valueElems[idx].textContent = CharacterStats.statDisplayString(player, finalStats, stat);\n\n\t\t\ttippy(this.tooltipElems[idx], {\n\t\t\t\t'content': `\n\t\t\t\t\t<div class=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Base:</span>\n\t\t\t\t\t\t<span>${CharacterStats.statDisplayString(player, baseStats, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Gear:</span>\n\t\t\t\t\t\t<span>${CharacterStats.statDisplayString(player, gearDelta, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Talents:</span>\n\t\t\t\t\t\t<span>${CharacterStats.statDisplayString(player, talentsDelta, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Buffs:</span>\n\t\t\t\t\t\t<span>${CharacterStats.statDisplayString(player, buffsDelta, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Consumes:</span>\n\t\t\t\t\t\t<span>${CharacterStats.statDisplayString(player, consumesDelta, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${debuffStats.getStat(stat) == 0 ? '' : `\n\t\t\t\t\t<div class=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Debuffs:</span>\n\t\t\t\t\t\t<span>${CharacterStats.statDisplayString(player, debuffStats, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t`}\n\t\t\t\t\t<div class=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Total:</span>\n\t\t\t\t\t\t<span>${CharacterStats.statDisplayString(player, finalStats, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t`,\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\t\t});\n\t}\n\n\tstatic statDisplayString(player: Player<any>, stats: Stats, stat: Stat): string {\n\t\tconst rawValue = stats.getStat(stat);\n\t\tlet displayStr = String(Math.round(rawValue));\n\n\t\tif (stat == Stat.StatMeleeHit) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.MELEE_HIT_RATING_PER_HIT_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatSpellHit) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.SPELL_HIT_RATING_PER_HIT_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatMeleeCrit || stat == Stat.StatSpellCrit) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatMeleeHaste) {\n\t\t\tif ([Class.ClassDruid, Class.ClassShaman, Class.ClassPaladin, Class.ClassDeathknight].includes(player.getClass())) {\n\t\t\t\tdisplayStr += ` (${(rawValue / Mechanics.SPECIAL_MELEE_HASTE_RATING_PER_HASTE_PERCENT).toFixed(2)}%)`;\n\t\t\t} else {\n\t\t\t\tdisplayStr += ` (${(rawValue / Mechanics.HASTE_RATING_PER_HASTE_PERCENT).toFixed(2)}%)`;\n\t\t\t}\n\t\t} else if (stat == Stat.StatSpellHaste) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.HASTE_RATING_PER_HASTE_PERCENT).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatExpertise) {\n\t\t\tdisplayStr += ` (${(Math.floor(rawValue / Mechanics.EXPERTISE_PER_QUARTER_PERCENT_REDUCTION)).toFixed(0)})`;\n\t\t} else if (stat == Stat.StatDefense) {\n\t\t\tdisplayStr += ` (${(Mechanics.CHARACTER_LEVEL * 5 + rawValue / Mechanics.DEFENSE_RATING_PER_DEFENSE).toFixed(1)})`;\n\t\t} else if (stat == Stat.StatBlock) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.BLOCK_RATING_PER_BLOCK_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatDodge) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.DODGE_RATING_PER_DODGE_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatParry) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.PARRY_RATING_PER_PARRY_CHANCE).toFixed(2)}%)`;\n\t\t}\n\n\t\treturn displayStr;\n\t}\n\n\tstatic getDebuffStats(player: Player<any>): Stats {\n\t\tlet debuffStats = new Stats();\n\n\t\tconst debuffs = player.sim.raid.getDebuffs();\n\t\tif (debuffs.misery || debuffs.faerieFire == TristateEffect.TristateEffectImproved) {\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatSpellHit, 3 * Mechanics.SPELL_HIT_RATING_PER_HIT_CHANCE);\n\t\t}\n\t\tif (debuffs.totemOfWrath || debuffs.heartOfTheCrusader || debuffs.masterPoisoner) {\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatSpellCrit, 3 * Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE);\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatMeleeCrit, 3 * Mechanics.MELEE_CRIT_RATING_PER_CRIT_CHANCE);\n\t\t}\n\t\tif (debuffs.improvedScorch || debuffs.wintersChill || debuffs.shadowMastery) {\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatSpellCrit, 5 * Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE);\n\t\t}\n\n\t\treturn debuffStats;\n\t}\n}\n","import { ActionId } from '../proto_utils/action_id.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Component } from './component.js';\nimport { Input, InputConfig } from './input.js';\n\ndeclare var tippy: any;\n\nexport interface IconEnumValueConfig<ModObject, T> {\n\t// One of these should be set. If actionId is set, shows the icon for that id. If\n\t// color is set, shows that color.\n\tactionId?: ActionId,\n\tcolor?: string,\n\n\tvalue: T,\n\n\t// Hover tooltip.\n\ttooltip?: string,\n\t// Text to be displayed on the icon.\n\ttext?: string,\n\n\tshowWhen?: (obj: ModObject) => boolean,\n}\n\nexport interface IconEnumPickerConfig<ModObject, T> extends InputConfig<ModObject, T> {\n\tnumColumns: number,\n\n\tvalues: Array<IconEnumValueConfig<ModObject, T>>;\n\n\t// Function for comparing two values.\n\tequals: (a: T, b: T) => boolean,\n\n\t// Value that will be considered inactive.\n\tzeroValue: T,\n\n\tbackupIconUrl?: (value: T) => ActionId,\n}\n\n// Icon-based UI for picking enum values.\n// ModObject is the object being modified (Sim, Player, or Target).\nexport class IconEnumPicker<ModObject, T> extends Input<ModObject, T> {\n\tprivate readonly config: IconEnumPickerConfig<ModObject, T>;\n\n\tprivate currentValue: T;\n\n\tprivate readonly buttonElem: HTMLAnchorElement;\n\tprivate readonly buttonText: HTMLElement;\n\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: IconEnumPickerConfig<ModObject, T>) {\n\t\tsuper(parent, 'icon-enum-picker-root', modObj, config);\n\t\tthis.config = config;\n\t\tthis.currentValue = this.config.zeroValue;\n\t\tthis.rootElem.classList.add('dropdown-root');\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<a class=\"dropdown-button icon-enum-picker-button\">\n\t\t\t\t<div class='icon-enum-text'></div>\n\t\t\t</a>\n\t\t\t<div class=\"dropdown-panel icon-enum-picker-dropdown\"></div>\n    `;\n\n\t\tthis.buttonElem = this.rootElem.getElementsByClassName('icon-enum-picker-button')[0] as HTMLAnchorElement;\n\t\tconst dropdownElem = this.rootElem.getElementsByClassName('icon-enum-picker-dropdown')[0] as HTMLElement;\n\t\tthis.buttonText\t= this.rootElem.getElementsByClassName('icon-enum-text')[0] as HTMLElement;\n\n\t\tthis.buttonElem.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.buttonElem.addEventListener('touchstart', event => {\n\t\t\tif (dropdownElem.style.display == \"block\") {\n\t\t\t\tdropdownElem.style.display = \"none\";\n\t\t\t} else {\n\t\t\t\tdropdownElem.style.display = \"block\";\n\t\t\t}\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.buttonElem.addEventListener('touchend', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\tdropdownElem.style.gridTemplateColumns = `repeat(${this.config.numColumns}, 1fr)`;\n\n\t\tconfig.values.forEach((valueConfig, i) => {\n\t\t\tconst optionContainer = document.createElement('div');\n\t\t\toptionContainer.classList.add('dropdown-option-container');\n\t\t\tdropdownElem.appendChild(optionContainer);\n\n\t\t\tconst option = document.createElement('a');\n\t\t\toption.classList.add('dropdown-option', 'icon-enum-picker-option');\n\t\t\toptionContainer.appendChild(option);\n\t\t\tthis.setImage(option, valueConfig);\n\n\t\t\tif (valueConfig.text != undefined){\n\t\t\t\tconst optionText = document.createElement('div');\n\t\t\t\toptionText.classList.add(\"icon-enum-text\")\n\t\t\t\toptionText.textContent = valueConfig.text\n\t\t\t\toption.append(optionText)\n\t\t\t}\n\n\t\t\tif (valueConfig.tooltip) {\n\t\t\t\ttippy(option, {\n\t\t\t\t\t'content': valueConfig.tooltip,\n\t\t\t\t\t'allowHTML': true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (valueConfig.showWhen) {\n\t\t\t\tconfig.changedEvent(this.modObject).on(eventID => {\n\t\t\t\t\tconst show = valueConfig.showWhen && valueConfig.showWhen(this.modObject);\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\toptionContainer.classList.remove('hide');\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptionContainer.classList.add('hide');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\toption.addEventListener('click', event => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.currentValue = valueConfig.value;\n\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\n\t\t\t\t// Wowhead tooltips can't seem to detect when an element is hidden while\n\t\t\t\t// being moused over, and the tooltip doesn't disappear. Patch this by\n\t\t\t\t// dispatching our own mouseout event.\n\t\t\t\toption.dispatchEvent(new Event('mouseout'));\n\t\t\t});\n\t\t\toption.addEventListener('touchstart', event => {\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\t\t\toption.addEventListener('touchend', event => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.currentValue = valueConfig.value;\n\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t\t\tdropdownElem.style.display = \"none\";\n\t\t\t});\n\t\t});\n\n\t\tthis.init();\n\t}\n\n\tprivate setActionImage(elem: HTMLAnchorElement, actionId: ActionId) {\n\t\tactionId.fillAndSet(elem, true, true);\n\t}\n\n\tprivate setImage(elem: HTMLAnchorElement, valueConfig: IconEnumValueConfig<ModObject, T>) {\n\t\tif (valueConfig.actionId) {\n\t\t\tthis.setActionImage(elem, valueConfig.actionId);\n\t\t} else {\n\t\t\telem.style.backgroundImage = '';\n\t\t\telem.style.backgroundColor = valueConfig.color!;\n\t\t}\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.buttonElem;\n\t}\n\n\tgetInputValue(): T {\n\t\treturn this.currentValue;\n\t}\n\n\tsetInputValue(newValue: T) {\n\t\tthis.currentValue = newValue;\n\n\t\tif (!this.config.equals(this.currentValue, this.config.zeroValue)) {\n\t\t\tthis.rootElem.classList.add('active');\n\t\t} else {\n\t\t\tthis.rootElem.classList.remove('active');\n\t\t}\n\n\t\tthis.buttonText.textContent = ''\n\t\tthis.buttonText.style.display = 'none'\n\t\tconst valueConfig = this.config.values.find(valueConfig => this.config.equals(valueConfig.value, this.currentValue))!;\n\t\tif (valueConfig) {\n\t\t\tthis.setImage(this.buttonElem, valueConfig);\n\t\t\tif (valueConfig.text != undefined){\n\t\t\t\tthis.buttonText.style.display = 'block'\n\t\t\t\tthis.buttonText.textContent = valueConfig.text\n\t\t\t}\n\t\t} else if (this.config.backupIconUrl) {\n\t\t\tconst backupId = this.config.backupIconUrl(this.currentValue);\n\t\t\tthis.setActionImage(this.buttonElem, backupId);\n\t\t\tthis.rootElem.classList.remove('active');\n\t\t}\n\t}\n}\n","import { EventID, TypedEvent } from '../typed_event.js';\nimport { arrayEquals } from '../utils.js';\n\nimport { Input, InputConfig } from './input.js';\n\n/**\n * Data for creating a number list picker.\n */\nexport interface NumberListPickerConfig<ModObject> extends InputConfig<ModObject, Array<number>> {\n\tplaceholder?: string,\n}\n\n// UI element for picking an arbitrary number list field.\nexport class NumberListPicker<ModObject> extends Input<ModObject, Array<number>> {\n\tprivate readonly inputElem: HTMLInputElement;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: NumberListPickerConfig<ModObject>) {\n\t\tsuper(parent, 'number-list-picker-root', modObject, config);\n\n\t\tthis.inputElem = document.createElement('input');\n\t\tthis.inputElem.type = 'text';\n\t\tthis.inputElem.placeholder = config.placeholder || '';\n\t\tthis.inputElem.classList.add('number-list-picker-input');\n\t\tthis.rootElem.appendChild(this.inputElem);\n\n\t\tthis.init();\n\n\t\tthis.inputElem.addEventListener('change', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.inputElem;\n\t}\n\n\tgetInputValue(): Array<number> {\n\t\tconst str = this.inputElem.value;\n\t\tif (!str) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn str.split(',').map(parseFloat).filter(val => !isNaN(val));\n\t}\n\n\tsetInputValue(newValue: Array<number>) {\n\t\tif (arrayEquals(this.getInputValue(), newValue)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.inputElem.value = newValue.map(v => String(v)).join(',');\n\t}\n}\n","import { Component } from '../components/component.js';\nimport { IconEnumPicker, IconEnumValueConfig } from '../components/icon_enum_picker.js';\nimport { Input, InputConfig } from '../components/input.js';\nimport { NumberListPicker } from '../components/number_list_picker.js';\nimport { Player } from '../player.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { ActionID as ActionIdProto } from '../proto/common.js';\nimport { Cooldowns } from '../proto/common.js';\nimport { Cooldown } from '../proto/common.js';\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { Class } from '../proto/common.js';\nimport { Spec } from '../proto/common.js';\nimport { getEnumValues } from '../utils.js';\nimport { wait } from '../utils.js';\n\ndeclare var tippy: any;\n\nexport class CooldownsPicker extends Component {\n\treadonly player: Player<any>;\n\n\tprivate cooldownPickers: Array<HTMLElement>;\n\n\tconstructor(parentElem: HTMLElement, player: Player<any>) {\n\t\tsuper(parentElem, 'cooldowns-picker-root');\n\t\tthis.player = player;\n\t\tthis.cooldownPickers = [];\n\n\t\tTypedEvent.onAny([this.player.currentStatsEmitter]).on(eventID => {\n\t\t\tthis.update();\n\t\t});\n\t\tthis.update();\n\t}\n\n\tprivate update() {\n\t\tthis.rootElem.innerHTML = '';\n\t\tconst cooldowns = this.player.getCooldowns().cooldowns;\n\n\t\tthis.cooldownPickers = [];\n\t\tfor (let i = 0; i < cooldowns.length + 1; i++) {\n\t\t\tconst cooldown = cooldowns[i];\n\n\t\t\tconst row = document.createElement('div');\n\t\t\trow.classList.add('cooldown-picker');\n\t\t\tif (i == cooldowns.length) {\n\t\t\t\trow.classList.add('add-cooldown-picker');\n\t\t\t}\n\t\t\tthis.rootElem.appendChild(row);\n\n\t\t\tconst deleteButton = document.createElement('span');\n\t\t\tdeleteButton.classList.add('delete-cooldown', 'fa', 'fa-times');\n\t\t\tdeleteButton.addEventListener('click', event => {\n\t\t\t\tconst newCooldowns = this.player.getCooldowns();\n\t\t\t\tnewCooldowns.cooldowns.splice(i, 1);\n\t\t\t\tthis.player.setCooldowns(TypedEvent.nextEventID(), newCooldowns);\n\t\t\t});\n\t\t\trow.appendChild(deleteButton);\n\n\t\t\tconst actionPicker = this.makeActionPicker(row, i);\n\n\t\t\tconst label = document.createElement('span');\n\t\t\tlabel.classList.add('cooldown-picker-label');\n\t\t\tif (cooldown && cooldown.id) {\n\t\t\t\tActionId.fromProto(cooldown.id).fill(this.player.getRaidIndex()).then(filledId => label.textContent = filledId.name);\n\t\t\t}\n\t\t\trow.appendChild(label);\n\n\t\t\tconst timingsPicker = this.makeTimingsPicker(row, i);\n\n\t\t\tthis.cooldownPickers.push(row);\n\t\t}\n\t}\n\n\tprivate makeActionPicker(parentElem: HTMLElement, cooldownIndex: number): IconEnumPicker<Player<any>, ActionIdProto> {\n\t\tconst availableCooldowns = this.player.getCurrentStats().cooldowns;\n\n\t\tconst actionPicker = new IconEnumPicker<Player<any>, ActionIdProto>(parentElem, this.player, {\n\t\t\textraCssClasses: [\n\t\t\t\t'cooldown-action-picker',\n\t\t\t],\n\t\t\tnumColumns: 3,\n\t\t\tvalues: ([\n\t\t\t\t{ color: '#grey', value: ActionIdProto.create() },\n\t\t\t] as Array<IconEnumValueConfig<Player<any>, ActionIdProto>>).concat(availableCooldowns.map(cooldownAction => {\n\t\t\t\treturn { actionId: ActionId.fromProto(cooldownAction), value: cooldownAction };\n\t\t\t})),\n\t\t\tequals: (a: ActionIdProto, b: ActionIdProto) => ActionIdProto.equals(a, b),\n\t\t\tzeroValue: ActionIdProto.create(),\n\t\t\tbackupIconUrl: (value: ActionIdProto) => ActionId.fromProto(value),\n\t\t\tchangedEvent: (player: Player<any>) => player.cooldownsChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getCooldowns().cooldowns[cooldownIndex]?.id || ActionIdProto.create(),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: ActionIdProto) => {\n\t\t\t\tconst newCooldowns = player.getCooldowns();\n\n\t\t\t\twhile (newCooldowns.cooldowns.length < cooldownIndex) {\n\t\t\t\t\tnewCooldowns.cooldowns.push(Cooldown.create());\n\t\t\t\t}\n\t\t\t\tnewCooldowns.cooldowns[cooldownIndex] = Cooldown.create({\n\t\t\t\t\tid: newValue,\n\t\t\t\t\ttimings: [],\n\t\t\t\t});\n\n\t\t\t\tplayer.setCooldowns(eventID, newCooldowns);\n\t\t\t},\n\t\t});\n\t\treturn actionPicker;\n\t}\n\n\tprivate makeTimingsPicker(parentElem: HTMLElement, cooldownIndex: number): NumberListPicker<Player<any>> {\n\t\tconst actionPicker = new NumberListPicker(parentElem, this.player, {\n\t\t\textraCssClasses: [\n\t\t\t\t'cooldown-timings-picker',\n\t\t\t],\n\t\t\tplaceholder: '20, 40, ...',\n\t\t\tchangedEvent: (player: Player<any>) => player.cooldownsChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => {\n\t\t\t\treturn player.getCooldowns().cooldowns[cooldownIndex]?.timings || [];\n\t\t\t},\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<number>) => {\n\t\t\t\tconst newCooldowns = player.getCooldowns();\n\t\t\t\tnewCooldowns.cooldowns[cooldownIndex].timings = newValue;\n\t\t\t\tplayer.setCooldowns(eventID, newCooldowns);\n\t\t\t},\n\t\t\tenableWhen: (player: Player<any>) => {\n\t\t\t\tconst curCooldown = player.getCooldowns().cooldowns[cooldownIndex];\n\t\t\t\treturn curCooldown && !ActionIdProto.equals(curCooldown.id, ActionIdProto.create());\n\t\t\t},\n\t\t});\n\t\treturn actionPicker;\n\t}\n}\n","import { REPO_NAME } from '../constants/other.js'\nimport { RaidSimRequest, RaidSimResult } from '../proto/api.js';\nimport { DetailedResultsUpdate, SimRun, SimRunData } from '../proto/ui.js';\nimport { SimResult } from '../proto_utils/sim_result.js';\nimport { SimUI } from '../sim_ui.js';\n\nimport { Component } from './component.js';\nimport { RaidSimResultsManager } from './raid_sim_action.js';\n\nexport class DetailedResults extends Component {\n\tprivate readonly simUI: SimUI;\n\tprivate readonly iframeElem: HTMLIFrameElement;\n\tprivate tabWindow: Window | null;\n\tprivate latestRun: SimRunData | null;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, simResultsManager: RaidSimResultsManager) {\n\t\tsuper(parent, 'detailed-results-manager-root');\n\t\tthis.simUI = simUI;\n\t\tthis.tabWindow = null;\n\t\tthis.latestRun = null;\n\n\t\tthis.simUI.sim.settingsChangeEmitter.on(() => this.updateSettings());\n\n\t\tconst computedStyles = window.getComputedStyle(this.rootElem);\n\n\t\tconst url = new URL(`${window.location.protocol}//${window.location.host}/${REPO_NAME}/detailed_results/index.html`);\n\t\turl.searchParams.append('mainTextColor', computedStyles.getPropertyValue('--main-text-color').trim());\n\t\turl.searchParams.append('themeColorPrimary', computedStyles.getPropertyValue('--theme-color-primary').trim());\n\t\turl.searchParams.append('themeColorBackground', computedStyles.getPropertyValue('--theme-color-background').trim());\n\t\turl.searchParams.append('themeColorBackgroundRaw', computedStyles.getPropertyValue('--theme-color-background-raw').trim());\n\t\turl.searchParams.append('themeBackgroundImage', computedStyles.getPropertyValue('--theme-background-image').trim());\n\t\turl.searchParams.append('themeBackgroundOpacity', computedStyles.getPropertyValue('--theme-background-opacity').trim());\n\t\tif (simUI.isIndividualSim()) {\n\t\t\turl.searchParams.append('isIndividualSim', '');\n\t\t}\n\n\t\tthis.rootElem.innerHTML = `\n\t\t<div class=\"detailed-results-controls-div\">\n\t\t\t<button class=\"detailed-results-new-tab-button sim-button\">VIEW IN SEPARATE TAB</button>\n\t\t</div>\n\t\t<iframe class=\"detailed-results-iframe\" src=\"${url.href}\" allowtransparency=\"true\"></iframe>\n\t\t`;\n\n\t\tthis.iframeElem = this.rootElem.getElementsByClassName('detailed-results-iframe')[0] as HTMLIFrameElement;\n\n\t\tconst newTabButton = this.rootElem.getElementsByClassName('detailed-results-new-tab-button')[0] as HTMLButtonElement;\n\t\tnewTabButton.addEventListener('click', event => {\n\t\t\tif (this.tabWindow == null || this.tabWindow.closed) {\n\t\t\t\tthis.tabWindow = window.open(url.href, 'Detailed Results');\n\t\t\t\tthis.tabWindow!.addEventListener('load', event => {\n\t\t\t\t\tif (this.latestRun) {\n\t\t\t\t\t\tthis.updateSettings();\n\t\t\t\t\t\tthis.setSimRunData(this.latestRun);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.tabWindow.focus();\n\t\t\t}\n\t\t});\n\n\t\tsimResultsManager.currentChangeEmitter.on(() => {\n\t\t\tconst runData = simResultsManager.getRunData();\n\t\t\tif (runData) {\n\t\t\t\tthis.setSimRunData(runData);\n\t\t\t}\n\t\t});\n\t}\n\n\t// TODO: Decide whether to continue using this or just remove it.\n\t//setPending() {\n\t//\tthis.latestRun = null;\n\t//\tthis.iframeElem.contentWindow!.postMessage(null, '*');\n\t//\tif (this.tabWindow) {\n\t//\t\tthis.tabWindow.postMessage(null, '*');\n\t//\t}\n\t//}\n\n\tprivate setSimRunData(simRunData: SimRunData) {\n\t\tthis.latestRun = simRunData;\n\t\tthis.postMessage(DetailedResultsUpdate.create({\n\t\t\tdata: {\n\t\t\t\toneofKind: 'runData',\n\t\t\t\trunData: simRunData,\n\t\t\t},\n\t\t}));\n\t}\n\n\tprivate updateSettings() {\n\t\tthis.postMessage(DetailedResultsUpdate.create({\n\t\t\tdata: {\n\t\t\t\toneofKind: 'settings',\n\t\t\t\tsettings: this.simUI.sim.toProto(),\n\t\t\t},\n\t\t}));\n\t}\n\n\tprivate postMessage(update: DetailedResultsUpdate) {\n\t\tthis.iframeElem.contentWindow!.postMessage(DetailedResultsUpdate.toJson(update), '*');\n\t\tif (this.tabWindow) {\n\t\t\tthis.tabWindow.postMessage(DetailedResultsUpdate.toJson(update), '*');\n\t\t}\n\t}\n}\n","import { EventID, TypedEvent } from '../typed_event.js';\nimport { arrayEquals, swap } from '../utils.js';\n\nimport { Input, InputConfig } from './input.js';\n\ndeclare var tippy: any;\n\nexport interface ListPickerConfig<ModObject, ItemType, ItemPicker> extends InputConfig<ModObject, Array<ItemType>> {\n\ttitle?: string,\n\ttitleTooltip?: string,\n\titemLabel: string,\n\tnewItem: () => ItemType,\n\tcopyItem: (oldItem: ItemType) => ItemType,\n\tnewItemPicker: (parent: HTMLElement, item: ItemType, listPicker: ListPicker<ModObject, ItemType, ItemPicker>) => ItemPicker,\n\tinlineMenuBar?: boolean,\n}\n\ninterface ItemPickerPair<ItemType, ItemPicker> {\n\titem: ItemType,\n\telem: HTMLElement,\n\tpicker: ItemPicker,\n}\n\nexport class ListPicker<ModObject, ItemType, ItemPicker> extends Input<ModObject, Array<ItemType>> {\n\tprivate readonly config: ListPickerConfig<ModObject, ItemType, ItemPicker>;\n\tprivate readonly itemsDiv: HTMLElement;\n\n\tprivate itemPickerPairs: Array<ItemPickerPair<ItemType, ItemPicker>>;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: ListPickerConfig<ModObject, ItemType, ItemPicker>) {\n\t\tsuper(parent, 'list-picker-root', modObject, config);\n\t\tthis.config = config;\n\t\tthis.itemPickerPairs = [];\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t${this.config.title ? `<span class=\"list-picker-title\">${this.config.title}</span>` : ''}\n\t\t\t<div class=\"list-picker-items\"></div>\n\t\t\t<button class=\"list-picker-new-button sim-button\">NEW ${config.itemLabel.toUpperCase()}</button>\n\t\t`;\n\n\t\tif (this.config.title && this.config.titleTooltip) {\n\t\t\tconst title = this.rootElem.getElementsByClassName('list-picker-title')[0] as HTMLElement;\n\t\t\ttippy(title, {\n\t\t\t\t'content': this.config.titleTooltip,\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\t\t}\n\n\t\tthis.itemsDiv = this.rootElem.getElementsByClassName('list-picker-items')[0] as HTMLElement;\n\n\t\tconst newItemButton = this.rootElem.getElementsByClassName('list-picker-new-button')[0] as HTMLElement;\n\t\tnewItemButton.addEventListener('click', event => {\n\t\t\tconst newItem = this.config.newItem();\n\t\t\tconst newList = this.config.getValue(this.modObject).concat([newItem]);\n\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\t\t});\n\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.rootElem;\n\t}\n\n\tgetInputValue(): Array<ItemType> {\n\t\treturn this.itemPickerPairs.map(pair => pair.item);\n\t}\n\n\tsetInputValue(newValue: Array<ItemType>): void {\n\t\t// Remove items that are no longer in the list.\n\t\tconst removePairs = this.itemPickerPairs.filter(ipp => !newValue.includes(ipp.item));\n\t\tremovePairs.forEach(ipp => ipp.elem.remove());\n\t\tthis.itemPickerPairs = this.itemPickerPairs.filter(ipp => !removePairs.includes(ipp));\n\n\t\t// Add items that were missing.\n\t\tconst curItems = this.getInputValue();\n\t\tnewValue\n\t\t\t.filter(newItem => !curItems.includes(newItem))\n\t\t\t.forEach(newItem => this.addNewPicker(newItem));\n\n\t\t// Reorder to match the new list.\n\t\tthis.itemPickerPairs = newValue.map(item => this.itemPickerPairs.find(ipp => ipp.item == item)!);\n\n\t\t// Reorder item picker elements in the DOM if necessary.\n\t\tconst curPickerElems = Array.from(this.itemsDiv.children);\n\t\tif (!curPickerElems.every((elem, i) => elem == this.itemPickerPairs[i].elem)) {\n\t\t\tthis.itemPickerPairs.forEach(ipp => ipp.elem.remove());\n\t\t\tthis.itemPickerPairs.forEach(ipp => this.itemsDiv.appendChild(ipp.elem));\n\t\t}\n\t}\n\n\tgetPickerIndex(picker: ItemPicker): number {\n\t\treturn this.itemPickerPairs.findIndex(ipp => ipp.picker == picker);\n\t}\n\n\tprivate addNewPicker(item: ItemType) {\n\t\tconst itemContainer = document.createElement('div');\n\t\titemContainer.classList.add('list-picker-item-container');\n\t\tif (this.config.inlineMenuBar) {\n\t\t\titemContainer.classList.add('inline');\n\t\t}\n\n\t\tconst itemHTML = '<div class=\"list-picker-item\"></div>';\n\t\titemContainer.innerHTML = `\n\t\t\t${this.config.inlineMenuBar ? itemHTML : ''}\n\t\t\t<div class=\"list-picker-item-header\">\n\t\t\t\t<span class=\"list-picker-item-up fa fa-angle-up\"></span>\n\t\t\t\t<span class=\"list-picker-item-down fa fa-angle-down\"></span>\n\t\t\t\t<span class=\"list-picker-item-copy fa fa-copy\"></span>\n\t\t\t\t<span class=\"list-picker-item-delete fa fa-times\"></span>\n\t\t\t</div>\n\t\t\t${!this.config.inlineMenuBar ? itemHTML : ''}\n\t\t`;\n\n\t\tconst upButton = itemContainer.getElementsByClassName('list-picker-item-up')[0] as HTMLElement;\n\t\tupButton.addEventListener('click', event => {\n\t\t\tconst index = this.itemPickerPairs.findIndex(ipp => ipp.item == item);\n\t\t\tif (index == -1) {\n\t\t\t\tconsole.error('Could not find list picker item!');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (index == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newList = this.config.getValue(this.modObject);\n\t\t\tswap(newList, index, index - 1);\n\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\t\t});\n\t\ttippy(upButton, {\n\t\t\t'content': `Move Up`,\n\t\t\t'allowHTML': true,\n\t\t});\n\n\t\tconst downButton = itemContainer.getElementsByClassName('list-picker-item-down')[0] as HTMLElement;\n\t\tdownButton.addEventListener('click', event => {\n\t\t\tconst index = this.itemPickerPairs.findIndex(ipp => ipp.item == item);\n\t\t\tif (index == -1) {\n\t\t\t\tconsole.error('Could not find list picker item!');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (index == this.itemPickerPairs.length - 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newList = this.config.getValue(this.modObject);\n\t\t\tswap(newList, index, index + 1);\n\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\t\t});\n\t\ttippy(downButton, {\n\t\t\t'content': `Move Down`,\n\t\t\t'allowHTML': true,\n\t\t});\n\n\t\tconst copyButton = itemContainer.getElementsByClassName('list-picker-item-copy')[0] as HTMLElement;\n\t\tcopyButton.addEventListener('click', event => {\n\t\t\tconst index = this.itemPickerPairs.findIndex(ipp => ipp.item == item);\n\t\t\tif (index == -1) {\n\t\t\t\tconsole.error('Could not find list picker item!');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst copiedItem = this.config.copyItem(item);\n\t\t\tconst newList = this.config.getValue(this.modObject).concat([copiedItem]);\n\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\t\t});\n\t\ttippy(copyButton, {\n\t\t\t'content': `Copy to New ${this.config.itemLabel}`,\n\t\t\t'allowHTML': true,\n\t\t});\n\n\t\tconst deleteButton = itemContainer.getElementsByClassName('list-picker-item-delete')[0] as HTMLElement;\n\t\tdeleteButton.addEventListener('click', event => {\n\t\t\tconst index = this.itemPickerPairs.findIndex(ipp => ipp.item == item);\n\t\t\tif (index == -1) {\n\t\t\t\tconsole.error('Could not find list picker item!');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newList = this.config.getValue(this.modObject);\n\t\t\tnewList.splice(index, 1);\n\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\t\t});\n\t\ttippy(deleteButton, {\n\t\t\t'content': `Delete`,\n\t\t\t'allowHTML': true,\n\t\t});\n\n\t\tconst itemElem = itemContainer.getElementsByClassName('list-picker-item')[0] as HTMLElement;\n\t\tconst itemPicker = this.config.newItemPicker(itemElem, item, this);\n\t\tthis.itemsDiv.appendChild(itemContainer);\n\n\t\tthis.itemPickerPairs.push({ item: item, elem: itemContainer, picker: itemPicker });\n\t}\n}\n","import { Spec } from '../proto/common.js';\nimport { CustomRotation, CustomSpell } from '../proto/common.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { Player } from '../player.js';\nimport { BooleanPicker } from '../components/boolean_picker.js';\nimport { IconEnumPicker, IconEnumPickerConfig, IconEnumValueConfig } from '../components/icon_enum_picker.js';\nimport { ListPicker, ListPickerConfig } from '../components/list_picker.js';\nimport { NumberPicker } from '../components/number_picker.js';\nimport { getEnumValues } from '../utils.js';\n\nimport { Component } from './component.js';\n\nexport interface CustomRotationPickerConfig<SpecType extends Spec, T> {\n\tgetValue: (player: Player<SpecType>) => CustomRotation,\n\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: CustomRotation) => void,\n\n\tnumColumns: number,\n\tvalues: Array<IconEnumValueConfig<Player<SpecType>, T>>;\n\n\tshowWhen?: (player: Player<SpecType>) => boolean,\n}\n\nexport class CustomRotationPicker<SpecType extends Spec, T> extends Component {\n\tconstructor(parent: HTMLElement, modPlayer: Player<SpecType>, config: CustomRotationPickerConfig<SpecType, T>) {\n\t\tsuper(parent, 'custom-rotation-picker-root');\n\n\t\tnew ListPicker<Player<SpecType>, CustomSpell, CustomSpellPicker<SpecType, T>>(this.rootElem, modPlayer, {\n\t\t\textraCssClasses: [\n\t\t\t\t'custom-spells-picker',\n\t\t\t],\n\t\t\ttitle: 'Spell Priority',\n\t\t\ttitleTooltip: 'Spells at the top of the list are prioritized first. Safely ignores untalented options.',\n\t\t\titemLabel: 'Spell',\n\t\t\tchangedEvent: (player: Player<SpecType>) => player.changeEmitter,\n\t\t\tgetValue: (player: Player<SpecType>) => config.getValue(player).spells,\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: Array<CustomSpell>) => {\n\t\t\t\tconfig.setValue(eventID, player, CustomRotation.create({\n\t\t\t\t\tspells: newValue,\n\t\t\t\t}));\n\t\t\t},\n\t\t\tnewItem: () => CustomSpell.create(),\n\t\t\tcopyItem: (oldItem: CustomSpell) => CustomSpell.clone(oldItem),\n\t\t\tnewItemPicker: (parent: HTMLElement, newItem: CustomSpell, listPicker: ListPicker<Player<SpecType>, CustomSpell, CustomSpellPicker<SpecType, T>>) => new CustomSpellPicker(parent, modPlayer, newItem, config, listPicker),\n\t\t\tinlineMenuBar: true,\n\t\t\tshowWhen: config.showWhen,\n\t\t});\n\t}\n}\n\nclass CustomSpellPicker<SpecType extends Spec, T> extends Component {\n\tprivate readonly player: Player<SpecType>;\n\tprivate readonly config: CustomRotationPickerConfig<SpecType, T>;\n\tprivate readonly listPicker: ListPicker<Player<SpecType>, CustomSpell, CustomSpellPicker<SpecType, T>>;\n\n\tconstructor(parent: HTMLElement, player: Player<SpecType>, modSpell: CustomSpell, config: CustomRotationPickerConfig<SpecType, T>, listPicker: ListPicker<Player<SpecType>, CustomSpell, CustomSpellPicker<SpecType, T>>) {\n\t\tsuper(parent, 'custom-spell-picker-root');\n\t\tthis.player = player;\n\t\tthis.config = config;\n\t\tthis.listPicker = listPicker;\n\n\t\tnew IconEnumPicker<CustomSpell, number>(this.rootElem, modSpell, {\n\t\t\tnumColumns: config.numColumns,\n\t\t\tvalues: config.values.map(value => {\n\t\t\t\tif (value.showWhen) {\n\t\t\t\t\tconst oldShowWhen = value.showWhen;\n\t\t\t\t\tvalue.showWhen = ((spell: CustomSpell) => oldShowWhen(player)) as unknown as ((player: Player<SpecType>) => boolean);\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}) as unknown as Array<IconEnumValueConfig<CustomSpell, number>>,\n\t\t\tequals: (a: number, b: number) => a == b,\n\t\t\tzeroValue: 0,\n\t\t\tchangedEvent: (spell: CustomSpell) => player.changeEmitter,\n\t\t\tgetValue: (spell: CustomSpell) => spell.spell,\n\t\t\tsetValue: (eventID: EventID, spell: CustomSpell, newValue: number) => {\n\t\t\t\tspell.spell = newValue;\n\t\t\t\tthis.setSpell(eventID, spell);\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate setSpell(eventID: EventID, spell: CustomSpell) {\n\t\tconst index = this.listPicker.getPickerIndex(this);\n\t\tconst cr = this.config.getValue(this.player);\n\t\tcr.spells[index] = CustomSpell.clone(spell);\n\t\tthis.config.setValue(eventID, this.player, cr);\n\t}\n}\n","import { Race } from '../proto/common.js';\nimport { specToEligibleRaces } from '../proto_utils/utils.js';\nimport { raceNames } from '../proto_utils/names.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Input, InputConfig } from './input.js';\n\nexport interface EnumValueConfig {\n\tname: string,\n\tvalue: number,\n\ttooltip?: string,\n}\n\nexport interface EnumPickerConfig<ModObject> extends InputConfig<ModObject, number> {\n\tvalues: Array<EnumValueConfig>;\n}\n\nexport class EnumPicker<ModObject> extends Input<ModObject, number> {\n\tprivate readonly selectElem: HTMLSelectElement;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: EnumPickerConfig<ModObject>) {\n\t\tsuper(parent, 'enum-picker-root', modObject, config);\n\n\t\tthis.selectElem = document.createElement('select');\n\t\tthis.selectElem.classList.add('enum-picker-selector');\n\t\tthis.rootElem.appendChild(this.selectElem);\n\n\t\tconfig.values.forEach((value) => {\n\t\t\tconst option = document.createElement('option');\n\t\t\toption.value = String(value.value);\n\t\t\toption.textContent = value.name;\n\t\t\tthis.selectElem.appendChild(option);\n\n\t\t\tif (value.tooltip) {\n\t\t\t\toption.title = value.tooltip;\n\t\t\t}\n\t\t});\n\n\t\tthis.init();\n\n\t\tthis.selectElem.addEventListener('change', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.selectElem;\n\t}\n\n\tgetInputValue(): number {\n\t\treturn parseInt(this.selectElem.value);\n\t}\n\n\tsetInputValue(newValue: number) {\n\t\tthis.selectElem.value = String(newValue);\n\t}\n}\n","import { MobType } from '../proto/common.js';\nimport { SpellSchool } from '../proto/common.js';\nimport { Stat } from '../proto/common.js';\nimport { Encounter } from '../encounter.js';\nimport { Raid } from '../raid.js';\nimport { Target } from '../target.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { BooleanPicker } from '../components/boolean_picker.js';\nimport { EnumPicker, EnumPickerConfig } from '../components/enum_picker.js';\nimport { ListPicker, ListPickerConfig } from '../components/list_picker.js';\nimport { NumberPicker } from '../components/number_picker.js';\nimport { Stats } from '../proto_utils/stats.js';\nimport { isHealingSpec, isTankSpec } from '../proto_utils/utils.js';\nimport { statNames } from '../proto_utils/names.js';\nimport { getEnumValues } from '../utils.js';\n\nimport { Component } from './component.js';\nimport { Popup } from './popup.js';\n\nimport * as Mechanics from '../constants/mechanics.js';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { SimUI } from '../sim_ui.js';\n\nexport interface EncounterPickerConfig {\n\tshowExecuteProportion: boolean,\n}\n\nexport class EncounterPicker extends Component {\n\tconstructor(parent: HTMLElement, modEncounter: Encounter, config: EncounterPickerConfig, simUI: SimUI) {\n\t\tsuper(parent, 'encounter-picker-root');\n\n\t\taddEncounterFieldPickers(this.rootElem, modEncounter, config.showExecuteProportion);\n\n\t\t// Need to wait so that the encounter and target presets will be loaded.\n\t\tmodEncounter.sim.waitForInit().then(() => {\n\t\t\tconst presetTargets = modEncounter.sim.getAllPresetTargets();\n\t\t\tnew EnumPicker<Encounter>(this.rootElem, modEncounter, {\n\t\t\t\textraCssClasses: ['damage-metrics', 'npc-picker'],\n\t\t\t\tlabel: 'NPC',\n\t\t\t\tlabelTooltip: 'Selects a preset NPC configuration.',\n\t\t\t\tvalues: [\n\t\t\t\t\t{ name: 'Custom', value: -1 },\n\t\t\t\t].concat(presetTargets.map((pe, i) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: pe.path,\n\t\t\t\t\t\tvalue: i,\n\t\t\t\t\t};\n\t\t\t\t})),\n\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t\tgetValue: (encounter: Encounter) => presetTargets.findIndex(pe => encounter.primaryTarget.matchesPreset(pe)),\n\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\t\tif (newValue != -1) {\n\t\t\t\t\t\tencounter.primaryTarget.applyPreset(eventID, presetTargets[newValue]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t//new EnumPicker<Encounter>(this.rootElem, modEncounter, {\n\t\t\t//\tlabel: 'Target Level',\n\t\t\t//\tvalues: [\n\t\t\t//\t\t{ name: '83', value: 83 },\n\t\t\t//\t\t{ name: '82', value: 82 },\n\t\t\t//\t\t{ name: '81', value: 81 },\n\t\t\t//\t\t{ name: '80', value: 80 },\n\t\t\t//\t],\n\t\t\t//\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t//\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getLevel(),\n\t\t\t//\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t//\t\tencounter.primaryTarget.setLevel(eventID, newValue);\n\t\t\t//\t},\n\t\t\t//});\n\n\t\t\t//new EnumPicker(this.rootElem, modEncounter, {\n\t\t\t//\tlabel: 'Mob Type',\n\t\t\t//\tvalues: mobTypeEnumValues,\n\t\t\t//\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t//\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getMobType(),\n\t\t\t//\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t//\t\tencounter.primaryTarget.setMobType(eventID, newValue);\n\t\t\t//\t},\n\t\t\t//});\n\n\t\t\t// Leaving this commented in case we want it later. But it takes up a lot of\n\t\t\t// screen space and none of these fields get changed much.\n\t\t\t//if (config.simpleTargetStats) {\n\t\t\t//\tconfig.simpleTargetStats.forEach(stat => {\n\t\t\t//\t\tnew NumberPicker(this.rootElem, modEncounter, {\n\t\t\t//\t\t\tlabel: statNames[stat],\n\t\t\t//\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t//\t\t\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getStats().getStat(stat),\n\t\t\t//\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t//\t\t\t\tencounter.primaryTarget.setStats(eventID, encounter.primaryTarget.getStats().withStat(stat, newValue));\n\t\t\t//\t\t\t},\n\t\t\t//\t\t});\n\t\t\t//\t});\n\t\t\t//}\n\n\t\t\tif (simUI.isIndividualSim() && isHealingSpec((simUI as IndividualSimUI<any>).player.spec)) {\n\t\t\t\tnew NumberPicker(this.rootElem, simUI.sim.raid, {\n\t\t\t\t\tlabel: 'Num Allies',\n\t\t\t\t\tlabelTooltip: 'Number of allied players in the raid.',\n\t\t\t\t\tchangedEvent: (raid: Raid) => raid.targetDummiesChangeEmitter,\n\t\t\t\t\tgetValue: (raid: Raid) => raid.getTargetDummies(),\n\t\t\t\t\tsetValue: (eventID: EventID, raid: Raid, newValue: number) => {\n\t\t\t\t\t\traid.setTargetDummies(eventID, newValue);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (simUI.isIndividualSim() && isTankSpec((simUI as IndividualSimUI<any>).player.spec)) {\n\t\t\t\tnew NumberPicker(this.rootElem, modEncounter, {\n\t\t\t\t\tlabel: 'Min Base Damage',\n\t\t\t\t\tlabelTooltip: 'Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.',\n\t\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t\t\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getMinBaseDamage(),\n\t\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\t\t\tencounter.primaryTarget.setMinBaseDamage(eventID, newValue);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst advancedButton = document.createElement('button');\n\t\t\tadvancedButton.classList.add('sim-button', 'advanced-button', 'damage-metrics');\n\t\t\tadvancedButton.textContent = 'ADVANCED';\n\t\t\tadvancedButton.addEventListener('click', () => new AdvancedEncounterPicker(this.rootElem, modEncounter, simUI));\n\t\t\tthis.rootElem.appendChild(advancedButton);\n\t\t});\n\t}\n}\n\nclass AdvancedEncounterPicker extends Popup {\n\tprivate readonly encounter: Encounter;\n\n\tconstructor(parent: HTMLElement, encounter: Encounter, simUI: SimUI) {\n\t\tsuper(parent);\n\t\tthis.encounter = encounter;\n\n\t\tthis.rootElem.classList.add('advanced-encounter-picker');\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"encounter-type\"></div>\n\t\t\t<div class=\"encounter-header\">\n\t\t\t</div>\n\t\t\t<div class=\"encounter-targets\">\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.addCloseButton();\n\n\t\tconst presetEncounters = this.encounter.sim.getAllPresetEncounters();\n\n\t\tconst encounterTypeContainer = this.rootElem.getElementsByClassName('encounter-type')[0] as HTMLElement;\n\t\tnew EnumPicker<Encounter>(encounterTypeContainer, this.encounter, {\n\t\t\tlabel: 'ENCOUNTER',\n\t\t\tvalues: [\n\t\t\t\t{ name: 'Custom', value: -1 },\n\t\t\t].concat(presetEncounters.map((pe, i) => {\n\t\t\t\treturn {\n\t\t\t\t\tname: pe.path,\n\t\t\t\t\tvalue: i,\n\t\t\t\t};\n\t\t\t})),\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => presetEncounters.findIndex(pe => encounter.matchesPreset(pe)),\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tif (newValue != -1) {\n\t\t\t\t\tencounter.applyPreset(eventID, presetEncounters[newValue]);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tconst header = this.rootElem.getElementsByClassName('encounter-header')[0] as HTMLElement;\n\t\tconst targetsElem = this.rootElem.getElementsByClassName('encounter-targets')[0] as HTMLElement;\n\n\t\taddEncounterFieldPickers(header, this.encounter, true);\n\t\tif (!simUI.isIndividualSim()) {\n\t\t\tnew BooleanPicker<Encounter>(header, encounter, {\n\t\t\t\tlabel: 'Use Health',\n\t\t\t\tlabelTooltip: 'Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.',\n\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t\tgetValue: (encounter: Encounter) => encounter.getUseHealth(),\n\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: boolean) => {\n\t\t\t\t\tencounter.setUseHealth(eventID, newValue);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tnew ListPicker<Encounter, Target, TargetPicker>(targetsElem, this.encounter, {\n\t\t\textraCssClasses: [\n\t\t\t\t'targets-picker',\n\t\t\t],\n\t\t\titemLabel: 'Target',\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.targetsChangeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.getTargets(),\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: Array<Target>) => {\n\t\t\t\tencounter.setTargets(eventID, newValue);\n\t\t\t},\n\t\t\tnewItem: () => Target.fromDefaults(TypedEvent.nextEventID(), this.encounter.sim),\n\t\t\tcopyItem: (oldItem: Target) => oldItem.clone(TypedEvent.nextEventID()),\n\t\t\tnewItemPicker: (parent: HTMLElement, target: Target) => new TargetPicker(parent, target),\n\t\t});\n\t}\n}\n\nclass TargetPicker extends Component {\n\tconstructor(parent: HTMLElement, modTarget: Target) {\n\t\tsuper(parent, 'target-picker-root');\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"target-picker-section target-picker-section1\"></div>\n\t\t\t<div class=\"target-picker-section target-picker-section2\"></div>\n\t\t\t<div class=\"target-picker-section target-picker-section3 threat-metrics\"></div>\n\t\t`;\n\n\t\tconst encounter = modTarget.sim.encounter;\n\t\tconst section1 = this.rootElem.getElementsByClassName('target-picker-section1')[0] as HTMLElement;\n\t\tconst section2 = this.rootElem.getElementsByClassName('target-picker-section2')[0] as HTMLElement;\n\t\tconst section3 = this.rootElem.getElementsByClassName('target-picker-section3')[0] as HTMLElement;\n\n\t\tconst presetTargets = modTarget.sim.getAllPresetTargets();\n\t\tnew EnumPicker<Target>(section1, modTarget, {\n\t\t\textraCssClasses: ['npc-picker'],\n\t\t\tlabel: 'NPC',\n\t\t\tlabelTooltip: 'Selects a preset NPC configuration.',\n\t\t\tvalues: [\n\t\t\t\t{ name: 'Custom', value: -1 },\n\t\t\t].concat(presetTargets.map((pe, i) => {\n\t\t\t\treturn {\n\t\t\t\t\tname: pe.path,\n\t\t\t\t\tvalue: i,\n\t\t\t\t};\n\t\t\t})),\n\t\t\tchangedEvent: (target: Target) => target.changeEmitter,\n\t\t\tgetValue: (target: Target) => presetTargets.findIndex(pe => target.matchesPreset(pe)),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\tif (newValue != -1) {\n\t\t\t\t\ttarget.applyPreset(eventID, presetTargets[newValue]);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tnew EnumPicker<Target>(section1, modTarget, {\n\t\t\textraCssClasses: ['ai-picker'],\n\t\t\tlabel: 'AI',\n\t\t\tlabelTooltip: `\n\t\t\t\t<p>Determines the target\\'s ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t`,\n\t\t\tvalues: [\n\t\t\t\t{ name: 'None', value: 0 },\n\t\t\t].concat(presetTargets.map(pe => {\n\t\t\t\treturn {\n\t\t\t\t\tname: pe.path,\n\t\t\t\t\tvalue: pe.target!.id,\n\t\t\t\t};\n\t\t\t})),\n\t\t\tchangedEvent: (target: Target) => target.changeEmitter,\n\t\t\tgetValue: (target: Target) => target.getId(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\ttarget.setId(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tnew EnumPicker<Target>(section1, modTarget, {\n\t\t\tlabel: 'Level',\n\t\t\tvalues: [\n\t\t\t\t{ name: '83', value: 83 },\n\t\t\t\t{ name: '82', value: 82 },\n\t\t\t\t{ name: '81', value: 81 },\n\t\t\t\t{ name: '80', value: 80 },\n\t\t\t],\n\t\t\tchangedEvent: (target: Target) => target.levelChangeEmitter,\n\t\t\tgetValue: (target: Target) => target.getLevel(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\ttarget.setLevel(eventID, newValue);\n\t\t\t},\n\t\t});\n\t\tnew EnumPicker(section1, modTarget, {\n\t\t\tlabel: 'Mob Type',\n\t\t\tvalues: mobTypeEnumValues,\n\t\t\tchangedEvent: (target: Target) => target.mobTypeChangeEmitter,\n\t\t\tgetValue: (target: Target) => target.getMobType(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\ttarget.setMobType(eventID, newValue);\n\t\t\t},\n\t\t});\n\t\tnew EnumPicker<Target>(section1, modTarget, {\n\t\t\textraCssClasses: ['threat-metrics'],\n\t\t\tlabel: 'Tanked By',\n\t\t\tlabelTooltip: 'Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.',\n\t\t\tvalues: [\n\t\t\t\t{ name: 'None', value: -1 },\n\t\t\t\t{ name: 'Main Tank', value: 0 },\n\t\t\t\t{ name: 'Tank 2', value: 1 },\n\t\t\t\t{ name: 'Tank 3', value: 2 },\n\t\t\t\t{ name: 'Tank 4', value: 3 },\n\t\t\t],\n\t\t\tchangedEvent: (target: Target) => target.propChangeEmitter,\n\t\t\tgetValue: (target: Target) => target.getTankIndex(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\ttarget.setTankIndex(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tALL_TARGET_STATS.forEach(statData => {\n\t\t\tconst stat = statData.stat;\n\t\t\tnew NumberPicker(section2, modTarget, {\n\t\t\t\textraCssClasses: statData.extraCssClasses,\n\t\t\t\tlabel: statNames[stat],\n\t\t\t\tlabelTooltip: statData.tooltip,\n\t\t\t\tchangedEvent: (target: Target) => target.statsChangeEmitter,\n\t\t\t\tgetValue: (target: Target) => target.getStats().getStat(stat),\n\t\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\t\ttarget.setStats(eventID, target.getStats().withStat(stat, newValue));\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tnew NumberPicker(section3, modTarget, {\n\t\t\tlabel: 'Swing Speed',\n\t\t\tlabelTooltip: 'Time in seconds between auto attacks. Set to 0 to disable auto attacks.',\n\t\t\tfloat: true,\n\t\t\tchangedEvent: (target: Target) => target.propChangeEmitter,\n\t\t\tgetValue: (target: Target) => target.getSwingSpeed(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\ttarget.setSwingSpeed(eventID, newValue);\n\t\t\t},\n\t\t});\n\t\tnew NumberPicker(section3, modTarget, {\n\t\t\tlabel: 'Min Base Damage',\n\t\t\tlabelTooltip: 'Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.',\n\t\t\tchangedEvent: (target: Target) => target.propChangeEmitter,\n\t\t\tgetValue: (target: Target) => target.getMinBaseDamage(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\ttarget.setMinBaseDamage(eventID, newValue);\n\t\t\t},\n\t\t});\n\t\tnew BooleanPicker(section3, modTarget, {\n\t\t\tlabel: 'Dual Wield',\n\t\t\tlabelTooltip: 'Uses 2 separate weapons to attack.',\n\t\t\tchangedEvent: (target: Target) => target.propChangeEmitter,\n\t\t\tgetValue: (target: Target) => target.getDualWield(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: boolean) => {\n\t\t\t\ttarget.setDualWield(eventID, newValue);\n\t\t\t},\n\t\t});\n\t\tnew BooleanPicker(section3, modTarget, {\n\t\t\tlabel: 'DW Miss Penalty',\n\t\t\tlabelTooltip: 'Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.',\n\t\t\tchangedEvent: (target: Target) => target.changeEmitter,\n\t\t\tgetValue: (target: Target) => target.getDualWieldPenalty(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: boolean) => {\n\t\t\t\ttarget.setDualWieldPenalty(eventID, newValue);\n\t\t\t},\n\t\t\tenableWhen: (target: Target) => target.getDualWield(),\n\t\t});\n\t\tnew BooleanPicker(section3, modTarget, {\n\t\t\tlabel: 'Parry Haste',\n\t\t\tlabelTooltip: 'Whether this enemy will gain parry haste when parrying attacks.',\n\t\t\tchangedEvent: (target: Target) => target.propChangeEmitter,\n\t\t\tgetValue: (target: Target) => target.getParryHaste(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: boolean) => {\n\t\t\t\ttarget.setParryHaste(eventID, newValue);\n\t\t\t},\n\t\t});\n\t\tnew EnumPicker<Target>(section3, modTarget, {\n\t\t\tlabel: 'Spell School',\n\t\t\tlabelTooltip: 'Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.',\n\t\t\tvalues: [\n\t\t\t\t{ name: 'Physical', value: SpellSchool.SpellSchoolPhysical },\n\t\t\t\t{ name: 'Arcane', value: SpellSchool.SpellSchoolArcane },\n\t\t\t\t{ name: 'Fire', value: SpellSchool.SpellSchoolFire },\n\t\t\t\t{ name: 'Frost', value: SpellSchool.SpellSchoolFrost },\n\t\t\t\t{ name: 'Holy', value: SpellSchool.SpellSchoolHoly },\n\t\t\t\t{ name: 'Nature', value: SpellSchool.SpellSchoolNature },\n\t\t\t\t{ name: 'Shadow', value: SpellSchool.SpellSchoolShadow },\n\t\t\t],\n\t\t\tchangedEvent: (target: Target) => target.propChangeEmitter,\n\t\t\tgetValue: (target: Target) => target.getSpellSchool(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: number) => {\n\t\t\t\ttarget.setSpellSchool(eventID, newValue);\n\t\t\t},\n\t\t});\n\t\tnew BooleanPicker(section3, modTarget, {\n\t\t\tlabel: 'Chill of the Throne',\n\t\t\tlabelTooltip: 'Reduces the chance for this enemy\\'s attacks to be dodged by 20%. Active in Icecrown Citadel.',\n\t\t\tchangedEvent: (target: Target) => target.changeEmitter,\n\t\t\tgetValue: (target: Target) => target.getSuppressDodge(),\n\t\t\tsetValue: (eventID: EventID, target: Target, newValue: boolean) => {\n\t\t\t\ttarget.setSuppressDodge(eventID, newValue);\n\t\t\t},\n\t\t\tenableWhen: (target: Target) => target.getLevel() == Mechanics.BOSS_LEVEL,\n\t\t});\n\t}\n}\n\nfunction addEncounterFieldPickers(rootElem: HTMLElement, encounter: Encounter, showExecuteProportion: boolean) {\n\tnew NumberPicker(rootElem, encounter, {\n\t\tlabel: 'Duration',\n\t\tlabelTooltip: 'The fight length for each sim iteration, in seconds.',\n\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\tgetValue: (encounter: Encounter) => encounter.getDuration(),\n\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\tencounter.setDuration(eventID, newValue);\n\t\t},\n\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\n\t});\n\tnew NumberPicker(rootElem, encounter, {\n\t\tlabel: 'Duration +/-',\n\t\tlabelTooltip: 'Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.',\n\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\tgetValue: (encounter: Encounter) => encounter.getDurationVariation(),\n\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\tencounter.setDurationVariation(eventID, newValue);\n\t\t},\n\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\n\t});\n\n\tif (showExecuteProportion) {\n\t\tnew NumberPicker(rootElem, encounter, {\n\t\t\tlabel: 'Execute Duration 20 (%)',\n\t\t\tlabelTooltip: 'Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.',\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion20() * 100,\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tencounter.setExecuteProportion20(eventID, newValue / 100);\n\t\t\t},\n\t\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\n\t\t});\n\t\tnew NumberPicker(rootElem, encounter, {\n\t\t\tlabel: 'Execute Duration 25 (%)',\n\t\t\tlabelTooltip: 'Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock\\'s Drain Soul.',\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion25() * 100,\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tencounter.setExecuteProportion25(eventID, newValue / 100);\n\t\t\t},\n\t\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\n\t\t});\n\t\tnew NumberPicker(rootElem, encounter, {\n\t\t\tlabel: 'Execute Duration 35 (%)',\n\t\t\tlabelTooltip: 'Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.',\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion35() * 100,\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tencounter.setExecuteProportion35(eventID, newValue / 100);\n\t\t\t},\n\t\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\n\t\t});\n\t}\n}\n\nconst ALL_TARGET_STATS: Array<{ stat: Stat, tooltip: string, extraCssClasses: Array<string> }> = [\n\t{ stat: Stat.StatHealth, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatArmor, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatArcaneResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatFireResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatFrostResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatNatureResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatShadowResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatAttackPower, tooltip: '', extraCssClasses: ['threat-metrics'] },\n\t{ stat: Stat.StatBlockValue, tooltip: '', extraCssClasses: ['threat-metrics'] },\n];\n\nconst mobTypeEnumValues = [\n\t{ name: 'None', value: MobType.MobTypeUnknown },\n\t{ name: 'Beast', value: MobType.MobTypeBeast },\n\t{ name: 'Demon', value: MobType.MobTypeDemon },\n\t{ name: 'Dragonkin', value: MobType.MobTypeDragonkin },\n\t{ name: 'Elemental', value: MobType.MobTypeElemental },\n\t{ name: 'Giant', value: MobType.MobTypeGiant },\n\t{ name: 'Humanoid', value: MobType.MobTypeHumanoid },\n\t{ name: 'Mechanical', value: MobType.MobTypeMechanical },\n\t{ name: 'Undead', value: MobType.MobTypeUndead },\n];\n","import { Enchant } from '../proto/common.js';\n\nlet descriptionsPromise: Promise<Record<number, string>> | null = null;\nfunction fetchEnchantDescriptions(): Promise<Record<number, string>> {\n\tif (descriptionsPromise == null) {\n\t\tdescriptionsPromise = fetch('/wotlk/assets/enchants/descriptions.json')\n\t\t\t.then(response => response.json())\n\t\t\t.then(json => {\n\t\t\t\tconst descriptionsMap: Record<number, string> = {};\n\t\t\t\tfor (let idStr in json) {\n\t\t\t\t\tdescriptionsMap[parseInt(idStr)] = json[idStr];\n\t\t\t\t}\n\t\t\t\treturn descriptionsMap;\n\t\t\t});\n\t}\n\treturn descriptionsPromise;\n}\n\nexport async function getEnchantDescription(enchant: Enchant): Promise<string> {\n\tconst descriptionsMap = await fetchEnchantDescriptions();\n\treturn descriptionsMap[enchant.effectId] || enchant.name;\n}\n","import { BooleanPicker } from '../components/boolean_picker.js';\nimport { EnumPicker, EnumPickerConfig } from '../components/enum_picker.js';\nimport { Conjured } from '../proto/common.js';\nimport { RaidTarget } from '../proto/common.js';\nimport { TristateEffect } from '../proto/common.js';\nimport { Party } from '../party.js';\nimport { Player } from '../player.js';\nimport { Sim } from '../sim.js';\nimport { Target } from '../target.js';\nimport { Encounter } from '../encounter.js';\nimport { Raid } from '../raid.js';\nimport { SimUI } from '../sim_ui.js';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { emptyRaidTarget } from '../proto_utils/utils.js';\n\nexport function makeShow1hWeaponsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\n\treturn new BooleanPicker<Sim>(parent, sim, {\n\t\textraCssClasses: [\n\t\t\t'show-1h-weapons-selector',\n\t\t],\n\t\tlabel: '1H',\n\t\tchangedEvent: (sim: Sim) => sim.show1hWeaponsChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getShow1hWeapons(),\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\tsim.setShow1hWeapons(eventID, newValue);\n\t\t},\n\t});\n}\n\nexport function makeShow2hWeaponsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\n\treturn new BooleanPicker<Sim>(parent, sim, {\n\t\textraCssClasses: [\n\t\t\t'show-2h-weapons-selector',\n\t\t],\n\t\tlabel: '2H',\n\t\tchangedEvent: (sim: Sim) => sim.show2hWeaponsChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getShow2hWeapons(),\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\tsim.setShow2hWeapons(eventID, newValue);\n\t\t},\n\t});\n}\n\nexport function makeShowMatchingGemsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\n\treturn new BooleanPicker<Sim>(parent, sim, {\n\t\textraCssClasses: [\n\t\t\t'show-matching-gems-selector',\n\t\t],\n\t\tlabel: 'Match Socket',\n\t\tchangedEvent: (sim: Sim) => sim.showMatchingGemsChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getShowMatchingGems(),\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\tsim.setShowMatchingGems(eventID, newValue);\n\t\t},\n\t});\n}\n\nexport function makePhaseSelector(parent: HTMLElement, sim: Sim): EnumPicker<Sim> {\n\treturn new EnumPicker<Sim>(parent, sim, {\n\t\textraCssClasses: [\n\t\t\t'phase-selector',\n\t\t],\n\t\tvalues: [\n\t\t\t{ name: 'Phase 1', value: 1 },\n\t\t\t{ name: 'Phase 2', value: 2 },\n\t\t\t{ name: 'Phase 3', value: 3 },\n\t\t\t{ name: 'Phase 4', value: 4 },\n\t\t\t{ name: 'Phase 5', value: 5 },\n\t\t],\n\t\tchangedEvent: (sim: Sim) => sim.phaseChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getPhase(),\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\tsim.setPhase(eventID, newValue);\n\t\t},\n\t});\n}\n\nexport const StartingConjured = {\n\ttype: 'enum' as const,\n\tlabel: 'Starting Conjured',\n\tlabelTooltip: 'If set, this conjured will be used instead of the default conjured for the first few uses.',\n\tvalues: [\n\t\t{ name: 'None', value: Conjured.ConjuredUnknown },\n\t\t{ name: 'Dark Rune', value: Conjured.ConjuredDarkRune },\n\t\t{ name: 'Flame Cap', value: Conjured.ConjuredFlameCap },\n\t\t{ name: 'Thistle Tea', value: Conjured.ConjuredRogueThistleTea },\n\t],\n\tchangedEvent: (player: Player<any>) => player.consumesChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getConsumes().startingConjured,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst newConsumes = player.getConsumes();\n\t\tnewConsumes.startingConjured = newValue;\n\t\tplayer.setConsumes(eventID, newConsumes);\n\t},\n};\n\nexport const NumStartingConjured = {\n\ttype: 'number' as const,\n\tlabel: '# to use',\n\tlabelTooltip: 'The number of starting conjured items to use before going back to the default conjured.',\n\tchangedEvent: (player: Player<any>) => player.consumesChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getConsumes().numStartingConjured,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst newConsumes = player.getConsumes();\n\t\tnewConsumes.numStartingConjured = newValue;\n\t\tplayer.setConsumes(eventID, newConsumes);\n\t},\n\tenableWhen: (player: Player<any>) => player.getConsumes().startingConjured != Conjured.ConjuredUnknown,\n};\n\nexport const InFrontOfTarget = {\n\ttype: 'boolean' as const,\n\tlabel: 'In Front of Target',\n\tlabelTooltip: 'Stand in front of the target, causing Blocks and Parries to be included in the attack table.',\n\tchangedEvent: (player: Player<any>) => player.inFrontOfTargetChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getInFrontOfTarget(),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: boolean) => {\n\t\tplayer.setInFrontOfTarget(eventID, newValue);\n\t},\n};\n\nexport const DistanceFromTarget = {\n\ttype: 'number' as const,\n\tlabel: 'Distance From Target',\n\tlabelTooltip: 'Distance from targets, in yards. Used to calculate travel time for certain spells.',\n\tchangedEvent: (player: Player<any>) => player.distanceFromTargetChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getDistanceFromTarget(),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tplayer.setDistanceFromTarget(eventID, newValue);\n\t},\n};\n\nexport const TankAssignment = {\n\ttype: 'enum' as const,\n\textraCssClasses: [\n\t\t'tank-selector',\n\t\t'threat-metrics',\n\t\t'within-raid-sim-hide',\n\t],\n\tlabel: 'Tank Assignment',\n\tlabelTooltip: 'Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.',\n\tvalues: [\n\t\t{ name: 'None', value: -1 },\n\t\t{ name: 'Main Tank', value: 0 },\n\t\t{ name: 'Tank 2', value: 1 },\n\t\t{ name: 'Tank 3', value: 2 },\n\t\t{ name: 'Tank 4', value: 3 },\n\t],\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.tanksChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getRaid()!.getTanks().findIndex(tank => RaidTarget.equals(tank, player.makeRaidTarget())),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst newTanks = [];\n\t\tif (newValue != -1) {\n\t\t\tfor (let i = 0; i < newValue; i++) {\n\t\t\t\tnewTanks.push(emptyRaidTarget());\n\t\t\t}\n\t\t\tnewTanks.push(player.makeRaidTarget());\n\t\t}\n\t\tplayer.getRaid()!.setTanks(eventID, newTanks);\n\t},\n};\n\nexport const IncomingHps = {\n\ttype: 'number' as const,\n\tlabel: 'Incoming HPS',\n\tlabelTooltip: `\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p>If set to 0, defaults to 125% of DTPS.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\n\tgetValue: (player: Player<any>) => player.getHealingModel().hps,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst healingModel = player.getHealingModel();\n\t\thealingModel.hps = newValue;\n\t\tplayer.setHealingModel(eventID, healingModel);\n\t},\n\tenableWhen: (player: Player<any>) => player.getRaid()!.getTanks().find(tank => RaidTarget.equals(tank, player.makeRaidTarget())) != null,\n};\n\nexport const HealingCadence = {\n\ttype: 'number' as const,\n\tfloat: true,\n\tlabel: 'Healing Cadence',\n\tlabelTooltip: `\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p>If set to 0, defaults to 2.5 seconds.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\n\tgetValue: (player: Player<any>) => player.getHealingModel().cadenceSeconds,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst healingModel = player.getHealingModel();\n\t\thealingModel.cadenceSeconds = newValue;\n\t\tplayer.setHealingModel(eventID, healingModel);\n\t},\n\tenableWhen: (player: Player<any>) => player.getRaid()!.getTanks().find(tank => RaidTarget.equals(tank, player.makeRaidTarget())) != null,\n};\n\nexport const HpPercentForDefensives = {\n\ttype: 'number' as const,\n\tfloat: true,\n\tlabel: 'HP % for Defensive CDs',\n\tlabelTooltip: `\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p>If set to 0, this restriction is disabled.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.cooldownsChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getCooldowns().hpPercentForDefensives * 100,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst cooldowns = player.getCooldowns();\n\t\tcooldowns.hpPercentForDefensives = newValue / 100;\n\t\tplayer.setCooldowns(eventID, cooldowns);\n\t},\n};\n\nexport const InspirationUptime = {\n    type: 'number' as const,\n    float: true,\n    label: 'Inspiration % Uptime',\n    labelTooltip: `\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p>If set to 0, the buff isn't applied.</p>\n\t`,\n    changedEvent: (player: Player<any>) => player.healingModelChangeEmitter,\n    getValue: (player: Player<any>) => player.getHealingModel().inspirationUptime * 100,\n    setValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n        const healingModel = player.getHealingModel();\n        healingModel.inspirationUptime = newValue / 100;\n        player.setHealingModel(eventID, healingModel);\n    },\n};\n","import { getWowheadItemId } from '../proto_utils/equipped_item.js';\nimport { EquippedItem } from '../proto_utils/equipped_item.js';\nimport { getEmptyGemSocketIconUrl, gemMatchesSocket } from '../proto_utils/gems.js';\nimport { setGemSocketCssClass } from '../proto_utils/gems.js';\nimport { Stats } from '../proto_utils/stats.js';\nimport { enchantAppliesToItem } from '../proto_utils/utils.js';\nimport { Class, Enchant, Gem, GemColor } from '../proto/common.js';\nimport { HandType } from '../proto/common.js';\nimport { WeaponType } from '../proto/common.js';\nimport { Item } from '../proto/common.js';\nimport { ItemQuality } from '../proto/common.js';\nimport { ItemSlot } from '../proto/common.js';\nimport { ItemType } from '../proto/common.js';\nimport { Profession } from '../proto/common.js';\nimport { getEnchantDescription } from '../proto_utils/enchants.js';\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { slotNames } from '../proto_utils/names.js';\nimport { setItemQualityCssClass } from '../css_utils.js';\nimport { Player } from '../player.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { formatDeltaTextElem } from '../utils.js';\nimport { getEnumValues } from '../utils.js';\n\nimport { Component } from './component.js';\nimport { Popup } from './popup.js';\nimport { makePhaseSelector } from './other_inputs.js';\nimport { makeShow1hWeaponsSelector } from './other_inputs.js';\nimport { makeShow2hWeaponsSelector } from './other_inputs.js';\nimport { makeShowMatchingGemsSelector } from './other_inputs.js';\n\ndeclare var $: any;\ndeclare var tippy: any;\n\nexport class GearPicker extends Component {\n\t// ItemSlot is used as the index\n\treadonly itemPickers: Array<ItemPicker>;\n\n\tconstructor(parent: HTMLElement, player: Player<any>) {\n\t\tsuper(parent, 'gear-picker-root');\n\n\t\tconst leftSide = document.createElement('div');\n\t\tleftSide.classList.add('gear-picker-left');\n\t\tthis.rootElem.appendChild(leftSide);\n\n\t\tconst rightSide = document.createElement('div');\n\t\trightSide.classList.add('gear-picker-right');\n\t\tthis.rootElem.appendChild(rightSide);\n\n\t\tconst leftItemPickers = [\n\t\t\tItemSlot.ItemSlotHead,\n\t\t\tItemSlot.ItemSlotNeck,\n\t\t\tItemSlot.ItemSlotShoulder,\n\t\t\tItemSlot.ItemSlotBack,\n\t\t\tItemSlot.ItemSlotChest,\n\t\t\tItemSlot.ItemSlotWrist,\n\t\t\tItemSlot.ItemSlotMainHand,\n\t\t\tItemSlot.ItemSlotOffHand,\n\t\t].map(slot => new ItemPicker(leftSide, player, slot));\n\n\t\tconst rightItemPickers = [\n\t\t\tItemSlot.ItemSlotHands,\n\t\t\tItemSlot.ItemSlotWaist,\n\t\t\tItemSlot.ItemSlotLegs,\n\t\t\tItemSlot.ItemSlotFeet,\n\t\t\tItemSlot.ItemSlotFinger1,\n\t\t\tItemSlot.ItemSlotFinger2,\n\t\t\tItemSlot.ItemSlotTrinket1,\n\t\t\tItemSlot.ItemSlotTrinket2,\n\t\t\tItemSlot.ItemSlotRanged,\n\t\t].map(slot => new ItemPicker(rightSide, player, slot));\n\n\t\tthis.itemPickers = leftItemPickers.concat(rightItemPickers).sort((a, b) => a.slot - b.slot);\n\t}\n}\n\nclass ItemPicker extends Component {\n\treadonly slot: ItemSlot;\n\n\tprivate readonly player: Player<any>;\n\tprivate readonly iconElem: HTMLAnchorElement;\n\tprivate readonly nameElem: HTMLAnchorElement;\n\tprivate readonly enchantElem: HTMLAnchorElement;\n\tprivate readonly socketsContainerElem: HTMLElement;\n\n\t// All items and enchants that are eligible for this slot\n\tprivate _items: Array<Item> = [];\n\tprivate _enchants: Array<Enchant> = [];\n\n\tprivate _equippedItem: EquippedItem | null = null;\n\n\n\tconstructor(parent: HTMLElement, player: Player<any>, slot: ItemSlot) {\n\t\tsuper(parent, 'item-picker-root');\n\t\tthis.slot = slot;\n\t\tthis.player = player;\n\n\t\tthis.rootElem.innerHTML = `\n      <a class=\"item-picker-icon\">\n        <div class=\"item-picker-sockets-container\">\n        </div>\n      </a>\n      <div class=\"item-picker-labels-container\">\n        <a class=\"item-picker-name\"></a><br>\n        <a class=\"item-picker-enchant\"></a>\n      </div>\n    `;\n\n\t\tthis.iconElem = this.rootElem.getElementsByClassName('item-picker-icon')[0] as HTMLAnchorElement;\n\t\tthis.nameElem = this.rootElem.getElementsByClassName('item-picker-name')[0] as HTMLAnchorElement;\n\t\tthis.enchantElem = this.rootElem.getElementsByClassName('item-picker-enchant')[0] as HTMLAnchorElement;\n\t\tthis.socketsContainerElem = this.rootElem.getElementsByClassName('item-picker-sockets-container')[0] as HTMLElement;\n\n\t\tthis.item = player.getEquippedItem(slot);\n\t\tplayer.sim.waitForInit().then(() => {\n\t\t\tthis._items = this.player.getItems(this.slot);\n\t\t\tthis._enchants = this.player.getEnchants(this.slot);\n\n\t\t\tconst onClickStart = (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst selectorModal = new SelectorModal(this.rootElem.closest('.individual-sim-ui')!, this.player, this.slot, this._equippedItem, this._items, this._enchants);\n\t\t\t};\n\t\t\tconst onClickEnd = (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t};\n\t\t\tthis.iconElem.addEventListener('click', onClickStart);\n\t\t\tthis.iconElem.addEventListener('touchstart', onClickStart);\n\t\t\tthis.iconElem.addEventListener('touchend', onClickEnd);\n\t\t\tthis.nameElem.addEventListener('click', onClickStart);\n\t\t\tthis.nameElem.addEventListener('touchstart', onClickStart);\n\t\t\tthis.nameElem.addEventListener('touchend', onClickEnd);\n\n\t\t\t// Make enchant name open enchant tab.\n\t\t\tthis.enchantElem.addEventListener('click', (ev: Event) => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tconst selectorModal = new SelectorModal(this.rootElem.closest('.individual-sim-ui')!, this.player, this.slot, this._equippedItem, this._items, this._enchants);\n\t\t\t\tselectorModal.openTab(1);\n\t\t\t});\n\t\t\tthis.enchantElem.addEventListener('touchstart', (ev: Event) => {\n\t\t\t\tev.preventDefault();\n\t\t\t\tconst selectorModal = new SelectorModal(this.rootElem.closest('.individual-sim-ui')!, this.player, this.slot, this._equippedItem, this._items, this._enchants);\n\t\t\t\tselectorModal.openTab(1);\n\t\t\t});\n\t\t\tthis.enchantElem.addEventListener('touchend', onClickEnd);\n\t\t});\n\t\tplayer.gearChangeEmitter.on(() => {\n\t\t\tthis.item = player.getEquippedItem(slot);\n\t\t});\n\t\tplayer.professionChangeEmitter.on(() => {\n\t\t\tif (this._equippedItem != null) {\n\t\t\t\tthis.player.setWowheadData(this._equippedItem, this.iconElem);\n\t\t\t}\n\t\t});\n\t}\n\n\tset item(newItem: EquippedItem | null) {\n\t\t// Clear everything first\n\t\tthis.nameElem.removeAttribute('data-wowhead');\n\t\tthis.nameElem.removeAttribute('href');\n\t\tthis.iconElem.style.backgroundImage = `url('${getEmptySlotIconUrl(this.slot)}')`;\n\t\tthis.iconElem.removeAttribute('data-wowhead');\n\t\tthis.iconElem.removeAttribute('href');\n\t\tthis.enchantElem.removeAttribute('data-wowhead');\n\n\t\tthis.nameElem.textContent = slotNames[this.slot];\n\t\tsetItemQualityCssClass(this.nameElem, null);\n\n\t\tthis.enchantElem.innerHTML = '';\n\t\tthis.socketsContainerElem.innerHTML = '';\n\n\t\tif (newItem != null) {\n\t\t\tthis.nameElem.textContent = newItem.item.name;\n\t\t\tif (newItem.item.heroic) {\n\t\t\t\tvar heroic_span = document.createElement('span');\n\t\t\t\theroic_span.style.color = \"green\";\n\t\t\t\theroic_span.style.marginLeft = \"3px\";\n\t\t\t\theroic_span.innerText = \"[H]\";\n\t\t\t\tthis.nameElem.appendChild(heroic_span);\n\t\t\t}\n\n\t\t\tsetItemQualityCssClass(this.nameElem, newItem.item.quality);\n\n\t\t\tthis.player.setWowheadData(newItem, this.iconElem);\n\t\t\tthis.player.setWowheadData(newItem, this.nameElem);\n\t\t\tnewItem.asActionId().fill().then(filledId => {\n\t\t\t\tfilledId.setBackgroundAndHref(this.iconElem);\n\t\t\t\tfilledId.setWowheadHref(this.nameElem);\n\t\t\t});\n\n\t\t\tif (newItem.enchant) {\n\t\t\t\tgetEnchantDescription(newItem.enchant).then(description => {\n\t\t\t\t\tthis.enchantElem.textContent = description;\n\t\t\t\t});\n\t\t\t\t// Make enchant text hover have a tooltip.\n\t\t\t\tif (newItem.enchant.isSpellId) {\n\t\t\t\t\tthis.enchantElem.setAttribute('data-wowhead', `domain=wotlk&spell=${newItem.enchant.id}`);\n\t\t\t\t} else {\n\t\t\t\t\tthis.enchantElem.setAttribute('data-wowhead', `domain=wotlk&item=${newItem.enchant.id}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnewItem.allSocketColors().forEach((socketColor, gemIdx) => {\n\t\t\t\tconst gemIconElem = document.createElement('img');\n\t\t\t\tgemIconElem.classList.add('item-picker-gem-icon');\n\t\t\t\tsetGemSocketCssClass(gemIconElem, socketColor);\n\t\t\t\tif (newItem.gems[gemIdx] == null) {\n\t\t\t\t\tgemIconElem.src = getEmptyGemSocketIconUrl(socketColor);\n\t\t\t\t} else {\n\t\t\t\t\tActionId.fromItemId(newItem.gems[gemIdx]!.id).fill().then(filledId => {\n\t\t\t\t\t\tgemIconElem.src = filledId.iconUrl;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.socketsContainerElem.appendChild(gemIconElem);\n\n\t\t\t\tif (gemIdx == newItem.numPossibleSockets - 1 && [ItemType.ItemTypeWrist, ItemType.ItemTypeHands].includes(newItem.item.type)) {\n\t\t\t\t\tconst updateProfession = () => {\n\t\t\t\t\t\tif (this.player.isBlacksmithing()) {\n\t\t\t\t\t\t\tgemIconElem.style.removeProperty('display');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgemIconElem.style.display = 'none';\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tthis.player.professionChangeEmitter.on(updateProfession);\n\t\t\t\t\tupdateProfession();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tthis._equippedItem = newItem;\n\t}\n}\n\nclass SelectorModal extends Popup {\n\tprivate player: Player<any>;\n\tprivate readonly tabsElem: HTMLElement;\n\tprivate readonly contentElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, player: Player<any>, slot: ItemSlot, equippedItem: EquippedItem | null, eligibleItems: Array<Item>, eligibleEnchants: Array<Enchant>) {\n\t\tsuper(parent);\n\t\tthis.player = player;\n\n\t\tthis.rootElem.classList.add('selector-modal');\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<ul class=\"nav nav-tabs selector-modal-tabs\">\n\t\t\t</ul>\n\t\t\t<div class=\"tab-content selector-modal-tab-content\">\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.addCloseButton();\n\t\tthis.tabsElem = this.rootElem.getElementsByClassName('selector-modal-tabs')[0] as HTMLElement;\n\t\tthis.contentElem = this.rootElem.getElementsByClassName('selector-modal-tab-content')[0] as HTMLElement;\n\n\t\tthis.setData(slot, equippedItem, eligibleItems, eligibleEnchants);\n\t}\n\n\topenTab(idx: number) {\n\t\tconst elems = this.tabsElem.getElementsByClassName(\"selector-modal-item-tab\");\n\t\t(elems[idx] as HTMLElement).click();\n\t}\n\n\tsetData(slot: ItemSlot, equippedItem: EquippedItem | null, eligibleItems: Array<Item>, eligibleEnchants: Array<Enchant>) {\n\t\tthis.tabsElem.innerHTML = '';\n\t\tthis.contentElem.innerHTML = '';\n\n\t\tthis.addTab(\n\t\t\t'Items',\n\t\t\tslot,\n\t\t\tequippedItem,\n\t\t\teligibleItems.map(item => {\n\t\t\t\treturn {\n\t\t\t\t\titem: item,\n\t\t\t\t\tid: item.id,\n\t\t\t\t\tactionId: ActionId.fromItem(item),\n\t\t\t\t\tname: item.name,\n\t\t\t\t\tquality: item.quality,\n\t\t\t\t\theroic: item.heroic,\n\t\t\t\t\tphase: item.phase,\n\t\t\t\t\tbaseEP: this.player.computeItemEP(item),\n\t\t\t\t\tignoreEPFilter: false,\n\t\t\t\t\tonEquip: (eventID, item: Item) => {\n\t\t\t\t\t\tconst equippedItem = this.player.getEquippedItem(slot);\n\t\t\t\t\t\tif (equippedItem) {\n\t\t\t\t\t\t\tthis.player.equipItem(eventID, slot, equippedItem.withItem(item));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.player.equipItem(eventID, slot, new EquippedItem(item));\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}),\n\t\t\titem => this.player.computeItemEP(item),\n\t\t\tequippedItem => equippedItem?.item,\n\t\t\tGemColor.GemColorUnknown,\n\t\t\teventID => {\n\t\t\t\tthis.player.equipItem(eventID, slot, null);\n\t\t\t});\n\n\t\tthis.addTab(\n\t\t\t'Enchants',\n\t\t\tslot,\n\t\t\tequippedItem,\n\t\t\teligibleEnchants.map(enchant => {\n\t\t\t\treturn {\n\t\t\t\t\titem: enchant,\n\t\t\t\t\tid: enchant.id,\n\t\t\t\t\tactionId: enchant.isSpellId ? ActionId.fromSpellId(enchant.id) : ActionId.fromItemId(enchant.id),\n\t\t\t\t\tname: enchant.name,\n\t\t\t\t\tquality: enchant.quality,\n\t\t\t\t\tphase: enchant.phase || 1,\n\t\t\t\t\tbaseEP: this.player.computeStatsEP(new Stats(enchant.stats)),\n\t\t\t\t\tignoreEPFilter: true,\n\t\t\t\t\theroic: false,\n\t\t\t\t\tonEquip: (eventID, enchant: Enchant) => {\n\t\t\t\t\t\tconst equippedItem = this.player.getEquippedItem(slot);\n\t\t\t\t\t\tif (equippedItem)\n\t\t\t\t\t\t\tthis.player.equipItem(eventID, slot, equippedItem.withEnchant(enchant));\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}),\n\t\t\tenchant => this.player.computeEnchantEP(enchant),\n\t\t\tequippedItem => equippedItem?.enchant,\n\t\t\tGemColor.GemColorUnknown,\n\t\t\teventID => {\n\t\t\t\tconst equippedItem = this.player.getEquippedItem(slot);\n\t\t\t\tif (equippedItem)\n\t\t\t\t\tthis.player.equipItem(eventID, slot, equippedItem.withEnchant(null));\n\t\t\t});\n\n\t\tthis.addGemTabs(slot, equippedItem);\n\t}\n\n\tprivate addGemTabs(slot: ItemSlot, equippedItem: EquippedItem | null) {\n\t\tif (equippedItem == undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst socketBonusEP = this.player.computeStatsEP(new Stats(equippedItem.item.socketBonus)) / (equippedItem.item.gemSockets.length || 1);\n\t\tequippedItem.curSocketColors(this.player.isBlacksmithing()).forEach((socketColor, socketIdx) => {\n\t\t\tthis.addTab(\n\t\t\t\t'Gem ' + (socketIdx + 1),\n\t\t\t\tslot,\n\t\t\t\tequippedItem,\n\t\t\t\tthis.player.getGems(socketColor).map((gem: Gem) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\titem: gem,\n\t\t\t\t\t\tid: gem.id,\n\t\t\t\t\t\tactionId: ActionId.fromItemId(gem.id),\n\t\t\t\t\t\tname: gem.name,\n\t\t\t\t\t\tquality: gem.quality,\n\t\t\t\t\t\tphase: gem.phase,\n\t\t\t\t\t\theroic: false,\n\t\t\t\t\t\tbaseEP: this.player.computeStatsEP(new Stats(gem.stats)),\n\t\t\t\t\t\tignoreEPFilter: true,\n\t\t\t\t\t\tonEquip: (eventID, gem: Gem) => {\n\t\t\t\t\t\t\tconst equippedItem = this.player.getEquippedItem(slot);\n\t\t\t\t\t\t\tif (equippedItem)\n\t\t\t\t\t\t\t\tthis.player.equipItem(eventID, slot, equippedItem.withGem(gem, socketIdx));\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tgem => {\n\t\t\t\t\tlet gemEP = this.player.computeGemEP(gem);\n\t\t\t\t\tif (gemMatchesSocket(gem, socketColor)) {\n\t\t\t\t\t\tgemEP += socketBonusEP;\n\t\t\t\t\t}\n\t\t\t\t\treturn gemEP;\n\t\t\t\t},\n\t\t\t\tequippedItem => equippedItem?.gems[socketIdx],\n\t\t\t\tsocketColor,\n\t\t\t\teventID => {\n\t\t\t\t\tconst equippedItem = this.player.getEquippedItem(slot);\n\t\t\t\t\tif (equippedItem)\n\t\t\t\t\t\tthis.player.equipItem(eventID, slot, equippedItem.withGem(null, socketIdx));\n\t\t\t\t},\n\t\t\t\ttabAnchor => {\n\t\t\t\t\ttabAnchor.classList.add('selector-modal-tab-gem-icon');\n\t\t\t\t\tsetGemSocketCssClass(tabAnchor, socketColor);\n\n\t\t\t\t\tconst updateGemIcon = () => {\n\t\t\t\t\t\tconst equippedItem = this.player.getEquippedItem(slot);\n\t\t\t\t\t\tconst gem = equippedItem?.gems[socketIdx];\n\n\t\t\t\t\t\tif (gem) {\n\t\t\t\t\t\t\tActionId.fromItemId(gem.id).fill().then(filledId => {\n\t\t\t\t\t\t\t\ttabAnchor.style.backgroundImage = `url('${filledId.iconUrl}')`;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst url = getEmptyGemSocketIconUrl(socketColor);\n\t\t\t\t\t\t\ttabAnchor.style.backgroundImage = `url('${url}')`;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.player.gearChangeEmitter.on(updateGemIcon);\n\t\t\t\t\tupdateGemIcon();\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Adds one of the tabs for the item selector menu.\n\t *\n\t * T is expected to be Item, Enchant, or Gem. Tab menus for all 3 looks extremely\n\t * similar so this function uses extra functions to do it generically.\n\t */\n\tprivate addTab<T>(\n\t\tlabel: string,\n\t\tslot: ItemSlot,\n\t\tequippedItem: EquippedItem | null,\n\t\titemData: Array<ItemData<T>>,\n\t\tcomputeEP: (item: T) => number,\n\t\tequippedToItemFn: (equippedItem: EquippedItem | null) => (T | null | undefined),\n\t\tsocketColor: GemColor,\n\t\tonRemove: (eventID: EventID) => void,\n\t\tsetTabContent?: (tabElem: HTMLAnchorElement) => void) {\n\t\tif (itemData.length == 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (slot == ItemSlot.ItemSlotTrinket1 || slot == ItemSlot.ItemSlotTrinket2) {\n\t\t\t// Trinket EP is weird so just sort by ilvl instead.\n\t\t\titemData.sort((dataA, dataB) => (dataB.item as unknown as Item).ilvl - (dataA.item as unknown as Item).ilvl);\n\t\t} else {\n\t\t\titemData.sort((dataA, dataB) => {\n\t\t\t\tconst diff = computeEP(dataB.item) - computeEP(dataA.item);\n\t\t\t\t// if EP is same, sort by ilvl\n\t\t\t\tif (Math.abs(diff) < 0.01) {\n\t\t\t\t\treturn (dataB.item as unknown as Item).ilvl - (dataA.item as unknown as Item).ilvl;\n\t\t\t\t}\n\t\t\t\treturn diff;\n\t\t\t});\n\t\t}\n\n\t\tconst tabElem = document.createElement('li');\n\t\tthis.tabsElem.appendChild(tabElem);\n\t\tconst tabContentId = (label + '-tab').split(' ').join('');\n\t\ttabElem.innerHTML = `<a class=\"selector-modal-item-tab\" data-toggle=\"tab\" href=\"#${tabContentId}\"></a>`;\n\n\t\tconst tabAnchor = tabElem.getElementsByClassName('selector-modal-item-tab')[0] as HTMLAnchorElement;\n\t\ttabAnchor.dataset.label = label;\n\t\tif (setTabContent) {\n\t\t\tsetTabContent(tabAnchor);\n\t\t} else {\n\t\t\ttabAnchor.textContent = label;\n\t\t}\n\n\t\tconst tabContent = document.createElement('div');\n\t\ttabContent.id = tabContentId;\n\t\ttabContent.classList.add('tab-pane', 'fade', 'selector-modal-tab-content');\n\t\tthis.contentElem.appendChild(tabContent);\n\t\ttabContent.innerHTML = `\n    <div class=\"selector-modal-tab-content-header\">\n      <button class=\"selector-modal-remove-button sim-button\">Remove</button>\n      <input class=\"selector-modal-search\" type=\"text\" placeholder=\"Search...\">\n      <div class=\"selector-modal-filter-bar-filler\"></div>\n      <div class=\"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons\"></div>\n      <div class=\"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons\"></div>\n      <div class=\"sim-input selector-modal-boolean-option selector-modal-show-matching-gems\"></div>\n      <div class=\"selector-modal-phase-selector\"></div>\n    </div>\n\t<div style=\"width: 100%;height: 30px;font-size: 18px;\">\n\t\t<span style=\"float:left\">Item</span>\n\t\t<span style=\"float:right\">EP(+/-)<span class=\"ep-help fas fa-search\" style=\"font-size:10px\"></span></span>\n\t</div>\n    <ul class=\"selector-modal-list\"></ul>\n    `;\n\n\t\tconst helpIcon = tabContent.getElementsByClassName(\"ep-help\").item(0);\n\t\ttippy(helpIcon, {'content': 'These values are computed using stat weights which can be edited using the \"Stat Weights\" button.'});\n\t\tconst show1hWeaponsSelector = makeShow1hWeaponsSelector(tabContent.getElementsByClassName('selector-modal-show-1h-weapons')[0] as HTMLElement, this.player.sim);\n\t\tconst show2hWeaponsSelector = makeShow2hWeaponsSelector(tabContent.getElementsByClassName('selector-modal-show-2h-weapons')[0] as HTMLElement, this.player.sim);\n\t\tif (label != 'Items' || slot != ItemSlot.ItemSlotMainHand && this.player.getClass() != Class.ClassWarrior) {\n\t\t\t(tabContent.getElementsByClassName('selector-modal-show-1h-weapons')[0] as HTMLElement).style.display = 'none';\n\t\t\t(tabContent.getElementsByClassName('selector-modal-show-2h-weapons')[0] as HTMLElement).style.display = 'none';\n\t\t}\n\n\t\tconst showMatchingGemsSelector = makeShowMatchingGemsSelector(tabContent.getElementsByClassName('selector-modal-show-matching-gems')[0] as HTMLElement, this.player.sim);\n\t\tif (!label.startsWith('Gem')) {\n\t\t\t(tabContent.getElementsByClassName('selector-modal-show-matching-gems')[0] as HTMLElement).style.display = 'none';\n\t\t}\n\n\t\tconst phaseSelector = makePhaseSelector(tabContent.getElementsByClassName('selector-modal-phase-selector')[0] as HTMLElement, this.player.sim);\n\n\t\tif (label == 'Items') {\n\t\t\ttabElem.classList.add('active', 'in');\n\t\t\ttabContent.classList.add('active', 'in');\n\t\t}\n\n\t\tconst listElem = tabContent.getElementsByClassName('selector-modal-list')[0] as HTMLElement;\n\n\t\tconst listItemElems = itemData.map((itemData, itemIdx) => {\n\t\t\tconst item = itemData.item;\n\t\t\tconst itemEP = computeEP(item);\n\n\t\t\tconst listItemElem = document.createElement('li');\n\t\t\tlistItemElem.classList.add('selector-modal-list-item');\n\t\t\tlistElem.appendChild(listItemElem);\n\n\t\t\tlistItemElem.dataset.idx = String(itemIdx);\n\n\t\t\tlistItemElem.innerHTML = `\n        <a class=\"selector-modal-list-item-icon\"></a>\n        <a class=\"selector-modal-list-item-name\">${itemData.heroic ? itemData.name + \"<span style=\\\"color:green\\\">[H]</span>\" : itemData.name}</a>\n        <div class=\"selector-modal-list-item-padding\"></div>\n        <div class=\"selector-modal-list-item-ep\">\n\t\t\t\t\t<span class=\"selector-modal-list-item-ep-value\">${itemEP < 9.95 ? itemEP.toFixed(1) : Math.round(itemEP)}</span>\n\t\t\t\t\t<span class=\"selector-modal-list-item-ep-delta\"></span>\n\t\t\t\t</div>\n      `;\n\n\t\t\tif (slot == ItemSlot.ItemSlotTrinket1 || slot == ItemSlot.ItemSlotTrinket2) {\n\t\t\t\tconst epElem = listItemElem.getElementsByClassName('selector-modal-list-item-ep')[0] as HTMLElement;\n\t\t\t\tepElem.style.display = 'none';\n\t\t\t}\n\n\t\t\tconst iconElem = listItemElem.getElementsByClassName('selector-modal-list-item-icon')[0] as HTMLImageElement;\n\t\t\titemData.actionId.fill().then(filledId => {\n\t\t\t\tfilledId.setWowheadHref(listItemElem.children[0] as HTMLAnchorElement);\n\t\t\t\tfilledId.setWowheadHref(listItemElem.children[1] as HTMLAnchorElement);\n\t\t\t\ticonElem.style.backgroundImage = `url('${filledId.iconUrl}')`;\n\t\t\t});\n\n\t\t\tconst nameElem = listItemElem.getElementsByClassName('selector-modal-list-item-name')[0] as HTMLImageElement;\n\t\t\tsetItemQualityCssClass(nameElem, itemData.quality);\n\n\t\t\tconst onclick = (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\titemData.onEquip(TypedEvent.nextEventID(), item);\n\n\t\t\t\t// If the item changes, the gem slots might change, so remove and recreate the gem tabs\n\t\t\t\tif (Item.is(item)) {\n\t\t\t\t\tthis.removeTabs('Gem');\n\t\t\t\t\tthis.addGemTabs(slot, this.player.getEquippedItem(slot));\n\t\t\t\t}\n\t\t\t};\n\t\t\tnameElem.addEventListener('click', onclick);\n\t\t\ticonElem.addEventListener('click', onclick);\n\n\t\t\treturn listItemElem;\n\t\t});\n\n\t\tconst removeButton = tabContent.getElementsByClassName('selector-modal-remove-button')[0] as HTMLButtonElement;\n\t\tremoveButton.addEventListener('click', event => {\n\t\t\tlistItemElems.forEach(elem => elem.classList.remove('active'));\n\t\t\tonRemove(TypedEvent.nextEventID());\n\t\t});\n\n\t\tconst updateSelected = () => {\n\t\t\tconst newEquippedItem = this.player.getEquippedItem(slot);\n\t\t\tconst newItem = equippedToItemFn(newEquippedItem);\n\n\t\t\tconst newItemId = (newItem as any)?.id || null;\n\t\t\tconst newEP = newItem ? computeEP(newItem) : 0;\n\n\t\t\tlistItemElems.forEach(elem => {\n\t\t\t\tconst listItemIdx = parseInt(elem.dataset.idx!);\n\t\t\t\tconst listItemData = itemData[listItemIdx];\n\t\t\t\tconst listItem = listItemData.item;\n\n\t\t\t\telem.classList.remove('active');\n\t\t\t\tif (listItemData.id == newItemId) {\n\t\t\t\t\telem.classList.add('active');\n\t\t\t\t}\n\n\t\t\t\tconst epDeltaElem = elem.getElementsByClassName('selector-modal-list-item-ep-delta')[0] as HTMLSpanElement;\n\t\t\t\tepDeltaElem.textContent = '';\n\t\t\t\tif (listItem) {\n\t\t\t\t\tconst listItemEP = computeEP(listItem);\n\t\t\t\t\tformatDeltaTextElem(epDeltaElem, newEP, listItemEP, 0);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\tupdateSelected();\n\t\tthis.player.gearChangeEmitter.on(updateSelected);\n\n\t\tconst applyFilters = () => {\n\t\t\tlet validItemElems = listItemElems;\n\t\t\tconst currentEquippedItem = this.player.getEquippedItem(slot);\n\n\t\t\tvalidItemElems = validItemElems.filter(elem => {\n\t\t\t\tconst listItemIdx = parseInt(elem.dataset.idx!);\n\t\t\t\tconst listItemData = itemData[listItemIdx];\n\n\t\t\t\tif (label == 'Items') {\n\t\t\t\t\tconst listItem = listItemData.item as unknown as Item;\n\t\t\t\t\tif (!this.player.sim.getShow1hWeapons() && listItem.weaponType != WeaponType.WeaponTypeUnknown && listItem.handType != HandType.HandTypeTwoHand) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.player.sim.getShow2hWeapons() && listItem.weaponType != WeaponType.WeaponTypeUnknown && listItem.handType == HandType.HandTypeTwoHand) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else if (label == 'Enchants') {\n\t\t\t\t\tconst listItem = listItemData.item as unknown as Enchant;\n\t\t\t\t\tif (currentEquippedItem && !enchantAppliesToItem(listItem, currentEquippedItem.item)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else if (label.startsWith('Gem')) {\n\t\t\t\t\tconst listItem = listItemData.item as unknown as Gem;\n\t\t\t\t\tif (this.player.sim.getShowMatchingGems() && !gemMatchesSocket(listItem, socketColor)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (listItemData.phase > this.player.sim.getPhase()) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (searchInput.value.length > 0) {\n\t\t\t\t\tconst searchQuery = searchInput.value.toLowerCase().split(\" \");\n\t\t\t\t\tconst name = listItemData.name.toLowerCase();\n\n\t\t\t\t\tvar include = true;\n\t\t\t\t\tsearchQuery.forEach(v => {\n\t\t\t\t\t\tif (!name.includes(v))\n\t\t\t\t\t\t\tinclude = false;\n\t\t\t\t\t});\n\t\t\t\t\tif (!include) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\tlet numShown = 0;\n\t\t\tlistItemElems.forEach(elem => {\n\t\t\t\tif (validItemElems.includes(elem)) {\n\t\t\t\t\telem.classList.remove('hidden');\n\t\t\t\t\tnumShown++;\n\t\t\t\t\tif (numShown % 2 == 0) {\n\t\t\t\t\t\telem.classList.remove('odd');\n\t\t\t\t\t} else {\n\t\t\t\t\t\telem.classList.add('odd');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\telem.classList.add('hidden');\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tconst searchInput = tabContent.getElementsByClassName('selector-modal-search')[0] as HTMLInputElement;\n\t\tsearchInput.addEventListener('input', applyFilters);\n\t\tsearchInput.addEventListener(\"keyup\", ev => {\n\t\t\tif (ev.key == \"Enter\") {\n\t\t\t\tlistItemElems.find(ele => {\n\t\t\t\t\tif (ele.classList.contains(\"hidden\")) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst nameElem = ele.getElementsByClassName('selector-modal-list-item-name')[0] as HTMLElement;\n\t\t\t\t\tnameElem.click();\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.player.sim.phaseChangeEmitter.on(() => {\n\t\t\tapplyFilters();\n\t\t});\n\t\tTypedEvent.onAny([\n\t\t\tthis.player.sim.show1hWeaponsChangeEmitter,\n\t\t\tthis.player.sim.show2hWeaponsChangeEmitter,\n\t\t\tthis.player.sim.showMatchingGemsChangeEmitter,\n\t\t]).on(() => {\n\t\t\tapplyFilters();\n\t\t});\n\t\tthis.player.gearChangeEmitter.on(() => {\n\t\t\tapplyFilters();\n\t\t\tupdateSelected();\n\t\t});\n\n\t\tapplyFilters();\n\t}\n\n\tprivate removeTabs(labelSubstring: string) {\n\t\tconst tabElems = Array.prototype.slice.call(this.tabsElem.getElementsByClassName('selector-modal-item-tab'))\n\t\t\t.filter(tab => tab.dataset.label.includes(labelSubstring));\n\n\t\tconst contentElems = tabElems\n\t\t\t.map(tabElem => document.getElementById(tabElem.getAttribute('href').substring(1)))\n\t\t\t.filter(tabElem => Boolean(tabElem));\n\n\t\ttabElems.forEach(elem => elem.parentElement.remove());\n\t\tcontentElems.forEach(elem => elem!.remove());\n\t}\n}\n\ninterface ItemData<T> {\n\titem: T,\n\tname: string,\n\tid: number,\n\tactionId: ActionId,\n\tquality: ItemQuality,\n\tphase: number,\n\tbaseEP: number,\n\tignoreEPFilter: boolean,\n\theroic: boolean,\n\tonEquip: (eventID: EventID, item: T) => void,\n}\n\nconst emptySlotIcons: Record<ItemSlot, string> = {\n\t[ItemSlot.ItemSlotHead]: 'https://cdn.seventyupgrades.com/item-slots/Head.jpg',\n\t[ItemSlot.ItemSlotNeck]: 'https://cdn.seventyupgrades.com/item-slots/Neck.jpg',\n\t[ItemSlot.ItemSlotShoulder]: 'https://cdn.seventyupgrades.com/item-slots/Shoulders.jpg',\n\t[ItemSlot.ItemSlotBack]: 'https://cdn.seventyupgrades.com/item-slots/Back.jpg',\n\t[ItemSlot.ItemSlotChest]: 'https://cdn.seventyupgrades.com/item-slots/Chest.jpg',\n\t[ItemSlot.ItemSlotWrist]: 'https://cdn.seventyupgrades.com/item-slots/Wrists.jpg',\n\t[ItemSlot.ItemSlotHands]: 'https://cdn.seventyupgrades.com/item-slots/Hands.jpg',\n\t[ItemSlot.ItemSlotWaist]: 'https://cdn.seventyupgrades.com/item-slots/Waist.jpg',\n\t[ItemSlot.ItemSlotLegs]: 'https://cdn.seventyupgrades.com/item-slots/Legs.jpg',\n\t[ItemSlot.ItemSlotFeet]: 'https://cdn.seventyupgrades.com/item-slots/Feet.jpg',\n\t[ItemSlot.ItemSlotFinger1]: 'https://cdn.seventyupgrades.com/item-slots/Finger.jpg',\n\t[ItemSlot.ItemSlotFinger2]: 'https://cdn.seventyupgrades.com/item-slots/Finger.jpg',\n\t[ItemSlot.ItemSlotTrinket1]: 'https://cdn.seventyupgrades.com/item-slots/Trinket.jpg',\n\t[ItemSlot.ItemSlotTrinket2]: 'https://cdn.seventyupgrades.com/item-slots/Trinket.jpg',\n\t[ItemSlot.ItemSlotMainHand]: 'https://cdn.seventyupgrades.com/item-slots/MainHand.jpg',\n\t[ItemSlot.ItemSlotOffHand]: 'https://cdn.seventyupgrades.com/item-slots/OffHand.jpg',\n\t[ItemSlot.ItemSlotRanged]: 'https://cdn.seventyupgrades.com/item-slots/Ranged.jpg',\n};\nexport function getEmptySlotIconUrl(slot: ItemSlot): string {\n\treturn emptySlotIcons[slot];\n}\n","import { Spec } from '../proto/common.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Component } from '../components/component.js';\n\ndeclare var tippy: any;\n\nexport type SavedDataManagerConfig<ModObject, T> = {\n\tlabel: string;\n\tpresetsOnly?: boolean;\n\tstorageKey: string;\n\tchangeEmitters: Array<TypedEvent<any>>,\n\tequals: (a: T, b: T) => boolean;\n\tgetData: (modObject: ModObject) => T;\n\tsetData: (eventID: EventID, modObject: ModObject, data: T) => void;\n\ttoJson: (a: T) => any;\n\tfromJson: (obj: any) => T;\n};\n\nexport type SavedDataConfig<ModObject, T> = {\n\tname: string;\n\tdata: T;\n\ttooltip?: string;\n\tisPreset?: boolean;\n\n\t// If set, will automatically hide the saved data when this evaluates to false.\n\tenableWhen?: (obj: ModObject) => boolean;\n};\n\ntype SavedData<ModObject, T> = {\n\tname: string;\n\tdata: T;\n\telem: HTMLElement;\n\tenableWhen?: (obj: ModObject) => boolean;\n};\n\nexport class SavedDataManager<ModObject, T> extends Component {\n\tprivate readonly modObject: ModObject;\n\tprivate readonly config: SavedDataManagerConfig<ModObject, T>;\n\n\tprivate readonly userData: Array<SavedData<ModObject, T>>;\n\tprivate readonly presets: Array<SavedData<ModObject, T>>;\n\n\tprivate readonly savedDataDiv: HTMLElement;\n\tprivate readonly saveInput: HTMLInputElement;\n\tprivate frozen: boolean;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: SavedDataManagerConfig<ModObject, T>) {\n\t\tsuper(parent, 'saved-data-manager-root');\n\t\tthis.modObject = modObject;\n\t\tthis.config = config;\n\n\t\tthis.userData = [];\n\t\tthis.presets = [];\n\t\tthis.frozen = false;\n\n\t\tthis.rootElem.innerHTML = `\n    <div class=\"saved-data-container\">\n    </div>\n    <div class=\"saved-data-create-container presets-only-hide\">\n      <input class=\"saved-data-save-input\" type=\"text\" placeholder=\"Label\">\n      <button class=\"saved-data-save-button sim-button\">SAVE CURRENT ${config.label.toUpperCase()}</button>\n    </div>\n    `;\n\n\t\tif (config.presetsOnly) {\n\t\t\tthis.rootElem.classList.add('presets-only');\n\t\t}\n\n\t\tthis.savedDataDiv = this.rootElem.getElementsByClassName('saved-data-container')[0] as HTMLElement;\n\n\t\tthis.saveInput = this.rootElem.getElementsByClassName('saved-data-save-input')[0] as HTMLInputElement;\n\t\tconst saveButton = this.rootElem.getElementsByClassName('saved-data-save-button')[0] as HTMLButtonElement;\n\t\tsaveButton.addEventListener('click', event => {\n\t\t\tif (this.frozen)\n\t\t\t\treturn;\n\n\t\t\tconst newName = this.saveInput.value;\n\t\t\tif (!newName) {\n\t\t\t\talert(`Choose a label for your saved ${config.label}!`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newName in this.presets) {\n\t\t\t\talert(`${config.label} with name ${newName} already exists.`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.addSavedData({\n\t\t\t\tname: newName,\n\t\t\t\tdata: config.getData(this.modObject),\n\t\t\t});\n\t\t\tthis.saveUserData();\n\t\t});\n\t}\n\n\taddSavedData(config: SavedDataConfig<ModObject, T>) {\n\t\tconst newData = this.makeSavedData(config);\n\n\t\tconst dataArr = config.isPreset ? this.presets : this.userData;\n\n\t\tconst oldIdx = dataArr.findIndex(data => data.name == config.name);\n\t\tif (oldIdx == -1) {\n\t\t\tif (config.isPreset || this.presets.length == 0) {\n\t\t\t\tthis.savedDataDiv.appendChild(newData.elem);\n\t\t\t} else {\n\t\t\t\tthis.savedDataDiv.insertBefore(newData.elem, this.presets[0].elem);\n\t\t\t}\n\t\t\tdataArr.push(newData);\n\t\t} else {\n\t\t\tthis.savedDataDiv.replaceChild(newData.elem, dataArr[oldIdx].elem);\n\t\t\tdataArr[oldIdx] = newData;\n\t\t}\n\t}\n\n\tprivate makeSavedData(config: SavedDataConfig<ModObject, T>): SavedData<ModObject, T> {\n\t\tconst dataElem = document.createElement('div');\n\t\tdataElem.classList.add('saved-data-set-chip');\n\t\tdataElem.innerHTML = `\n    <span class=\"saved-data-set-name\">${config.name}</span>\n    <span class=\"saved-data-set-tooltip fa fa-info-circle\"></span>\n    <span class=\"saved-data-set-delete fa fa-times\"></span>\n    `;\n\n\t\tdataElem.addEventListener('click', event => {\n\t\t\tthis.config.setData(TypedEvent.nextEventID(), this.modObject, config.data);\n\t\t\tthis.saveInput.value = config.name;\n\t\t});\n\n\t\tif (config.isPreset) {\n\t\t\tdataElem.classList.add('saved-data-preset');\n\t\t} else {\n\t\t\tconst deleteButton = dataElem.getElementsByClassName('saved-data-set-delete')[0] as HTMLElement;\n\t\t\tdeleteButton.addEventListener('click', event => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tconst shouldDelete = confirm(`Delete saved ${this.config.label} '${config.name}'?`);\n\t\t\t\tif (!shouldDelete)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst idx = this.userData.findIndex(data => data.name == config.name);\n\t\t\t\tthis.userData[idx].elem.remove();\n\t\t\t\tthis.userData.splice(idx, 1);\n\t\t\t\tthis.saveUserData();\n\t\t\t});\n\t\t}\n\n\t\tif (config.tooltip) {\n\t\t\tdataElem.classList.add('saved-data-has-tooltip');\n\t\t\ttippy(dataElem.getElementsByClassName('saved-data-set-tooltip')[0], {\n\t\t\t\t'content': config.tooltip,\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\t\t}\n\n\t\tconst checkActive = () => {\n\t\t\tif (this.config.equals(config.data, this.config.getData(this.modObject))) {\n\t\t\t\tdataElem.classList.add('active');\n\t\t\t} else {\n\t\t\t\tdataElem.classList.remove('active');\n\t\t\t}\n\n\t\t\tif (config.enableWhen && !config.enableWhen(this.modObject)) {\n\t\t\t\tdataElem.classList.add('disabled');\n\t\t\t} else {\n\t\t\t\tdataElem.classList.remove('disabled');\n\t\t\t}\n\t\t};\n\n\t\tcheckActive();\n\t\tthis.config.changeEmitters.forEach(emitter => emitter.on(checkActive));\n\n\t\treturn {\n\t\t\tname: config.name,\n\t\t\tdata: config.data,\n\t\t\telem: dataElem,\n\t\t\tenableWhen: config.enableWhen,\n\t\t};\n\t}\n\n\t// Save data to window.localStorage.\n\tprivate saveUserData() {\n\t\tconst userData: Record<string, Object> = {};\n\t\tthis.userData.forEach(savedData => {\n\t\t\tuserData[savedData.name] = this.config.toJson(savedData.data);\n\t\t});\n\n\t\twindow.localStorage.setItem(this.config.storageKey, JSON.stringify(userData));\n\t}\n\n\t// Load data from window.localStorage.\n\tloadUserData() {\n\t\tconst dataStr = window.localStorage.getItem(this.config.storageKey);\n\t\tif (!dataStr)\n\t\t\treturn;\n\n\t\tlet jsonData;\n\t\ttry {\n\t\t\tjsonData = JSON.parse(dataStr);\n\t\t} catch (e) {\n\t\t\tconsole.warn('Invalid json for local storage value: ' + dataStr);\n\t\t}\n\n\t\tfor (let name in jsonData) {\n\t\t\ttry {\n\t\t\t\tthis.addSavedData({\n\t\t\t\t\tname: name,\n\t\t\t\t\tdata: this.config.fromJson(jsonData[name]),\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Failed parsing saved data: ' + jsonData[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Prevent user input from creating / deleting saved data.\n\tfreeze() {\n\t\tthis.frozen = true;\n\t\tthis.rootElem.classList.add('frozen');\n\t}\n}\n","import { ActionId } from '../proto_utils/action_id.js';\nimport { CustomRotation } from '../proto/common.js';\nimport { Spec } from '../proto/common.js';\nimport { TristateEffect } from '../proto/common.js';\nimport { Party } from '../party.js';\nimport { Player } from '../player.js';\nimport { Raid } from '../raid.js';\nimport { Sim } from '../sim.js';\nimport { Target } from '../target.js';\nimport { Encounter } from '../encounter.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { SpecOptions, SpecRotation } from '../proto_utils/utils.js';\n\nimport { CustomRotationPickerConfig } from './custom_rotation_picker.js';\nimport { IconPickerConfig } from './icon_picker.js';\nimport { IconEnumPicker, IconEnumPickerConfig, IconEnumValueConfig } from './icon_enum_picker.js';\nimport { EnumPickerConfig, EnumValueConfig } from './enum_picker.js';\nimport { BooleanPickerConfig } from './boolean_picker.js';\nimport { NumberPickerConfig } from './number_picker.js';\nimport { MultiIconPickerConfig } from './multi_icon_picker.js';\n\nexport function makeMultiIconInput<ModObject>(inputs: Array<IconPickerConfig<ModObject, any>>, label: string, numColumns?: number): MultiIconPickerConfig<ModObject> {\n\treturn {\n\t\tinputs: inputs,\n\t\tnumColumns: numColumns || 1,\n\t\temptyColor: 'grey',\n\t\tlabel: label,\n\t};\n}\n\n// Extend this to add player callbacks as optional config fields.\ninterface BasePlayerConfig<SpecType extends Spec, T> {\n\tgetValue?: (player: Player<SpecType>) => T,\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newVal: T) => void,\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>,\n\textraCssClasses?: Array<string>,\n}\n\n/////////////////////////////////////////////////////////////////////////////////\n//                                    BOOLEAN\n/////////////////////////////////////////////////////////////////////////////////\nexport interface TypedBooleanPickerConfig<ModObject> extends BooleanPickerConfig<ModObject> {\n\ttype: 'boolean',\n}\n\ninterface WrappedBooleanInputConfig<SpecType extends Spec, ModObject> extends BooleanPickerConfig<ModObject> {\n\tgetModObject: (player: Player<SpecType>) => ModObject,\n}\nfunction makeWrappedBooleanInput<SpecType extends Spec, ModObject>(config: WrappedBooleanInputConfig<SpecType, ModObject>): TypedBooleanPickerConfig<Player<SpecType>> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'boolean',\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: boolean) => config.setValue(eventID, getModObject(player), newValue),\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\n\t}\n}\nexport interface PlayerBooleanInputConfig<SpecType extends Spec, Message> extends BasePlayerConfig<SpecType, boolean> {\n\tfieldName: keyof Message,\n\tlabel: string,\n\tlabelTooltip?: string,\n\tenableWhen?: (player: Player<SpecType>) => boolean,\n\tshowWhen?: (player: Player<SpecType>) => boolean,\n}\nexport function makeSpecOptionsBooleanInput<SpecType extends Spec>(config: PlayerBooleanInputConfig<SpecType, SpecOptions<SpecType>>): TypedBooleanPickerConfig<Player<SpecType>> {\n\treturn makeWrappedBooleanInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as boolean),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: boolean) => {\n\t\t\tconst newMessage = player.getSpecOptions();\n\t\t\t(newMessage[config.fieldName] as unknown as boolean) = newVal;\n\t\t\tplayer.setSpecOptions(eventID, newMessage);\n\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\nexport function makeRotationBooleanInput<SpecType extends Spec>(config: PlayerBooleanInputConfig<SpecType, SpecRotation<SpecType>>): TypedBooleanPickerConfig<Player<SpecType>> {\n\treturn makeWrappedBooleanInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getRotation()[config.fieldName] as unknown as boolean),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: boolean) => {\n\t\t\tconst newMessage = player.getRotation();\n\t\t\t(newMessage[config.fieldName] as unknown as boolean) = newVal;\n\t\t\tplayer.setRotation(eventID, newMessage);\n\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\n\n/////////////////////////////////////////////////////////////////////////////////\n//                                    NUMBER\n/////////////////////////////////////////////////////////////////////////////////\nexport interface TypedNumberPickerConfig<ModObject> extends NumberPickerConfig<ModObject> {\n\ttype: 'number',\n}\n\ninterface WrappedNumberInputConfig<SpecType extends Spec, ModObject> extends NumberPickerConfig<ModObject> {\n\tgetModObject: (player: Player<SpecType>) => ModObject,\n}\nfunction makeWrappedNumberInput<SpecType extends Spec, ModObject>(config: WrappedNumberInputConfig<SpecType, ModObject>): TypedNumberPickerConfig<Player<SpecType>> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'number',\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tfloat: config.float,\n\t\tpositive: config.positive,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: number) => config.setValue(eventID, getModObject(player), newValue),\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\n\t}\n}\nexport interface PlayerNumberInputConfig<SpecType extends Spec, Message> extends BasePlayerConfig<SpecType, number> {\n\tfieldName: keyof Message,\n\tlabel: string,\n\tlabelTooltip?: string,\n\tpercent?: boolean,\n\tfloat?: boolean,\n\tpositive?: boolean,\n\tenableWhen?: (player: Player<SpecType>) => boolean,\n\tshowWhen?: (player: Player<SpecType>) => boolean,\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>,\n}\nexport function makeSpecOptionsNumberInput<SpecType extends Spec>(config: PlayerNumberInputConfig<SpecType, SpecOptions<SpecType>>): TypedNumberPickerConfig<Player<SpecType>> {\n\tconst internalConfig = {\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tfloat: config.float,\n\t\tpositive: config.positive,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as number),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\tconst newMessage = player.getSpecOptions();\n\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\tplayer.setSpecOptions(eventID, newMessage);\n\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n\tif (config.percent) {\n\t\tconst getValue = internalConfig.getValue;\n\t\tinternalConfig.getValue = (player: Player<SpecType>) => getValue(player) * 100;\n\t\tconst setValue = internalConfig.setValue;\n\t\tinternalConfig.setValue = (eventID: EventID, player: Player<SpecType>, newVal: number) => setValue(eventID, player, newVal / 100);\n\t}\n\treturn makeWrappedNumberInput<SpecType, Player<SpecType>>(internalConfig);\n}\nexport function makeRotationNumberInput<SpecType extends Spec>(config: PlayerNumberInputConfig<SpecType, SpecRotation<SpecType>>): TypedNumberPickerConfig<Player<SpecType>> {\n\tconst internalConfig = {\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tfloat: config.float,\n\t\tpositive: config.positive,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getRotation()[config.fieldName] as unknown as number),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\tconst newMessage = player.getRotation();\n\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\tplayer.setRotation(eventID, newMessage);\n\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n\tif (config.percent) {\n\t\tconst getValue = internalConfig.getValue;\n\t\tinternalConfig.getValue = (player: Player<SpecType>) => getValue(player) * 100;\n\t\tconst setValue = internalConfig.setValue;\n\t\tinternalConfig.setValue = (eventID: EventID, player: Player<SpecType>, newVal: number) => setValue(eventID, player, newVal / 100);\n\t}\n\treturn makeWrappedNumberInput<SpecType, Player<SpecType>>(internalConfig);\n}\n\n\n/////////////////////////////////////////////////////////////////////////////////\n//                                    ENUM\n/////////////////////////////////////////////////////////////////////////////////\nexport interface TypedEnumPickerConfig<ModObject> extends EnumPickerConfig<ModObject> {\n\ttype: 'enum',\n}\n\ninterface WrappedEnumInputConfig<SpecType extends Spec, ModObject> extends EnumPickerConfig<ModObject> {\n\tgetModObject: (player: Player<SpecType>) => ModObject,\n}\nfunction makeWrappedEnumInput<SpecType extends Spec, ModObject>(config: WrappedEnumInputConfig<SpecType, ModObject>): TypedEnumPickerConfig<Player<SpecType>> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'enum',\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tvalues: config.values,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: number) => config.setValue(eventID, getModObject(player), newValue),\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\n\t}\n}\n\nexport interface PlayerEnumInputConfig<SpecType extends Spec, Message> {\n\tfieldName: keyof Message,\n\tlabel: string,\n\tlabelTooltip?: string,\n\tvalues: Array<EnumValueConfig>;\n\tgetValue?: (player: Player<SpecType>) => number,\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newValue: number) => void,\n\tenableWhen?: (player: Player<SpecType>) => boolean,\n\tshowWhen?: (player: Player<SpecType>) => boolean,\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>,\n}\n// T is unused, but kept to have the same interface as the icon enum inputs.\nexport function makeSpecOptionsEnumInput<SpecType extends Spec, T>(config: PlayerEnumInputConfig<SpecType, SpecOptions<SpecType>>): TypedEnumPickerConfig<Player<SpecType>> {\n\treturn makeWrappedEnumInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tvalues: config.values,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as number),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\tconst newMessage = player.getSpecOptions();\n\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\tplayer.setSpecOptions(eventID, newMessage);\n\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t});\n}\n// T is unused, but kept to have the same interface as the icon enum inputs.\nexport function makeRotationEnumInput<SpecType extends Spec, T>(config: PlayerEnumInputConfig<SpecType, SpecRotation<SpecType>>): TypedEnumPickerConfig<Player<SpecType>> {\n\treturn makeWrappedEnumInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tvalues: config.values,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getRotation()[config.fieldName] as unknown as number),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\tconst newMessage = player.getRotation();\n\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\tplayer.setRotation(eventID, newMessage);\n\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t});\n}\n\n\n/////////////////////////////////////////////////////////////////////////////////\n//                                  ICON\n/////////////////////////////////////////////////////////////////////////////////\nexport interface TypedIconPickerConfig<ModObject, T> extends IconPickerConfig<ModObject, T> {\n\ttype: 'icon',\n}\n\ninterface WrappedIconInputConfig<SpecType extends Spec, ModObject, T> extends IconPickerConfig<ModObject, T> {\n\tgetModObject: (player: Player<SpecType>) => ModObject,\n}\nfunction makeWrappedIconInput<SpecType extends Spec, ModObject, T>(config: WrappedIconInputConfig<SpecType, ModObject, T>): TypedIconPickerConfig<Player<SpecType>, T> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'icon',\n\t\tid: config.id,\n\t\tstates: config.states,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: T) => config.setValue(eventID, getModObject(player), newValue),\n\t\textraCssClasses: config.extraCssClasses,\n\t}\n}\n\ninterface WrappedTypedInputConfig<Message, ModObject, T> {\n\tgetModObject: (player: Player<any>) => ModObject,\n\tgetValue: (modObj: ModObject) => Message,\n\tsetValue: (eventID: EventID, modObj: ModObject, messageVal: Message) => void,\n\tchangeEmitter: (modObj: ModObject) => TypedEvent<any>,\n\textraCssClasses?: Array<string>,\n\n\tgetFieldValue?: (modObj: ModObject) => T,\n\tsetFieldValue?: (eventID: EventID, modObj: ModObject, newValue: T) => void,\n}\n\nexport function makeBooleanIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, boolean>, id: ActionId, fieldName: keyof Message, value?: number): TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn makeWrappedIconInput<SpecType, ModObject, boolean>({\n\t\tgetModObject: config.getModObject,\n\t\tid: id,\n\t\tstates: 2,\n\t\tchangedEvent: config.changeEmitter,\n\t\tgetValue: config.getFieldValue || ((modObj: ModObject) => value ? (config.getValue(modObj)[fieldName] as unknown as number) == value : (config.getValue(modObj)[fieldName] as unknown as boolean)),\n\t\tsetValue: config.setFieldValue || ((eventID: EventID, modObj: ModObject, newValue: boolean) => {\n\t\t\tconst newMessage = config.getValue(modObj);\n\t\t\tif (value) {\n\t\t\t\tif (newValue) {\n\t\t\t\t\t(newMessage[fieldName] as unknown as number) = value;\n\t\t\t\t} else if ((newMessage[fieldName] as unknown as number) == value) {\n\t\t\t\t\t(newMessage[fieldName] as unknown as number) = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t(newMessage[fieldName] as unknown as boolean) = newValue;\n\t\t\t}\n\t\t\tconfig.setValue(eventID, modObj, newMessage);\n\t\t}),\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\n\nexport interface PlayerBooleanIconInputConfig<SpecType extends Spec, Message, T> extends BasePlayerConfig<SpecType, T> {\n\tfieldName: keyof Message,\n\tid: ActionId,\n\tvalue?: number,\n}\nexport function makeSpecOptionsBooleanIconInput<SpecType extends Spec>(config: PlayerBooleanIconInputConfig<SpecType, SpecOptions<SpecType>, boolean>): TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn makeBooleanIconInput<SpecType, SpecOptions<SpecType>, Player<SpecType>>({\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: (player: Player<SpecType>) => player.getSpecOptions(),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: SpecOptions<SpecType>) => player.setSpecOptions(eventID, newVal),\n\t\tchangeEmitter: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\textraCssClasses: config.extraCssClasses,\n\t\tgetFieldValue: config.getValue,\n\t\tsetFieldValue: config.setValue,\n\t}, config.id, config.fieldName, config.value);\n}\n\nfunction makeNumberIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, number>, id: ActionId, fieldName: keyof Message, multiplier?: number): TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn makeWrappedIconInput<SpecType, ModObject, number>({\n\t\tgetModObject: config.getModObject,\n\t\tid: id,\n\t\tstates: 0, // Must be assigned externally.\n\t\tchangedEvent: config.changeEmitter,\n\t\tgetValue: (modObj: ModObject) => config.getValue(modObj)[fieldName] as unknown as number,\n\t\tsetValue: (eventID: EventID, modObj: ModObject, newValue: number) => {\n\t\t\tconst newMessage = config.getValue(modObj);\n\t\t\tif (multiplier) {\n\t\t\t\tconst sign = newValue - (newMessage[fieldName] as unknown as number)\n\t\t\t\tnewValue += (multiplier - 1) * sign\n\t\t\t}\n\t\t\tif (newValue < 0) {\n\t\t\t\tnewValue = 0\n\t\t\t}\n\t\t\t(newMessage[fieldName] as unknown as number) = newValue;\n\t\t\tconfig.setValue(eventID, modObj, newMessage);\n\t\t},\n\t});\n}\nexport function makeTristateIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, number>, id: ActionId, impId: ActionId, fieldName: keyof Message): TypedIconPickerConfig<Player<SpecType>, number> {\n\tconst input = makeNumberIconInput(config, id, fieldName);\n\tinput.states = 3;\n\tinput.improvedId = impId;\n\treturn input;\n}\nexport function makeQuadstateIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, number>, id: ActionId, impId: ActionId, impId2: ActionId, fieldName: keyof Message): TypedIconPickerConfig<Player<SpecType>, number> {\n\tconst input = makeNumberIconInput(config, id, fieldName);\n\tinput.states = 4;\n\tinput.improvedId = impId;\n\tinput.improvedId2 = impId2;\n\treturn input;\n}\nexport function makeMultistateIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, number>, id: ActionId, numStates: number, fieldName: keyof Message, multiplier?: number): TypedIconPickerConfig<Player<SpecType>, number> {\n\tconst input = makeNumberIconInput(config, id, fieldName, multiplier);\n\tinput.states = numStates;\n\treturn input;\n}\n\n\nexport interface TypedIconEnumPickerConfig<ModObject, T> extends IconEnumPickerConfig<ModObject, T> {\n\ttype: 'iconEnum',\n}\n\ninterface WrappedEnumIconInputConfig<SpecType extends Spec, ModObject, T> extends IconEnumPickerConfig<ModObject, T> {\n\tgetModObject: (player: Player<SpecType>) => ModObject,\n}\nfunction makeWrappedEnumIconInput<SpecType extends Spec, ModObject, T>(config: WrappedEnumIconInputConfig<SpecType, ModObject, T>): TypedIconEnumPickerConfig<Player<SpecType>, T> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'iconEnum',\n\t\tnumColumns: config.numColumns,\n\t\tvalues: config.values.map(value => {\n\t\t\tif (value.showWhen) {\n\t\t\t\tconst showWhen = value.showWhen;\n\t\t\t\tvalue.showWhen = ((player: Player<SpecType>) => showWhen(getModObject(player))) as any;\n\t\t\t}\n\t\t\treturn value as unknown as IconEnumValueConfig<Player<SpecType>, T>;\n\t\t}),\n\t\tequals: config.equals,\n\t\tzeroValue: config.zeroValue,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: T) => config.setValue(eventID, getModObject(player), newValue),\n\t\textraCssClasses: config.extraCssClasses,\n\t}\n}\n\nexport interface PlayerEnumIconInputConfig<SpecType extends Spec, Message, T> extends BasePlayerConfig<SpecType, T> {\n\tfieldName: keyof Message,\n\tvalues: Array<IconEnumValueConfig<Player<SpecType>, T>>;\n\tnumColumns?: number,\n}\nexport function makeSpecOptionsEnumIconInput<SpecType extends Spec, T>(config: PlayerEnumIconInputConfig<SpecType, SpecOptions<SpecType>, T>): TypedIconEnumPickerConfig<Player<SpecType>, T> {\n\treturn makeWrappedEnumIconInput<SpecType, Player<SpecType>, T>({\n\t\tnumColumns: config.numColumns || 1,\n\t\tvalues: config.values,\n\t\tequals: (a: T, b: T) => a == b,\n\t\tzeroValue: 0 as unknown as T,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as T),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: T) => {\n\t\t\tconst newMessage = player.getSpecOptions();\n\t\t\t(newMessage[config.fieldName] as unknown as T) = newVal;\n\t\t\tplayer.setSpecOptions(eventID, newMessage);\n\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\nexport function makeRotationEnumIconInput<SpecType extends Spec, T>(config: PlayerEnumIconInputConfig<SpecType, SpecRotation<SpecType>, T>): TypedIconEnumPickerConfig<Player<SpecType>, T> {\n\treturn makeWrappedEnumIconInput<SpecType, Player<SpecType>, T>({\n\t\tnumColumns: config.numColumns || 1,\n\t\tvalues: config.values,\n\t\tequals: (a: T, b: T) => a == b,\n\t\tzeroValue: 0 as unknown as T,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getRotation()[config.fieldName] as unknown as T),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: T) => {\n\t\t\tconst newMessage = player.getRotation();\n\t\t\t(newMessage[config.fieldName] as unknown as T) = newVal;\n\t\t\tplayer.setRotation(eventID, newMessage);\n\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\n\nexport interface TypedCustomRotationPickerConfig<SpecType extends Spec, T> extends CustomRotationPickerConfig<SpecType, T> {\n\ttype: 'customRotation',\n}\n\ninterface WrappedCustomRotationInputConfig<SpecType extends Spec, T> {\n\tfieldName: keyof SpecRotation<SpecType>,\n\tgetValue?: (player: Player<SpecType>) => CustomRotation,\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newValue: CustomRotation) => void,\n\n\tnumColumns: number,\n\tvalues: Array<IconEnumValueConfig<Player<SpecType>, T>>;\n\n\tshowWhen?: (player: Player<SpecType>) => boolean,\n}\nexport function makeCustomRotationInput<SpecType extends Spec, T>(config: WrappedCustomRotationInputConfig<SpecType, T>): TypedCustomRotationPickerConfig<SpecType, T> {\n\treturn {\n\t\ttype: 'customRotation',\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => (player.getRotation()[config.fieldName] as unknown as CustomRotation) || CustomRotation.create()),\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newValue: CustomRotation) => {\n\t\t\tconst rotation = player.getRotation();\n\t\t\t(rotation[config.fieldName] as unknown as CustomRotation) = newValue;\n\t\t\tplayer.setRotation(eventID, rotation);\n\t\t}),\n\t\tshowWhen: config.showWhen,\n\t\tnumColumns: config.numColumns,\n\t\tvalues: config.values,\n\t}\n}\n","import { Spec } from '../proto/common.js';\nimport { HunterPetTalents, Hunter_Options_PetType as PetType } from '../proto/hunter.js';\nimport { Player } from '../player.js';\nimport { Component } from '../components/component.js';\nimport { EnumPicker, EnumPickerConfig } from '../components/enum_picker.js';\nimport { SavedDataManager } from '../components/saved_data_manager.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { ActionId } from '../proto_utils/action_id.js';\n\nimport { TalentsConfig, TalentsPicker, newTalentsConfig } from './talents_picker.js';\nimport { protoToTalentString, talentStringToProto } from './factory.js';\n\nimport * as InputHelpers from '../components/input_helpers.js';\n\nexport function makePetTypeInputConfig(includeLabel: boolean): InputHelpers.TypedIconEnumPickerConfig<Player<Spec.SpecHunter>, PetType> {\n\treturn InputHelpers.makeSpecOptionsEnumIconInput<Spec.SpecHunter, PetType>({\n\t\tfieldName: 'petType',\n\t\tnumColumns: 5,\n\t\t//label: includeLabel ? 'Pet' : '',\n\t\tvalues: [\n\t\t\t{ color: 'grey', value: PetType.PetNone },\n\t\t\t{ actionId: ActionId.fromPetName('Bat'), tooltip: 'Bat', value: PetType.Bat },\n\t\t\t{ actionId: ActionId.fromPetName('Bear'), tooltip: 'Bear', value: PetType.Bear },\n\t\t\t{ actionId: ActionId.fromPetName('Bird of Prey'), tooltip: 'Bird of Prey', value: PetType.BirdOfPrey },\n\t\t\t{ actionId: ActionId.fromPetName('Boar'), tooltip: 'Boar', value: PetType.Boar },\n\t\t\t{ actionId: ActionId.fromPetName('Carrion Bird'), tooltip: 'Carrion Bird', value: PetType.CarrionBird },\n\t\t\t{ actionId: ActionId.fromPetName('Cat'), tooltip: 'Cat', value: PetType.Cat },\n\t\t\t{ actionId: ActionId.fromPetName('Chimaera'), tooltip: 'Chimaera (Exotic)', value: PetType.Chimaera },\n\t\t\t{ actionId: ActionId.fromPetName('Core Hound'), tooltip: 'Core Hound (Exotic)', value: PetType.CoreHound },\n\t\t\t{ actionId: ActionId.fromPetName('Crab'), tooltip: 'Crab', value: PetType.Crab },\n\t\t\t{ actionId: ActionId.fromPetName('Crocolisk'), tooltip: 'Crocolisk', value: PetType.Crocolisk },\n\t\t\t{ actionId: ActionId.fromPetName('Devilsaur'), tooltip: 'Devilsaur (Exotic)', value: PetType.Devilsaur },\n\t\t\t{ actionId: ActionId.fromPetName('Dragonhawk'), tooltip: 'Dragonhawk', value: PetType.Dragonhawk },\n\t\t\t{ actionId: ActionId.fromPetName('Gorilla'), tooltip: 'Gorilla', value: PetType.Gorilla },\n\t\t\t{ actionId: ActionId.fromPetName('Hyena'), tooltip: 'Hyena', value: PetType.Hyena },\n\t\t\t{ actionId: ActionId.fromPetName('Moth'), tooltip: 'Moth', value: PetType.Moth },\n\t\t\t{ actionId: ActionId.fromPetName('Nether Ray'), tooltip: 'Nether Ray', value: PetType.NetherRay },\n\t\t\t{ actionId: ActionId.fromPetName('Raptor'), tooltip: 'Raptor', value: PetType.Raptor },\n\t\t\t{ actionId: ActionId.fromPetName('Ravager'), tooltip: 'Ravager', value: PetType.Ravager },\n\t\t\t{ actionId: ActionId.fromPetName('Rhino'), tooltip: 'Rhino', value: PetType.Rhino },\n\t\t\t{ actionId: ActionId.fromPetName('Scorpid'), tooltip: 'Scorpid', value: PetType.Scorpid },\n\t\t\t{ actionId: ActionId.fromPetName('Serpent'), tooltip: 'Serpent', value: PetType.Serpent },\n\t\t\t{ actionId: ActionId.fromPetName('Silithid'), tooltip: 'Silithid (Exotic)', value: PetType.Silithid },\n\t\t\t{ actionId: ActionId.fromPetName('Spider'), tooltip: 'Spider', value: PetType.Spider },\n\t\t\t{ actionId: ActionId.fromPetName('Spirit Beast'), tooltip: 'Spirit Beast (Exotic)', value: PetType.SpiritBeast },\n\t\t\t{ actionId: ActionId.fromPetName('Spore Bat'), tooltip: 'Spore Bat', value: PetType.SporeBat },\n\t\t\t{ actionId: ActionId.fromPetName('Tallstrider'), tooltip: 'Tallstrider', value: PetType.Tallstrider },\n\t\t\t{ actionId: ActionId.fromPetName('Turtle'), tooltip: 'Turtle', value: PetType.Turtle },\n\t\t\t{ actionId: ActionId.fromPetName('Warp Stalker'), tooltip: 'Warp Stalker', value: PetType.WarpStalker },\n\t\t\t{ actionId: ActionId.fromPetName('Wasp'), tooltip: 'Wasp', value: PetType.Wasp },\n\t\t\t{ actionId: ActionId.fromPetName('Wind Serpent'), tooltip: 'Wind Serpent', value: PetType.WindSerpent },\n\t\t\t{ actionId: ActionId.fromPetName('Wolf'), tooltip: 'Wolf', value: PetType.Wolf },\n\t\t\t{ actionId: ActionId.fromPetName('Worm'), tooltip: 'Worm (Exotic)', value: PetType.Worm },\n\t\t],\n\t});\n}\n\nenum PetCategory {\n\tCunning,\n\tFerocity,\n\tTenacity,\n}\n\nconst petCategories: Record<PetType, PetCategory> = {\n\t[PetType.PetNone]: PetCategory.Ferocity,\n\t[PetType.Bat]: PetCategory.Cunning,\n\t[PetType.Bear]: PetCategory.Tenacity,\n\t[PetType.BirdOfPrey]: PetCategory.Cunning,\n\t[PetType.Boar]: PetCategory.Tenacity,\n\t[PetType.CarrionBird]: PetCategory.Ferocity,\n\t[PetType.Cat]: PetCategory.Ferocity,\n\t[PetType.Chimaera]: PetCategory.Cunning,\n\t[PetType.CoreHound]: PetCategory.Ferocity,\n\t[PetType.Crab]: PetCategory.Tenacity,\n\t[PetType.Crocolisk]: PetCategory.Tenacity,\n\t[PetType.Devilsaur]: PetCategory.Ferocity,\n\t[PetType.Dragonhawk]: PetCategory.Cunning,\n\t[PetType.Gorilla]: PetCategory.Tenacity,\n\t[PetType.Hyena]: PetCategory.Ferocity,\n\t[PetType.Moth]: PetCategory.Ferocity,\n\t[PetType.NetherRay]: PetCategory.Cunning,\n\t[PetType.Raptor]: PetCategory.Ferocity,\n\t[PetType.Ravager]: PetCategory.Cunning,\n\t[PetType.Rhino]: PetCategory.Tenacity,\n\t[PetType.Scorpid]: PetCategory.Tenacity,\n\t[PetType.Serpent]: PetCategory.Cunning,\n\t[PetType.Silithid]: PetCategory.Cunning,\n\t[PetType.Spider]: PetCategory.Cunning,\n\t[PetType.SpiritBeast]: PetCategory.Ferocity,\n\t[PetType.SporeBat]: PetCategory.Cunning,\n\t[PetType.Tallstrider]: PetCategory.Ferocity,\n\t[PetType.Turtle]: PetCategory.Tenacity,\n\t[PetType.WarpStalker]: PetCategory.Tenacity,\n\t[PetType.Wasp]: PetCategory.Ferocity,\n\t[PetType.WindSerpent]: PetCategory.Cunning,\n\t[PetType.Wolf]: PetCategory.Ferocity,\n\t[PetType.Worm]: PetCategory.Tenacity,\n};\n\nconst categoryOrder = [PetCategory.Cunning, PetCategory.Ferocity, PetCategory.Tenacity];\nconst categoryClasses = ['cunning', 'ferocity', 'tenacity'];\n\nexport class HunterPetTalentsPicker extends Component {\n\tprivate readonly player: Player<Spec.SpecHunter>;\n\tprivate curCategory: PetCategory | null;\n\tprivate curTalents: HunterPetTalents;\n\n\t// Not saved to storage, just holds last-used values for this session.\n\tprivate savedSets: Array<HunterPetTalents>;\n\n\tconstructor(parent: HTMLElement, player: Player<Spec.SpecHunter>) {\n\t\tsuper(parent, 'hunter-pet-talents-picker');\n\t\tthis.player = player;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"pet-talents-container\"></div>\n\t\t`;\n\n\t\tthis.curCategory = this.getCategoryFromPlayer();\n\t\tthis.curTalents = this.getPetTalentsFromPlayer();\n\t\tthis.savedSets = defaultTalents.slice();\n\t\tthis.savedSets[this.curCategory] = this.curTalents;\n\t\tthis.rootElem.classList.add(categoryClasses[this.curCategory]);\n\n\t\tconst talentsContainer = this.rootElem.getElementsByClassName('pet-talents-container')[0] as HTMLElement;\n\n\t\tconst pickers = categoryOrder.map((category, i) => {\n\t\t\tconst talentsConfig = petTalentsConfig[i];\n\n\t\t\tconst pickerContainer = document.createElement('div');\n\t\t\tpickerContainer.classList.add('hunter-pet-talents-' + categoryClasses[i]);\n\t\t\ttalentsContainer.appendChild(pickerContainer);\n\n\t\t\tconst picker = new TalentsPicker(pickerContainer, player, {\n\t\t\t\ttrees: talentsConfig,\n\t\t\t\tchangedEvent: (player: Player<Spec.SpecHunter>) => player.specOptionsChangeEmitter,\n\t\t\t\tgetValue: (player: Player<Spec.SpecHunter>) => protoToTalentString(this.getPetTalentsFromPlayer(), talentsConfig),\n\t\t\t\tsetValue: (eventID: EventID, player: Player<Spec.SpecHunter>, newValue: string) => {\n\t\t\t\t\tconst options = player.getSpecOptions();\n\t\t\t\t\toptions.petTalents = talentStringToProto(HunterPetTalents.create(), newValue, talentsConfig);\n\t\t\t\t\tplayer.setSpecOptions(eventID, options);\n\n\t\t\t\t\tthis.savedSets[i] = options.petTalents;\n\t\t\t\t\tthis.curTalents = options.petTalents;\n\t\t\t\t},\n\t\t\t\tpointsPerRow: 3,\n\t\t\t\tmaxPoints: 16,\n\t\t\t});\n\n\t\t\tconst savedTalentsManager = new SavedDataManager<Player<Spec.SpecHunter>, string>(pickerContainer, this.player, {\n\t\t\t\tpresetsOnly: true,\n\t\t\t\tlabel: 'Pet Talents',\n\t\t\t\tstorageKey: '__NEVER_USED__',\n\t\t\t\tgetData: (player: Player<Spec.SpecHunter>) => protoToTalentString(this.getPetTalentsFromPlayer(), talentsConfig),\n\t\t\t\tsetData: (eventID: EventID, player: Player<Spec.SpecHunter>, newValue: string) => {\n\t\t\t\t\tconst options = player.getSpecOptions();\n\t\t\t\t\toptions.petTalents = talentStringToProto(HunterPetTalents.create(), newValue, talentsConfig);\n\t\t\t\t\tplayer.setSpecOptions(eventID, options);\n\n\t\t\t\t\tthis.savedSets[i] = options.petTalents;\n\t\t\t\t\tthis.curTalents = options.petTalents;\n\t\t\t\t},\n\t\t\t\tchangeEmitters: [this.player.specOptionsChangeEmitter],\n\t\t\t\tequals: (a: string, b: string) => a == b,\n\t\t\t\ttoJson: (a: string) => a,\n\t\t\t\tfromJson: (obj: any) => '',\n\t\t\t});\n\t\t\tsavedTalentsManager.addSavedData({\n\t\t\t\tname: 'Default',\n\t\t\t\tisPreset: true,\n\t\t\t\tdata: protoToTalentString(defaultTalents[i], talentsConfig),\n\t\t\t});\n\t\t\tsavedTalentsManager.addSavedData({\n\t\t\t\tname: 'BM',\n\t\t\t\tisPreset: true,\n\t\t\t\tdata: protoToTalentString(defaultBMTalents[i], talentsConfig),\n\t\t\t});\n\n\t\t\treturn picker;\n\t\t});\n\n\t\tplayer.specOptionsChangeEmitter.on(() => {\n\t\t\tconst petCategory = this.getCategoryFromPlayer();\n\t\t\tconst categoryIdx = categoryOrder.indexOf(petCategory);\n\n\t\t\tif (petCategory != this.curCategory) {\n\t\t\t\tthis.curCategory = petCategory;\n\t\t\t\tthis.rootElem.classList.remove(...categoryClasses);\n\t\t\t\tthis.rootElem.classList.add(categoryClasses[categoryIdx]);\n\n\t\t\t\tconst curTalents = this.getPetTalentsFromPlayer();\n\t\t\t\tif (!HunterPetTalents.equals(curTalents, this.curTalents)) {\n\t\t\t\t\t// If the current talents have also changed, this was probably a load so we shouldn't switch sets.\n\t\t\t\t\tthis.curTalents = curTalents;\n\t\t\t\t\tthis.savedSets[this.curCategory] = this.curTalents;\n\t\t\t\t} else {\n\t\t\t\t\t// Revert to the talents from last time the user was editing this category.\n\t\t\t\t\tconst options = this.player.getSpecOptions();\n\t\t\t\t\toptions.petTalents = this.savedSets[this.curCategory];\n\t\t\t\t\tthis.player.setSpecOptions(TypedEvent.nextEventID(), options);\n\t\t\t\t\tthis.curTalents = options.petTalents;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst updateIsBM = () => {\n\t\t\tconst maxPoints = this.player.getTalents().beastMastery ? 20 : 16;\n\t\t\tpickers.forEach(picker => picker.setMaxPoints(maxPoints));\n\t\t};\n\t\tplayer.talentsChangeEmitter.on(updateIsBM);\n\t\tupdateIsBM();\n\t}\n\n\tgetPetTalentsFromPlayer(): HunterPetTalents {\n\t\treturn this.player.getSpecOptions().petTalents || HunterPetTalents.create();\n\t}\n\n\tgetCategoryFromPlayer(): PetCategory {\n\t\tconst petType = this.player.getSpecOptions().petType;\n\t\treturn petCategories[petType];\n\t}\n}\n\nexport function getPetTalentsConfig(petType: PetType): TalentsConfig<HunterPetTalents> {\n\tconst petCategory = petCategories[petType];\n\tconst categoryIdx = categoryOrder.indexOf(petCategory);\n\treturn petTalentsConfig[categoryIdx];\n}\n\nexport const cunningDefault: HunterPetTalents = HunterPetTalents.create({\n\tcobraReflexes: 2,\n\tdive: true,\n\tboarsSpeed: true,\n\tmobility: 2,\n\tspikedCollar: 3,\n\tcornered: 2,\n\tfeedingFrenzy: 2,\n\twolverineBite: true,\n\tbullheaded: true,\n\twildHunt: 1,\n});\nexport const ferocityDefault: HunterPetTalents = HunterPetTalents.create({\n\tcobraReflexes: 2,\n\tdive: true,\n\tspikedCollar: 3,\n\tboarsSpeed: true,\n\tcullingTheHerd: 3,\n\tspidersBite: 3,\n\trabid: true,\n\tcallOfTheWild: true,\n\twildHunt: 1,\n});\nexport const tenacityDefault: HunterPetTalents = HunterPetTalents.create({\n\tcobraReflexes: 2,\n\tcharge: true,\n\tgreatStamina: 3,\n\tbloodOfTheRhino: 2,\n\tguardDog: 2,\n\tthunderstomp: true,\n\tgraceOfTheMantis: 2,\n\ttaunt: true,\n\troarOfSacrifice: true,\n\twildHunt: 1,\n});\nconst defaultTalents = [cunningDefault, ferocityDefault, tenacityDefault];\n\nexport const cunningBMDefault: HunterPetTalents = HunterPetTalents.create({\n\tcobraReflexes: 2,\n\tdive: true,\n\tboarsSpeed: true,\n\tmobility: 2,\n\tspikedCollar: 3,\n\tcornered: 2,\n\tfeedingFrenzy: 2,\n\twolverineBite: true,\n\tbullheaded: true,\n\tgraceOfTheMantis: 2,\n\twildHunt: 2,\n\troarOfSacrifice: true,\n});\nexport const ferocityBMDefault: HunterPetTalents = HunterPetTalents.create({\n\tcobraReflexes: 2,\n\tdive: true,\n\tbloodthirsty: 1,\n\tspikedCollar: 3,\n\tboarsSpeed: true,\n\tcullingTheHerd: 3,\n\tspidersBite: 3,\n\trabid: true,\n\tcallOfTheWild: true,\n\tsharkAttack: 2,\n\twildHunt: 2,\n});\nexport const tenacityBMDefault: HunterPetTalents = HunterPetTalents.create({\n\tcobraReflexes: 2,\n\tcharge: true,\n\tgreatStamina: 3,\n\tspikedCollar: 3,\n\tbloodOfTheRhino: 2,\n\tguardDog: 2,\n\tthunderstomp: true,\n\tgraceOfTheMantis: 2,\n\ttaunt: true,\n\troarOfSacrifice: true,\n\twildHunt: 2,\n});\nconst defaultBMTalents = [cunningBMDefault, ferocityBMDefault, tenacityBMDefault];\n\nconst cunningPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig([\n\t{\n\t\tname: 'Cunning',\n\t\tbackgroundUrl: 'https://wotlkdb.com/static/images/wow/hunterpettalents/bg_3.jpg?85',\n\t\ttalents: [\n\t\t\t{\n\t\t\t\tfieldName: 'cobraReflexes',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [61682],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'dive',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [23145],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'greatStamina',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [61686],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'naturalArmor',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [61689],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'boarsSpeed',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [19596],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'mobility',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [53554],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'owlsFocus',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53514, 53516],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'spikedCollar',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [53182],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'cullingTheHerd',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [61680, 61681, 52858],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'lionhearted',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [53409, 53411],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'carrionFeeder',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [54044],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'greatResistance',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [53427, 53429],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'cornered',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [52234, 53497],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'feedingFrenzy',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [53511],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'wolverineBite',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [53508],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'roarOfRecovery',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [53517],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'bullheaded',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53490],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'graceOfTheMantis',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [53450],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'wildHunt',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 5,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [62758, 62762],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'roarOfSacrifice',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 5,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [53480],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t],\n\t},\n]);\nconst ferocityPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig([\n\t{\n\t\tname: 'Ferocity',\n\t\tbackgroundUrl: 'https://wotlkdb.com/static/images/wow/hunterpettalents/bg_1.jpg?85',\n\t\ttalents: [\n\t\t\t{\n\t\t\t\tfieldName: 'cobraReflexes',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [61682],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'dive',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [23145],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'greatStamina',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [61686],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'naturalArmor',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [61689],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'improvedCower',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [53180],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'bloodthirsty',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [53186],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'spikedCollar',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53182],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'boarsSpeed',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [19596],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'cullingTheHerd',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [61680, 61681, 52858],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'lionhearted',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53409, 53411],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'charge',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [61685],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'heartOfThePheonix',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [55709],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'spidersBite',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53203],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'greatResistance',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [53427, 53429],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'rabid',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [53401],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'lickYourWounds',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [53426],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'callOfTheWild',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53434],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'sharkAttack',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 5,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [62759],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'wildHunt',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 5,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [62758, 62762],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t],\n\t},\n]);\nconst tenacityPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig([\n\t{\n\t\tname: 'Tenacity',\n\t\tbackgroundUrl: 'https://wotlkdb.com/static/images/wow/hunterpettalents/bg_2.jpg?85',\n\t\ttalents: [\n\t\t\t{\n\t\t\t\tfieldName: 'cobraReflexes',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [61682],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'charge',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [61685],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'greatStamina',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [61686],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'naturalArmor',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [61689],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'spikedCollar',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [53182],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'boarsSpeed',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [19596],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'bloodOfTheRhino',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53481],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'petBarding',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 1,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 0,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [53175],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'cullingTheHerd',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [61680, 61681, 52858],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'guardDog',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [53178],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'lionhearted',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53409, 53411],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'thunderstomp',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [63900],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'graceOfTheMantis',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53450],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'greatResistance',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [53427, 53429],\n\t\t\t\tmaxPoints: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'lastStand',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 0,\n\t\t\t\t},\n\t\t\t\tspellIds: [53478],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'taunt',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 2,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [53477],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'roarOfSacrifice',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 3,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [53480],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'intervene',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 3,\n\t\t\t\t},\n\t\t\t\tspellIds: [53476],\n\t\t\t\tmaxPoints: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'silverback',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 5,\n\t\t\t\t\tcolIdx: 1,\n\t\t\t\t},\n\t\t\t\tspellIds: [62764],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldName: 'wildHunt',\n\t\t\t\tlocation: {\n\t\t\t\t\trowIdx: 5,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tprereqLocation: {\n\t\t\t\t\trowIdx: 4,\n\t\t\t\t\tcolIdx: 2,\n\t\t\t\t},\n\t\t\t\tspellIds: [62758, 62762],\n\t\t\t\tmaxPoints: 2,\n\t\t\t},\n\t\t],\n\t},\n]);\n\nconst petTalentsConfig = [\n\tcunningPetTalentsConfig,\n\tferocityPetTalentsConfig,\n\ttenacityPetTalentsConfig,\n];\n","import { ActionId } from '../proto_utils/action_id.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { isRightClick } from '../utils.js';\n\nimport { Component } from './component.js';\nimport { Input, InputConfig } from './input.js';\n\n// Data for creating an icon-based input component.\n// \n// E.g. one of these for arcane brilliance, another for kings, etc.\n// ModObject is the object being modified (Sim, Player, or Target).\n// ValueType is either number or boolean.\nexport interface IconPickerConfig<ModObject, ValueType> extends InputConfig<ModObject, ValueType> {\n\tid: ActionId;\n\n\t// The number of possible 'states' this icon can have. Most inputs will use 2\n\t// for a bi-state icon (on or off). 0 indicates an unlimited number of states.\n\tstates: number;\n\n\t// Only used if states >= 3.\n\timprovedId?: ActionId;\n\n\t// Only used if states >= 4.\n\timprovedId2?: ActionId;\n};\n\n// Icon-based UI for picking buffs / consumes / etc\n// ModObject is the object being modified (Sim, Player, or Target).\nexport class IconPicker<ModObject, ValueType> extends Input<ModObject, ValueType> {\n\tprivate readonly config: IconPickerConfig<ModObject, ValueType>;\n\n\tprivate readonly rootAnchor: HTMLAnchorElement;\n\tprivate readonly improvedAnchor: HTMLAnchorElement;\n\tprivate readonly improvedAnchor2: HTMLAnchorElement;\n\tprivate readonly counterElem: HTMLElement;\n\n\tprivate currentValue: number;\n\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: IconPickerConfig<ModObject, ValueType>) {\n\t\tsuper(parent, 'icon-input-root', modObj, config);\n\t\tthis.config = config;\n\t\tthis.currentValue = 0;\n\n\t\tthis.rootAnchor = document.createElement('a');\n\t\tthis.rootAnchor.classList.add('icon-input');\n\t\tthis.rootAnchor.target = '_blank';\n\t\tthis.rootElem.appendChild(this.rootAnchor);\n\n\t\tconst useImprovedIcons = Boolean(this.config.improvedId);\n\t\tif (useImprovedIcons) {\n\t\t\tthis.rootAnchor.classList.add('use-improved-icons');\n\t\t}\n\t\tif (this.config.improvedId2) {\n\t\t\tthis.rootAnchor.classList.add('use-improved-icons2');\n\t\t}\n\t\tif (!useImprovedIcons && this.config.states > 2) {\n\t\t\tthis.rootAnchor.classList.add('use-counter');\n\t\t}\n\n\t\tconst levelContainer = document.createElement('div');\n\t\tlevelContainer.classList.add('icon-input-level-container');\n\t\tthis.rootAnchor.appendChild(levelContainer);\n\t\tlevelContainer.innerHTML = `\n      <a class=\"icon-input-improved icon-input-improved1\"></a>\n      <a class=\"icon-input-improved icon-input-improved2\"></a>\n      <span class=\"icon-input-counter\"></span>\n    `;\n\n\t\tthis.improvedAnchor = this.rootAnchor.getElementsByClassName('icon-input-improved1')[0] as HTMLAnchorElement;\n\t\tthis.improvedAnchor2 = this.rootAnchor.getElementsByClassName('icon-input-improved2')[0] as HTMLAnchorElement;\n\t\tthis.counterElem = this.rootAnchor.getElementsByClassName('icon-input-counter')[0] as HTMLElement;\n\n\t\tthis.config.id.fillAndSet(this.rootAnchor, true, true);\n\n\t\tif (this.config.states >= 3 && this.config.improvedId) {\n\t\t\tthis.config.improvedId.fillAndSet(this.improvedAnchor, true, true);\n\t\t}\n\t\tif (this.config.states >= 4 && this.config.improvedId2) {\n\t\t\tthis.config.improvedId2.fillAndSet(this.improvedAnchor2, true, true);\n\t\t}\n\n\t\tthis.init();\n\n\t\tthis.rootAnchor.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.rootAnchor.addEventListener('contextmenu', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.rootAnchor.addEventListener('mousedown', event => {\n\t\t\tconst rightClick = isRightClick(event);\n\n\t\t\tif (rightClick) {\n\t\t\t\tif (this.currentValue > 0) {\n\t\t\t\t\tthis.currentValue--;\n\t\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.config.states == 0 || (this.currentValue + 1) < this.config.states) {\n\t\t\t\t\tthis.currentValue++;\n\t\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.rootAnchor.addEventListener('touchstart', event => {\n\t\t\tif (this.config.states == 0 || (this.currentValue + 1) < this.config.states) {\n\t\t\t\tthis.currentValue++;\n\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t\t} else if (this.currentValue > 0) { // roll over\n\t\t\t\tthis.currentValue = 0;\n\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t\t}\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.rootAnchor.addEventListener('touchend', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.rootAnchor;\n\t}\n\n\tgetInputValue(): ValueType {\n\t\tif (this.config.states == 2) {\n\t\t\treturn Boolean(this.currentValue) as unknown as ValueType;\n\t\t} else {\n\t\t\treturn this.currentValue as unknown as ValueType;\n\t\t}\n\t}\n\n\t// Returns the ActionId of the currently selected value, or null if none selected.\n\tgetActionId(): ActionId | null {\n\n\t\t// Go directly to source because during event propogation \n\t\t//  the internal `this.currentValue` may not yet have been updated.\n\t\tconst v = Number(this.config.getValue(this.modObject));\n\t\tif (v == 0) {\n\t\t\treturn null;\n\t\t} else if (v == 1) {\n\t\t\treturn this.config.id;\n\t\t} else if (v == 2 && this.config.improvedId) {\n\t\t\treturn this.config.improvedId;\n\t\t} else if (v == 3 && this.config.improvedId2) {\n\t\t\treturn this.config.improvedId2;\n\t\t} else {\n\t\t\treturn this.config.id;\n\t\t}\n\t}\n\n\tsetInputValue(newValue: ValueType) {\n\t\tthis.currentValue = Number(newValue);\n\n\t\tif (this.currentValue > 0) {\n\t\t\tthis.rootAnchor.classList.add('active');\n\t\t\tthis.counterElem.classList.add('active');\n\t\t} else {\n\t\t\tthis.rootAnchor.classList.remove('active');\n\t\t\tthis.counterElem.classList.remove('active');\n\t\t}\n\n\t\tif (this.config.states >= 3 && this.config.improvedId) {\n\t\t\tif (this.currentValue > 1) {\n\t\t\t\tthis.improvedAnchor.classList.add('active');\n\t\t\t} else {\n\t\t\t\tthis.improvedAnchor.classList.remove('active');\n\t\t\t}\n\t\t}\n\t\tif (this.config.states >= 4 && this.config.improvedId2) {\n\t\t\tif (this.currentValue > 2) {\n\t\t\t\tthis.improvedAnchor2.classList.add('active');\n\t\t\t} else {\n\t\t\t\tthis.improvedAnchor2.classList.remove('active');\n\t\t\t}\n\t\t}\n\n\t\tif (!this.config.improvedId && (this.config.states > 3 || this.config.states == 0)) {\n\t\t\tthis.counterElem.textContent = String(this.currentValue);\n\t\t}\n\t}\n}\n","import { SimUI } from '../sim_ui.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Component } from './component.js';\n\nexport class LogRunner extends Component {\n\tconstructor(parent: HTMLElement, simUI: SimUI) {\n\t\tsuper(parent, 'log-runner-root');\n\n\t\tconst controlBar = document.createElement('div');\n\t\tcontrolBar.classList.add('log-runner-control-bar');\n\t\tthis.rootElem.appendChild(controlBar);\n\n\t\tconst simButton = document.createElement('button');\n\t\tsimButton.classList.add('log-runner-button', 'sim-button');\n\t\tsimButton.textContent = 'SIM 1 ITERATION';\n\t\tcontrolBar.appendChild(simButton);\n\n\t\tconst logsDiv = document.createElement('div');\n\t\tlogsDiv.classList.add('log-runner-logs');\n\t\tthis.rootElem.appendChild(logsDiv);\n\n\t\tsimButton.addEventListener('click', async () => simUI.runSimOnce());\n\n\t\tsimUI.sim.simResultEmitter.on((eventID, simResult) => {\n\t\t\tconst logs = simResult.logs;\n\t\t\tlogsDiv.textContent = '';\n\t\t\tlogs\n\t\t\t\t.filter(log => {\n\t\t\t\t\treturn !log.isCastCompleted();\n\t\t\t\t})\n\t\t\t\t.forEach(log => {\n\t\t\t\t\tconst lineElem = document.createElement('span');\n\t\t\t\t\tlineElem.textContent = log.toString();\n\t\t\t\t\tlogsDiv.appendChild(lineElem);\n\t\t\t\t});\n\t\t});\n\t}\n}\n","import { ActionId } from '../proto_utils/action_id.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { SimUI } from '../sim_ui.js';\n\nimport { Component } from './component.js';\nimport { IconPicker, IconPickerConfig } from './icon_picker.js';\nimport { Input, InputConfig } from './input.js';\n\nexport interface MultiIconPickerItemConfig<ModObject> extends IconPickerConfig<ModObject, any> {\n}\n\nexport interface MultiIconPickerConfig<ModObject> {\n\tinputs: Array<MultiIconPickerItemConfig<ModObject>>,\n\temptyColor: string,\n\tnumColumns: number,\n\tlabel?: string,\n\tcategoryId?: ActionId,\n}\n\n// Icon-based UI for a dropdown with multiple icon pickers.\n// ModObject is the object being modified (Sim, Player, or Target).\nexport class MultiIconPicker<ModObject> extends Component {\n\tprivate readonly config: MultiIconPickerConfig<ModObject>;\n\n\tprivate currentValue: ActionId | null;\n\n\tprivate readonly dropdownRootElem: HTMLElement;\n\tprivate readonly buttonElem: HTMLAnchorElement;\n\tprivate readonly pickers: Array<IconPicker<ModObject, any>>;\n\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: MultiIconPickerConfig<ModObject>, simUI: SimUI) {\n\t\tsuper(parent, 'multi-icon-picker-root');\n\t\tthis.config = config;\n\t\tthis.currentValue = null;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<span class=\"multi-icon-picker-label\"></span>\n\t\t\t<div class=\"dropdown-root multi-icon-picker-dropdown-root\">\n\t\t\t\t<a class=\"dropdown-button multi-icon-picker-button\"></a>\n\t\t\t\t<div class=\"dropdown-panel multi-icon-picker-dropdown\"></div>\n\t\t\t</div>\n    `;\n\t\tthis.dropdownRootElem = this.rootElem.getElementsByClassName('multi-icon-picker-dropdown-root')[0] as HTMLElement;\n\n\t\tconst labelElem = this.rootElem.getElementsByClassName('multi-icon-picker-label')[0] as HTMLElement;\n\t\tif (config.label) {\n\t\t\tlabelElem.textContent = config.label;\n\t\t} else {\n\t\t\tlabelElem.remove();\n\t\t}\n\n\t\tthis.buttonElem = this.rootElem.getElementsByClassName('multi-icon-picker-button')[0] as HTMLAnchorElement;\n\t\tconst dropdownElem = this.rootElem.getElementsByClassName('multi-icon-picker-dropdown')[0] as HTMLElement;\n\n\t\tthis.buttonElem.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.buttonElem.addEventListener('touchstart', event => {\n\t\t\tif (dropdownElem.style.display == \"block\") {\n\t\t\t\tdropdownElem.style.display = \"none\";\n\t\t\t} else {\n\t\t\t\tdropdownElem.style.display = \"block\";\n\t\t\t}\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.buttonElem.addEventListener('touchend', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\tdropdownElem.style.gridTemplateColumns = `repeat(${this.config.numColumns}, 1fr)`;\n\n\t\tthis.pickers = config.inputs.map((pickerConfig, i) => {\n\t\t\tconst optionContainer = document.createElement('div');\n\t\t\toptionContainer.classList.add('dropdown-option-container');\n\t\t\toptionContainer.classList.add('multi-icon-dropdown-container');\n\t\t\tdropdownElem.appendChild(optionContainer);\n\n\t\t\tconst option = document.createElement('a');\n\t\t\toption.classList.add('dropdown-option', 'multi-icon-picker-option');\n\t\t\toptionContainer.appendChild(option);\n\t\t\treturn new IconPicker(option, modObj, pickerConfig);\n\t\t});\n\t\tsimUI.sim.waitForInit().then(() => this.updateButtonImage());\n\t\tsimUI.changeEmitter.on(() => this.updateButtonImage());\n\t}\n\n\tprivate updateButtonImage() {\n\t\tthis.currentValue = this.getMaxValue();\n\n\t\tif (this.currentValue) {\n\t\t\tthis.dropdownRootElem.classList.add('active');\n\t\t\tif (this.config.categoryId != null) {\n\t\t\t\tthis.config.categoryId.fillAndSet(this.buttonElem, false, true);\n\t\t\t} else {\n\t\t\t\tthis.currentValue.fillAndSet(this.buttonElem, false, true);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.dropdownRootElem.classList.remove('active');\n\t\t\tif (this.config.categoryId != null) {\n\t\t\t\tthis.config.categoryId.fillAndSet(this.buttonElem, false, true);\n\t\t\t} else {\n\t\t\t\tthis.buttonElem.style.backgroundImage = '';\n\t\t\t}\n\t\t\tthis.buttonElem.style.backgroundColor = this.config.emptyColor;\n\t\t\tthis.buttonElem.removeAttribute(\"href\");\n\t\t}\n\t}\n\n\tprivate getMaxValue(): ActionId | null {\n\t\treturn this.pickers.map(picker => picker.getActionId()).filter(id => id != null)[0] || null;\n\t}\n}\n","import { Class } from '../proto/common.js';\nimport { EquipmentSpec } from '../proto/common.js';\nimport { ItemSpec } from '../proto/common.js';\nimport { Race } from '../proto/common.js';\nimport { Spec } from '../proto/common.js';\nimport { Stat } from '../proto/common.js';\nimport { SimUI } from '../sim_ui.js';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { Sim } from '../sim.js';\nimport { Player } from '../player.js';\nimport { classNames, nameToClass, nameToRace, statNames } from '../proto_utils/names.js';\nimport { talentSpellIdsToTalentString } from '../talents/factory.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { BooleanPicker } from '../components/boolean_picker.js';\nimport { NumberPicker } from '../components/number_picker.js';\nimport { getEnumValues } from '../utils.js';\n\nimport { Popup } from './popup.js';\n\ndeclare var $: any;\ndeclare var tippy: any;\n\nexport class SettingsMenu extends Popup {\n\tprivate readonly simUI: SimUI;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI) {\n\t\tsuper(parent);\n\t\tthis.rootElem.classList.add('settings-menu');\n\t\tthis.simUI = simUI;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"settings-menu-title\">\n\t\t\t\t<span>OPTIONS</span>\n\t\t\t</div>\n\t\t\t<div class=\"settings-menu-content\">\n\t\t\t\t<div class=\"settings-menu-content-left\">\n\t\t\t\t\t<button class=\"restore-defaults-button sim-button\">RESTORE DEFAULTS</button>\n\t\t\t\t\t<div class=\"settings-menu-section\">\n\t\t\t\t\t\t<div class=\"fixed-rng-seed\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"last-used-rng-seed-container\">\n\t\t\t\t\t\t\t<span>Last used RNG seed:</span><span class=\"last-used-rng-seed\">0</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"show-threat-metrics-picker\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"show-experimental-picker\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-menu-content-right\">\n\t\t\t\t\t<div class=\"settings-menu-section settings-menu-ep-weights within-raid-sim-hide\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.addCloseButton();\n\n\t\tconst restoreDefaultsButton = this.rootElem.getElementsByClassName('restore-defaults-button')[0] as HTMLElement;\n\t\trestoreDefaultsButton.addEventListener('click', event => {\n\t\t\tthis.simUI.applyDefaults(TypedEvent.nextEventID());\n\t\t});\n\t\ttippy(restoreDefaultsButton, {\n\t\t\t'content': 'Restores all default settings (gear, consumes, buffs, talents, EP weights, etc).',\n\t\t\t'allowHTML': true,\n\t\t});\n\n\t\tconst fixedRngSeed = this.rootElem.getElementsByClassName('fixed-rng-seed')[0] as HTMLElement;\n\t\tnew NumberPicker(fixedRngSeed, this.simUI.sim, {\n\t\t\tlabel: 'Fixed RNG Seed',\n\t\t\tlabelTooltip: 'Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.',\n\t\t\tchangedEvent: (sim: Sim) => sim.fixedRngSeedChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getFixedRngSeed(),\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\tsim.setFixedRngSeed(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tconst lastUsedRngSeed = this.rootElem.getElementsByClassName('last-used-rng-seed')[0] as HTMLElement;\n\t\tlastUsedRngSeed.textContent = String(this.simUI.sim.getLastUsedRngSeed());\n\t\tthis.simUI.sim.lastUsedRngSeedChangeEmitter.on(() => lastUsedRngSeed.textContent = String(this.simUI.sim.getLastUsedRngSeed()));\n\n\t\tconst showThreatMetrics = this.rootElem.getElementsByClassName('show-threat-metrics-picker')[0] as HTMLElement;\n\t\tnew BooleanPicker(showThreatMetrics, this.simUI.sim, {\n\t\t\tlabel: 'Show Threat/Tank Options',\n\t\t\tlabelTooltip: 'Shows all options and metrics relevant to tanks, like TPS/DTPS.',\n\t\t\tchangedEvent: (sim: Sim) => sim.showThreatMetricsChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getShowThreatMetrics(),\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\tsim.setShowThreatMetrics(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\t// Comment this out when there are no experiments to show.\n\t\tconst showExperimental = this.rootElem.getElementsByClassName('show-experimental-picker')[0] as HTMLElement;\n\t\tnew BooleanPicker(showExperimental, this.simUI.sim, {\n\t\t\tlabel: 'Show Experimental',\n\t\t\tchangedEvent: (sim: Sim) => sim.showExperimentalChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getShowExperimental(),\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\tsim.setShowExperimental(eventID, newValue);\n\t\t\t},\n\t\t});\n\t}\n}\n","import { Component } from '../components/component.js';\n\nexport class ResultsViewer extends Component {\n\treadonly pendingElem: HTMLElement;\n\treadonly contentElem: HTMLElement;\n\n\tconstructor(parentElem: HTMLElement) {\n\t\tsuper(parentElem, 'results-viewer');\n\t\tthis.rootElem.innerHTML = `\n      <div class=\"results-pending\">\n        <div class=\"loader\"></div>\n      </div>\n      <div class=\"results-content\">\n      </div>\n\t\t`;\n\n\t\tthis.pendingElem = this.rootElem.getElementsByClassName('results-pending')[0] as HTMLElement;\n\t\tthis.contentElem = this.rootElem.getElementsByClassName('results-content')[0] as HTMLElement;\n\t\tthis.hideAll();\n\t}\n\n\thideAll() {\n\t\tthis.contentElem.style.display = 'none';\n\t\tthis.pendingElem.style.display = 'none';\n\t}\n\n\tsetPending() {\n\t\tthis.contentElem.style.display = 'none';\n\t\tthis.pendingElem.style.display = 'initial';\n\t}\n\n\tsetContent(innerHTML: string) {\n\t\tthis.contentElem.innerHTML = innerHTML;\n\t\tthis.contentElem.style.display = 'initial';\n\t\tthis.pendingElem.style.display = 'none';\n\t}\n}\n","import { Spec } from './proto/common.js';\n\n// This file is for anything related to launching a new sim. DO NOT touch this\n// file until your sim is ready to launch!\n\nexport enum LaunchStatus {\n\tUnlaunched,\n\tAlpha,\n\tBeta,\n\tLaunched,\n}\n\nexport const raidSimLaunched = false;\n\n// This list controls which links are shown in the top-left dropdown menu.\nexport const simLaunchStatuses: Record<Spec, LaunchStatus> = {\n\t[Spec.SpecBalanceDruid]: LaunchStatus.Alpha,\n\t[Spec.SpecElementalShaman]: LaunchStatus.Alpha,\n\t[Spec.SpecEnhancementShaman]: LaunchStatus.Alpha,\n\t[Spec.SpecFeralDruid]: LaunchStatus.Alpha,\n\t[Spec.SpecFeralTankDruid]: LaunchStatus.Unlaunched,\n\t[Spec.SpecHunter]: LaunchStatus.Beta,\n\t[Spec.SpecMage]: LaunchStatus.Alpha,\n\t[Spec.SpecRogue]: LaunchStatus.Alpha,\n\t[Spec.SpecRetributionPaladin]: LaunchStatus.Alpha,\n\t[Spec.SpecProtectionPaladin]: LaunchStatus.Alpha,\n\t[Spec.SpecHealingPriest]: LaunchStatus.Unlaunched,\n\t[Spec.SpecShadowPriest]: LaunchStatus.Alpha,\n\t[Spec.SpecSmitePriest]: LaunchStatus.Alpha,\n\t[Spec.SpecWarlock]: LaunchStatus.Alpha,\n\t[Spec.SpecWarrior]: LaunchStatus.Alpha,\n\t[Spec.SpecProtectionWarrior]: LaunchStatus.Alpha,\n\t[Spec.SpecDeathknight]: LaunchStatus.Alpha,\n\t[Spec.SpecTankDeathknight]: LaunchStatus.Unlaunched,\n};\n\n// Meme specs are excluded from title drop-down menu.\nexport const memeSpecs: Array<Spec> = [\n\tSpec.SpecSmitePriest,\n];\n\nexport function getLaunchedSims(): Array<Spec> {\n\treturn Object.keys(simLaunchStatuses)\n\t\t.map(specStr => parseInt(specStr) as Spec)\n\t\t.filter(spec => simLaunchStatuses[spec] > LaunchStatus.Unlaunched);\n}\n","import { Component } from '../components/component.js';\nimport { getLaunchedSims, raidSimLaunched, memeSpecs } from '../launched_sims.js';\nimport { Spec } from '../proto/common.js';\nimport {\n\tclassColors,\n\tgetSpecSiteUrl,\n\tnaturalSpecOrder,\n\traidSimSiteUrl,\n\tspecNames,\n\tspecToClass,\n\ttitleIcons,\n\traidSimIcon,\n} from '../proto_utils/utils.js';\n\ndeclare var tippy: any;\n\nexport interface SimLinkOption {\n\ticonUrl: string,\n\thref: string,\n\ttext: string,\n\tcolor: string,\n};\n\n// Dropdown menu for selecting a player.\nexport class Title extends Component {\n\tprivate readonly buttonElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, currentSpec: Spec | null) {\n\t\tsuper(parent, 'sim-title-root');\n\t\tthis.rootElem.classList.add('dropdown-root');\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"dropdown-button sim-title-button\"></div>\n\t\t\t<div class=\"dropdown-panel sim-title-dropdown within-raid-sim-hide\"></div>\n    `;\n\n\t\tthis.buttonElem = this.rootElem.getElementsByClassName('sim-title-button')[0] as HTMLElement;\n\t\tconst dropdownPanel = this.rootElem.getElementsByClassName('dropdown-panel')[0] as HTMLElement;\n\n\t\tthis.buttonElem.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\tconst orderedLaunchedSpecs: Array<Spec | null> = (naturalSpecOrder\n\t\t\t.filter(spec => getLaunchedSims().includes(spec)) as Array<Spec | null>)\n\t\t\t.filter(spec => !spec || !memeSpecs.includes(spec))\n\t\t\t.concat(raidSimLaunched ? [null] : []); // Null represents the raid sim.\n\n\t\tdropdownPanel.style.gridTemplateRows = `repeat(${Math.ceil(orderedLaunchedSpecs.length / 2)}, 1fr)`;\n\n\t\tconst currentOption = this.makeOptionData(currentSpec, true);\n\t\tconst otherOptions = orderedLaunchedSpecs.map(spec => this.makeOptionData(spec, false));\n\n\t\tthis.buttonElem.appendChild(Title.makeOptionElem(currentOption));\n\n\t\tconst isWithinRaidSim = this.rootElem.closest('.within-raid-sim') != null;\n\t\tif (!isWithinRaidSim) {\n\t\t\totherOptions.forEach((option, i) => dropdownPanel.appendChild(this.makeOption(option)));\n\t\t}\n\t}\n\n\tprivate makeOptionData(spec: Spec | null, isButton: boolean) {\n\t\tif (spec == null) {\n\t\t\treturn {\n\t\t\t\ticonUrl: raidSimIcon,\n\t\t\t\thref: raidSimSiteUrl,\n\t\t\t\ttext: 'RAID',\n\t\t\t\tcolor: isButton ? '' : 'black',\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\ticonUrl: titleIcons[spec],\n\t\t\t\thref: getSpecSiteUrl(spec),\n\t\t\t\ttext: specNames[spec].toUpperCase(),\n\t\t\t\tcolor: isButton ? '' : classColors[specToClass[spec]],\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate makeOption(data: SimLinkOption): HTMLElement {\n\t\tconst option = Title.makeOptionElem(data);\n\n\t\toption.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t\twindow.location.href = data.href;\n\t\t});\n\n\t\treturn option;\n\t}\n\n\tstatic makeOptionElem(data: SimLinkOption): HTMLElement {\n\t\tconst optionContainer = document.createElement('a');\n\t\toptionContainer.href = data.href;\n\t\toptionContainer.classList.add('sim-title-dropdown-option-container', 'dropdown-option-container');\n\n\t\tconst option = document.createElement('div');\n\t\toption.classList.add('sim-title-option', 'dropdown-option');\n\t\toptionContainer.appendChild(option);\n\n\t\tif (data.color) {\n\t\t\toption.style.backgroundColor = data.color;\n\t\t}\n\n\t\tconst icon = document.createElement('img');\n\t\ticon.src = data.iconUrl;\n\t\ticon.classList.add('sim-title-icon');\n\t\toption.appendChild(icon);\n\n\t\tconst labelDiv = document.createElement('div');\n\t\tlabelDiv.classList.add('sim-title-label-container');\n\t\toption.appendChild(labelDiv);\n\n\t\tif (!data.color) { // Hacky check for 'isButton'\n\t\t\tconst simLabel = document.createElement('span');\n\t\t\tsimLabel.textContent = 'WotLK Simulator';\n\t\t\tsimLabel.classList.add('sim-title-sim-label', 'sim-title-label');\n\t\t\tlabelDiv.appendChild(simLabel);\n\t\t}\n\n\t\tconst label = document.createElement('span');\n\t\tlabel.textContent = data.text;\n\t\tlabel.classList.add('sim-title-spec-label', 'sim-title-label');\n\t\tlabelDiv.appendChild(label);\n\n\t\treturn optionContainer;\n\t}\n}\n","import { Component } from './components/component.js';\nimport { NumberPicker } from './components/number_picker.js';\nimport { ResultsViewer } from './components/results_viewer.js';\nimport { Title } from './components/title.js';\nimport { Spec } from './proto/common.js';\nimport { SimOptions } from './proto/api.js';\nimport { LaunchStatus } from './launched_sims.js';\nimport { specToLocalStorageKey } from './proto_utils/utils.js';\n\nimport { Sim, SimError } from './sim.js';\nimport { Target } from './target.js';\nimport { EventID, TypedEvent } from './typed_event.js';\n\ndeclare var tippy: any;\ndeclare var pako: any;\n\nconst URLMAXLEN = 2048;\nconst noticeText = '';\n//const noticeText = 'We are looking for help migrating our sims to Wrath of the Lich King. If you\\'d like to participate in a fun side project working with an open-source community please <a href=\"https://discord.gg/jJMPr9JWwx\" target=\"_blank\">join our discord!</a>';\n\n// Config for displaying a warning to the user whenever a condition is met.\nexport interface SimWarning {\n\tupdateOn: TypedEvent<any>,\n\tgetContent: () => string | Array<string>,\n}\n\nexport interface SimUIConfig {\n\t// The spec, if an individual sim, or null if the raid sim.\n\tspec: Spec | null,\n\tlaunchStatus: LaunchStatus,\n\tknownIssues?: Array<string>,\n}\n\n// Shared UI for all individual sims and the raid sim.\nexport abstract class SimUI extends Component {\n\treadonly sim: Sim;\n\treadonly isWithinRaidSim: boolean;\n\n\t// Emits when anything from the sim, raid, or encounter changes.\n\treadonly changeEmitter;\n\n\treadonly resultsViewer: ResultsViewer\n\n\tprivate warnings: Array<SimWarning>;\n\tprivate warningsTippy: any;\n\n\tconstructor(parentElem: HTMLElement, sim: Sim, config: SimUIConfig) {\n\t\tsuper(parentElem, 'sim-ui');\n\t\tthis.sim = sim;\n\t\tthis.rootElem.innerHTML = simHTML;\n\t\tthis.isWithinRaidSim = this.rootElem.closest('.within-raid-sim') != null;\n\t\tif (!this.isWithinRaidSim) {\n\t\t\tthis.rootElem.classList.add('not-within-raid-sim');\n\t\t}\n\n\t\tthis.changeEmitter = TypedEvent.onAny([\n\t\t\tthis.sim.changeEmitter,\n\t\t], 'SimUIChange');\n\n\t\tthis.sim.crashEmitter.on((eventID: EventID, error: SimError) => this.handleCrash(error));\n\n\t\tconst updateShowDamageMetrics = () => {\n\t\t\tif (this.sim.getShowDamageMetrics()) {\n\t\t\t\tthis.rootElem.classList.remove('hide-damage-metrics');\n\t\t\t} else {\n\t\t\t\tthis.rootElem.classList.add('hide-damage-metrics');\n\t\t\t}\n\t\t};\n\t\tupdateShowDamageMetrics();\n\t\tthis.sim.showDamageMetricsChangeEmitter.on(updateShowDamageMetrics);\n\n\t\tconst updateShowThreatMetrics = () => {\n\t\t\tif (this.sim.getShowThreatMetrics()) {\n\t\t\t\tthis.rootElem.classList.remove('hide-threat-metrics');\n\t\t\t} else {\n\t\t\t\tthis.rootElem.classList.add('hide-threat-metrics');\n\t\t\t}\n\t\t};\n\t\tupdateShowThreatMetrics();\n\t\tthis.sim.showThreatMetricsChangeEmitter.on(updateShowThreatMetrics);\n\n\t\tconst updateShowHealingMetrics = () => {\n\t\t\tif (this.sim.getShowHealingMetrics()) {\n\t\t\t\tthis.rootElem.classList.remove('hide-healing-metrics');\n\t\t\t} else {\n\t\t\t\tthis.rootElem.classList.add('hide-healing-metrics');\n\t\t\t}\n\t\t};\n\t\tupdateShowHealingMetrics();\n\t\tthis.sim.showHealingMetricsChangeEmitter.on(updateShowHealingMetrics);\n\n\t\tconst updateShowExperimental = () => {\n\t\t\tif (this.sim.getShowExperimental()) {\n\t\t\t\tthis.rootElem.classList.remove('hide-experimental');\n\t\t\t} else {\n\t\t\t\tthis.rootElem.classList.add('hide-experimental');\n\t\t\t}\n\t\t};\n\t\tupdateShowExperimental();\n\t\tthis.sim.showExperimentalChangeEmitter.on(updateShowExperimental);\n\n\t\tconst noticesElem = document.getElementsByClassName('notices')[0] as HTMLElement;\n\t\tif (noticeText) {\n\t\t\ttippy(noticesElem, {\n\t\t\t\tcontent: noticeText,\n\t\t\t\tallowHTML: true,\n\t\t\t\tinteractive: true,\n\t\t\t});\n\t\t} else {\n\t\t\tnoticesElem.remove();\n\t\t}\n\n\t\tthis.warnings = [];\n\t\tconst warningsElem = document.getElementsByClassName('warnings')[0] as HTMLElement;\n\t\tthis.warningsTippy = tippy(warningsElem, {\n\t\t\tcontent: '',\n\t\t\tallowHTML: true,\n\t\t});\n\t\tthis.updateWarnings();\n\n\t\tlet statusStr = '';\n\t\tif (config.launchStatus == LaunchStatus.Unlaunched) {\n\t\t\tstatusStr = 'This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.';\n\t\t} else if (config.launchStatus == LaunchStatus.Alpha) {\n\t\t\tstatusStr = 'This sim is in ALPHA. Bugs are expected; please let us know if you find one!';\n\t\t} else if (config.launchStatus == LaunchStatus.Beta) {\n\t\t\tstatusStr = 'This sim is in BETA. There may still be a few bugs; please let us know if you find one!';\n\t\t}\n\t\tif (statusStr) {\n\t\t\tconfig.knownIssues = [statusStr].concat(config.knownIssues || []);\n\t\t}\n\t\tif (config.knownIssues && config.knownIssues.length) {\n\t\t\tconst knownIssuesContainer = document.getElementsByClassName('known-issues')[0] as HTMLElement;\n\t\t\tknownIssuesContainer.style.display = 'initial';\n\t\t\ttippy(knownIssuesContainer, {\n\t\t\t\tcontent: `\n\t\t\t\t<ul class=\"known-issues-tooltip\">\n\t\t\t\t\t${config.knownIssues.map(issue => '<li>' + issue + '</li>').join('')}\n\t\t\t\t</ul>\n\t\t\t\t`,\n\t\t\t\tallowHTML: true,\n\t\t\t\tinteractive: true,\n\t\t\t});\n\t\t}\n\n\t\tconst resultsViewerElem = this.rootElem.getElementsByClassName('sim-sidebar-results')[0] as HTMLElement;\n\t\tthis.resultsViewer = new ResultsViewer(resultsViewerElem);\n\n\t\tconst titleElem = this.rootElem.getElementsByClassName('sim-sidebar-title')[0] as HTMLElement;\n\t\tconst title = new Title(titleElem, config.spec);\n\n\t\tconst simActionsContainer = this.rootElem.getElementsByClassName('sim-sidebar-actions')[0] as HTMLElement;\n\t\tconst iterationsPicker = new NumberPicker(simActionsContainer, this.sim, {\n\t\t\tlabel: 'Iterations',\n\t\t\textraCssClasses: [\n\t\t\t\t'iterations-picker',\n\t\t\t\t'within-raid-sim-hide',\n\t\t\t],\n\t\t\tchangedEvent: (sim: Sim) => sim.iterationsChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getIterations(),\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\tsim.setIterations(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tconst reportBug = document.createElement('span');\n\t\treportBug.classList.add('report-bug', 'fa', 'fa-bug');\n\t\ttippy(reportBug, {\n\t\t\t'content': 'Report a bug / request a feature',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\treportBug.addEventListener('click', event => {\n\t\t\twindow.open('https://github.com/wowsims/wotlk/issues/new/choose', '_blank');\n\t\t});\n\t\tthis.addToolbarItem(reportBug);\n\n\t\tif (!this.isWithinRaidSim) {\n\t\t\twindow.addEventListener('message', async event => {\n\t\t\t\tif (event.data == 'runOnce') {\n\t\t\t\t\tthis.runSimOnce();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst downloadBinary = document.createElement('span');\n\t\t// downloadBinary.src = \"/wotlk/assets/img/gauge.svg\"\n\t\tdownloadBinary.classList.add('downbin', 'hide');\n\t\tdownloadBinary.addEventListener('click', event => {\n\t\t\twindow.open('https://github.com/wowsims/wotlk/releases', '_blank');\n\t\t});\n\n\t\tif (document.location.href.includes(\"localhost\")) {\n\t\t\tfetch(document.location.protocol + \"//\" + document.location.host + \"/version\").then(resp => {\n\t\t\t\tresp.json()\n\t\t\t\t\t.then((versionInfo) => {\n\t\t\t\t\t\tif (versionInfo.outdated == 2) {\n\t\t\t\t\t\t\ttippy(downloadBinary, {\n\t\t\t\t\t\t\t\t'content': 'Newer version of simulator available for download',\n\t\t\t\t\t\t\t\t'allowHTML': true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tdownloadBinary.classList.add('downbinalert');\n\t\t\t\t\t\t\tthis.addToolbarItem(downloadBinary);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tconsole.warn('No version info found!');\n\t\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\ttippy(downloadBinary, {\n\t\t\t\t'content': 'Download simulator for faster simulating',\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\t\t\tdownloadBinary.classList.add('downbinnorm');\n\t\t\tthis.addToolbarItem(downloadBinary);\n\t\t}\n\t}\n\n\taddAction(name: string, cssClass: string, actFn: () => void) {\n\t\tconst simActionsContainer = this.rootElem.getElementsByClassName('sim-sidebar-actions')[0] as HTMLElement;\n\t\tconst iterationsPicker = this.rootElem.getElementsByClassName('iterations-picker')[0] as HTMLElement;\n\n\t\tconst button = document.createElement('button');\n\t\tbutton.classList.add('sim-sidebar-actions-button', cssClass);\n\t\tbutton.textContent = name;\n\t\tbutton.addEventListener('click', actFn);\n\t\tsimActionsContainer.insertBefore(button, iterationsPicker);\n\t}\n\n\taddTab(title: string, cssClass: string, innerHTML: string) {\n\t\tconst simTabsContainer = this.rootElem.getElementsByClassName('sim-tabs')[0] as HTMLElement;\n\t\tconst simTabContentsContainer = this.rootElem.getElementsByClassName('tab-content')[0] as HTMLElement;\n\t\tconst topBar = simTabsContainer.getElementsByClassName('sim-top-bar')[0] as HTMLElement;\n\n\t\tconst contentId = cssClass.replace(/\\s+/g, '-') + '-tab';\n\t\tconst isFirstTab = simTabsContainer.children.length == 1;\n\n\t\tconst newTab = document.createElement('li');\n\t\tnewTab.innerHTML = `<a data-toggle=\"tab\" href=\"#${contentId}\">${title}</a>`;\n\t\tnewTab.classList.add(cssClass + '-tab');\n\n\t\tconst newContent = document.createElement('div');\n\t\tnewContent.id = contentId;\n\t\tnewContent.classList.add(cssClass, 'tab-pane', 'fade');\n\t\tnewContent.innerHTML = innerHTML;\n\n\t\tif (isFirstTab) {\n\t\t\tnewTab.classList.add('active');\n\t\t\tnewContent.classList.add('active', 'in');\n\t\t}\n\n\t\tsimTabsContainer.insertBefore(newTab, topBar);\n\t\tsimTabContentsContainer.appendChild(newContent);\n\t}\n\n\taddToolbarItem(elem: HTMLElement) {\n\t\tconst topBar = this.rootElem.getElementsByClassName('sim-top-bar')[0] as HTMLElement;\n\t\telem.classList.add('sim-top-bar-item');\n\t\ttopBar.appendChild(elem);\n\t}\n\n\tprivate updateWarnings() {\n\t\tconst activeWarnings = this.warnings.map(warning => warning.getContent()).flat().filter(content => content != '');\n\n\t\tconst warningsElem = document.getElementsByClassName('warnings')[0] as HTMLElement;\n\t\tif (activeWarnings.length == 0) {\n\t\t\twarningsElem.style.display = 'none';\n\t\t} else {\n\t\t\twarningsElem.style.display = 'initial';\n\t\t\tthis.warningsTippy.setContent(`\n\t\t\t\t<ul class=\"known-issues-tooltip\">\n\t\t\t\t\t${activeWarnings.map(content => '<li>' + content + '</li>').join('')}\n\t\t\t\t</ul>`\n\t\t\t);\n\t\t}\n\t}\n\n\taddWarning(warning: SimWarning) {\n\t\tthis.warnings.push(warning);\n\t\twarning.updateOn.on(() => this.updateWarnings());\n\t\tthis.updateWarnings();\n\t}\n\n\t// Returns a key suitable for the browser's localStorage feature.\n\tabstract getStorageKey(postfix: string): string;\n\n\tgetSettingsStorageKey(): string {\n\t\treturn this.getStorageKey('__currentSettings__');\n\t}\n\n\tgetSavedEncounterStorageKey(): string {\n\t\t// By skipping the call to this.getStorageKey(), saved encounters will be\n\t\t// shared across all sims.\n\t\treturn 'sharedData__savedEncounter__';\n\t}\n\n\tisIndividualSim(): boolean {\n\t\treturn this.rootElem.classList.contains('individual-sim-ui');\n\t}\n\n\tasync runSim(onProgress: Function) {\n\t\tthis.resultsViewer.setPending();\n\t\ttry {\n\t\t\tawait this.sim.runRaidSim(TypedEvent.nextEventID(), onProgress);\n\t\t} catch (e) {\n\t\t\tthis.resultsViewer.hideAll();\n\t\t\tthis.handleCrash(e);\n\t\t}\n\t}\n\n\tasync runSimOnce() {\n\t\tthis.resultsViewer.setPending();\n\t\ttry {\n\t\t\tawait this.sim.runRaidSimWithLogs(TypedEvent.nextEventID());\n\t\t} catch (e) {\n\t\t\tthis.resultsViewer.hideAll();\n\t\t\tthis.handleCrash(e);\n\t\t}\n\t}\n\n\thandleCrash(error: any) {\n\t\tif (!(error instanceof SimError)) {\n\t\t\talert(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst errorStr = (error as SimError).errorStr;\n\t\tif (window.confirm('Simulation Failure:\\n' + errorStr + '\\nPress Ok to file crash report')) {\n\t\t\t// Splice out just the line numbers\n\t\t\tconst hash = this.hashCode(errorStr);\n\t\t\tconst link = this.toLink();\n\t\t\tconst rngSeed = this.sim.getLastUsedRngSeed();\n\t\t\tfetch('https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/wotlk+' + hash).then(resp => {\n\t\t\t\tresp.json().then((issues) => {\n\t\t\t\t\tif (issues.total_count > 0) {\n\t\t\t\t\t\twindow.open(issues.items[0].html_url, '_blank');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst base_url = 'https://github.com/wowsims/wotlk/issues/new?assignees=&labels=&title=Crash%20Report%20'\n\t\t\t\t\t\tconst base = `${base_url}${hash}&body=`;\n\t\t\t\t\t\tconst maxBodyLength = URLMAXLEN - base.length;\n\t\t\t\t\t\tlet issueBody = encodeURIComponent(`Link:\\n${link}\\n\\nRNG Seed: ${rngSeed}\\n\\n${errorStr}`)\n\t\t\t\t\t\twhile (issueBody.length > maxBodyLength) {\n\t\t\t\t\t\t\tissueBody = issueBody.slice(0, issueBody.lastIndexOf('%')) // Avoid truncating in the middle of a URLencoded segment\n\t\t\t\t\t\t}\n\t\t\t\t\t\twindow.open(base + issueBody, '_blank');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).catch(fetchErr => {\n\t\t\t\talert('Failed to file report... try again another time:' + fetchErr);\n\t\t\t});\n\t\t}\n\t\treturn;\n\t}\n\n\thashCode(str: string): number {\n\t\tlet hash = 0;\n\t\tfor (let i = 0, len = str.length; i < len; i++) {\n\t\t\tlet chr = str.charCodeAt(i);\n\t\t\thash = (hash << 5) - hash + chr;\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\t\treturn hash;\n\t}\n\n\tabstract applyDefaults(eventID: EventID): void;\n\tabstract toLink(): string;\n}\n\nconst simHTML = `\n<div class=\"sim-root\">\n  <section class=\"sim-sidebar\">\n    <div class=\"sim-sidebar-title\"></div>\n    <div class=\"sim-sidebar-actions within-raid-sim-hide\"></div>\n    <div class=\"sim-sidebar-results within-raid-sim-hide\"></div>\n    <div class=\"sim-sidebar-footer\"></div>\n  </section>\n  <section class=\"sim-main\">\n\t\t<div class=\"sim-toolbar\">\n\t\t\t<ul class=\"sim-tabs nav nav-tabs\">\n\t\t\t\t<li class=\"sim-top-bar\">\n\t\t\t\t\t<span class=\"notices fas fa-exclamation-circle\"></span>\n\t\t\t\t\t<span class=\"warnings fa fa-exclamation-triangle\"></span>\n\t\t\t\t\t<div class=\"known-issues\">Known Issues</div>\n\t\t\t\t</li>\n\t\t\t</ul>\n    </div>\n    <div class=\"tab-content\">\n    </div>\n  </section>\n</div>\n`;\n","import { StatWeightsRequest, StatWeightsResult, StatWeightValues, ProgressMetrics } from '../proto/api.js';\nimport { ItemSlot } from '../proto/common.js';\nimport { Gem } from '../proto/common.js';\nimport { GemColor } from '../proto/common.js';\nimport { Profession } from '../proto/common.js';\nimport { Stat } from '../proto/common.js';\nimport { Stats } from '../proto_utils/stats.js';\nimport { Gear } from '../proto_utils/gear.js';\nimport { statNames, statOrder } from '../proto_utils/names.js';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { Player } from '../player.js';\nimport { stDevToConf90 } from '../utils.js';\nimport { BooleanPicker } from '../components/boolean_picker.js';\nimport { NumberPicker } from '../components/number_picker.js';\nimport { ResultsViewer } from '../components/results_viewer.js';\nimport { combinations, combinationsWithDups, permutations, getEnumValues, maxIndex, sum } from '../utils.js';\n\nimport * as Gems from '../proto_utils/gems.js';\n\nimport { Popup } from './popup.js';\n\ndeclare var tippy: any;\n\nexport function addStatWeightsAction(simUI: IndividualSimUI<any>, epStats: Array<Stat>, epReferenceStat: Stat) {\n\tsimUI.addAction('STAT WEIGHTS', 'ep-weights-action', () => {\n\t\tnew EpWeightsMenu(simUI, epStats, epReferenceStat);\n\t});\n}\n\nclass EpWeightsMenu extends Popup {\n\tprivate readonly simUI: IndividualSimUI<any>;\n\tprivate readonly tableContainer: HTMLElement;\n\tprivate readonly tableBody: HTMLElement;\n\tprivate readonly tableHeader: HTMLElement;\n\tprivate readonly resultsViewer: ResultsViewer;\n\n\tprivate statsType: string;\n\tprivate epStats: Array<Stat>;\n\tprivate epReferenceStat: Stat;\n\n\tconstructor(simUI: IndividualSimUI<any>, epStats: Array<Stat>, epReferenceStat: Stat) {\n\t\tsuper(simUI.rootElem);\n\t\tthis.simUI = simUI;\n\t\tthis.statsType = 'ep';\n\t\tthis.epStats = epStats;\n\t\tthis.epReferenceStat = epReferenceStat;\n\n\t\tthis.rootElem.classList.add('ep-weights-menu');\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"ep-weights-header\">\n\t\t\t\t<div class=\"ep-weights-actions\">\n\t\t\t\t\t<button class=\"sim-button calc-weights\">CALCULATE</button>\n\t\t\t\t\t<p>Use \"CALCULATE\" to begin calculating all EPs. \n\t\t\t\t\tOnce complete you can use the new EPs by using the \n\t\t\t\t\t<span class=\"fa fa-copy\" style=\"color: var(--theme-color-primary);\"></span> icon above the EPs.</p>\n\t\t\t\t\t<p>The 'Current EPs' column displays the values currently used by the item pickers to sort items.</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ep-weights-results\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"stats-controls-row\">\n\t\t\t\t<div class=\"ep-weights-options\">\n\t\t\t\t\t<select class=\"ep-type-select\">\n\t\t\t\t\t\t<option value=\"ep\">EP</option>\n\t\t\t\t\t\t<option value=\"weight\">Weights</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"show-all-stats-container\">\n\t\t\t\t</div>\n\t\t\t\t<button class=\"sim-button optimize-gems\">OPTIMIZE GEMS</button>\n\t\t\t</div>\n\t\t\t<div class=\"ep-weights-table\">\n\t\t\t\t<table class=\"results-ep-table\">\n\t\t\t\t\t<tbody id=\"ep-tbody\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Stat</th>\n\t\t\t\t\t\t\t<th class=\"damage-metrics type-weight\"><span>DPS Weight</span><span class=\"col-action fa fa-copy\"></span></th>\n\t\t\t\t\t\t\t<th class=\"damage-metrics type-ep\"><span>DPS EP</span><span class=\"col-action fa fa-copy\"></span></th>\n\t\t\t\t\t\t\t<th class=\"healing-metrics type-weight\"><span>HPS Weight</span><span class=\"col-action fa fa-copy\"></span></th>\n\t\t\t\t\t\t\t<th class=\"healing-metrics type-ep\"><span>HPS EP</span><span class=\"col-action fa fa-copy\"></span></th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight\"><span>TPS Weight</span><span class=\"col-action fa fa-copy\"></span></th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep\"><span>TPS EP</span><span class=\"col-action fa fa-copy\"></span></th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight\"><span>DTPS Weight</span><span class=\"col-action fa fa-copy\"></span></th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep\"><span>DTPS EP</span><span class=\"col-action fa fa-copy\"></span></th>\n\t\t\t\t\t\t\t<th><span>Current EP</span><span class=\"col-action fa fa-recycle\"></span></th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.tableContainer = this.rootElem.getElementsByClassName('ep-weights-table')[0] as HTMLElement;\n\t\tthis.tableBody = this.rootElem.querySelector('#ep-tbody') as HTMLElement;\n\t\tthis.tableHeader = this.rootElem.querySelector('#ep-tbody > tr') as HTMLElement;\n\n\t\tconst resultsViewerElem = this.rootElem.getElementsByClassName('ep-weights-results')[0] as HTMLElement;\n\t\tthis.resultsViewer = new ResultsViewer(resultsViewerElem);\n\n\t\tconst updateType = () => {\n\t\t\tif (this.statsType == 'ep') {\n\t\t\t\tthis.tableContainer.classList.remove('stats-type-weight');\n\t\t\t\tthis.tableContainer.classList.add('stats-type-ep');\n\t\t\t} else {\n\t\t\t\tthis.tableContainer.classList.add('stats-type-weight');\n\t\t\t\tthis.tableContainer.classList.remove('stats-type-ep');\n\t\t\t}\n\t\t};\n\n\t\tconst selectElem = this.rootElem.getElementsByClassName('ep-type-select')[0] as HTMLSelectElement;\n\t\tselectElem.addEventListener('input', event => {\n\t\t\tthis.statsType = selectElem.value;\n\t\t\tupdateType();\n\t\t});\n\t\tselectElem.value = this.statsType;\n\t\tupdateType();\n\n\t\tconst calcButton = this.rootElem.getElementsByClassName('calc-weights')[0] as HTMLElement;\n\t\tcalcButton.addEventListener('click', async event => {\n\t\t\tthis.resultsViewer.setPending();\n\t\t\tconst iterations = this.simUI.sim.getIterations();\n\t\t\tconst result = await this.simUI.player.computeStatWeights(TypedEvent.nextEventID(), this.epStats, this.epReferenceStat, (progress: ProgressMetrics) => {\n\t\t\t\tthis.setSimProgress(progress);\n\t\t\t});\n\t\t\tthis.resultsViewer.hideAll();\n\t\t\tthis.simUI.prevEpIterations = iterations;\n\t\t\tthis.simUI.prevEpSimResult = result;\n\t\t\tthis.updateTable(iterations, result);\n\t\t});\n\n\t\tconst colActionButtons = Array.from(this.rootElem.getElementsByClassName('col-action')) as Array<HTMLSelectElement>;\n\t\tconst makeUpdateWeights = (button: HTMLElement, labelTooltip: string, tooltip: string, weightsFunc: () => Array<number>) => {\n\t\t\ttippy(button.previousSibling, {\n\t\t\t\t'content': labelTooltip,\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\t\t\ttippy(button, {\n\t\t\t\t'content': tooltip,\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\t\t\tbutton.addEventListener('click', event => {\n\t\t\t\tthis.simUI.player.setEpWeights(TypedEvent.nextEventID(), new Stats(weightsFunc()));\n\t\t\t});\n\t\t};\n\t\tmakeUpdateWeights(colActionButtons[0], 'Per-point increase in DPS (Damage Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().dps!.weights);\n\t\tmakeUpdateWeights(colActionButtons[1], `EP (Equivalency Points) for DPS (Damage Per Second) for each stat. Normalized by ${statNames[this.epReferenceStat]}.`, 'Copy to Current EP', () => this.getPrevSimResult().dps!.epValues);\n\t\tmakeUpdateWeights(colActionButtons[2], 'Per-point increase in HPS (Healing Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().hps!.weights);\n\t\tmakeUpdateWeights(colActionButtons[3], `EP (Equivalency Points) for HPS (Healing Per Second) for each stat. Normalized by ${statNames[this.epReferenceStat]}.`, 'Copy to Current EP', () => this.getPrevSimResult().hps!.epValues);\n\t\tmakeUpdateWeights(colActionButtons[4], 'Per-point increase in TPS (Threat Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().tps!.weights);\n\t\tmakeUpdateWeights(colActionButtons[5], `EP (Equivalency Points) for TPS (Threat Per Second) for each stat. Normalized by ${statNames[this.epReferenceStat]}.`, 'Copy to Current EP', () => this.getPrevSimResult().tps!.epValues);\n\t\tmakeUpdateWeights(colActionButtons[6], 'Per-point increase in DTPS (Damage Taken Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().dtps!.weights);\n\t\tmakeUpdateWeights(colActionButtons[7], `EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat. Normalized by ${statNames[Stat.StatArmor]}.`, 'Copy to Current EP', () => this.getPrevSimResult().dtps!.epValues);\n\t\tmakeUpdateWeights(colActionButtons[8], 'Current EP Weights. Used to sort the gear selector menus.', 'Restore Default EP', () => this.simUI.individualConfig.defaults.epWeights.asArray());\n\n\t\tconst showAllStatsContainer = this.rootElem.getElementsByClassName('show-all-stats-container')[0] as HTMLElement;\n\t\tnew BooleanPicker(showAllStatsContainer, this, {\n\t\t\tlabel: 'Show All Stats',\n\t\t\tchangedEvent: () => new TypedEvent(),\n\t\t\tgetValue: () => this.tableContainer.classList.contains('show-all-stats'),\n\t\t\tsetValue: (eventID: EventID, menu: EpWeightsMenu, newValue: boolean) => {\n\t\t\t\tif (newValue) {\n\t\t\t\t\tthis.tableContainer.classList.add('show-all-stats');\n\t\t\t\t} else {\n\t\t\t\t\tthis.tableContainer.classList.remove('show-all-stats');\n\t\t\t\t}\n\t\t\t\tthis.applyAlternatingColors();\n\t\t\t},\n\t\t});\n\n\t\tthis.updateTable(this.simUI.prevEpIterations || 1, this.getPrevSimResult());\n\n\t\tconst optimizeGemsButton = this.rootElem.getElementsByClassName('optimize-gems')[0] as HTMLElement;\n\t\ttippy(optimizeGemsButton, {\n\t\t\t'content': `\n\t\t\t\t<p>Optimizes equipped gems to maximize EP, based on the values in <b>Current EP</b>.</p>\n\t\t\t\t<p>Does not change the meta gem, but ensures that its condition is met. Uses JC gems if Jewelcrafting is a selected profession.</p>\n\t\t\t`,\n\t\t\t'allowHTML': true,\n\t\t});\n\t\toptimizeGemsButton.addEventListener('click', event => this.optimizeGems(TypedEvent.nextEventID()));\n\n\t\tthis.addCloseButton();\n\t}\n\n\tsetSimProgress(progress: ProgressMetrics) {\n\t\tthis.resultsViewer.setContent(`\n  <div class=\"results-sim\">\n  \t\t\t<div class=\"\"> ${progress.completedSims} / ${progress.totalSims}<br>simulations complete</div>\n  \t\t\t<div class=\"\">\n\t\t\t\t${progress.completedIterations} / ${progress.totalIterations}<br>iterations complete\n\t\t\t</div>\n  </div>\n`);\n\t}\n\n\tprivate updateTable(iterations: number, result: StatWeightsResult) {\n\t\tthis.tableHeader.remove();\n\t\tthis.tableBody.innerHTML = '';\n\t\tthis.tableBody.appendChild(this.tableHeader);\n\n\t\tconst allStats = statOrder.filter(stat => ![Stat.StatMana, Stat.StatEnergy, Stat.StatRage].includes(stat));\n\t\tallStats.forEach(stat => {\n\t\t\tconst row = this.makeTableRow(stat, iterations, result);\n\t\t\tif (!this.epStats.includes(stat)) {\n\t\t\t\trow.classList.add('non-ep-stat');\n\t\t\t}\n\t\t\tthis.tableBody.appendChild(row);\n\t\t});\n\n\t\tthis.applyAlternatingColors();\n\t}\n\n\tprivate makeTableRow(stat: Stat, iterations: number, result: StatWeightsResult): HTMLElement {\n\t\tconst row = document.createElement('tr');\n\t\trow.innerHTML = `\n\t\t\t<td>${statNames[stat]}</td>\n\t\t\t<td class=\"stdev-cell damage-metrics type-weight\"><span>${result.dps!.weights[stat].toFixed(2)}</span><span>${stDevToConf90(result.dps!.weightsStdev[stat], iterations).toFixed(2)}</span></td>\n\t\t\t<td class=\"stdev-cell damage-metrics type-ep\"><span>${result.dps!.epValues[stat].toFixed(2)}</span><span>${stDevToConf90(result.dps!.epValuesStdev[stat], iterations).toFixed(2)}</span></td>\n\t\t\t<td class=\"stdev-cell threat-metrics type-weight\"><span>${result.tps!.weights[stat].toFixed(2)}</span><span>${stDevToConf90(result.tps!.weightsStdev[stat], iterations).toFixed(2)}</span></td>\n\t\t\t<td class=\"stdev-cell threat-metrics type-ep\"><span>${result.tps!.epValues[stat].toFixed(2)}</span><span>${stDevToConf90(result.tps!.epValuesStdev[stat], iterations).toFixed(2)}</span></td>\n\t\t\t<td class=\"stdev-cell threat-metrics type-weight\"><span>${result.dtps!.weights[stat].toFixed(2)}</span><span>${stDevToConf90(result.dtps!.weightsStdev[stat], iterations).toFixed(2)}</span></td>\n\t\t\t<td class=\"stdev-cell threat-metrics type-ep\"><span>${result.dtps!.epValues[stat].toFixed(2)}</span><span>${stDevToConf90(result.dtps!.epValuesStdev[stat], iterations).toFixed(2)}</span></td>\n\t\t\t<td class=\"current-ep\"></td>\n\t\t`;\n\n\t\tconst currentEpCell = row.querySelector('.current-ep') as HTMLElement;\n\t\tnew NumberPicker(currentEpCell, this.simUI.player, {\n\t\t\tfloat: true,\n\t\t\tchangedEvent: (player: Player<any>) => player.epWeightsChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getEpWeights().getStat(stat),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\tconst epWeights = player.getEpWeights().withStat(stat, newValue);\n\t\t\t\tplayer.setEpWeights(eventID, epWeights);\n\t\t\t},\n\t\t});\n\n\t\treturn row;\n\t}\n\n\tprivate applyAlternatingColors() {\n\t\t(Array.from(this.tableBody.childNodes) as Array<HTMLElement>)\n\t\t\t.filter(row => window.getComputedStyle(row).getPropertyValue('display') != 'none')\n\t\t\t.forEach((row, i) => {\n\t\t\t\tif (i % 2 == 0) {\n\t\t\t\t\trow.classList.remove('odd');\n\t\t\t\t} else {\n\t\t\t\t\trow.classList.add('odd');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tprivate getPrevSimResult(): StatWeightsResult {\n\t\treturn this.simUI.prevEpSimResult || StatWeightsResult.create({\n\t\t\tdps: {\n\t\t\t\tweights: new Stats().asArray(),\n\t\t\t\tweightsStdev: new Stats().asArray(),\n\t\t\t\tepValues: new Stats().asArray(),\n\t\t\t\tepValuesStdev: new Stats().asArray(),\n\t\t\t},\n\t\t\ttps: {\n\t\t\t\tweights: new Stats().asArray(),\n\t\t\t\tweightsStdev: new Stats().asArray(),\n\t\t\t\tepValues: new Stats().asArray(),\n\t\t\t\tepValuesStdev: new Stats().asArray(),\n\t\t\t},\n\t\t\tdtps: {\n\t\t\t\tweights: new Stats().asArray(),\n\t\t\t\tweightsStdev: new Stats().asArray(),\n\t\t\t\tepValues: new Stats().asArray(),\n\t\t\t\tepValuesStdev: new Stats().asArray(),\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate optimizeGems(eventID: EventID) {\n\t\t// Replace 0 weights with a very tiny value, so we always prefer to take free stats even if the user gave a 0 weight.\n\t\tlet epWeights = this.simUI.player.getEpWeights();\n\t\tepWeights = new Stats(epWeights.asArray().map(w => w == 0 ? 1e-8 : w));\n\n\t\tconst gear = this.simUI.player.getGear();\n\t\tconst allGems = this.simUI.sim.getGems();\n\t\tconst phase = this.simUI.sim.getPhase();\n\t\tconst isBlacksmithing = this.simUI.player.isBlacksmithing();\n\t\tconst isJewelcrafting = this.simUI.player.hasProfession(Profession.Jewelcrafting);\n\n\t\tconst optimizedGear = EpWeightsMenu.optimizeGemsForWeights(epWeights, gear, allGems, phase, isBlacksmithing, isJewelcrafting);\n\t\tthis.simUI.player.setGear(eventID, optimizedGear);\n\t}\n\n\tprivate static optimizeGemsForWeights(epWeights: Stats, gear: Gear, allGems: Array<Gem>, phase: number, isBlacksmithing: boolean, isJewelcrafting: boolean): Gear {\n\t\tconst unrestrictedGems = allGems.filter(gem => Gems.isUnrestrictedGem(gem, phase));\n\n\t\tconst {\n\t\t\tbestGemForColor: bestGemForColor,\n\t\t\tbestGemForColorEP: bestGemForColorEP,\n\t\t\tbestGemForSocket: bestGemForSocket,\n\t\t\tbestGemForSocketEP: bestGemForSocketEP,\n\t\t\tbestGem: bestGem,\n\t\t\tbestGemEP: bestGemEP,\n\t\t} = EpWeightsMenu.findBestGems(unrestrictedGems, epWeights);\n\n\t\tconst items = gear.asMap();\n\t\tconst socketBonusEPs = Object.values(items).map(item => item != null ? new Stats(item.item.socketBonus).computeEP(epWeights) : 0);\n\n\t\t// Start by optimally filling all items, ignoring meta condition.\n\t\tObject.entries(items).forEach(([itemSlot, equippedItem], i) => {\n\t\t\tif (equippedItem == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst item = equippedItem.item;\n\t\t\tconst socketColors = equippedItem.curSocketColors(isBlacksmithing);\n\n\t\t\t// Compare whether its better to match sockets + get socket bonus, or just use best gems.\n\t\t\tconst bestGemEPNotMatchingSockets = sum(socketColors.map(socketColor => socketColor == GemColor.GemColorMeta ? 0 : bestGemEP));\n\t\t\tconst bestGemEPMatchingSockets = socketBonusEPs[i] + sum(socketColors.map(socketColor => socketColor == GemColor.GemColorMeta ? 0 : bestGemForSocketEP[socketColor]));\n\n\t\t\tif (bestGemEPNotMatchingSockets > bestGemEPMatchingSockets) {\n\t\t\t\tsocketColors.forEach((socketColor, i) => {\n\t\t\t\t\tif (socketColor != GemColor.GemColorMeta) {\n\t\t\t\t\t\tequippedItem = equippedItem!.withGem(bestGem, i);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsocketColors.forEach((socketColor, i) => {\n\t\t\t\t\tif (socketColor != GemColor.GemColorMeta) {\n\t\t\t\t\t\tequippedItem = equippedItem!.withGem(bestGemForSocket[socketColor], i);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\titems[Number(itemSlot) as ItemSlot] = equippedItem;\n\t\t});\n\t\tgear = new Gear(items);\n\n\t\tconst allSockets: Array<{ itemSlot: ItemSlot, socketIdx: number }> = Object.keys(items).map((itemSlotStr) => {\n\t\t\tconst itemSlot = parseInt(itemSlotStr) as ItemSlot;\n\t\t\tconst item = items[itemSlot];\n\t\t\tif (!item) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst numSockets = item.numSockets(isBlacksmithing);\n\t\t\treturn [...Array(numSockets).keys()]\n\t\t\t\t.filter(socketIdx => item.item.gemSockets[socketIdx] != GemColor.GemColorMeta)\n\t\t\t\t.map(socketIdx => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\titemSlot: itemSlot,\n\t\t\t\t\t\tsocketIdx: socketIdx,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t}).flat();\n\t\tconst threeSocketCombos = permutations(allSockets, 3);\n\t\tconst calculateGearGemsEP = (gear: Gear): number => gear.statsFromGems(isBlacksmithing).computeEP(epWeights);\n\n\t\t// Now make adjustments to satisfy meta condition.\n\t\t// Use a wrapper function so we can return for readability.\n\t\tgear = ((gear: Gear): Gear => {\n\t\t\tconst metaGem = gear.getMetaGem();\n\t\t\tif (!metaGem) {\n\t\t\t\treturn gear;\n\t\t\t}\n\n\t\t\tconst condition = Gems.getMetaGemCondition(metaGem.id);\n\t\t\t// Only TBC gems use compare color conditions, so just ignore them.\n\t\t\tif (!condition || condition.isCompareColorCondition()) {\n\t\t\t\treturn gear;\n\t\t\t}\n\n\t\t\t// If there are very few non-meta gem slots, just skip because it's annoying to deal with.\n\t\t\tif (gear.getAllGems(isBlacksmithing).length - 1 < 3) {\n\t\t\t\treturn gear;\n\t\t\t}\n\n\t\t\t// In wrath, all meta gems use min colors condition (numRed >= r && numYellow >= y && numBlue >= b)\n\t\t\t// All conditions require 3 gems, e.g. 3 of a single color, 2 of one color and 1 of another, or 1 of each.\n\t\t\t// So the maximum number of gems that ever need to change is 3.\n\n\t\t\tconst colorCombos = EpWeightsMenu.getColorCombosToSatisfyCondition(condition);\n\n\t\t\tlet bestGear = gear;\n\t\t\tlet bestGearEP = calculateGearGemsEP(gear);\n\n\t\t\t// Use brute-force to try every possibility.\n\t\t\tcolorCombos.forEach(colorCombo => {\n\t\t\t\tthreeSocketCombos.forEach(socketCombo => {\n\t\t\t\t\tconst curItems = gear.asMap();\n\t\t\t\t\tfor (let i = 0; i < colorCombo.length; i++) {\n\t\t\t\t\t\tconst gemColor = colorCombo[i];\n\t\t\t\t\t\tconst { itemSlot, socketIdx } = socketCombo[i];\n\t\t\t\t\t\tcurItems[itemSlot] = curItems[itemSlot]!.withGem(bestGemForColor[gemColor], socketIdx);\n\t\t\t\t\t}\n\t\t\t\t\tconst curGear = new Gear(curItems);\n\t\t\t\t\tif (curGear.hasActiveMetaGem(isBlacksmithing)) {\n\t\t\t\t\t\tconst curGearEP = calculateGearGemsEP(curGear);\n\t\t\t\t\t\tif (curGearEP > bestGearEP) {\n\t\t\t\t\t\t\tbestGear = curGear;\n\t\t\t\t\t\t\tbestGearEP = curGearEP;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn bestGear;\n\t\t})(gear);\n\n\t\t// Now insert 3 JC gems, if Jewelcrafting is selected.\n\t\t// Use a wrapper function so we can return for readability.\n\t\tgear = ((gear: Gear): Gear => {\n\t\t\tif (!isJewelcrafting) {\n\t\t\t\treturn gear;\n\t\t\t}\n\n\t\t\tconst jcGems = allGems.filter(gem => gem.requiredProfession == Profession.Jewelcrafting);\n\n\t\t\tconst {\n\t\t\t\tbestGemForColor: bestJcGemForColor,\n\t\t\t\tbestGemForColorEP: bestJcGemForColorEP,\n\t\t\t\tbestGemForSocket: bestJcGemForSocket,\n\t\t\t\tbestGemForSocketEP: bestJcGemForSocketEP,\n\t\t\t\tbestGem: bestJcGem,\n\t\t\t\tbestGemEP: bestJcGemEP,\n\t\t\t} = EpWeightsMenu.findBestGems(jcGems, epWeights);\n\n\t\t\tlet bestGear = gear;\n\t\t\tlet bestGearEP = calculateGearGemsEP(gear);\n\n\t\t\tthreeSocketCombos.forEach(socketCombo => {\n\t\t\t\tconst curItems = gear.asMap();\n\t\t\t\tfor (let i = 0; i < socketCombo.length; i++) {\n\t\t\t\t\tconst { itemSlot, socketIdx } = socketCombo[i];\n\t\t\t\t\tconst ei = curItems[itemSlot]!;\n\t\t\t\t\tconst gemColor = ei.gems[socketIdx]!.color;\n\t\t\t\t\tcurItems[itemSlot] = ei.withGem(bestJcGemForColor[gemColor], socketIdx);\n\t\t\t\t}\n\n\t\t\t\tconst curGear = new Gear(curItems);\n\t\t\t\tif (curGear.hasActiveMetaGem(isBlacksmithing)) {\n\t\t\t\t\tconst curGearEP = calculateGearGemsEP(curGear);\n\t\t\t\t\tif (curGearEP > bestGearEP) {\n\t\t\t\t\t\tbestGear = curGear;\n\t\t\t\t\t\tbestGearEP = curGearEP;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn bestGear;\n\t\t})(gear);\n\n\t\treturn gear;\n\t}\n\n\t// Returns every possible way we could satisfy the gem condition.\n\tprivate static getColorCombosToSatisfyCondition(condition: Gems.MetaGemCondition): Array<Array<GemColor>> {\n\t\tif (condition.isOneOfEach()) {\n\t\t\treturn [\n\t\t\t\tGems.PRIMARY_COLORS,\n\t\t\t\t[GemColor.GemColorPrismatic],\n\t\t\t].concat(\n\t\t\t\tGems.SECONDARY_COLORS.map((secondaryColor, i) => {\n\t\t\t\t\tconst remainingColor = Gems.PRIMARY_COLORS[i];\n\t\t\t\t\treturn Gems.socketToMatchingColors.get(remainingColor)!.map(matchingColor => [matchingColor, secondaryColor]);\n\t\t\t\t}).flat()\n\t\t\t);\n\t\t} else if (condition.isTwoAndOne()) {\n\t\t\tconst oneColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(1)];\n\t\t\tconst twoColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(2)];\n\t\t\tconst secondaryColor = Gems.SECONDARY_COLORS.find(color => Gems.gemColorMatchesSocket(color, oneColor) && Gems.gemColorMatchesSocket(color, twoColor))!;\n\n\t\t\treturn [\n\t\t\t\t// All the ways to get 1 point in both colors. These are partial combos,\n\t\t\t\t// which still need 1 more gem in the 2-color.\n\t\t\t\t[GemColor.GemColorPrismatic],\n\t\t\t\t[secondaryColor],\n\t\t\t\t[oneColor, twoColor],\n\t\t\t].map(partialCombo => {\n\t\t\t\treturn Gems.socketToMatchingColors.get(twoColor)!.map(matchingColor => partialCombo.concat([matchingColor]));\n\t\t\t}).flat();\n\t\t} else if (condition.isThreeOfAColor()) {\n\t\t\tconst threeColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(3)];\n\t\t\tconst matchingColors = Gems.socketToMatchingColors.get(threeColor)!;\n\t\t\treturn combinationsWithDups(matchingColors, 3);\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tprivate static findBestGems(gemList: Array<Gem>, epWeights: Stats): BestGemsResult {\n\t\t// Best gem when we need a gem of a specific color.\n\t\tconst bestGemForColor: Array<Gem> = Gems.GEM_COLORS.map(color => null as unknown as Gem);\n\t\tconst bestGemForColorEP: Array<number> = Gems.GEM_COLORS.map(color => 0);\n\t\t// Best gem when we need to match a socket to activate a bonus.\n\t\tconst bestGemForSocket: Array<Gem> = bestGemForColor.slice();\n\t\tconst bestGemForSocketEP: Array<number> = bestGemForColorEP.slice();\n\t\t// The single best gem, when color doesn't matter.\n\t\tlet bestGem = gemList[0];\n\t\tlet bestGemEP = 0;\n\t\tgemList.forEach(gem => {\n\t\t\tconst gemEP = new Stats(gem.stats).computeEP(epWeights);\n\t\t\tif (gemEP > bestGemForColorEP[gem.color]) {\n\t\t\t\tbestGemForColorEP[gem.color] = gemEP;\n\t\t\t\tbestGemForColor[gem.color] = gem;\n\n\t\t\t\tif (gem.color != GemColor.GemColorMeta && gemEP > bestGemEP) {\n\t\t\t\t\tbestGemEP = gemEP;\n\t\t\t\t\tbestGem = gem;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tGems.GEM_COLORS.forEach(socketColor => {\n\t\t\t\tif (Gems.gemMatchesSocket(gem, socketColor) && gemEP > bestGemForSocketEP[socketColor]) {\n\t\t\t\t\tbestGemForSocketEP[socketColor] = gemEP;\n\t\t\t\t\tbestGemForSocket[socketColor] = gem;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tbestGemForColor: bestGemForColor,\n\t\t\tbestGemForColorEP: bestGemForColorEP,\n\t\t\tbestGemForSocket: bestGemForSocket,\n\t\t\tbestGemForSocketEP: bestGemForSocketEP,\n\t\t\tbestGem: bestGem,\n\t\t\tbestGemEP: bestGemEP,\n\t\t};\n\t}\n}\n\ninterface BestGemsResult {\n\tbestGemForColor: Array<Gem>,\n\tbestGemForColorEP: Array<number>,\n\tbestGemForSocket: Array<Gem>,\n\tbestGemForSocketEP: Array<number>,\n\tbestGem: Gem,\n\tbestGemEP: number,\n}\n","import { Class } from '../proto/common.js';\nimport { EquipmentSpec } from '../proto/common.js';\nimport { ItemSpec } from '../proto/common.js';\nimport { Race } from '../proto/common.js';\nimport { Spec } from '../proto/common.js';\nimport { Stat } from '../proto/common.js';\nimport { IndividualSimSettings } from '../proto/ui.js';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { Player } from '../player.js';\nimport { classNames, nameToClass, nameToRace } from '../proto_utils/names.js';\nimport { talentSpellIdsToTalentString } from '../talents/factory.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { downloadString, getEnumValues } from '../utils.js';\n\nimport { Popup } from './popup.js';\n\ndeclare var $: any;\ndeclare var tippy: any;\ndeclare var pako: any;\n\nexport function newIndividualExporters<SpecType extends Spec>(simUI: IndividualSimUI<SpecType>): HTMLElement {\n\tconst exportSettings = document.createElement('div');\n\texportSettings.classList.add('export-settings', 'sim-dropdown-menu');\n\texportSettings.innerHTML = `\n\t\t<span id=\"exportMenuLink\" class=\"dropdown-toggle fas fa-file-export\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" arai-expanded=\"false\"></span>\n\t\t<div class=\"dropdown-menu dropdown-menu-right\" aria-labelledby=\"exportMenuLink\">\n\t\t</div>\n\t`;\n\tconst linkElem = exportSettings.getElementsByClassName('dropdown-toggle')[0] as HTMLElement;\n\ttippy(linkElem, {\n\t\t'content': 'Export',\n\t\t'allowHTML': true,\n\t});\n\n\tconst menuElem = exportSettings.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\n\tconst addMenuItem = (label: string, onClick: () => void, showInRaidSim: boolean) => {\n\t\tconst itemElem = document.createElement('span');\n\t\titemElem.classList.add('dropdown-item');\n\t\tif (!showInRaidSim) {\n\t\t\titemElem.classList.add('within-raid-sim-hide');\n\t\t}\n\t\titemElem.textContent = label;\n\t\titemElem.addEventListener('click', onClick);\n\t\tmenuElem.appendChild(itemElem);\n\t};\n\n\taddMenuItem('Link', () => new IndividualLinkExporter(menuElem, simUI), false);\n\taddMenuItem('Json', () => new IndividualJsonExporter(menuElem, simUI), true);\n\taddMenuItem('80U EP', () => new Individual80UEPExporter(menuElem, simUI), false);\n\taddMenuItem('Pawn EP', () => new IndividualPawnEPExporter(menuElem, simUI), false);\n\n\treturn exportSettings;\n}\n\nexport abstract class Exporter extends Popup {\n\tprivate readonly textElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, title: string, allowDownload: boolean) {\n\t\tsuper(parent);\n\n\t\tthis.rootElem.classList.add('exporter');\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<span class=\"exporter-title\">${title}</span>\n\t\t\t<div class=\"export-content\">\n\t\t\t\t<textarea class=\"exporter-textarea\" readonly></textarea>\n\t\t\t</div>\n\t\t\t<div class=\"actions-row\">\n\t\t\t\t<button class=\"exporter-button sim-button clipboard-button\">COPY TO CLIPBOARD</button>\n\t\t\t\t<button class=\"exporter-button sim-button download-button\">DOWNLOAD</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.addCloseButton();\n\n\t\tthis.textElem = this.rootElem.getElementsByClassName('exporter-textarea')[0] as HTMLElement;\n\n\t\tconst clipboardButton = this.rootElem.getElementsByClassName('clipboard-button')[0] as HTMLElement;\n\t\tclipboardButton.addEventListener('click', event => {\n\t\t\tconst data = this.textElem.textContent!;\n\t\t\tif (navigator.clipboard == undefined) {\n\t\t\t\talert(data);\n\t\t\t} else {\n\t\t\t\tnavigator.clipboard.writeText(data);\n\t\t\t}\n\t\t});\n\n\t\tconst downloadButton = this.rootElem.getElementsByClassName('download-button')[0] as HTMLElement;\n\t\tif (allowDownload) {\n\t\t\tdownloadButton.addEventListener('click', event => {\n\t\t\t\tconst data = this.textElem.textContent!;\n\t\t\t\tdownloadString(data, 'wowsims.json');\n\t\t\t});\n\t\t} else {\n\t\t\tdownloadButton.remove();\n\t\t}\n\t}\n\n\tprotected init() {\n\t\tthis.textElem.textContent = this.getData();\n\t}\n\n\tabstract getData(): string;\n}\n\nclass IndividualLinkExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, 'Sharable Link', false);\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\treturn this.simUI.toLink();\n\t}\n}\n\nclass IndividualJsonExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, 'JSON Export', true);\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\treturn JSON.stringify(IndividualSimSettings.toJson(this.simUI.toProto()), null, 2);\n\t}\n}\n\nclass Individual80UEPExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, '80Upgrades EP Export', true);\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\tconst epValues = this.simUI.player.getEpWeights();\n\t\tconst allStats = (getEnumValues(Stat) as Array<Stat>).filter(stat => ![Stat.StatEnergy, Stat.StatRage].includes(stat));\n\t\treturn `https://eightyupgrades.com/ep/import?name=${encodeURIComponent('WoWSims Weights')}` +\n\t\t\tallStats\n\t\t\t\t.filter(stat => epValues.getStat(stat) != 0)\n\t\t\t\t.map(stat => `&${Individual80UEPExporter.linkNames[stat]}=${epValues.getStat(stat).toFixed(3)}`).join('');\n\t}\n\n\tstatic linkNames: Record<Stat, string> = {\n\t\t[Stat.StatStrength]: 'strength',\n\t\t[Stat.StatAgility]: 'agility',\n\t\t[Stat.StatStamina]: 'stamina',\n\t\t[Stat.StatIntellect]: 'intellect',\n\t\t[Stat.StatSpirit]: 'spirit',\n\t\t[Stat.StatSpellPower]: 'spellDamage',\n\t\t[Stat.StatMP5]: 'mp5',\n\t\t[Stat.StatSpellHit]: 'spellHitRating',\n\t\t[Stat.StatSpellCrit]: 'spellCritRating',\n\t\t[Stat.StatSpellHaste]: 'spellHasteRating',\n\t\t[Stat.StatSpellPenetration]: 'spellPen',\n\t\t[Stat.StatAttackPower]: 'attackPower',\n\t\t[Stat.StatMeleeHit]: 'hitRating',\n\t\t[Stat.StatMeleeCrit]: 'critRating',\n\t\t[Stat.StatMeleeHaste]: 'hasteRating',\n\t\t[Stat.StatArmorPenetration]: 'armorPen',\n\t\t[Stat.StatExpertise]: 'expertiseRating',\n\t\t[Stat.StatMana]: 'mana',\n\t\t[Stat.StatEnergy]: 'energy',\n\t\t[Stat.StatRage]: 'rage',\n\t\t[Stat.StatArmor]: 'armor',\n\t\t[Stat.StatRangedAttackPower]: 'rangedAttackPower',\n\t\t[Stat.StatDefense]: 'defenseRating',\n\t\t[Stat.StatBlock]: 'blockRating',\n\t\t[Stat.StatBlockValue]: 'blockValue',\n\t\t[Stat.StatDodge]: 'dodgeRating',\n\t\t[Stat.StatParry]: 'parryRating',\n\t\t[Stat.StatResilience]: 'resilienceRating',\n\t\t[Stat.StatHealth]: 'health',\n\t\t[Stat.StatArcaneResistance]: 'arcaneResistance',\n\t\t[Stat.StatFireResistance]: 'fireResistance',\n\t\t[Stat.StatFrostResistance]: 'frostResistance',\n\t\t[Stat.StatNatureResistance]: 'natureResistance',\n\t\t[Stat.StatShadowResistance]: 'shadowResistance',\n\t}\n}\n\nclass IndividualPawnEPExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, 'Pawn EP Export', true);\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\tconst epValues = this.simUI.player.getEpWeights();\n\t\tconst allStats = (getEnumValues(Stat) as Array<Stat>).filter(stat => ![Stat.StatEnergy, Stat.StatRage].includes(stat));\n\t\treturn `( Pawn: v1: \"WoWSims Weights\": Class=${classNames[this.simUI.player.getClass()]},` +\n\t\t\tallStats\n\t\t\t\t.filter(stat => epValues.getStat(stat) != 0)\n\t\t\t\t.map(stat => `${IndividualPawnEPExporter.statNames[stat]}=${epValues.getStat(stat).toFixed(3)}`).join(',') +\n\t\t\t' )';\n\t}\n\n\tstatic statNames: Record<Stat, string> = {\n\t\t[Stat.StatStrength]: 'Strength',\n\t\t[Stat.StatAgility]: 'Agility',\n\t\t[Stat.StatStamina]: 'Stamina',\n\t\t[Stat.StatIntellect]: 'Intellect',\n\t\t[Stat.StatSpirit]: 'Spirit',\n\t\t[Stat.StatSpellPower]: 'SpellDamage',\n\t\t[Stat.StatMP5]: 'Mp5',\n\t\t[Stat.StatSpellHit]: 'SpellHitRating',\n\t\t[Stat.StatSpellCrit]: 'SpellCritRating',\n\t\t[Stat.StatSpellHaste]: 'SpellHasteRating',\n\t\t[Stat.StatSpellPenetration]: 'SpellPen',\n\t\t[Stat.StatAttackPower]: 'Ap',\n\t\t[Stat.StatMeleeHit]: 'HitRating',\n\t\t[Stat.StatMeleeCrit]: 'CritRating',\n\t\t[Stat.StatMeleeHaste]: 'HasteRating',\n\t\t[Stat.StatArmorPenetration]: 'ArmorPenetration',\n\t\t[Stat.StatExpertise]: 'ExpertiseRating',\n\t\t[Stat.StatMana]: 'Mana',\n\t\t[Stat.StatEnergy]: 'Energy',\n\t\t[Stat.StatRage]: 'Rage',\n\t\t[Stat.StatArmor]: 'Armor',\n\t\t[Stat.StatRangedAttackPower]: 'Rap',\n\t\t[Stat.StatDefense]: 'DefenseRating',\n\t\t[Stat.StatBlock]: 'BlockRating',\n\t\t[Stat.StatBlockValue]: 'BlockValue',\n\t\t[Stat.StatDodge]: 'DodgeRating',\n\t\t[Stat.StatParry]: 'ParryRating',\n\t\t[Stat.StatResilience]: 'ResilienceRating',\n\t\t[Stat.StatHealth]: 'Health',\n\t\t[Stat.StatArcaneResistance]: 'ArcaneResistance',\n\t\t[Stat.StatFireResistance]: 'FireResistance',\n\t\t[Stat.StatFrostResistance]: 'FrostResistance',\n\t\t[Stat.StatNatureResistance]: 'NatureResistance',\n\t\t[Stat.StatShadowResistance]: 'ShadowResistance',\n\t}\n}\n","import { Class } from '../proto/common.js';\nimport { EquipmentSpec } from '../proto/common.js';\nimport { ItemSpec } from '../proto/common.js';\nimport { Glyphs } from '../proto/common.js';\nimport { Profession } from '../proto/common.js';\nimport { Race } from '../proto/common.js';\nimport { Spec } from '../proto/common.js';\nimport { IndividualSimSettings } from '../proto/ui.js';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { Player } from '../player.js';\nimport { classNames, nameToClass, nameToRace, nameToProfession } from '../proto_utils/names.js';\nimport { classGlyphsConfig, talentSpellIdsToTalentString } from '../talents/factory.js';\nimport { GlyphConfig } from '../talents/glyphs_picker.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Popup } from './popup.js';\n\ndeclare var $: any;\ndeclare var tippy: any;\n\nexport function newIndividualImporters<SpecType extends Spec>(simUI: IndividualSimUI<SpecType>): HTMLElement {\n\tconst importSettings = document.createElement('div');\n\timportSettings.classList.add('import-settings', 'sim-dropdown-menu');\n\timportSettings.innerHTML = `\n\t\t<span id=\"importMenuLink\" class=\"dropdown-toggle fas fa-file-import\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" arai-expanded=\"false\"></span>\n\t\t<div class=\"dropdown-menu dropdown-menu-right\" aria-labelledby=\"importMenuLink\">\n\t\t</div>\n\t`;\n\tconst linkElem = importSettings.getElementsByClassName('dropdown-toggle')[0] as HTMLElement;\n\ttippy(linkElem, {\n\t\t'content': 'Import',\n\t\t'allowHTML': true,\n\t});\n\n\tconst menuElem = importSettings.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\n\tconst addMenuItem = (label: string, onClick: () => void, showInRaidSim: boolean) => {\n\t\tconst itemElem = document.createElement('span');\n\t\titemElem.classList.add('dropdown-item');\n\t\tif (!showInRaidSim) {\n\t\t\titemElem.classList.add('within-raid-sim-hide');\n\t\t}\n\t\titemElem.textContent = label;\n\t\titemElem.addEventListener('click', onClick);\n\t\tmenuElem.appendChild(itemElem);\n\t};\n\n\taddMenuItem('Json', () => new IndividualJsonImporter(menuElem, simUI), true);\n\taddMenuItem('80U', () => new Individual80UImporter(menuElem, simUI), true);\n\taddMenuItem('Addon', () => new IndividualAddonImporter(menuElem, simUI), true);\n\n\treturn importSettings;\n}\n\nexport abstract class Importer extends Popup {\n\tprivate readonly textElem: HTMLTextAreaElement;\n\tprotected readonly descriptionElem: HTMLElement;\n\tprotected readonly importButton: HTMLButtonElement;\n\tprivate readonly includeFile: boolean;\n\n\tconstructor(parent: HTMLElement, title: string, includeFile: boolean) {\n\t\tsuper(parent);\n\t\tthis.includeFile = includeFile;\n\t\tconst uploadInputId = 'upload-input-' + title.toLowerCase().replaceAll(' ', '-');\n\n\t\tthis.rootElem.classList.add('importer');\n\t\tlet htmlVal = `\n\t\t\t<span class=\"importer-title\">${title}</span>\n\t\t\t<div class=\"import-description\">\n\t\t\t</div>\n\t\t\t<div class=\"import-content\">\n\t\t\t\t<textarea class=\"importer-textarea\"></textarea>\n\t\t\t</div>\n\t\t\t<div class=\"actions-row\">\n\t\t`;\n\t\tif (this.includeFile) {\n\t\t\thtmlVal += `<label for=\"${uploadInputId}\" class=\"importer-button sim-button upload-button\">UPLOAD FROM FILE</label>\n\t\t\t\t<input type=\"file\" id=\"${uploadInputId}\" class=\"importer-upload-input\" hidden>\n\t\t\t`\n\t\t}\n\t\thtmlVal += `<button class=\"importer-button sim-button import-button\">IMPORT</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.rootElem.innerHTML = htmlVal\n\n\t\tthis.addCloseButton();\n\n\t\tthis.textElem = this.rootElem.getElementsByClassName('importer-textarea')[0] as HTMLTextAreaElement;\n\t\tthis.descriptionElem = this.rootElem.getElementsByClassName('import-description')[0] as HTMLElement;\n\n\t\tif (this.includeFile) {\n\t\t\tconst uploadInput = this.rootElem.getElementsByClassName('importer-upload-input')[0] as HTMLButtonElement;\n\t\t\tuploadInput.addEventListener('change', async event => {\n\t\t\t\tconst data: string = await (event as any).target.files[0].text();\n\t\t\t\tthis.textElem.textContent = data;\n\t\t\t});\n\t\t}\n\n\t\tthis.importButton = this.rootElem.getElementsByClassName('import-button')[0] as HTMLButtonElement;\n\t\tthis.importButton.addEventListener('click', event => {\n\t\t\ttry {\n\t\t\t\tthis.onImport(this.textElem.value || '');\n\t\t\t} catch (error) {\n\t\t\t\talert('Import error: ' + error);\n\t\t\t}\n\t\t});\n\t}\n\n\tabstract onImport(data: string): void\n\n\tprotected finishIndividualImport<SpecType extends Spec>(simUI: IndividualSimUI<SpecType>, charClass: Class, race: Race, equipmentSpec: EquipmentSpec, talentsStr: string, glyphs: Glyphs | null, professions: Array<Profession>) {\n\t\tconst playerClass = simUI.player.getClass();\n\t\tif (charClass != playerClass) {\n\t\t\tthrow new Error(`Wrong Class! Expected ${classNames[playerClass]} but found ${classNames[charClass]}!`);\n\t\t}\n\n\t\tequipmentSpec.items.forEach(item => {\n\t\t\tif (item.enchant) {\n\t\t\t\tconst dbEnchant = simUI.sim.getEnchantFlexible(item.enchant);\n\t\t\t\tif (dbEnchant) {\n\t\t\t\t\titem.enchant = dbEnchant.id;\n\t\t\t\t} else {\n\t\t\t\t\titem.enchant = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst gear = simUI.sim.lookupEquipmentSpec(equipmentSpec);\n\n\t\tconst expectedEnchantIds = equipmentSpec.items.map(item => item.enchant);\n\t\tconst foundEnchantIds = gear.asSpec().items.map(item => item.enchant);\n\t\tconst missingEnchants = expectedEnchantIds.filter(expectedId => expectedId != 0 && !foundEnchantIds.includes(expectedId));\n\n\t\tconst expectedItemIds = equipmentSpec.items.map(item => item.id);\n\t\tconst foundItemIds = gear.asSpec().items.map(item => item.id);\n\t\tconst missingItems = expectedItemIds.filter(expectedId => !foundItemIds.includes(expectedId));\n\n\t\t// Now update settings using the parsed values.\n\t\tconst eventID = TypedEvent.nextEventID();\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tsimUI.player.setRace(eventID, race);\n\t\t\tsimUI.player.setGear(eventID, gear);\n\t\t\tif (talentsStr) {\n\t\t\t\tsimUI.player.setTalentsString(eventID, talentsStr);\n\t\t\t}\n\t\t\tif (glyphs) {\n\t\t\t\tsimUI.player.setGlyphs(eventID, glyphs)\n\t\t\t}\n\t\t\tif (professions.length > 0) {\n\t\t\t\tsimUI.player.setProfessions(eventID, professions)\n\t\t\t}\n\t\t});\n\n\t\tthis.close();\n\n\t\tif (missingItems.length == 0 && missingEnchants.length == 0) {\n\t\t\talert('Import successful!');\n\t\t} else {\n\t\t\talert('Import successful, but the following IDs were not found in the sim database:' +\n\t\t\t\t(missingItems.length == 0 ? '' : '\\n\\nItems: ' + missingItems.join(', ')) +\n\t\t\t\t(missingEnchants.length == 0 ? '' : '\\n\\nEnchants: ' + missingEnchants.join(', ')));\n\t\t}\n\t}\n}\n\nclass IndividualJsonImporter<SpecType extends Spec> extends Importer {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, 'JSON Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport settings from a JSON text file, which can be created using the JSON Export feature of this site.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the JSON text below and click, 'Import'.\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tonImport(data: string) {\n\t\tconst proto = IndividualSimSettings.fromJsonString(data);\n\t\tif (this.simUI.isWithinRaidSim) {\n\t\t\tif (proto.player) {\n\t\t\t\tthis.simUI.player.fromProto(TypedEvent.nextEventID(), proto.player);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.simUI.fromProto(TypedEvent.nextEventID(), proto);\n\t\t}\n\t\tthis.close();\n\t}\n}\n\nclass Individual80UImporter<SpecType extends Spec> extends Importer {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, '80 Upgrades Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport settings from <a href=\"https://eightyupgrades.com\" target=\"_blank\">Eighty Upgrades</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the site's export option below and click, 'Import'.\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tonImport(data: string) {\n\t\tconst importJson = JSON.parse(data);\n\n\t\t// Parse all the settings.\n\t\tconst charClass = nameToClass((importJson?.character?.gameClass as string) || '');\n\t\tif (charClass == Class.ClassUnknown) {\n\t\t\tthrow new Error('Could not parse Class!');\n\t\t}\n\n\t\tconst race = nameToRace((importJson?.character?.race as string) || '');\n\t\tif (race == Race.RaceUnknown) {\n\t\t\tthrow new Error('Could not parse Race!');\n\t\t}\n\n\t\tlet talentsStr = '';\n\t\tif (importJson?.talents?.length > 0) {\n\t\t\tconst talentIds = (importJson.talents as Array<any>).map(talentJson => talentJson.spellId);\n\t\t\ttalentsStr = talentSpellIdsToTalentString(charClass, talentIds);\n\t\t}\n\n\t\tlet equipmentSpec = EquipmentSpec.create();\n\t\t(importJson.items as Array<any>).forEach(itemJson => {\n\t\t\tlet itemSpec = ItemSpec.create();\n\t\t\titemSpec.id = itemJson.id;\n\t\t\tif (itemJson.enchant?.id) {\n\t\t\t\titemSpec.enchant = itemJson.enchant.id;\n\t\t\t}\n\t\t\tif (itemJson.gems) {\n\t\t\t\titemSpec.gems = (itemJson.gems as Array<any>).filter(gemJson => gemJson?.id).map(gemJson => gemJson.id);\n\t\t\t}\n\t\t\tequipmentSpec.items.push(itemSpec);\n\t\t});\n\n\t\tconst gear = this.simUI.sim.lookupEquipmentSpec(equipmentSpec);\n\n\t\tthis.finishIndividualImport(this.simUI, charClass, race, equipmentSpec, talentsStr, null, []);\n\t}\n}\n\nclass IndividualAddonImporter<SpecType extends Spec> extends Importer {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, 'Addon Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport settings from the <a href=\"https://www.curseforge.com/wow/addons/wowsimsexporter\" target=\"_blank\">WoWSims Importer In-Game Addon</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, talents, glyphs, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the addon below and click, 'Import'.\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tonImport(data: string) {\n\t\tconst importJson = JSON.parse(data);\n\n\t\t// Parse all the settings.\n\t\tconst charClass = nameToClass((importJson['class'] as string) || '');\n\t\tif (charClass == Class.ClassUnknown) {\n\t\t\tthrow new Error('Could not parse Class!');\n\t\t}\n\n\t\tconst race = nameToRace((importJson['race'] as string) || '');\n\t\tif (race == Race.RaceUnknown) {\n\t\t\tthrow new Error('Could not parse Race!');\n\t\t}\n\n\t\tconst professions = (importJson['professions'] as Array<{name: string, level: number}>).map(profData => nameToProfession(profData.name));\n\t\tprofessions.forEach((prof, i) => {\n\t\t\tif (prof == Profession.ProfessionUnknown) {\n\t\t\t\tthrow new Error(`Could not parse profession '${importJson['professions'][i]}'`);\n\t\t\t}\n\t\t});\n\n\t\tconst talentsStr = (importJson['talents'] as string) || '';\n\n\t\tconst glyphsConfig = classGlyphsConfig[charClass];\n\t\tconst majorGlyphIDs = (importJson['glyphs']['major'] as Array<string>).map(glyphName => glyphNameToID(glyphName, glyphsConfig.majorGlyphs));\n\t\tconst minorGlyphIDs = (importJson['glyphs']['minor'] as Array<string>).map(glyphName => glyphNameToID(glyphName, glyphsConfig.minorGlyphs));\n\t\tconst glyphs = Glyphs.create({\n\t\t\tmajor1: majorGlyphIDs[0] || 0,\n\t\t\tmajor2: majorGlyphIDs[1] || 0,\n\t\t\tmajor3: majorGlyphIDs[2] || 0,\n\t\t\tminor1: minorGlyphIDs[0] || 0,\n\t\t\tminor2: minorGlyphIDs[1] || 0,\n\t\t\tminor3: minorGlyphIDs[2] || 0,\n\t\t});\n\n\t\tconst gearJson = importJson['gear'];\n\t\tgearJson.items = (gearJson.items as Array<any>).filter(item => item != null);\n\t\tconst equipmentSpec = EquipmentSpec.fromJson(gearJson);\n\n\t\tthis.finishIndividualImport(this.simUI, charClass, race, equipmentSpec, talentsStr, glyphs, professions);\n\t}\n}\n\nfunction glyphNameToID(glyphName: string, glyphsConfig: Record<number, GlyphConfig>): number {\n\tif (!glyphName) {\n\t\treturn 0;\n\t}\n\n\tfor (let glyphIDStr in glyphsConfig) {\n\t\tif (glyphsConfig[glyphIDStr].name == glyphName) {\n\t\t\treturn parseInt(glyphIDStr);\n\t\t}\n\t}\n\tthrow new Error(`Unknown glyph name '${glyphName}'`);\n}\n","import { ActionId } from '../proto_utils/action_id.js';\nimport { BattleElixir } from '../proto/common.js';\nimport { Explosive } from '../proto/common.js';\nimport { Flask } from '../proto/common.js';\nimport { Food } from '../proto/common.js';\nimport { GuardianElixir } from '../proto/common.js';\nimport { RaidBuffs } from '../proto/common.js';\nimport { PartyBuffs } from '../proto/common.js';\nimport { IndividualBuffs } from '../proto/common.js';\nimport { Conjured } from '../proto/common.js';\nimport { Consumes } from '../proto/common.js';\nimport { Debuffs } from '../proto/common.js';\n\nimport { PetFood } from '../proto/common.js';\nimport { Potions } from '../proto/common.js';\nimport { Spec } from '../proto/common.js';\nimport { TristateEffect } from '../proto/common.js';\nimport { Party } from '../party.js';\nimport { Player } from '../player.js';\nimport { Raid } from '../raid.js';\nimport { Sim } from '../sim.js';\nimport { Target } from '../target.js';\nimport { Encounter } from '../encounter.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\n\nimport { IconPickerConfig } from './icon_picker.js';\nimport { IconEnumPicker, IconEnumPickerConfig, IconEnumValueConfig } from './icon_enum_picker.js';\nimport { MultiIconPickerConfig } from './multi_icon_picker.js';\n\nimport * as InputHelpers from './input_helpers.js';\n\n// Raid Buffs\n\nexport const AllStatsBuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(48470), ActionId.fromSpellId(17051), 'giftOfTheWild'),\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(49634), 'drumsOfTheWild'),\n], 'Stats');\n\nexport const AllStatsPercentBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(25898), 'blessingOfKings'),\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(49633), 'drumsOfForgottenKings'),\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(25899), 'blessingOfSanctuary'),\n], 'Stats %');\n\nexport const ArmorBuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(48942), ActionId.fromSpellId(20140), 'devotionAura'),\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(58753), ActionId.fromSpellId(16293), 'stoneskinTotem'),\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(43468), 'scrollOfProtection'),\n\t// stoneskin?\n], 'Armor');\n\nexport const StaminaBuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(48161), ActionId.fromSpellId(14767), 'powerWordFortitude'),\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(37094), 'scrollOfStamina'),\n], 'Stam');\n\nexport const StrengthAndAgilityBuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(58643), ActionId.fromSpellId(52456), 'strengthOfEarthTotem'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(57623), 'hornOfWinter'),\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(43464), 'scrollOfAgility'),\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(43466), 'scrollOfStrength'),\n], 'Str/Agi');\n\nexport const IntellectBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(43002), 'arcaneBrilliance'),\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(57567), ActionId.fromSpellId(54038), 'felIntelligence'),\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(37092), 'scrollOfIntellect'),\n], 'Int');\n\nexport const SpiritBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(48073), 'divineSpirit'),\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(57567), ActionId.fromSpellId(54038), 'felIntelligence'),\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(37098), 'scrollOfSpirit'),\n], 'Spi');\n\nexport const AttackPowerBuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateIndividualBuffInput(ActionId.fromSpellId(48934), ActionId.fromSpellId(20045), 'blessingOfMight'),\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(47436), ActionId.fromSpellId(12861), 'battleShout'),\n], 'AP');\n\nexport const AttackPowerPercentBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(53138), 'abominationsMight'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(30809), 'unleashedRage'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(19506), 'trueshotAura'),\n], 'AP %');\n\nexport const DamagePercentBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(31869), 'sanctifiedRetribution'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(31583), 'arcaneEmpowerment'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(34460), 'ferociousInspiration'),\n], 'Dmg %');\n\nexport const DamageReductionPercentBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(57472), 'renewedHope'),\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(25899), 'blessingOfSanctuary'),\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(50720), 'vigilance'),\n], 'Mit %');\n\nexport const HastePercentBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(53648), 'swiftRetribution'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(48396), 'moonkinAura', TristateEffect.TristateEffectImproved),\n], 'Haste %');\n\nexport const HealthBuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(47440), ActionId.fromSpellId(12861), 'commandingShout'),\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(47982), ActionId.fromSpellId(18696), 'bloodPact'),\n], 'Health');\n\nexport const MP5Buff = InputHelpers.makeMultiIconInput([\n\tmakeTristateIndividualBuffInput(ActionId.fromSpellId(48938), ActionId.fromSpellId(20245), 'blessingOfWisdom'),\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(58774), ActionId.fromSpellId(16206), 'manaSpringTotem'),\n], 'MP5');\n\nexport const MeleeCritBuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(17007), ActionId.fromSpellId(34300), 'leaderOfThePack'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(29801), 'rampage'),\n], 'Melee Crit');\n\nexport const MeleeHasteBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(55610), 'icyTalons'),\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(65990), ActionId.fromSpellId(29193), 'windfuryTotem'),\n], 'Melee Haste');\n\nexport const ReplenishmentBuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(48160), 'vampiricTouch'),\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(31878), 'judgementsOfTheWise'),\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(53292), 'huntingParty'),\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(54118), 'improvedSoulLeech'),\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(44561), 'enduringWinter'),\n], 'Repl', 2);\n\nexport const SpellCritBuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(24907), ActionId.fromSpellId(48396), 'moonkinAura'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(51470), 'elementalOath'),\n], 'Spell Crit');\n\nexport const SpellHasteBuff = withLabel(makeBooleanRaidBuffInput(ActionId.fromSpellId(3738), 'wrathOfAirTotem'), 'Spell Haste');\n\nexport const SpellPowerBuff = InputHelpers.makeMultiIconInput([\n\tmakeMultistateRaidBuffInput(ActionId.fromSpellId(47240), 5000, 'demonicPact', 500),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(57722), 'totemOfWrath'),\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(58656), 'flametongueTotem'),\n], 'SP');\n\nexport const Bloodlust = withLabel(makeBooleanRaidBuffInput(ActionId.fromSpellId(2825), 'bloodlust'), 'Lust');\n\n// Misc Buffs\nexport const RetributionAura = makeBooleanRaidBuffInput(ActionId.fromSpellId(54043), 'retributionAura');\nexport const ShadowProtection = makeBooleanRaidBuffInput(ActionId.fromSpellId(48170), 'shadowProtection');\nexport const BraidedEterniumChain = makeBooleanPartyBuffInput(ActionId.fromSpellId(31025), 'braidedEterniumChain');\nexport const ChainOfTheTwilightOwl = makeBooleanPartyBuffInput(ActionId.fromSpellId(31035), 'chainOfTheTwilightOwl');\nexport const HeroicPresence = makeBooleanPartyBuffInput(ActionId.fromSpellId(6562), 'heroicPresence');\nexport const EyeOfTheNight = makeBooleanPartyBuffInput(ActionId.fromSpellId(31033), 'eyeOfTheNight');\nexport const Thorns = makeTristateRaidBuffInput(ActionId.fromSpellId(53307), ActionId.fromSpellId(16840), 'thorns');\nexport const ManaTideTotem = makeMultistatePartyBuffInput(ActionId.fromSpellId(16190), 5, 'manaTideTotems');\nexport const Innervate = makeMultistateIndividualBuffInput(ActionId.fromSpellId(29166), 11, 'innervates');\nexport const PowerInfusion = makeMultistateIndividualBuffInput(ActionId.fromSpellId(10060), 11, 'powerInfusions');\nexport const FocusMagic = makeBooleanIndividualBuffInput(ActionId.fromSpellId(54648), 'focusMagic');\nexport const TricksOfTheTrade = makeMultistateIndividualBuffInput(ActionId.fromSpellId(57933), 20, 'tricksOfTheTrades');\nexport const UnholyFrenzy = makeMultistateIndividualBuffInput(ActionId.fromSpellId(49016), 11, 'unholyFrenzy');\nexport const RevitalizeRejuvination = makeMultistateMultiplierIndividualBuffInput(ActionId.fromSpellId(26982), 101, 10, 'revitalizeRejuvination');\nexport const RevitalizeWildGrowth = makeMultistateMultiplierIndividualBuffInput(ActionId.fromSpellId(53251), 101, 10, 'revitalizeWildGrowth');\n\n// Debuffs\n\nexport const MajorArmorDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(7386), 'sunderArmor'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(8647), 'exposeArmor'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(55754), 'acidSpit'),\n], 'Major Ar');\n\nexport const MinorArmorDebuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateDebuffInput(ActionId.fromSpellId(770), ActionId.fromSpellId(33602), 'faerieFire'),\n\tmakeTristateDebuffInput(ActionId.fromSpellId(50511), ActionId.fromSpellId(18180), 'curseOfWeakness'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(56631), 'sting'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(53598), 'sporeCloud'),\n], 'Minor Ar');\n\nexport const AttackPowerDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(26016), 'vindication'),\n\tmakeTristateDebuffInput(ActionId.fromSpellId(47437), ActionId.fromSpellId(12879), 'demoralizingShout'),\n\tmakeTristateDebuffInput(ActionId.fromSpellId(48560), ActionId.fromSpellId(16862), 'demoralizingRoar'),\n\tmakeTristateDebuffInput(ActionId.fromSpellId(50511), ActionId.fromSpellId(18180), 'curseOfWeakness'),\n], 'AP');\n\nexport const BleedDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(33876), 'mangle'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(46855), 'trauma'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(57393), 'stampede'),\n], 'Bleed');\n\nexport const CritDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(30706), 'totemOfWrath'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(20337), 'heartOfTheCrusader'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(58410), 'masterPoisoner'),\n], 'Crit');\n\nexport const MeleeAttackSpeedDebuff = InputHelpers.makeMultiIconInput([\n\tmakeTristateDebuffInput(ActionId.fromSpellId(47502), ActionId.fromSpellId(12666), 'thunderClap'),\n\tmakeTristateDebuffInput(ActionId.fromSpellId(55095), ActionId.fromSpellId(51456), 'frostFever'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(53696), 'judgementsOfTheJust'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(48485), 'infectedWounds'),\n], 'Atk Spd');\n\nexport const MeleeHitDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(65855), 'insectSwarm'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(3043), 'scorpidSting'),\n], 'Miss');\n\nexport const PhysicalDamageDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(29859), 'bloodFrenzy'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(58413), 'savageCombat'),\n], 'Phys Vuln');\n\nexport const SpellCritDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(17800), 'shadowMastery'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(12873), 'improvedScorch'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(28593), 'wintersChill'),\n], 'Spell Crit');\n\nexport const SpellHitDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(33198), 'misery'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(33602), 'faerieFire', TristateEffect.TristateEffectImproved),\n], 'Spell Hit');\n\nexport const SpellDamageDebuff = InputHelpers.makeMultiIconInput([\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(51161), 'ebonPlaguebringer'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(48511), 'earthAndMoon'),\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(47865), 'curseOfElements'),\n], 'Spell Dmg');\n\nexport const HuntersMark = withLabel(makeQuadstateDebuffInput(ActionId.fromSpellId(53338), ActionId.fromSpellId(19423), ActionId.fromItemId(42907), 'huntersMark'), 'Mark');\nexport const JudgementOfWisdom = withLabel(makeBooleanDebuffInput(ActionId.fromSpellId(53408), 'judgementOfWisdom'), 'JoW');\nexport const JudgementOfLight = makeBooleanDebuffInput(ActionId.fromSpellId(20271), 'judgementOfLight');\nexport const ShatteringThrow = makeMultistateIndividualBuffInput(ActionId.fromSpellId(64382), 20, 'shatteringThrows');\nexport const GiftOfArthas = makeBooleanDebuffInput(ActionId.fromSpellId(11374), 'giftOfArthas');\n\n// Consumes\nexport const ThermalSapper = makeBooleanConsumeInput(ActionId.fromItemId(42641), 'thermalSapper');\nexport const ExplosiveDecoy = makeBooleanConsumeInput(ActionId.fromItemId(40536), 'explosiveDecoy');\n\nexport const SpicedMammothTreats = makeBooleanConsumeInput(ActionId.fromItemId(43005), 'petFood', PetFood.PetFoodSpicedMammothTreats);\nexport const PetScrollOfAgilityV = makeBooleanConsumeInput(ActionId.fromItemId(27498), 'petScrollOfAgility', 5);\nexport const PetScrollOfStrengthV = makeBooleanConsumeInput(ActionId.fromItemId(27503), 'petScrollOfStrength', 5);\n\nfunction withLabel<ModObject, T>(config: InputHelpers.TypedIconPickerConfig<ModObject, T>, label: string): InputHelpers.TypedIconPickerConfig<ModObject, T> {\n\tconfig.label = label;\n\treturn config;\n}\n\nfunction makeBooleanRaidBuffInput(id: ActionId, fieldName: keyof RaidBuffs, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, RaidBuffs, Raid>({\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\n\t\tgetValue: (raid: Raid) => raid.getBuffs(),\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: RaidBuffs) => raid.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (raid: Raid) => raid.buffsChangeEmitter,\n\t}, id, fieldName, value);\n}\nfunction makeBooleanPartyBuffInput(id: ActionId, fieldName: keyof PartyBuffs, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, PartyBuffs, Party>({\n\t\tgetModObject: (player: Player<any>) => player.getParty()!,\n\t\tgetValue: (party: Party) => party.getBuffs(),\n\t\tsetValue: (eventID: EventID, party: Party, newVal: PartyBuffs) => party.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (party: Party) => party.buffsChangeEmitter,\n\t}, id, fieldName, value);\n}\nfunction makeBooleanIndividualBuffInput(id: ActionId, fieldName: keyof IndividualBuffs, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, IndividualBuffs, Player<any>>({\n\t\tgetModObject: (player: Player<any>) => player,\n\t\tgetValue: (player: Player<any>) => player.getBuffs(),\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (player: Player<any>) => player.buffsChangeEmitter,\n\t}, id, fieldName, value);\n}\nfunction makeBooleanConsumeInput(id: ActionId, fieldName: keyof Consumes, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, Consumes, Player<any>>({\n\t\tgetModObject: (player: Player<any>) => player,\n\t\tgetValue: (player: Player<any>) => player.getConsumes(),\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: Consumes) => player.setConsumes(eventID, newVal),\n\t\tchangeEmitter: (player: Player<any>) => player.consumesChangeEmitter,\n\t}, id, fieldName, value);\n}\nfunction makeBooleanDebuffInput(id: ActionId, fieldName: keyof Debuffs, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, Debuffs, Raid>({\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\n\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\n\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\n\t}, id, fieldName, value);\n}\n\nfunction makeTristateRaidBuffInput(id: ActionId, impId: ActionId, fieldName: keyof RaidBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeTristateIconInput<any, RaidBuffs, Raid>({\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\n\t\tgetValue: (raid: Raid) => raid.getBuffs(),\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: RaidBuffs) => raid.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (raid: Raid) => raid.buffsChangeEmitter,\n\t}, id, impId, fieldName);\n}\nfunction makeTristateIndividualBuffInput(id: ActionId, impId: ActionId, fieldName: keyof IndividualBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeTristateIconInput<any, IndividualBuffs, Player<any>>({\n\t\tgetModObject: (player: Player<any>) => player,\n\t\tgetValue: (player: Player<any>) => player.getBuffs(),\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (player: Player<any>) => player.buffsChangeEmitter,\n\t}, id, impId, fieldName);\n}\nfunction makeTristateDebuffInput(id: ActionId, impId: ActionId, fieldName: keyof Debuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeTristateIconInput<any, Debuffs, Raid>({\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\n\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\n\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\n\t}, id, impId, fieldName);\n}\nfunction makeQuadstateDebuffInput(id: ActionId, impId: ActionId, impId2: ActionId, fieldName: keyof Debuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeQuadstateIconInput<any, Debuffs, Raid>({\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\n\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\n\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\n\t}, id, impId, impId2, fieldName);\n}\nfunction makeMultistateRaidBuffInput(id: ActionId, numStates: number, fieldName: keyof RaidBuffs, multiplier?: number): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, RaidBuffs, Raid>({\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\n\t\tgetValue: (raid: Raid) => raid.getBuffs(),\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: RaidBuffs) => raid.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (raid: Raid) => raid.buffsChangeEmitter,\n\t}, id, numStates, fieldName, multiplier);\n}\nfunction makeMultistatePartyBuffInput(id: ActionId, numStates: number, fieldName: keyof PartyBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, PartyBuffs, Party>({\n\t\tgetModObject: (player: Player<any>) => player.getParty()!,\n\t\tgetValue: (party: Party) => party.getBuffs(),\n\t\tsetValue: (eventID: EventID, party: Party, newVal: PartyBuffs) => party.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (party: Party) => party.buffsChangeEmitter,\n\t}, id, numStates, fieldName);\n}\nfunction makeMultistateIndividualBuffInput(id: ActionId, numStates: number, fieldName: keyof IndividualBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, IndividualBuffs, Player<any>>({\n\t\tgetModObject: (player: Player<any>) => player,\n\t\tgetValue: (player: Player<any>) => player.getBuffs(),\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (player: Player<any>) => player.buffsChangeEmitter,\n\t}, id, numStates, fieldName);\n}\nfunction makeMultistateMultiplierIndividualBuffInput(id: ActionId, numStates: number, multiplier: number, fieldName: keyof IndividualBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, IndividualBuffs, Player<any>>({\n\t\tgetModObject: (player: Player<any>) => player,\n\t\tgetValue: (player: Player<any>) => player.getBuffs(),\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n\t\tchangeEmitter: (player: Player<any>) => player.buffsChangeEmitter,\n\t}, id, numStates, fieldName, multiplier);\n}\n\n\n//////////////////////////////////////////////////////////////////////\n// Custom buffs that don't fit into any of the helper functions above.\n//////////////////////////////////////////////////////////////////////\n\nfunction makePotionInputFactory(consumesFieldName: keyof Consumes): (options: Array<Potions>) => InputHelpers.TypedIconEnumPickerConfig<Player<any>, Potions> {\n\treturn makeConsumeInputFactory(consumesFieldName, [\n\t\t{ actionId: ActionId.fromItemId(33447), value: Potions.RunicHealingPotion },\n\t\t{ actionId: ActionId.fromItemId(33448), value: Potions.RunicManaPotion },\n\t\t{ actionId: ActionId.fromItemId(40093), value: Potions.IndestructiblePotion },\n\t\t{ actionId: ActionId.fromItemId(40211), value: Potions.PotionOfSpeed },\n\t\t{ actionId: ActionId.fromItemId(40212), value: Potions.PotionOfWildMagic },\n\n\t\t{ actionId: ActionId.fromItemId(22839), value: Potions.DestructionPotion },\n\t\t{ actionId: ActionId.fromItemId(22838), value: Potions.HastePotion },\n\t\t{ actionId: ActionId.fromItemId(13442), value: Potions.MightyRagePotion },\n\t\t{ actionId: ActionId.fromItemId(22832), value: Potions.SuperManaPotion },\n\t\t{ actionId: ActionId.fromItemId(31677), value: Potions.FelManaPotion },\n\t\t{ actionId: ActionId.fromItemId(22828), value: Potions.InsaneStrengthPotion },\n\t\t{ actionId: ActionId.fromItemId(22849), value: Potions.IronshieldPotion },\n\t\t{ actionId: ActionId.fromItemId(22837), value: Potions.HeroicPotion },\n\t] as Array<IconEnumValueConfig<Player<any>, Potions>>);\n}\nexport const makePotionsInput = makePotionInputFactory('defaultPotion');\nexport const makePrepopPotionsInput = makePotionInputFactory('prepopPotion');\n\nexport const makeConjuredInput = makeConsumeInputFactory('defaultConjured', [\n\t{ actionId: ActionId.fromItemId(12662), value: Conjured.ConjuredDarkRune },\n\t{ actionId: ActionId.fromItemId(22788), value: Conjured.ConjuredFlameCap },\n\t{ actionId: ActionId.fromItemId(22105), value: Conjured.ConjuredHealthstone },\n\t{ actionId: ActionId.fromItemId(7676), value: Conjured.ConjuredRogueThistleTea },\n] as Array<IconEnumValueConfig<Player<any>, Conjured>>);\n\nexport const makeFlasksInput = makeConsumeInputFactory('flask', [\n\t{ actionId: ActionId.fromItemId(46376), value: Flask.FlaskOfTheFrostWyrm },\n\t{ actionId: ActionId.fromItemId(46377), value: Flask.FlaskOfEndlessRage },\n\t{ actionId: ActionId.fromItemId(46378), value: Flask.FlaskOfPureMojo },\n\t{ actionId: ActionId.fromItemId(46379), value: Flask.FlaskOfStoneblood },\n\t{ actionId: ActionId.fromItemId(40079), value: Flask.LesserFlaskOfToughness },\n\t{ actionId: ActionId.fromItemId(44939), value: Flask.LesserFlaskOfResistance },\n\t{ actionId: ActionId.fromItemId(22861), value: Flask.FlaskOfBlindingLight },\n\t{ actionId: ActionId.fromItemId(22853), value: Flask.FlaskOfMightyRestoration },\n\t{ actionId: ActionId.fromItemId(22866), value: Flask.FlaskOfPureDeath },\n\t{ actionId: ActionId.fromItemId(22854), value: Flask.FlaskOfRelentlessAssault },\n\t{ actionId: ActionId.fromItemId(13512), value: Flask.FlaskOfSupremePower },\n\t{ actionId: ActionId.fromItemId(22851), value: Flask.FlaskOfFortification },\n\t{ actionId: ActionId.fromItemId(33208), value: Flask.FlaskOfChromaticWonder },\n] as Array<IconEnumValueConfig<Player<any>, Flask>>, (eventID: EventID, player: Player<any>, newValue: Flask) => {\n\tif (newValue) {\n\t\tconst newConsumes = player.getConsumes();\n\t\tnewConsumes.battleElixir = BattleElixir.BattleElixirUnknown;\n\t\tnewConsumes.guardianElixir = GuardianElixir.GuardianElixirUnknown;\n\t\tplayer.setConsumes(eventID, newConsumes);\n\t}\n});\n\nexport const makeBattleElixirsInput = makeConsumeInputFactory('battleElixir', [\n\t{ actionId: ActionId.fromItemId(44325), value: BattleElixir.ElixirOfAccuracy },\n\t{ actionId: ActionId.fromItemId(44330), value: BattleElixir.ElixirOfArmorPiercing },\n\t{ actionId: ActionId.fromItemId(44327), value: BattleElixir.ElixirOfDeadlyStrikes },\n\t{ actionId: ActionId.fromItemId(44329), value: BattleElixir.ElixirOfExpertise },\n\t{ actionId: ActionId.fromItemId(44331), value: BattleElixir.ElixirOfLightningSpeed },\n\t{ actionId: ActionId.fromItemId(39666), value: BattleElixir.ElixirOfMightyAgility },\n\t{ actionId: ActionId.fromItemId(40073), value: BattleElixir.ElixirOfMightyStrength },\n\t{ actionId: ActionId.fromItemId(40076), value: BattleElixir.GurusElixir },\n\t{ actionId: ActionId.fromItemId(40070), value: BattleElixir.SpellpowerElixir },\n\t{ actionId: ActionId.fromItemId(40068), value: BattleElixir.WrathElixir },\n\t{ actionId: ActionId.fromItemId(28103), value: BattleElixir.AdeptsElixir },\n\t{ actionId: ActionId.fromItemId(9224), value: BattleElixir.ElixirOfDemonslaying },\n\t{ actionId: ActionId.fromItemId(22831), value: BattleElixir.ElixirOfMajorAgility },\n\t{ actionId: ActionId.fromItemId(22833), value: BattleElixir.ElixirOfMajorFirePower },\n\t{ actionId: ActionId.fromItemId(22827), value: BattleElixir.ElixirOfMajorFrostPower },\n\t{ actionId: ActionId.fromItemId(22835), value: BattleElixir.ElixirOfMajorShadowPower },\n\t{ actionId: ActionId.fromItemId(22824), value: BattleElixir.ElixirOfMajorStrength },\n\t{ actionId: ActionId.fromItemId(28104), value: BattleElixir.ElixirOfMastery },\n\t{ actionId: ActionId.fromItemId(13452), value: BattleElixir.ElixirOfTheMongoose },\n\t{ actionId: ActionId.fromItemId(31679), value: BattleElixir.FelStrengthElixir },\n\t{ actionId: ActionId.fromItemId(13454), value: BattleElixir.GreaterArcaneElixir },\n] as Array<IconEnumValueConfig<Player<any>, BattleElixir>>, (eventID: EventID, player: Player<any>, newValue: BattleElixir) => {\n\tif (newValue) {\n\t\tconst newConsumes = player.getConsumes();\n\t\tnewConsumes.flask = Flask.FlaskUnknown;\n\t\tplayer.setConsumes(eventID, newConsumes);\n\t}\n});\n\nexport const makeGuardianElixirsInput = makeConsumeInputFactory('guardianElixir', [\n\t{ actionId: ActionId.fromItemId(44328), value: GuardianElixir.ElixirOfMightyDefense },\n\t{ actionId: ActionId.fromItemId(40078), value: GuardianElixir.ElixirOfMightyFortitude },\n\t{ actionId: ActionId.fromItemId(40109), value: GuardianElixir.ElixirOfMightyMageblood },\n\t{ actionId: ActionId.fromItemId(44332), value: GuardianElixir.ElixirOfMightyThoughts },\n\t{ actionId: ActionId.fromItemId(40097), value: GuardianElixir.ElixirOfProtection },\n\t{ actionId: ActionId.fromItemId(40072), value: GuardianElixir.ElixirOfSpirit },\n\t{ actionId: ActionId.fromItemId(9088), value: GuardianElixir.GiftOfArthas },\n\t{ actionId: ActionId.fromItemId(32067), value: GuardianElixir.ElixirOfDraenicWisdom },\n\t{ actionId: ActionId.fromItemId(32068), value: GuardianElixir.ElixirOfIronskin },\n\t{ actionId: ActionId.fromItemId(22834), value: GuardianElixir.ElixirOfMajorDefense },\n\t{ actionId: ActionId.fromItemId(32062), value: GuardianElixir.ElixirOfMajorFortitude },\n\t{ actionId: ActionId.fromItemId(22840), value: GuardianElixir.ElixirOfMajorMageblood },\n] as Array<IconEnumValueConfig<Player<any>, GuardianElixir>>, (eventID: EventID, player: Player<any>, newValue: GuardianElixir) => {\n\tif (newValue) {\n\t\tconst newConsumes = player.getConsumes();\n\t\tnewConsumes.flask = Flask.FlaskUnknown;\n\t\tplayer.setConsumes(eventID, newConsumes);\n\t}\n});\n\nexport const makeFoodInput = makeConsumeInputFactory('food', [\n\t{ actionId: ActionId.fromItemId(43015), value: Food.FoodFishFeast },\n\t{ actionId: ActionId.fromItemId(34753), value: Food.FoodGreatFeast },\n\t{ actionId: ActionId.fromItemId(42999), value: Food.FoodBlackenedDragonfin },\n\t{ actionId: ActionId.fromItemId(42995), value: Food.FoodHeartyRhino },\n\t{ actionId: ActionId.fromItemId(34754), value: Food.FoodMegaMammothMeal },\n\t{ actionId: ActionId.fromItemId(34756), value: Food.FoodSpicedWormBurger },\n\t{ actionId: ActionId.fromItemId(42994), value: Food.FoodRhinoliciousWormsteak },\n\t{ actionId: ActionId.fromItemId(34769), value: Food.FoodImperialMantaSteak },\n\t{ actionId: ActionId.fromItemId(42996), value: Food.FoodSnapperExtreme },\n\t{ actionId: ActionId.fromItemId(34758), value: Food.FoodMightyRhinoDogs },\n\t{ actionId: ActionId.fromItemId(34767), value: Food.FoodFirecrackerSalmon },\n\t{ actionId: ActionId.fromItemId(42998), value: Food.FoodCuttlesteak },\n\t{ actionId: ActionId.fromItemId(43000), value: Food.FoodDragonfinFilet },\n\n\t{ actionId: ActionId.fromItemId(27657), value: Food.FoodBlackenedBasilisk },\n\t{ actionId: ActionId.fromItemId(27664), value: Food.FoodGrilledMudfish },\n\t{ actionId: ActionId.fromItemId(27655), value: Food.FoodRavagerDog },\n\t{ actionId: ActionId.fromItemId(27658), value: Food.FoodRoastedClefthoof },\n\t{ actionId: ActionId.fromItemId(33872), value: Food.FoodSpicyHotTalbuk },\n\t{ actionId: ActionId.fromItemId(33825), value: Food.FoodSkullfishSoup },\n\t{ actionId: ActionId.fromItemId(33052), value: Food.FoodFishermansFeast },\n] as Array<IconEnumValueConfig<Player<any>, Food>>);\n\nexport const FillerExplosiveInput = makeConsumeInput('fillerExplosive', [\n\t{ actionId: ActionId.fromItemId(41119), value: Explosive.ExplosiveSaroniteBomb },\n\t{ actionId: ActionId.fromItemId(40771), value: Explosive.ExplosiveCobaltFragBomb },\n] as Array<IconEnumValueConfig<Player<any>, Explosive>>);\n\nfunction makeConsumeInputFactory<T extends number>(consumesFieldName: keyof Consumes, allOptions: Array<IconEnumValueConfig<Player<any>, T>>, onSet?: (eventID: EventID, player: Player<any>, newValue: T) => void): (options: Array<T>) => InputHelpers.TypedIconEnumPickerConfig<Player<any>, T> {\n\treturn (options: Array<T>) => {\n\t\treturn {\n\t\t\ttype: 'iconEnum',\n\t\t\tnumColumns: options.length > 5 ? 2 : 1,\n\t\t\tvalues: [\n\t\t\t\t{ color: 'grey', value: 0 } as unknown as IconEnumValueConfig<Player<any>, T>,\n\t\t\t].concat(options.map(option => allOptions.find(allOption => allOption.value == option)!)),\n\t\t\tequals: (a: T, b: T) => a == b,\n\t\t\tzeroValue: 0 as T,\n\t\t\tchangedEvent: (player: Player<any>) => player.consumesChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getConsumes()[consumesFieldName] as T,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\tconst newConsumes = player.getConsumes();\n\t\t\t\t(newConsumes[consumesFieldName] as number) = newValue;\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tplayer.setConsumes(eventID, newConsumes);\n\t\t\t\t\tif (onSet) {\n\t\t\t\t\t\tonSet(eventID, player, newValue as T);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\t};\n}\n\nfunction makeConsumeInput<T extends number>(consumesFieldName: keyof Consumes, allOptions: Array<IconEnumValueConfig<Player<any>, T>>, onSet?: (eventID: EventID, player: Player<any>, newValue: T) => void): InputHelpers.TypedIconEnumPickerConfig<Player<any>, T> {\n\tconst factory = makeConsumeInputFactory(consumesFieldName, allOptions, onSet);\n\treturn factory(allOptions.map(option => option.value));\n}\n","export const OTHER_BUFFS_SECTION = 'Buffs provided by other party/raid members.';\nexport const DEBUFFS_SECTION = 'Debuffs applied by other raid members.';\nexport const COOLDOWNS_SECTION = 'Specify cooldown timings, in seconds. Cooldowns will be used as soon as possible after their specified timings. When not specified, cooldowns will be used when ready and it is sensible to do so.<br><br>Multiple timings can be provided by separating with commas. Any cooldown usages after the last provided timing will use the default logic.';\nexport const BLESSINGS_SECTION = 'Specify Paladin Blessings for each role, in order of priority. Blessings in the 1st column will be used if there is at least 1 Paladin in the raid, 2nd column if at least 2, etc.';\n\nexport const BASIC_BIS_DISCLAIMER = '<p>Preset gear lists are intended as rough approximations of BIS, and will often not be the absolute highest-DPS setup for you. Your optimal gear setup will depend on many factors; that\\'s why we have a sim!</p><p>Items may also be omitted from the presets if they are highly contested and clearly better utilized on other classes, to encourage equitable gearing for the raid as a whole.</p>';\n","import { ActionId } from './proto_utils/action_id.js';\nimport { BattleElixir, HandType } from './proto/common.js';\nimport { BonusStatsPicker } from './components/bonus_stats_picker.js';\nimport { BooleanPicker, BooleanPickerConfig } from './components/boolean_picker.js';\nimport { CharacterStats, StatMods } from './components/character_stats.js';\nimport { Class } from './proto/common.js';\nimport { Conjured } from './proto/common.js';\nimport { Consumes } from './proto/common.js';\nimport { Cooldowns } from './proto/common.js';\nimport { CooldownsPicker } from './components/cooldowns_picker.js';\nimport { Debuffs } from './proto/common.js';\nimport { DetailedResults } from './components/detailed_results.js';\n\nimport { CustomRotationPicker } from './components/custom_rotation_picker.js';\nimport { Encounter as EncounterProto } from './proto/common.js';\nimport { Encounter } from './encounter.js';\nimport { EncounterPicker, EncounterPickerConfig } from './components/encounter_picker.js';\nimport { EnumPicker, EnumPickerConfig } from './components/enum_picker.js';\nimport { EquipmentSpec } from './proto/common.js';\nimport { EventID, TypedEvent } from './typed_event.js';\nimport { Flask } from './proto/common.js';\nimport { Food } from './proto/common.js';\nimport { Gear } from './proto_utils/gear.js';\nimport { GearPicker } from './components/gear_picker.js';\nimport { Glyphs } from './proto/common.js';\nimport { GuardianElixir } from './proto/common.js';\nimport { HealingModel } from './proto/common.js';\nimport { HunterPetTalentsPicker } from './talents/hunter_pet.js';\nimport { IconEnumPicker, IconEnumPickerConfig } from './components/icon_enum_picker.js';\nimport { IconPicker, IconPickerConfig } from './components/icon_picker.js';\nimport { ItemSlot } from './proto/common.js';\nimport { IndividualBuffs } from './proto/common.js';\nimport { IndividualSimSettings } from './proto/ui.js';\nimport { Input } from './components/input.js';\nimport { LogRunner } from './components/log_runner.js';\nimport { MobType } from './proto/common.js';\nimport { MultiIconPicker } from './components/multi_icon_picker.js';\nimport { NumberPicker, NumberPickerConfig } from './components/number_picker.js';\nimport { Party } from './party.js';\nimport { PartyBuffs } from './proto/common.js';\nimport { PetFood } from './proto/common.js';\nimport { Player as PlayerProto } from './proto/api.js';\nimport { Player } from './player.js';\nimport { Potions } from './proto/common.js';\nimport { Profession } from './proto/common.js';\nimport { Race } from './proto/common.js';\nimport { Raid } from './raid.js';\nimport { RaidBuffs } from './proto/common.js';\nimport { SavedDataConfig, SavedDataManager } from './components/saved_data_manager.js';\nimport { SavedEncounter } from './proto/ui.js';\nimport { SavedGearSet } from './proto/ui.js';\nimport { SavedSettings } from './proto/ui.js';\nimport { SavedTalents } from './proto/ui.js';\nimport { SettingsMenu } from './components/settings_menu.js';\nimport { ShattrathFaction } from './proto/common.js';\nimport { Sim } from './sim.js';\nimport { SimOptions } from './proto/api.js';\nimport { SimSettings as SimSettingsProto } from './proto/ui.js';\nimport { SimUI, SimWarning } from './sim_ui.js';\nimport { Spec } from './proto/common.js';\nimport { SpecOptions } from './proto_utils/utils.js';\nimport { SpecRotation } from './proto_utils/utils.js';\nimport { Stat } from './proto/common.js';\nimport { StatWeightsRequest, StatWeightsResult } from './proto/api.js';\nimport { Stats } from './proto_utils/stats.js';\nimport { shattFactionNames } from './proto_utils/names.js';\nimport { Target } from './target.js';\nimport { Target as TargetProto } from './proto/common.js';\nimport { addRaidSimAction, RaidSimResultsManager } from './components/raid_sim_action.js';\nimport { addStatWeightsAction } from './components/stat_weights_action.js';\nimport { equalsOrBothNull, getEnumValues } from './utils.js';\nimport { getMetaGemConditionDescription } from './proto_utils/gems.js';\nimport { getTalentPoints } from './proto_utils/utils.js';\nimport { isDualWieldSpec } from './proto_utils/utils.js';\nimport { simLaunchStatuses } from './launched_sims.js';\nimport { makePetTypeInputConfig } from './talents/hunter_pet.js';\nimport { newIndividualExporters } from './components/exporters.js';\nimport { newIndividualImporters } from './components/importers.js';\nimport { newGlyphsPicker } from './talents/factory.js';\nimport { newTalentsPicker } from './talents/factory.js';\nimport { professionNames, raceNames } from './proto_utils/names.js';\nimport { isHealingSpec, isTankSpec } from './proto_utils/utils.js';\nimport { specNames } from './proto_utils/utils.js';\nimport { specToEligibleRaces } from './proto_utils/utils.js';\nimport { specToLocalStorageKey } from './proto_utils/utils.js';\n\nimport * as IconInputs from './components/icon_inputs.js';\nimport * as InputHelpers from './components/input_helpers.js';\nimport * as Mechanics from './constants/mechanics.js';\nimport * as OtherConstants from './constants/other.js';\nimport * as Tooltips from './constants/tooltips.js';\n\ndeclare var Muuri: any;\ndeclare var tippy: any;\ndeclare var pako: any;\n\nconst SAVED_GEAR_STORAGE_KEY = '__savedGear__';\nconst SAVED_ROTATION_STORAGE_KEY = '__savedRotation__';\nconst SAVED_SETTINGS_STORAGE_KEY = '__savedSettings__';\nconst SAVED_TALENTS_STORAGE_KEY = '__savedTalents__';\n\nexport type InputConfig<ModObject> = (\n\tInputHelpers.TypedBooleanPickerConfig<ModObject> |\n\tInputHelpers.TypedNumberPickerConfig<ModObject> |\n\tInputHelpers.TypedEnumPickerConfig<ModObject> |\n\tInputHelpers.TypedCustomRotationPickerConfig<any, any>);\n\nexport type IconInputConfig<ModObject, T> = (\n\tInputHelpers.TypedIconPickerConfig<ModObject, T> |\n\tInputHelpers.TypedIconEnumPickerConfig<ModObject, T>);\n\nexport interface InputSection {\n\ttooltip?: string,\n\tinputs: Array<InputConfig<Player<any>>>,\n}\n\nexport interface OtherDefaults {\n\tprofession1?: Profession,\n\tprofession2?: Profession,\n\tdistanceFromTarget?: number,\n}\n\nexport interface IndividualSimUIConfig<SpecType extends Spec> {\n\t// Additional css class to add to the root element.\n\tcssClass: string,\n\n\tknownIssues?: Array<string>;\n\twarnings?: Array<(simUI: IndividualSimUI<SpecType>) => SimWarning>,\n\n\tepStats: Array<Stat>;\n\tepReferenceStat: Stat;\n\tdisplayStats: Array<Stat>;\n\tmodifyDisplayStats?: (player: Player<SpecType>) => StatMods,\n\n\tdefaults: {\n\t\tgear: EquipmentSpec,\n\t\tepWeights: Stats,\n\t\tconsumes: Consumes,\n\t\trotation: SpecRotation<SpecType>,\n\t\ttalents: SavedTalents,\n\t\tspecOptions: SpecOptions<SpecType>,\n\n\t\traidBuffs: RaidBuffs,\n\t\tpartyBuffs: PartyBuffs,\n\t\tindividualBuffs: IndividualBuffs,\n\n\t\tdebuffs: Debuffs,\n\n\t\tother?: OtherDefaults,\n\t},\n\n\tplayerIconInputs: Array<IconInputConfig<Player<SpecType>, any>>,\n\tpetConsumeInputs?: Array<IconInputConfig<Player<SpecType>, any>>,\n\trotationInputs: InputSection;\n\trotationIconInputs?: Array<IconInputConfig<Player<any>, any>>;\n\tincludeBuffDebuffInputs: Array<any>,\n\texcludeBuffDebuffInputs: Array<any>,\n\totherInputs: InputSection;\n\n\t// Extra UI sections with the same input config as other sections.\n\tadditionalSections?: Record<string, InputSection>;\n\tadditionalIconSections?: Record<string, Array<IconInputConfig<Player<any>, any>>>;\n\n\t// For when extra sections are needed, with even more flexibility than additionalSections.\n\t// Return value is the label for the section.\n\tcustomSections?: Array<(simUI: IndividualSimUI<SpecType>, parentElem: HTMLElement) => string>;\n\n\tencounterPicker: EncounterPickerConfig,\n\n\tpresets: {\n\t\tgear: Array<PresetGear>,\n\t\ttalents: Array<SavedDataConfig<Player<any>, SavedTalents>>,\n\t\trotation?: Array<SavedDataConfig<Player<any>, string>>,\n\t},\n}\n\nexport interface GearAndStats {\n\tgear: Gear,\n\tbonusStats?: Stats,\n}\n\nexport interface PresetGear {\n\tname: string;\n\tgear: EquipmentSpec;\n\ttooltip?: string;\n\tenableWhen?: (obj: Player<any>) => boolean;\n}\n\nexport interface Settings {\n\traidBuffs: RaidBuffs,\n\tpartyBuffs: PartyBuffs,\n\tindividualBuffs: IndividualBuffs,\n\tconsumes: Consumes,\n\trace: Race,\n\tprofessions?: Array<Profession>;\n}\n\n// Extended shared UI for all individual player sims.\nexport abstract class IndividualSimUI<SpecType extends Spec> extends SimUI {\n\treadonly player: Player<SpecType>;\n\treadonly individualConfig: IndividualSimUIConfig<SpecType>;\n\n\tprivate raidSimResultsManager: RaidSimResultsManager | null;\n\n\tprivate settingsMuuri: any;\n\n\tprevEpIterations: number;\n\tprevEpSimResult: StatWeightsResult | null;\n\n\tconstructor(parentElem: HTMLElement, player: Player<SpecType>, config: IndividualSimUIConfig<SpecType>) {\n\t\tsuper(parentElem, player.sim, {\n\t\t\tspec: player.spec,\n\t\t\tknownIssues: config.knownIssues,\n\t\t\tlaunchStatus: simLaunchStatuses[player.spec],\n\t\t});\n\t\tthis.rootElem.classList.add('individual-sim-ui', config.cssClass);\n\t\tthis.player = player;\n\t\tthis.individualConfig = config;\n\t\tthis.raidSimResultsManager = null;\n\t\tthis.settingsMuuri = null;\n\t\tthis.prevEpIterations = 0;\n\t\tthis.prevEpSimResult = null;\n\n\t\tthis.addWarning({\n\t\t\tupdateOn: this.player.gearChangeEmitter,\n\t\t\tgetContent: () => {\n\t\t\t\tif (!this.player.getGear().hasInactiveMetaGem(this.player.isBlacksmithing())) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tconst metaGem = this.player.getGear().getMetaGem()!;\n\t\t\t\treturn `Meta gem disabled (${metaGem.name}): ${getMetaGemConditionDescription(metaGem)}`;\n\t\t\t},\n\t\t});\n\t\tthis.addWarning({\n\t\t\tupdateOn: TypedEvent.onAny([this.player.gearChangeEmitter, this.player.professionChangeEmitter]),\n\t\t\tgetContent: () => {\n\t\t\t\tconst failedProfReqs = this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());\n\t\t\t\tif (failedProfReqs.length == 0) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn failedProfReqs.map(fpr => `${fpr.name} requires ${professionNames[fpr.requiredProfession]}, but it is not selected.`);\n\t\t\t},\n\t\t});\n\t\tthis.addWarning({\n\t\t\tupdateOn: this.player.gearChangeEmitter,\n\t\t\tgetContent: () => {\n\t\t\t\tconst jcGems = this.player.getGear().getJCGems(this.player.isBlacksmithing());\n\t\t\t\tif (jcGems.length <= 3) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn `Only 3 Jewelcrafting Gems are allowed, but ${jcGems.length} are equipped.`;\n\t\t\t},\n\t\t});\n\t\tthis.addWarning({\n\t\t\tupdateOn: this.player.talentsChangeEmitter,\n\t\t\tgetContent: () => {\n\t\t\t\tconst talentPoints = getTalentPoints(this.player.getTalentsString());\n\n\t\t\t\tif (talentPoints == 0) {\n\t\t\t\t\t// Just return here, so we don't show a warning during page load.\n\t\t\t\t\treturn '';\n\t\t\t\t} else if (talentPoints < Mechanics.MAX_TALENT_POINTS) {\n\t\t\t\t\treturn 'Unspent talent points.';\n\t\t\t\t} else if (talentPoints > Mechanics.MAX_TALENT_POINTS) {\n\t\t\t\t\treturn 'More than maximum talent points spent.';\n\t\t\t\t} else {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tthis.addWarning({\n\t\t\tupdateOn: TypedEvent.onAny([this.player.gearChangeEmitter, this.player.talentsChangeEmitter]),\n\t\t\tgetContent: () => {\n\t\t\t\tif (!this.player.canDualWield2H() &&\n\t\t\t\t\t(this.player.getEquippedItem(ItemSlot.ItemSlotMainHand)?.item.handType == HandType.HandTypeTwoHand &&\n\t\t\t\t\t\tthis.player.getEquippedItem(ItemSlot.ItemSlotOffHand) != null ||\n\t\t\t\t\t\tthis.player.getEquippedItem(ItemSlot.ItemSlotOffHand)?.item.handType == HandType.HandTypeTwoHand)) {\n\t\t\t\t\treturn \"Dual wielding two-handed weapon(s) without Titan's Grip spec.\"\n\t\t\t\t} else {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\t(config.warnings || []).forEach(warning => this.addWarning(warning(this)));\n\n\t\tif (!this.isWithinRaidSim) {\n\t\t\t// This needs to go before all the UI components so that gear loading is the\n\t\t\t// first callback invoked from waitForInit().\n\t\t\tthis.sim.waitForInit().then(() => this.loadSettings());\n\t\t}\n\n\t\tthis.addSidebarComponents();\n\t\tthis.addTopbarComponents();\n\t\tthis.addGearTab();\n\t\tthis.addSettingsTab();\n\t\tthis.addTalentsTab();\n\n\t\tif (!this.isWithinRaidSim) {\n\t\t\tthis.addDetailedResultsTab();\n\t\t\tthis.addLogTab();\n\t\t}\n\n\t\tthis.player.changeEmitter.on(() => this.recomputeSettingsLayout());\n\t}\n\n\tprivate loadSettings() {\n\t\tconst initEventID = TypedEvent.nextEventID();\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tlet loadedSettings = false;\n\n\t\t\tlet hash = window.location.hash;\n\t\t\tif (hash.length > 1) {\n\t\t\t\t// Remove leading '#'\n\t\t\t\thash = hash.substring(1);\n\t\t\t\ttry {\n\t\t\t\t\tconst binary = atob(hash);\n\t\t\t\t\tconst bytes = new Uint8Array(binary.length);\n\t\t\t\t\tfor (let i = 0; i < bytes.length; i++) {\n\t\t\t\t\t\tbytes[i] = binary.charCodeAt(i);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst settingsBytes = pako.inflate(bytes);\n\t\t\t\t\tconst settings = IndividualSimSettings.fromBinary(settingsBytes);\n\t\t\t\t\tthis.fromProto(initEventID, settings);\n\t\t\t\t\tloadedSettings = true;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Failed to parse settings from window hash: ' + e);\n\t\t\t\t}\n\t\t\t}\n\t\t\twindow.location.hash = '';\n\n\t\t\tconst savedSettings = window.localStorage.getItem(this.getSettingsStorageKey());\n\t\t\tif (!loadedSettings && savedSettings != null) {\n\t\t\t\ttry {\n\t\t\t\t\tconst settings = IndividualSimSettings.fromJsonString(savedSettings);\n\t\t\t\t\tthis.fromProto(initEventID, settings);\n\t\t\t\t\tloadedSettings = true;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Failed to parse saved settings: ' + e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!loadedSettings) {\n\t\t\t\tthis.applyDefaults(initEventID);\n\t\t\t}\n\t\t\tthis.player.setName(initEventID, 'Player');\n\n\t\t\t// This needs to go last so it doesn't re-store things as they are initialized.\n\t\t\tthis.changeEmitter.on(eventID => {\n\t\t\t\tconst jsonStr = IndividualSimSettings.toJsonString(this.toProto());\n\t\t\t\twindow.localStorage.setItem(this.getSettingsStorageKey(), jsonStr);\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate addSidebarComponents() {\n\t\tthis.raidSimResultsManager = addRaidSimAction(this);\n\t\taddStatWeightsAction(this, this.individualConfig.epStats, this.individualConfig.epReferenceStat);\n\n\t\tconst characterStats = new CharacterStats(\n\t\t\tthis.rootElem.getElementsByClassName('sim-sidebar-footer')[0] as HTMLElement,\n\t\t\tthis.player,\n\t\t\tthis.individualConfig.displayStats,\n\t\t\tthis.individualConfig.modifyDisplayStats);\n\t}\n\n\tprivate addTopbarComponents() {\n\t\tthis.addToolbarItem(newIndividualImporters(this));\n\t\tthis.addToolbarItem(newIndividualExporters(this));\n\n\t\tconst optionsMenu = document.createElement('span');\n\t\toptionsMenu.classList.add('fas', 'fa-cog');\n\t\ttippy(optionsMenu, {\n\t\t\t'content': 'Options',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\toptionsMenu.addEventListener('click', event => {\n\t\t\tnew SettingsMenu(this.rootElem, this);\n\t\t});\n\t\tthis.addToolbarItem(optionsMenu);\n\t}\n\n\tprivate addGearTab() {\n\t\tthis.addTab('GEAR', 'gear-tab', `\n\t\t\t<div class=\"gear-tab-columns\">\n\t\t\t\t<div class=\"left-gear-panel\">\n\t\t\t\t\t<div class=\"gear-picker\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"right-gear-panel\">\n\t\t\t\t\t<div class=\"bonus-stats-picker\">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"saved-gear-manager\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tconst gearPicker = new GearPicker(this.rootElem.getElementsByClassName('gear-picker')[0] as HTMLElement, this.player);\n\t\tconst bonusStatsPicker = new BonusStatsPicker(this.rootElem.getElementsByClassName('bonus-stats-picker')[0] as HTMLElement, this.player, this.individualConfig.epStats);\n\n\t\tconst savedGearManager = new SavedDataManager<Player<any>, SavedGearSet>(this.rootElem.getElementsByClassName('saved-gear-manager')[0] as HTMLElement, this.player, {\n\t\t\tlabel: 'Gear',\n\t\t\tstorageKey: this.getSavedGearStorageKey(),\n\t\t\tgetData: (player: Player<any>) => {\n\t\t\t\treturn SavedGearSet.create({\n\t\t\t\t\tgear: player.getGear().asSpec(),\n\t\t\t\t\tbonusStats: player.getBonusStats().asArray(),\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetData: (eventID: EventID, player: Player<any>, newSavedGear: SavedGearSet) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tplayer.setGear(eventID, this.sim.lookupEquipmentSpec(newSavedGear.gear || EquipmentSpec.create()));\n\t\t\t\t\tplayer.setBonusStats(eventID, new Stats(newSavedGear.bonusStats || []));\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [this.player.changeEmitter],\n\t\t\tequals: (a: SavedGearSet, b: SavedGearSet) => SavedGearSet.equals(a, b),\n\t\t\ttoJson: (a: SavedGearSet) => SavedGearSet.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedGearSet.fromJson(obj),\n\t\t});\n\n\t\tthis.sim.waitForInit().then(() => {\n\t\t\tsavedGearManager.loadUserData();\n\t\t\tthis.individualConfig.presets.gear.forEach(presetGear => {\n\t\t\t\tsavedGearManager.addSavedData({\n\t\t\t\t\tname: presetGear.name,\n\t\t\t\t\ttooltip: presetGear.tooltip,\n\t\t\t\t\tisPreset: true,\n\t\t\t\t\tdata: SavedGearSet.create({\n\t\t\t\t\t\t// Convert to gear and back so order is always the same.\n\t\t\t\t\t\tgear: this.sim.lookupEquipmentSpec(presetGear.gear).asSpec(),\n\t\t\t\t\t\tbonusStats: new Stats().asArray(),\n\t\t\t\t\t}),\n\t\t\t\t\tenableWhen: presetGear.enableWhen,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\n\tprivate addSettingsTab() {\n\t\tthis.addTab('SETTINGS', 'settings-tab', `\n\t\t\t<div class=\"settings-inputs\">\n\t\t\t\t<div class=\"settings-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section encounter-section within-raid-sim-hide\">\n\t\t\t\t\t\t<legend>Encounter</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t\t<fieldset class=\"settings-section race-section\">\n\t\t\t\t\t\t<legend>Player</legend>\n\t\t\t\t\t\t<div class=\"settings-section-iconrow player-iconrow\"></div>\n\t\t\t\t\t</fieldset>\n\t\t\t\t\t<fieldset class=\"settings-section rotation-section\">\n\t\t\t\t\t\t<legend>Rotation</legend>\n\t\t\t\t\t\t<div class=\"settings-section-iconrow rotation-iconrow\"></div>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container custom-sections-container\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container labeled-icon-section within-raid-sim-hide\">\n\t\t\t\t\t<fieldset class=\"settings-section buffs-section\">\n\t\t\t\t\t\t<legend>Raid Buffs</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t\t<fieldset class=\"settings-section debuffs-section damage-metrics\">\n\t\t\t\t\t\t<legend>Debuffs</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section new-consumes-section\">\n\t\t\t\t\t\t<legend>Consumes</legend>\n\t\t\t\t\t\t<div class=\"consumes-row\">\n\t\t\t\t\t\t\t<span>Potions</span>\n\t\t\t\t\t\t\t<div class=\"consumes-row-inputs\">\n\t\t\t\t\t\t\t\t<div class=\"consumes-prepot\"></div>\n\t\t\t\t\t\t\t\t<div class=\"consumes-potions\"></div>\n\t\t\t\t\t\t\t\t<div class=\"consumes-conjured\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"consumes-row\">\n\t\t\t\t\t\t\t<span>Elixirs</span>\n\t\t\t\t\t\t\t<div class=\"consumes-row-inputs\">\n\t\t\t\t\t\t\t\t<div class=\"consumes-flasks\"></div>\n\t\t\t\t\t\t\t\t<span>OR</span>\n\t\t\t\t\t\t\t\t<div class=\"consumes-battle-elixirs\"></div>\n\t\t\t\t\t\t\t\t<div class=\"consumes-guardian-elixirs\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"consumes-row\">\n\t\t\t\t\t\t\t<span>Food</span>\n\t\t\t\t\t\t\t<div class=\"consumes-row-inputs\">\n\t\t\t\t\t\t\t\t<div class=\"consumes-food\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"consumes-row damage-metrics\">\n\t\t\t\t\t\t\t<span>Eng</span>\n\t\t\t\t\t\t\t<div class=\"consumes-row-inputs consumes-trade\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"consumes-row consumes-row-pet\">\n\t\t\t\t\t\t\t<span>Pet</span>\n\t\t\t\t\t\t\t<div class=\"consumes-row-inputs consumes-pet\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"consumes-row\">\n\t\t\t\t\t\t\t<div class=\"consumes-row-inputs consumes-other\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container cooldowns-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section cooldowns-section\">\n\t\t\t\t\t\t<legend>Cooldowns</legend>\n\t\t\t\t\t\t<div class=\"cooldowns-section-content\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fieldset>\n\t\t\t\t\t<fieldset class=\"settings-section other-settings-section\">\n\t\t\t\t\t\t<legend>Other</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"settings-bottom-bar\">\n\t\t\t\t<div class=\"saved-encounter-manager within-raid-sim-hide\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"saved-settings-manager within-raid-sim-hide\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tconst settingsTab = this.rootElem.getElementsByClassName('settings-inputs')[0] as HTMLElement;\n\n\t\tconst configureIconSection = (sectionElem: HTMLElement, iconPickers: Array<any>, tooltip?: string, adjustColumns?: boolean) => {\n\t\t\tif (tooltip) {\n\t\t\t\ttippy(sectionElem, {\n\t\t\t\t\t'content': tooltip,\n\t\t\t\t\t'allowHTML': true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (iconPickers.length == 0) {\n\t\t\t\tsectionElem.style.display = 'none';\n\t\t\t} else if (adjustColumns) {\n\t\t\t\tif (iconPickers.length < 4) {\n\t\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${iconPickers.length}, 1fr)`;\n\t\t\t\t} else if (iconPickers.length > 4 && iconPickers.length < 8) {\n\t\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${Math.ceil(iconPickers.length / 2)}, 1fr)`;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst makeIconInput = (parent: HTMLElement, inputConfig: IconInputConfig<Player<SpecType>, any>) => {\n\t\t\tif (inputConfig.type == 'icon') {\n\t\t\t\treturn new IconPicker<Player<SpecType>, any>(parent, this.player, inputConfig);\n\t\t\t} else if (inputConfig.type == 'iconEnum') {\n\t\t\t\treturn new IconEnumPicker<Player<SpecType>, any>(parent, this.player, inputConfig);\n\t\t\t}\n\t\t};\n\n\t\tconst playerIconsSection = this.rootElem.getElementsByClassName('player-iconrow')[0] as HTMLElement;\n\t\tconfigureIconSection(\n\t\t\tplayerIconsSection,\n\t\t\tthis.individualConfig.playerIconInputs.map(iconInput => makeIconInput(playerIconsSection, iconInput)),\n\t\t\t'', true);\n\n\t\tconst buffOptions = this.splitRelevantOptions([\n\t\t\t{ item: IconInputs.AllStatsBuff, stats: [] },\n\t\t\t{ item: IconInputs.AllStatsPercentBuff, stats: [] },\n\t\t\t{ item: IconInputs.HealthBuff, stats: [Stat.StatHealth] },\n\t\t\t{ item: IconInputs.ArmorBuff, stats: [Stat.StatArmor] },\n\t\t\t{ item: IconInputs.StaminaBuff, stats: [Stat.StatStamina] },\n\t\t\t{ item: IconInputs.StrengthAndAgilityBuff, stats: [Stat.StatStrength, Stat.StatAgility] },\n\t\t\t{ item: IconInputs.IntellectBuff, stats: [Stat.StatIntellect] },\n\t\t\t{ item: IconInputs.SpiritBuff, stats: [Stat.StatSpirit] },\n\t\t\t{ item: IconInputs.AttackPowerBuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t\t{ item: IconInputs.AttackPowerPercentBuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t\t{ item: IconInputs.MeleeCritBuff, stats: [Stat.StatMeleeCrit] },\n\t\t\t{ item: IconInputs.MeleeHasteBuff, stats: [Stat.StatMeleeHaste] },\n\t\t\t{ item: IconInputs.SpellPowerBuff, stats: [Stat.StatSpellPower] },\n\t\t\t{ item: IconInputs.SpellCritBuff, stats: [Stat.StatSpellCrit] },\n\t\t\t{ item: IconInputs.HastePercentBuff, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t\t\t{ item: IconInputs.DamagePercentBuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower] },\n\t\t\t{ item: IconInputs.DamageReductionPercentBuff, stats: [Stat.StatArmor] },\n\t\t\t{ item: IconInputs.MP5Buff, stats: [Stat.StatMP5] },\n\t\t\t{ item: IconInputs.ReplenishmentBuff, stats: [Stat.StatMP5] },\n\t\t]);\n\t\tconst buffsSection = this.rootElem.getElementsByClassName('buffs-section')[0] as HTMLElement;\n\t\tconfigureIconSection(\n\t\t\tbuffsSection,\n\t\t\tbuffOptions.map(multiIconInput => new MultiIconPicker(buffsSection, this.player, multiIconInput, this)),\n\t\t\tTooltips.OTHER_BUFFS_SECTION);\n\n\t\tconst otherBuffOptions = this.splitRelevantOptions([\n\t\t\t{ item: IconInputs.Bloodlust, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t\t\t{ item: IconInputs.SpellHasteBuff, stats: [Stat.StatSpellHaste] },\n\t\t] as Array<StatOption<IconInputConfig<Player<any>, any>>>);\n\t\totherBuffOptions.forEach(iconInput => makeIconInput(buffsSection, iconInput));\n\n\t\tconst revitalizeBuffOptions = this.splitRelevantOptions([\n\t\t\t{ item: IconInputs.RevitalizeRejuvination, stats: [] },\n\t\t\t{ item: IconInputs.RevitalizeWildGrowth, stats: [] },\n\t\t] as Array<StatOption<IconPickerConfig<Player<any>, any>>>);\n\t\tif (revitalizeBuffOptions.length > 0) {\n\t\t\tnew MultiIconPicker(buffsSection, this.player, {\n\t\t\t\tinputs: revitalizeBuffOptions,\n\t\t\t\tnumColumns: 1,\n\t\t\t\temptyColor: 'grey',\n\t\t\t\tlabel: 'Revitalize',\n\t\t\t\tcategoryId: ActionId.fromSpellId(48545),\n\t\t\t}, this);\n\t\t}\n\n\t\tconst miscBuffOptions = this.splitRelevantOptions([\n\t\t\t{ item: IconInputs.HeroicPresence, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\n\t\t\t{ item: IconInputs.BraidedEterniumChain, stats: [Stat.StatMeleeCrit] },\n\t\t\t{ item: IconInputs.ChainOfTheTwilightOwl, stats: [Stat.StatSpellCrit] },\n\t\t\t{ item: IconInputs.FocusMagic, stats: [Stat.StatSpellCrit] },\n\t\t\t{ item: IconInputs.EyeOfTheNight, stats: [Stat.StatSpellPower] },\n\t\t\t{ item: IconInputs.Thorns, stats: [Stat.StatArmor] },\n\t\t\t{ item: IconInputs.RetributionAura, stats: [Stat.StatArmor] },\n\t\t\t{ item: IconInputs.ShadowProtection, stats: [Stat.StatStamina] },\n\t\t\t{ item: IconInputs.ManaTideTotem, stats: [Stat.StatMP5] },\n\t\t\t{ item: IconInputs.Innervate, stats: [Stat.StatMP5] },\n\t\t\t{ item: IconInputs.PowerInfusion, stats: [Stat.StatMP5, Stat.StatSpellPower] },\n\t\t\t{ item: IconInputs.TricksOfTheTrade, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower] },\n\t\t\t{ item: IconInputs.UnholyFrenzy, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t] as Array<StatOption<IconPickerConfig<Player<any>, any>>>);\n\t\tif (miscBuffOptions.length > 0) {\n\t\t\tnew MultiIconPicker(buffsSection, this.player, {\n\t\t\t\tinputs: miscBuffOptions,\n\t\t\t\tnumColumns: 3,\n\t\t\t\temptyColor: 'grey',\n\t\t\t\tlabel: 'Misc',\n\t\t\t}, this);\n\t\t}\n\n\t\tconst debuffOptions = this.splitRelevantOptions([\n\t\t\t{ item: IconInputs.MajorArmorDebuff, stats: [Stat.StatArmorPenetration] },\n\t\t\t{ item: IconInputs.MinorArmorDebuff, stats: [Stat.StatArmorPenetration] },\n\t\t\t{ item: IconInputs.PhysicalDamageDebuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t\t{ item: IconInputs.BleedDebuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t\t{ item: IconInputs.SpellDamageDebuff, stats: [Stat.StatSpellPower] },\n\t\t\t{ item: IconInputs.SpellHitDebuff, stats: [Stat.StatSpellHit] },\n\t\t\t{ item: IconInputs.SpellCritDebuff, stats: [Stat.StatSpellCrit] },\n\t\t\t{ item: IconInputs.CritDebuff, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\n\t\t\t{ item: IconInputs.AttackPowerDebuff, stats: [Stat.StatArmor] },\n\t\t\t{ item: IconInputs.MeleeAttackSpeedDebuff, stats: [Stat.StatArmor] },\n\t\t\t{ item: IconInputs.MeleeHitDebuff, stats: [Stat.StatDodge] },\n\t\t]);\n\t\tconst debuffsSection = this.rootElem.getElementsByClassName('debuffs-section')[0] as HTMLElement;\n\t\tconfigureIconSection(\n\t\t\tdebuffsSection,\n\t\t\tdebuffOptions.map(multiIconInput => new MultiIconPicker(debuffsSection, this.player, multiIconInput, this)),\n\t\t\tTooltips.DEBUFFS_SECTION);\n\n\t\tconst otherDebuffOptions = this.splitRelevantOptions([\n\t\t\t{ item: IconInputs.JudgementOfWisdom, stats: [Stat.StatMP5, Stat.StatIntellect] },\n\t\t\t{ item: IconInputs.HuntersMark, stats: [Stat.StatRangedAttackPower] },\n\t\t] as Array<StatOption<InputHelpers.TypedIconPickerConfig<Player<any>, any>>>);\n\t\totherDebuffOptions.forEach(iconInput => makeIconInput(debuffsSection, iconInput));\n\n\t\tconst miscDebuffOptions = this.splitRelevantOptions([\n\t\t\t{ item: IconInputs.JudgementOfLight, stats: [Stat.StatStamina] },\n\t\t\t{ item: IconInputs.ShatteringThrow, stats: [Stat.StatArmorPenetration] },\n\t\t\t{ item: IconInputs.GiftOfArthas, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t] as Array<StatOption<IconPickerConfig<Player<any>, any>>>);\n\t\tif (miscDebuffOptions.length > 0) {\n\t\t\tnew MultiIconPicker(debuffsSection, this.player, {\n\t\t\t\tinputs: miscDebuffOptions,\n\t\t\t\tnumColumns: 3,\n\t\t\t\temptyColor: 'grey',\n\t\t\t\tlabel: 'Misc',\n\t\t\t}, this);\n\t\t}\n\n\t\tconst prepopPotionOptions = this.splitRelevantOptions([\n\t\t\t// This list is smaller because some potions don't make sense to use as prepot.\n\t\t\t// E.g. healing/mana potions.\n\t\t\t{ item: Potions.IndestructiblePotion, stats: [Stat.StatArmor] },\n\t\t\t{ item: Potions.InsaneStrengthPotion, stats: [Stat.StatStrength] },\n\t\t\t{ item: Potions.PotionOfSpeed, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t\t\t{ item: Potions.PotionOfWildMagic, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit, Stat.StatSpellPower] },\n\t\t]);\n\t\tif (prepopPotionOptions.length) {\n\t\t\tconst elem = this.rootElem.getElementsByClassName('consumes-prepot')[0] as HTMLElement;\n\t\t\tnew IconEnumPicker(elem, this.player, IconInputs.makePrepopPotionsInput(prepopPotionOptions));\n\t\t\ttippy(elem, {\n\t\t\t\t'content': 'Prepop Potion (1s before combat)',\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\t\t}\n\n\t\tconst potionOptions = this.splitRelevantOptions([\n\t\t\t{ item: Potions.RunicHealingPotion, stats: [Stat.StatStamina] },\n\t\t\t{ item: Potions.RunicManaPotion, stats: [Stat.StatIntellect] },\n\t\t\t{ item: Potions.IndestructiblePotion, stats: [Stat.StatArmor] },\n\t\t\t{ item: Potions.InsaneStrengthPotion, stats: [Stat.StatStrength] },\n\t\t\t{ item: Potions.PotionOfSpeed, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t\t\t{ item: Potions.PotionOfWildMagic, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit, Stat.StatSpellPower] },\n\t\t]);\n\t\tif (potionOptions.length) {\n\t\t\tconst elem = this.rootElem.getElementsByClassName('consumes-potions')[0] as HTMLElement;\n\t\t\tnew IconEnumPicker(elem, this.player, IconInputs.makePotionsInput(potionOptions));\n\t\t\ttippy(elem, {\n\t\t\t\t'content': 'Combat Potion',\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\t\t}\n\n\t\tconst conjuredOptions = this.splitRelevantOptions([\n\t\t\tthis.player.getClass() == Class.ClassRogue ? { item: Conjured.ConjuredRogueThistleTea, stats: [] } : null,\n\t\t\t{ item: Conjured.ConjuredHealthstone, stats: [Stat.StatStamina] },\n\t\t\t{ item: Conjured.ConjuredDarkRune, stats: [Stat.StatIntellect] },\n\t\t\t{ item: Conjured.ConjuredFlameCap, stats: [] },\n\t\t]);\n\t\tif (conjuredOptions.length) {\n\t\t\tconst elem = this.rootElem.getElementsByClassName('consumes-conjured')[0] as HTMLElement;\n\t\t\tnew IconEnumPicker(elem, this.player, IconInputs.makeConjuredInput(conjuredOptions));\n\t\t}\n\n\t\tconst flaskOptions = this.splitRelevantOptions([\n\t\t\t{ item: Flask.FlaskOfTheFrostWyrm, stats: [Stat.StatSpellPower] },\n\t\t\t{ item: Flask.FlaskOfEndlessRage, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t\t{ item: Flask.FlaskOfPureMojo, stats: [Stat.StatMP5] },\n\t\t\t{ item: Flask.FlaskOfStoneblood, stats: [Stat.StatStamina] },\n\t\t\t{ item: Flask.LesserFlaskOfToughness, stats: [Stat.StatResilience] },\n\t\t\t{ item: Flask.LesserFlaskOfResistance, stats: [Stat.StatArcaneResistance, Stat.StatFireResistance, Stat.StatFrostResistance, Stat.StatNatureResistance, Stat.StatShadowResistance] },\n\t\t]);\n\t\tif (flaskOptions.length) {\n\t\t\tconst elem = this.rootElem.getElementsByClassName('consumes-flasks')[0] as HTMLElement;\n\t\t\tnew IconEnumPicker(elem, this.player, IconInputs.makeFlasksInput(flaskOptions));\n\t\t}\n\n\t\tconst battleElixirOptions = this.splitRelevantOptions([\n\t\t\t{ item: BattleElixir.ElixirOfAccuracy, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\n\t\t\t{ item: BattleElixir.ElixirOfArmorPiercing, stats: [Stat.StatArmorPenetration] },\n\t\t\t{ item: BattleElixir.ElixirOfDeadlyStrikes, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\n\t\t\t{ item: BattleElixir.ElixirOfExpertise, stats: [Stat.StatExpertise] },\n\t\t\t{ item: BattleElixir.ElixirOfLightningSpeed, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t\t\t{ item: BattleElixir.ElixirOfMightyAgility, stats: [Stat.StatAgility] },\n\t\t\t{ item: BattleElixir.ElixirOfMightyStrength, stats: [Stat.StatStrength] },\n\t\t\t{ item: BattleElixir.GurusElixir, stats: [Stat.StatStamina, Stat.StatAgility, Stat.StatStrength, Stat.StatSpirit, Stat.StatIntellect] },\n\t\t\t{ item: BattleElixir.SpellpowerElixir, stats: [Stat.StatSpellPower] },\n\t\t\t{ item: BattleElixir.WrathElixir, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t]);\n\t\tif (battleElixirOptions.length) {\n\t\t\tconst elem = this.rootElem.getElementsByClassName('consumes-battle-elixirs')[0] as HTMLElement;\n\t\t\tnew IconEnumPicker(elem, this.player, IconInputs.makeBattleElixirsInput(battleElixirOptions));\n\t\t}\n\n\t\tconst guardianElixirOptions = this.splitRelevantOptions([\n\t\t\t{ item: GuardianElixir.ElixirOfMightyDefense, stats: [Stat.StatDefense] },\n\t\t\t{ item: GuardianElixir.ElixirOfMightyFortitude, stats: [Stat.StatStamina] },\n\t\t\t{ item: GuardianElixir.ElixirOfMightyMageblood, stats: [Stat.StatMP5] },\n\t\t\t{ item: GuardianElixir.ElixirOfMightyThoughts, stats: [Stat.StatIntellect] },\n\t\t\t{ item: GuardianElixir.ElixirOfProtection, stats: [Stat.StatArmor] },\n\t\t\t{ item: GuardianElixir.ElixirOfSpirit, stats: [Stat.StatSpirit] },\n\t\t\t{ item: GuardianElixir.GiftOfArthas, stats: [Stat.StatStamina] },\n\t\t]);\n\t\tif (guardianElixirOptions.length) {\n\t\t\tconst elem = this.rootElem.getElementsByClassName('consumes-guardian-elixirs')[0] as HTMLElement;\n\t\t\tnew IconEnumPicker(elem, this.player, IconInputs.makeGuardianElixirsInput(guardianElixirOptions));\n\t\t}\n\n\t\tconst foodOptions = this.splitRelevantOptions([\n\t\t\t{ item: Food.FoodFishFeast, stats: [Stat.StatStamina, Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower] },\n\t\t\t{ item: Food.FoodGreatFeast, stats: [Stat.StatStamina, Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower] },\n\t\t\t{ item: Food.FoodBlackenedDragonfin, stats: [Stat.StatAgility] },\n\t\t\t{ item: Food.FoodDragonfinFilet, stats: [Stat.StatStrength] },\n\t\t\t{ item: Food.FoodCuttlesteak, stats: [Stat.StatSpirit] },\n\t\t\t{ item: Food.FoodMegaMammothMeal, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t\t\t{ item: Food.FoodHeartyRhino, stats: [Stat.StatArmorPenetration] },\n\t\t\t{ item: Food.FoodRhinoliciousWormsteak, stats: [Stat.StatExpertise] },\n\t\t\t{ item: Food.FoodFirecrackerSalmon, stats: [Stat.StatSpellPower] },\n\t\t\t{ item: Food.FoodSnapperExtreme, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\n\t\t\t{ item: Food.FoodSpicedWormBurger, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\n\t\t\t{ item: Food.FoodImperialMantaSteak, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t\t\t{ item: Food.FoodMightyRhinoDogs, stats: [Stat.StatMP5] },\n\t\t]);\n\t\tif (foodOptions.length) {\n\t\t\tconst elem = this.rootElem.getElementsByClassName('consumes-food')[0] as HTMLElement;\n\t\t\tnew IconEnumPicker(elem, this.player, IconInputs.makeFoodInput(foodOptions));\n\t\t}\n\n\t\tconst tradeConsumesElem = this.rootElem.getElementsByClassName('consumes-trade')[0] as HTMLElement;\n\t\t//tradeConsumesElem.parentElement!.style.display = 'none';\n\t\tmakeIconInput(tradeConsumesElem, IconInputs.ThermalSapper);\n\t\tmakeIconInput(tradeConsumesElem, IconInputs.ExplosiveDecoy);\n\t\tmakeIconInput(tradeConsumesElem, IconInputs.FillerExplosiveInput);\n\n\t\tconst updateProfession = () => {\n\t\t\tif (this.player.hasProfession(Profession.Engineering)) {\n\t\t\t\ttradeConsumesElem.parentElement!.style.removeProperty('display');\n\t\t\t} else {\n\t\t\t\ttradeConsumesElem.parentElement!.style.display = 'none';\n\t\t\t}\n\t\t};\n\t\tthis.player.professionChangeEmitter.on(updateProfession);\n\t\tupdateProfession();\n\n\t\tif (this.individualConfig.petConsumeInputs?.length) {\n\t\t\tconst petConsumesElem = this.rootElem.getElementsByClassName('consumes-pet')[0] as HTMLElement;\n\t\t\tthis.individualConfig.petConsumeInputs.map(iconInput => makeIconInput(petConsumesElem, iconInput));\n\t\t} else {\n\t\t\tconst petRowElem = this.rootElem.getElementsByClassName('consumes-row-pet')[0] as HTMLElement;\n\t\t\tpetRowElem.style.display = 'none';\n\t\t}\n\n\t\tconst configureInputSection = (sectionElem: HTMLElement, sectionConfig: InputSection) => {\n\t\t\tif (sectionConfig.tooltip) {\n\t\t\t\ttippy(sectionElem, {\n\t\t\t\t\t'content': sectionConfig.tooltip,\n\t\t\t\t\t'allowHTML': true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsectionConfig.inputs.forEach(inputConfig => {\n\t\t\t\tif (inputConfig.type == 'number') {\n\t\t\t\t\tnew NumberPicker(sectionElem, this.player, inputConfig);\n\t\t\t\t} else if (inputConfig.type == 'boolean') {\n\t\t\t\t\tnew BooleanPicker(sectionElem, this.player, inputConfig);\n\t\t\t\t} else if (inputConfig.type == 'enum') {\n\t\t\t\t\tnew EnumPicker(sectionElem, this.player, inputConfig);\n\t\t\t\t} else if (inputConfig.type == 'customRotation') {\n\t\t\t\t\tnew CustomRotationPicker(sectionElem, this.player, inputConfig);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tif (this.individualConfig.rotationIconInputs?.length) {\n\t\t\tconst rotationIconSection = this.rootElem.getElementsByClassName('rotation-iconrow')[0] as HTMLElement;\n\t\t\tconfigureIconSection(\n\t\t\t\trotationIconSection,\n\t\t\t\tthis.individualConfig.rotationIconInputs.map(iconInput => makeIconInput(rotationIconSection, iconInput)),\n\t\t\t\t'', true);\n\t\t}\n\n\n\t\tconfigureInputSection(this.rootElem.getElementsByClassName('rotation-section')[0] as HTMLElement, this.individualConfig.rotationInputs);\n\n\t\tif (this.individualConfig.otherInputs?.inputs.length) {\n\t\t\tconfigureInputSection(this.rootElem.getElementsByClassName('other-settings-section')[0] as HTMLElement, this.individualConfig.otherInputs);\n\t\t}\n\n\t\tconst races = specToEligibleRaces[this.player.spec];\n\t\tconst racePicker = new EnumPicker(this.rootElem.getElementsByClassName('race-section')[0] as HTMLElement, this.player, {\n\t\t\tlabel: 'Race',\n\t\t\tvalues: races.map(race => {\n\t\t\t\treturn {\n\t\t\t\t\tname: raceNames[race],\n\t\t\t\t\tvalue: race,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: sim => sim.raceChangeEmitter,\n\t\t\tgetValue: sim => sim.getRace(),\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setRace(eventID, newValue),\n\t\t});\n\t\tconst professions = getEnumValues(Profession) as Array<Profession>;\n\t\tconst profession1Picker = new EnumPicker(this.rootElem.getElementsByClassName('race-section')[0] as HTMLElement, this.player, {\n\t\t\tlabel: 'Profession 1',\n\t\t\tvalues: professions.map(p => {\n\t\t\t\treturn {\n\t\t\t\t\tname: professionNames[p],\n\t\t\t\t\tvalue: p,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: sim => sim.professionChangeEmitter,\n\t\t\tgetValue: sim => sim.getProfession1(),\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setProfession1(eventID, newValue),\n\t\t});\n\t\tconst profession2Picker = new EnumPicker(this.rootElem.getElementsByClassName('race-section')[0] as HTMLElement, this.player, {\n\t\t\tlabel: 'Profession 2',\n\t\t\tvalues: professions.map(p => {\n\t\t\t\treturn {\n\t\t\t\t\tname: professionNames[p],\n\t\t\t\t\tvalue: p,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: sim => sim.professionChangeEmitter,\n\t\t\tgetValue: sim => sim.getProfession2(),\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setProfession2(eventID, newValue),\n\t\t});\n\t\tconst shattFactionPicker = new EnumPicker(this.rootElem.getElementsByClassName('race-section')[0] as HTMLElement, this.player, {\n\t\t\tlabel: 'Shatt Faction',\n\t\t\tvalues: [ShattrathFaction.ShattrathFactionAldor, ShattrathFaction.ShattrathFactionScryer].map(faction => {\n\t\t\t\treturn {\n\t\t\t\t\tname: shattFactionNames[faction],\n\t\t\t\t\tvalue: faction,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: sim => sim.gearChangeEmitter,\n\t\t\tgetValue: sim => sim.getShattFaction(),\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setShattFaction(eventID, newValue),\n\t\t\tshowWhen: (player: Player<any>) => this.player.getEquippedItem(ItemSlot.ItemSlotNeck)?.item.id == 34678 || this.player.getEquippedItem(ItemSlot.ItemSlotNeck)?.item.id == 34679,\n\t\t});\n\n\t\tconst encounterSectionElem = settingsTab.getElementsByClassName('encounter-section')[0] as HTMLElement;\n\t\tnew EncounterPicker(encounterSectionElem, this.sim.encounter, this.individualConfig.encounterPicker, this);\n\t\tconst savedEncounterManager = new SavedDataManager<Encounter, SavedEncounter>(this.rootElem.getElementsByClassName('saved-encounter-manager')[0] as HTMLElement, this.sim.encounter, {\n\t\t\tlabel: 'Encounter',\n\t\t\tstorageKey: this.getSavedEncounterStorageKey(),\n\t\t\tgetData: (encounter: Encounter) => SavedEncounter.create({ encounter: encounter.toProto() }),\n\t\t\tsetData: (eventID: EventID, encounter: Encounter, newEncounter: SavedEncounter) => encounter.fromProto(eventID, newEncounter.encounter!),\n\t\t\tchangeEmitters: [this.sim.encounter.changeEmitter],\n\t\t\tequals: (a: SavedEncounter, b: SavedEncounter) => SavedEncounter.equals(a, b),\n\t\t\ttoJson: (a: SavedEncounter) => SavedEncounter.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedEncounter.fromJson(obj),\n\t\t});\n\n\t\tconst cooldownSectionElem = settingsTab.getElementsByClassName('cooldowns-section')[0] as HTMLElement;\n\t\tconst cooldownContentElem = settingsTab.getElementsByClassName('cooldowns-section-content')[0] as HTMLElement;\n\t\tnew CooldownsPicker(cooldownContentElem, this.player);\n\t\ttippy(cooldownSectionElem, {\n\t\t\tcontent: Tooltips.COOLDOWNS_SECTION,\n\t\t\tallowHTML: true,\n\t\t\tplacement: 'left',\n\t\t});\n\n\t\t// Init Muuri layout only when settings tab is clicked, because it needs the elements\n\t\t// to be shown so it can calculate sizes.\n\t\t(this.rootElem.getElementsByClassName('settings-tab-tab')[0] as HTMLElement)!.addEventListener('click', event => {\n\t\t\tif (this.settingsMuuri == null) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.settingsMuuri = new Muuri('.settings-inputs');\n\t\t\t\t}, 200); // Magic amount of time before Muuri init seems to work\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.recomputeSettingsLayout();\n\t\t\t}, 200);\n\t\t});\n\n\t\tconst savedSettingsManager = new SavedDataManager<IndividualSimUI<any>, SavedSettings>(this.rootElem.getElementsByClassName('saved-settings-manager')[0] as HTMLElement, this, {\n\t\t\tlabel: 'Settings',\n\t\t\tstorageKey: this.getSavedSettingsStorageKey(),\n\t\t\tgetData: (simUI: IndividualSimUI<any>) => {\n\t\t\t\tconst player = simUI.player;\n\t\t\t\treturn SavedSettings.create({\n\t\t\t\t\traidBuffs: simUI.sim.raid.getBuffs(),\n\t\t\t\t\tpartyBuffs: player.getParty()?.getBuffs() || PartyBuffs.create(),\n\t\t\t\t\tplayerBuffs: player.getBuffs(),\n\t\t\t\t\tdebuffs: simUI.sim.raid.getDebuffs(),\n\t\t\t\t\tconsumes: player.getConsumes(),\n\t\t\t\t\trace: player.getRace(),\n\t\t\t\t\tcooldowns: player.getCooldowns(),\n\t\t\t\t\trotationJson: JSON.stringify(player.specTypeFunctions.rotationToJson(player.getRotation())),\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetData: (eventID: EventID, simUI: IndividualSimUI<any>, newSettings: SavedSettings) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tsimUI.sim.raid.setBuffs(eventID, newSettings.raidBuffs || RaidBuffs.create());\n\t\t\t\t\tsimUI.sim.raid.setDebuffs(eventID, newSettings.debuffs || Debuffs.create());\n\t\t\t\t\tconst party = simUI.player.getParty();\n\t\t\t\t\tif (party) {\n\t\t\t\t\t\tparty.setBuffs(eventID, newSettings.partyBuffs || PartyBuffs.create());\n\t\t\t\t\t}\n\t\t\t\t\tsimUI.player.setBuffs(eventID, newSettings.playerBuffs || IndividualBuffs.create());\n\t\t\t\t\tsimUI.player.setConsumes(eventID, newSettings.consumes || Consumes.create());\n\t\t\t\t\tsimUI.player.setRace(eventID, newSettings.race);\n\t\t\t\t\tsimUI.player.setCooldowns(eventID, newSettings.cooldowns || Cooldowns.create());\n\t\t\t\t\tif (newSettings.rotationJson) {\n\t\t\t\t\t\tsimUI.player.setRotation(eventID, simUI.player.specTypeFunctions.rotationFromJson(JSON.parse(newSettings.rotationJson)));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [\n\t\t\t\tthis.sim.raid.buffsChangeEmitter,\n\t\t\t\tthis.sim.raid.debuffsChangeEmitter,\n\t\t\t\tthis.player.getParty()!.buffsChangeEmitter,\n\t\t\t\tthis.player.buffsChangeEmitter,\n\t\t\t\tthis.player.consumesChangeEmitter,\n\t\t\t\tthis.player.raceChangeEmitter,\n\t\t\t\tthis.player.cooldownsChangeEmitter,\n\t\t\t\tthis.player.rotationChangeEmitter,\n\t\t\t],\n\t\t\tequals: (a: SavedSettings, b: SavedSettings) => SavedSettings.equals(a, b),\n\t\t\ttoJson: (a: SavedSettings) => SavedSettings.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedSettings.fromJson(obj),\n\t\t});\n\n\t\tconst customSectionsContainer = this.rootElem.getElementsByClassName('custom-sections-container')[0] as HTMLElement;\n\t\tlet anyCustomSections = false;\n\t\tfor (const [sectionName, sectionConfig] of Object.entries(this.individualConfig.additionalSections || {})) {\n\t\t\tconst sectionCssPrefix = sectionName.replace(/\\s+/g, '');\n\t\t\tconst sectionElem = document.createElement('fieldset');\n\t\t\tsectionElem.classList.add('settings-section', sectionCssPrefix + '-section');\n\t\t\tsectionElem.innerHTML = `<legend>${sectionName}</legend>`;\n\t\t\tcustomSectionsContainer.appendChild(sectionElem);\n\t\t\tconfigureInputSection(sectionElem, sectionConfig);\n\t\t\tanyCustomSections = true;\n\t\t};\n\n\t\tfor (const [sectionName, sectionConfig] of Object.entries(this.individualConfig.additionalIconSections || {})) {\n\t\t\tconst sectionCssPrefix = sectionName.replace(/\\s+/g, '');\n\t\t\tconst sectionElem = document.createElement('fieldset');\n\t\t\tsectionElem.classList.add('settings-section', sectionCssPrefix + '-section');\n\t\t\tsectionElem.innerHTML = `<legend>${sectionName}</legend>`;\n\t\t\tcustomSectionsContainer.appendChild(sectionElem);\n\t\t\tconfigureIconSection(sectionElem, sectionConfig.map(iconInput => makeIconInput(sectionElem, iconInput)));\n\t\t\tanyCustomSections = true;\n\t\t};\n\n\t\t(this.individualConfig.customSections || []).forEach(customSection => {\n\t\t\tconst sectionElem = document.createElement('fieldset');\n\t\t\tcustomSectionsContainer.appendChild(sectionElem);\n\t\t\tconst sectionName = customSection(this, sectionElem);\n\t\t\tconst sectionCssPrefix = sectionName.replace(/\\s+/g, '');\n\t\t\tsectionElem.classList.add('settings-section', sectionCssPrefix + '-section');\n\t\t\tconst labelElem = document.createElement('legend');\n\t\t\tlabelElem.textContent = sectionName;\n\t\t\tsectionElem.prepend(labelElem);\n\t\t\tanyCustomSections = true;\n\t\t});\n\n\t\tif (!anyCustomSections) {\n\t\t\tcustomSectionsContainer.remove();\n\t\t}\n\n\t\tthis.sim.waitForInit().then(() => {\n\t\t\tsavedEncounterManager.loadUserData();\n\t\t\tsavedSettingsManager.loadUserData();\n\t\t});\n\n\t\tArray.from(this.rootElem.getElementsByClassName('settings-section-container')).forEach((container, i) => {\n\t\t\t(container as HTMLElement).style.zIndex = String(1000 - i);\n\t\t});\n\t}\n\n\tprivate addTalentsTab() {\n\t\tthis.addTab('TALENTS', 'talents-tab', `\n\t\t\t<div class=\"player-pet-toggle\">\n\t\t\t</div>\n\t\t\t<div class=\"talents-content\">\n\t\t\t\t<div class=\"talents-tab-content\">\n\t\t\t\t\t<div class=\"talents-picker\">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"glyphs-picker\">\n\t\t\t\t\t<span>Glyphs</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"saved-talents-manager\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"talents-content\">\n\t\t\t\t<div class=\"talents-tab-content\">\n\t\t\t\t\t<div class=\"pet-talents-picker\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tconst talentsPicker = newTalentsPicker(this.rootElem.getElementsByClassName('talents-picker')[0] as HTMLElement, this.player);\n\t\tconst glyphsPicker = newGlyphsPicker(this.rootElem.getElementsByClassName('glyphs-picker')[0] as HTMLElement, this.player);\n\n\t\tconst savedTalentsManager = new SavedDataManager<Player<any>, SavedTalents>(this.rootElem.getElementsByClassName('saved-talents-manager')[0] as HTMLElement, this.player, {\n\t\t\tlabel: 'Talents',\n\t\t\tstorageKey: this.getSavedTalentsStorageKey(),\n\t\t\tgetData: (player: Player<any>) => SavedTalents.create({\n\t\t\t\ttalentsString: player.getTalentsString(),\n\t\t\t\tglyphs: player.getGlyphs(),\n\t\t\t}),\n\t\t\tsetData: (eventID: EventID, player: Player<any>, newTalents: SavedTalents) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tplayer.setTalentsString(eventID, newTalents.talentsString);\n\t\t\t\t\tplayer.setGlyphs(eventID, newTalents.glyphs || Glyphs.create());\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [this.player.talentsChangeEmitter, this.player.glyphsChangeEmitter],\n\t\t\tequals: (a: SavedTalents, b: SavedTalents) => SavedTalents.equals(a, b),\n\t\t\ttoJson: (a: SavedTalents) => SavedTalents.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedTalents.fromJson(obj),\n\t\t});\n\n\t\tthis.sim.waitForInit().then(() => {\n\t\t\tsavedTalentsManager.loadUserData();\n\t\t\tthis.individualConfig.presets.talents.forEach(config => {\n\t\t\t\tconfig.isPreset = true;\n\t\t\t\tsavedTalentsManager.addSavedData({\n\t\t\t\t\tname: config.name,\n\t\t\t\t\tisPreset: true,\n\t\t\t\t\tdata: config.data,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (this.player.getClass() == Class.ClassHunter) {\n\t\t\t\tconst petTalentsPicker = new HunterPetTalentsPicker(this.rootElem.getElementsByClassName('pet-talents-picker')[0] as HTMLElement, this.player as Player<Spec.SpecHunter>);\n\n\t\t\t\tlet curShown = 0;\n\t\t\t\tconst toggledElems = Array.from(this.rootElem.getElementsByClassName('talents-content')) as Array<HTMLElement>;\n\t\t\t\tconst updateToggle = () => {\n\t\t\t\t\ttoggledElems[1 - curShown].style.display = 'none';\n\t\t\t\t\ttoggledElems[curShown].style.removeProperty('display');\n\n\t\t\t\t\tif (curShown == 0) {\n\t\t\t\t\t\tpetTypeToggle.rootElem.style.display = 'none';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpetTypeToggle.rootElem.style.removeProperty('display');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst toggleContainer = this.rootElem.getElementsByClassName('player-pet-toggle')[0] as HTMLElement;\n\t\t\t\tconst playerPetToggle = new EnumPicker(toggleContainer, this, {\n\t\t\t\t\tvalues: [\n\t\t\t\t\t\t{ name: 'Player', value: 0 },\n\t\t\t\t\t\t{ name: 'Pet', value: 1 },\n\t\t\t\t\t],\n\t\t\t\t\tchangedEvent: sim => new TypedEvent(),\n\t\t\t\t\tgetValue: sim => curShown,\n\t\t\t\t\tsetValue: (eventID, sim, newValue) => {\n\t\t\t\t\t\tcurShown = newValue;\n\t\t\t\t\t\tupdateToggle();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tconst petTypeToggle = new IconEnumPicker(toggleContainer, this.player as Player<Spec.SpecHunter>, makePetTypeInputConfig(false));\n\t\t\t\tupdateToggle();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate addDetailedResultsTab() {\n\t\tthis.addTab('DETAILED RESULTS', 'detailed-results-tab', `\n\t\t\t<div class=\"detailed-results\">\n\t\t\t</div>\n\t\t`);\n\n\t\tconst detailedResults = new DetailedResults(this.rootElem.getElementsByClassName('detailed-results')[0] as HTMLElement, this, this.raidSimResultsManager!);\n\t}\n\n\tprivate addLogTab() {\n\t\tthis.addTab('LOG', 'log-tab', `\n\t\t\t<div class=\"log-runner\">\n\t\t\t</div>\n\t\t`);\n\n\t\tconst logRunner = new LogRunner(this.rootElem.getElementsByClassName('log-runner')[0] as HTMLElement, this);\n\t}\n\n\tapplyDefaults(eventID: EventID) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tconst tankSpec = isTankSpec(this.player.spec);\n\t\t\tconst healingSpec = isHealingSpec(this.player.spec);\n\n\t\t\tthis.player.applySharedDefaults(eventID);\n\t\t\tthis.player.setRace(eventID, specToEligibleRaces[this.player.spec][0]);\n\t\t\tthis.player.setGear(eventID, this.sim.lookupEquipmentSpec(this.individualConfig.defaults.gear));\n\t\t\tthis.player.setConsumes(eventID, this.individualConfig.defaults.consumes);\n\t\t\tthis.player.setRotation(eventID, this.individualConfig.defaults.rotation);\n\t\t\tthis.player.setTalentsString(eventID, this.individualConfig.defaults.talents.talentsString);\n\t\t\tthis.player.setGlyphs(eventID, this.individualConfig.defaults.talents.glyphs || Glyphs.create());\n\t\t\tthis.player.setSpecOptions(eventID, this.individualConfig.defaults.specOptions);\n\t\t\tthis.player.setBuffs(eventID, this.individualConfig.defaults.individualBuffs);\n\t\t\tthis.player.getParty()!.setBuffs(eventID, this.individualConfig.defaults.partyBuffs);\n\t\t\tthis.player.getRaid()!.setBuffs(eventID, this.individualConfig.defaults.raidBuffs);\n\t\t\tthis.player.setEpWeights(eventID, this.individualConfig.defaults.epWeights);\n\t\t\tthis.player.setProfession1(eventID, this.individualConfig.defaults.other?.profession1 || Profession.Engineering);\n\t\t\tthis.player.setProfession2(eventID, this.individualConfig.defaults.other?.profession2 || Profession.Jewelcrafting);\n\t\t\tthis.player.setDistanceFromTarget(eventID, this.individualConfig.defaults.other?.distanceFromTarget || 0);\n\n\t\t\tif (this.isWithinRaidSim) {\n\t\t\t\tthis.sim.raid.setTargetDummies(eventID, 0);\n\t\t\t} else {\n\t\t\t\tthis.sim.raid.setTargetDummies(eventID, healingSpec ? 9 : 0);\n\t\t\t\tthis.sim.encounter.applyDefaults(eventID);\n\t\t\t\tthis.sim.raid.setDebuffs(eventID, this.individualConfig.defaults.debuffs);\n\t\t\t\tthis.sim.applyDefaults(eventID, tankSpec, healingSpec);\n\n\t\t\t\tif (tankSpec) {\n\t\t\t\t\tthis.sim.raid.setTanks(eventID, [this.player.makeRaidTarget()]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.sim.raid.setTanks(eventID, []);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSavedGearStorageKey(): string {\n\t\treturn this.getStorageKey(SAVED_GEAR_STORAGE_KEY);\n\t}\n\n\tgetSavedRotationStorageKey(): string {\n\t\treturn this.getStorageKey(SAVED_ROTATION_STORAGE_KEY);\n\t}\n\n\tgetSavedSettingsStorageKey(): string {\n\t\treturn this.getStorageKey(SAVED_SETTINGS_STORAGE_KEY);\n\t}\n\n\tgetSavedTalentsStorageKey(): string {\n\t\treturn this.getStorageKey(SAVED_TALENTS_STORAGE_KEY);\n\t}\n\n\tprivate recomputeSettingsLayout() {\n\t\tif (this.settingsMuuri) {\n\t\t\t//this.settingsMuuri.refreshItems();\n\t\t}\n\t\twindow.dispatchEvent(new Event('resize'));\n\t}\n\n\t// Returns the actual key to use for local storage, based on the given key part and the site context.\n\tgetStorageKey(keyPart: string): string {\n\t\t// Local storage is shared by all sites under the same domain, so we need to use\n\t\t// different keys for each spec site.\n\t\treturn specToLocalStorageKey[this.player.spec] + keyPart;\n\t}\n\n\ttoProto(): IndividualSimSettings {\n\t\treturn IndividualSimSettings.create({\n\t\t\tsettings: this.sim.toProto(),\n\t\t\tplayer: this.player.toProto(true),\n\t\t\traidBuffs: this.sim.raid.getBuffs(),\n\t\t\tdebuffs: this.sim.raid.getDebuffs(),\n\t\t\ttanks: this.sim.raid.getTanks(),\n\t\t\tpartyBuffs: this.player.getParty()?.getBuffs() || PartyBuffs.create(),\n\t\t\tencounter: this.sim.encounter.toProto(),\n\t\t\tepWeights: this.player.getEpWeights().asArray(),\n\t\t\ttargetDummies: this.sim.raid.getTargetDummies(),\n\t\t});\n\t}\n\n\ttoLink(): string {\n\t\tconst proto = this.toProto();\n\t\t// When sharing links, people generally don't intend to share settings/ep weights.\n\t\tproto.settings = undefined;\n\t\tproto.epWeights = [];\n\n\t\tconst protoBytes = IndividualSimSettings.toBinary(proto);\n\t\tconst deflated = pako.deflate(protoBytes, { to: 'string' });\n\t\tconst encoded = btoa(String.fromCharCode(...deflated));\n\n\t\tconst linkUrl = new URL(window.location.href);\n\t\tlinkUrl.hash = encoded;\n\t\treturn linkUrl.toString();\n\t}\n\n\tfromProto(eventID: EventID, settings: IndividualSimSettings) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tif (!settings.player) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.player.fromProto(eventID, settings.player);\n\t\t\tif (settings.epWeights?.length > 0) {\n\t\t\t\t// Correction for removal of healing power and arcane/fire/etc power.\n\t\t\t\t// TODO: Remove this after 2 months (2022/11/22).\n\t\t\t\tif (settings.epWeights.length > 37) {\n\t\t\t\t\tsettings.epWeights.splice(6, 7);\n\t\t\t\t}\n\t\t\t\tthis.player.setEpWeights(eventID, new Stats(settings.epWeights));\n\t\t\t} else {\n\t\t\t\tthis.player.setEpWeights(eventID, this.individualConfig.defaults.epWeights);\n\t\t\t}\n\t\t\tthis.sim.raid.setBuffs(eventID, settings.raidBuffs || RaidBuffs.create());\n\t\t\tthis.sim.raid.setDebuffs(eventID, settings.debuffs || Debuffs.create());\n\t\t\tthis.sim.raid.setTanks(eventID, settings.tanks || []);\n\t\t\tthis.sim.raid.setTargetDummies(eventID, settings.targetDummies);\n\t\t\tconst party = this.player.getParty();\n\t\t\tif (party) {\n\t\t\t\tparty.setBuffs(eventID, settings.partyBuffs || PartyBuffs.create());\n\t\t\t}\n\n\t\t\tif (settings.encounter) {\n\t\t\t\t// Correction for removal of healing power and arcane/fire/etc power.\n\t\t\t\t// TODO: Remove this after 2 months (2022/11/22).\n\t\t\t\tsettings.encounter.targets.forEach(target => {\n\t\t\t\t\tif (target.stats.length > 37) {\n\t\t\t\t\t\ttarget.stats.splice(6, 7);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.sim.encounter.fromProto(eventID, settings.encounter || EncounterProto.create());\n\n\t\t\tif (settings.settings) {\n\t\t\t\tthis.sim.fromProto(eventID, settings.settings);\n\t\t\t} else {\n\t\t\t\tconst tankSpec = isTankSpec(this.player.spec);\n\t\t\t\tconst healingSpec = isHealingSpec(this.player.spec);\n\t\t\t\tthis.sim.applyDefaults(eventID, tankSpec, healingSpec);\n\t\t\t}\n\n\t\t\t// Needed because of new proto field addition. Can remove on 2022/11/14 (2 months).\n\t\t\tif (!isHealingSpec(this.player.spec)) {\n\t\t\t\tthis.sim.setShowDamageMetrics(eventID, true);\n\t\t\t}\n\t\t});\n\t}\n\n\tsplitRelevantOptions<T>(options: Array<StatOption<T> | null>): Array<T> {\n\t\treturn options\n\t\t\t.filter(option => option != null)\n\t\t\t.filter(option =>\n\t\t\t\tthis.individualConfig.includeBuffDebuffInputs.includes(option!.item) ||\n\t\t\t\toption!.stats.length == 0 ||\n\t\t\t\toption!.stats.some(stat => this.individualConfig.epStats.includes(stat)))\n\t\t\t.filter(option =>\n\t\t\t\t!this.individualConfig.excludeBuffDebuffInputs.includes(option!.item))\n\t\t\t.map(option => option!.item);\n\t}\n}\n\nexport interface StatOption<T> {\n\tstats: Array<Stat>,\n\titem: T,\n}\n"],"names":["Target","constructor","sim","this","id","name","level","Mechanics.BOSS_LEVEL","mobType","MobType","MobTypeDemon","tankIndex","stats","Stats","swingSpeed","minBaseDamage","dualWield","dualWieldPenalty","suppressDodge","parryHaste","spellSchool","SpellSchool","SpellSchoolPhysical","idChangeEmitter","TypedEvent","nameChangeEmitter","levelChangeEmitter","mobTypeChangeEmitter","propChangeEmitter","statsChangeEmitter","changeEmitter","forEach","emitter","on","eventID","emit","encounter","getId","setId","newId","getName","setName","newName","getLevel","setLevel","newLevel","getMobType","setMobType","newMobType","getTankIndex","setTankIndex","newTankIndex","getSwingSpeed","setSwingSpeed","newSwingSpeed","getMinBaseDamage","setMinBaseDamage","newMinBaseDamage","getDualWield","setDualWield","newDualWield","getDualWieldPenalty","setDualWieldPenalty","newDualWieldPenalty","getSuppressDodge","setSuppressDodge","newSuppressDodge","getParryHaste","setParryHaste","newParryHaste","getSpellSchool","setSpellSchool","newSpellSchool","getStats","setStats","newStats","equals","matchesPreset","preset","TargetProto","toProto","target","applyPreset","fromProto","create","asArray","proto","freezeAllAndDo","clone","newTarget","static","MobTypeUndead","fromMap","Stat","StatArmor","StatAttackPower","defaultProto","Encounter","duration","durationVariation","executeProportion20","executeProportion25","executeProportion35","useHealth","targetsChangeEmitter","durationChangeEmitter","executeProportionChangeEmitter","targets","fromDefaults","nextEventID","primaryTarget","getDurationVariation","setDurationVariation","newDuration","getDuration","setDuration","getExecuteProportion20","setExecuteProportion20","newExecuteProportion20","getExecuteProportion25","setExecuteProportion25","newExecuteProportion25","getExecuteProportion35","setExecuteProportion35","newExecuteProportion35","getUseHealth","setUseHealth","newUseHealth","getNumTargets","length","getTargets","slice","setTargets","newTargets","every","i","t","push","nt","EncounterProto","map","targetProto","applyDefaults","MAX_NUM_PARTIES","Raid","buffs","RaidBuffs","debuffs","Debuffs","tanks","targetDummies","compChangeEmitter","buffsChangeEmitter","debuffsChangeEmitter","tanksChangeEmitter","targetDummiesChangeEmitter","parties","Array","keys","newParty","Party","onAny","size","sum","party","isEmpty","getParties","getParty","index","getPlayers","flat","getPlayer","Math","floor","MAX_PARTY_SIZE","getPlayerFromRaidTarget","raidTarget","targetIndex","NO_TARGET","setPlayer","newPlayer","getClassCount","playerClass","filter","player","getClass","getBuffs","setBuffs","newBuffs","totemOfWrath","newDebuff","setDebuffs","getDebuffs","newDebuffs","getTanks","RaidTarget","tank","setTanks","newTanks","getTargetDummies","setTargetDummies","newTargetDummies","forExport","RaidProto","clear","SIM_WORKER_URL","REPO_NAME","WorkerPool","numWorkers","workers","SimWorker","getLeastBusyWorker","reduce","curMinWorker","nextWorker","numTasksRunning","async","requestName","request","doApiCall","result","makeApiCall","GearListRequest","toBinary","GearListResult","fromBinary","ComputeStatsRequest","ComputeStatsResult","onProgress","console","log","StatWeightsRequest","toJsonString","worker","makeTaskId","addPromiseFunc","newProgressHandler","err","resultData","ProgressMetrics","StatWeightsResult","finalWeightResult","RaidSimRequest","resultJson","RaidSimResult","toJson","finalRaidResult","JSON","stringify","progressData","progress","taskIdsToPromiseFuncs","window","Worker","resolveReady","onReady","Promise","_resolve","_reject","onmessage","event","data","msg","postMessage","warn","promiseFuncs","outputData","callback","onError","characters","charAt","random","taskPromise","resolve","reject","inputData","_Sim","iterations","phase","OtherConstants.CURRENT_PHASE","faction","Faction","Alliance","fixedRngSeed","show1hWeapons","show2hWeapons","showMatchingGems","showDamageMetrics","showThreatMetrics","showHealingMetrics","showExperimental","items","enchants","gems","presetEncounters","presetTargets","iterationsChangeEmitter","phaseChangeEmitter","factionChangeEmitter","fixedRngSeedChangeEmitter","lastUsedRngSeedChangeEmitter","show1hWeaponsChangeEmitter","show2hWeaponsChangeEmitter","showMatchingGemsChangeEmitter","showDamageMetricsChangeEmitter","showThreatMetricsChangeEmitter","showHealingMetricsChangeEmitter","showExperimentalChangeEmitter","crashEmitter","simResultEmitter","lastUsedRngSeed","modifyRaidProto","workerPool","_initPromise","getGearList","then","item","gem","encounters","path","e","raid","settingsChangeEmitter","updateCharacterStats","waitForInit","setModifyRaidProto","newModFn","getModifiedRaidProto","raidProto","players","equipment","gear","lookupEquipmentSpec","gearChanged","isBlacksmith","profession1","profession2","includes","Profession","Blacksmithing","hasInactiveMetaGem","withoutMetaGem","withoutBlacksmithSockets","asSpec","makeRaidSimRequest","debug","simOptions","SimOptions","getIterations","randomSeed","BigInt","nextRngSeed","debugFirstIteration","Error","raidSimAsync","errorResult","SimError","simResult","SimResult","makeNew","req","computeStats","raidStats","partyStats","partyIndex","playerStats","playerIndex","setCurrentStats","epStats","epReferenceStat","getRaidIndex","raidBuffs","partyBuffs","statsToWeigh","statWeightsAsync","getItems","slot","Object","values","getEligibleItemSlots","getEnchants","enchant","getEligibleEnchantSlots","getEnchantFlexible","find","effectId","getGems","socketColor","gemEligibleForSocket","getMatchingGems","gemMatchesSocket","getPresetEncounter","getPresetTarget","getAllPresetEncounters","getAllPresetTargets","getPhase","setPhase","newPhase","getFaction","setFaction","newFaction","getFixedRngSeed","setFixedRngSeed","newFixedRngSeed","rngSeed","MAX_RNG_SEED","getLastUsedRngSeed","getShow1hWeapons","setShow1hWeapons","newShow1hWeapons","getShow2hWeapons","setShow2hWeapons","newShow2hWeapons","getShowMatchingGems","setShowMatchingGems","newShowMatchingGems","getShowDamageMetrics","setShowDamageMetrics","newShowDamageMetrics","getShowThreatMetrics","setShowThreatMetrics","newShowThreatMetrics","getShowHealingMetrics","setShowHealingMetrics","newShowHealingMetrics","getShowExperimental","setShowExperimental","newShowExperimental","setIterations","newIterations","lookupItemSpec","itemSpec","type","gemId","EquippedItem","equipSpec","gearMap","assignedSlot","Item","Gear","SimSettingsProto","Number","isTankSim","isHealingSim","Sim","pow","errorStr","super","NumberPicker","Input","parent","modObject","config","float","positive","inputElem","document","createElement","inputMode","min","onchange","value","abs","parseInt","toString","classList","add","rootElem","appendChild","init","addEventListener","inputChanged","getInputElem","getInputValue","parseFloat","setInputValue","newValue","String","BonusStatsPicker","Component","label","textContent","tippy","content","allowHTML","statPickers","statOrder","stat","statNames","changedEvent","bonusStatsChangeEmitter","getValue","getBonusStats","getStat","setValue","bonusStats","withStat","player2","setBonusStats","statPicker","remove","BooleanPicker","Boolean","checked","CharacterStats","modifyDisplayStats","table","valueElems","tooltipElems","row","innerHTML","toUpperCase","valueElem","getElementsByClassName","tooltipElem","updateStats","currentStatsEmitter","getCurrentStats","statMods","talents","baseStats","gearStats","talentsStats","buffsStats","consumesStats","debuffStats","getDebuffStats","finalStats","gearDelta","subtract","talentsDelta","buffsDelta","consumesDelta","idx","statDisplayString","rawValue","displayStr","round","StatMeleeHit","Mechanics.MELEE_HIT_RATING_PER_HIT_CHANCE","toFixed","StatSpellHit","Mechanics.SPELL_HIT_RATING_PER_HIT_CHANCE","StatMeleeCrit","StatSpellCrit","Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE","StatMeleeHaste","Class","ClassDruid","ClassShaman","ClassPaladin","ClassDeathknight","Mechanics.SPECIAL_MELEE_HASTE_RATING_PER_HASTE_PERCENT","Mechanics.HASTE_RATING_PER_HASTE_PERCENT","StatSpellHaste","StatExpertise","Mechanics.EXPERTISE_PER_QUARTER_PERCENT_REDUCTION","StatDefense","Mechanics.CHARACTER_LEVEL","Mechanics.DEFENSE_RATING_PER_DEFENSE","StatBlock","Mechanics.BLOCK_RATING_PER_BLOCK_CHANCE","StatDodge","Mechanics.DODGE_RATING_PER_DODGE_CHANCE","StatParry","Mechanics.PARRY_RATING_PER_PARRY_CHANCE","misery","faerieFire","TristateEffect","TristateEffectImproved","addStat","heartOfTheCrusader","masterPoisoner","Mechanics.MELEE_CRIT_RATING_PER_CRIT_CHANCE","improvedScorch","wintersChill","shadowMastery","IconEnumPicker","modObj","currentValue","zeroValue","buttonElem","dropdownElem","buttonText","preventDefault","style","display","gridTemplateColumns","numColumns","valueConfig","optionContainer","option","setImage","text","optionText","append","tooltip","showWhen","dispatchEvent","Event","setActionImage","elem","actionId","fillAndSet","backgroundImage","backgroundColor","color","backupIconUrl","backupId","NumberListPicker","placeholder","str","split","val","isNaN","arrayEquals","v","join","CooldownsPicker","parentElem","cooldownPickers","update","cooldowns","getCooldowns","cooldown","deleteButton","newCooldowns","splice","setCooldowns","makeActionPicker","ActionId","fill","filledId","makeTimingsPicker","cooldownIndex","availableCooldowns","extraCssClasses","ActionIdProto","concat","cooldownAction","a","b","cooldownsChangeEmitter","Cooldown","timings","enableWhen","curCooldown","DetailedResults","simUI","simResultsManager","tabWindow","latestRun","updateSettings","computedStyles","getComputedStyle","url","URL","location","protocol","host","searchParams","getPropertyValue","trim","isIndividualSim","href","iframeElem","closed","open","setSimRunData","focus","currentChangeEmitter","runData","getRunData","simRunData","DetailedResultsUpdate","oneofKind","settings","contentWindow","ListPicker","itemPickerPairs","title","itemLabel","titleTooltip","itemsDiv","newItem","newList","pair","removePairs","ipp","curItems","addNewPicker","from","children","getPickerIndex","picker","findIndex","itemContainer","inlineMenuBar","itemHTML","upButton","error","swap","downButton","copyButton","copiedItem","copyItem","itemElem","itemPicker","newItemPicker","CustomRotationPicker","modPlayer","spells","CustomRotation","CustomSpell","oldItem","listPicker","CustomSpellPicker","modSpell","oldShowWhen","spell","setSpell","cr","EnumPicker","selectElem","EncounterPicker","modEncounter","addEncounterFieldPickers","showExecuteProportion","labelTooltip","pe","isHealingSpec","spec","isTankSpec","advancedButton","AdvancedEncounterPicker","Popup","addCloseButton","encounterTypeContainer","encounter2","header","targetsElem","TargetPicker","modTarget","section1","section2","section3","mobTypeEnumValues","ALL_TARGET_STATS","statData","SpellSchoolArcane","SpellSchoolFire","SpellSchoolFrost","SpellSchoolHoly","SpellSchoolNature","SpellSchoolShadow","obj","StatHealth","StatArcaneResistance","StatFireResistance","StatFrostResistance","StatNatureResistance","StatShadowResistance","StatBlockValue","MobTypeUnknown","MobTypeBeast","MobTypeDragonkin","MobTypeElemental","MobTypeGiant","MobTypeHumanoid","MobTypeMechanical","descriptionsPromise","getEnchantDescription","fetch","response","json","descriptionsMap","idStr","StartingConjured","Conjured","ConjuredUnknown","ConjuredDarkRune","ConjuredFlameCap","ConjuredRogueThistleTea","consumesChangeEmitter","getConsumes","startingConjured","newConsumes","setConsumes","InFrontOfTarget","inFrontOfTargetChangeEmitter","getInFrontOfTarget","setInFrontOfTarget","DistanceFromTarget","distanceFromTargetChangeEmitter","getDistanceFromTarget","setDistanceFromTarget","TankAssignment","getRaid","makeRaidTarget","emptyRaidTarget","IncomingHps","getHealingModel","hps","healingModel","setHealingModel","HealingCadence","cadenceSeconds","HpPercentForDefensives","hpPercentForDefensives","InspirationUptime","healingModelChangeEmitter","inspirationUptime","GearPicker","leftSide","rightSide","leftItemPickers","ItemSlot","ItemSlotHead","ItemSlotNeck","ItemSlotShoulder","ItemSlotBack","ItemSlotChest","ItemSlotWrist","ItemSlotMainHand","ItemSlotOffHand","ItemPicker","rightItemPickers","ItemSlotHands","ItemSlotWaist","ItemSlotLegs","ItemSlotFeet","ItemSlotFinger1","ItemSlotFinger2","ItemSlotTrinket1","ItemSlotTrinket2","ItemSlotRanged","itemPickers","sort","_items","_enchants","_equippedItem","iconElem","nameElem","enchantElem","socketsContainerElem","getEquippedItem","onClickStart","SelectorModal","closest","onClickEnd","ev","openTab","gearChangeEmitter","professionChangeEmitter","setWowheadData","removeAttribute","emptySlotIcons","slotNames","setItemQualityCssClass","heroic","heroic_span","marginLeft","innerText","quality","asActionId","setBackgroundAndHref","setWowheadHref","description","isSpellId","setAttribute","allSocketColors","gemIdx","gemIconElem","setGemSocketCssClass","src","getEmptyGemSocketIconUrl","fromItemId","iconUrl","numPossibleSockets","ItemType","ItemTypeWrist","ItemTypeHands","updateProfession","isBlacksmithing","removeProperty","equippedItem","eligibleItems","eligibleEnchants","tabsElem","contentElem","setData","click","addTab","fromItem","baseEP","computeItemEP","ignoreEPFilter","onEquip","equipItem","withItem","GemColor","GemColorUnknown","fromSpellId","computeStatsEP","withEnchant","computeEnchantEP","addGemTabs","socketBonusEP","socketBonus","gemSockets","curSocketColors","socketIdx","withGem","gemEP","computeGemEP","tabAnchor","updateGemIcon","itemData","computeEP","equippedToItemFn","onRemove","setTabContent","dataA","dataB","ilvl","diff","tabElem","tabContentId","dataset","tabContent","helpIcon","sim2","makeShow2hWeaponsSelector","ClassWarrior","makeShowMatchingGemsSelector","startsWith","makePhaseSelector","listElem","listItemElems","itemIdx","itemEP","listItemElem","onclick","is","removeTabs","updateSelected","newEquippedItem","newItemId","newEP","listItemIdx","listItemData","listItem","epDeltaElem","listItemEP","formatDeltaTextElem","applyFilters","validItemElems","currentEquippedItem","weaponType","WeaponType","WeaponTypeUnknown","handType","HandType","HandTypeTwoHand","enchantAppliesToItem","searchInput","searchQuery","toLowerCase","include","numShown","key","ele","contains","labelSubstring","tabElems","prototype","call","tab","contentElems","getElementById","getAttribute","substring","parentElement","SavedDataManager","userData","presets","frozen","presetsOnly","savedDataDiv","saveInput","alert","addSavedData","getData","saveUserData","newData","makeSavedData","dataArr","isPreset","oldIdx","insertBefore","replaceChild","dataElem","stopPropagation","confirm","checkActive","changeEmitters","savedData","localStorage","setItem","storageKey","loadUserData","dataStr","getItem","jsonData","parse","fromJson","freeze","makeMultiIconInput","inputs","emptyColor","makeWrappedBooleanInput","getModObject","makeSpecOptionsBooleanInput","getSpecOptions","fieldName","newVal","newMessage","setSpecOptions","specOptionsChangeEmitter","makeRotationBooleanInput","getRotation","setRotation","rotationChangeEmitter","makeWrappedNumberInput","makeSpecOptionsNumberInput","internalConfig","percent","makeRotationNumberInput","makeWrappedEnumInput","makeSpecOptionsEnumInput","makeRotationEnumInput","makeWrappedIconInput","states","makeBooleanIconInput","getFieldValue","setFieldValue","makeSpecOptionsBooleanIconInput","makeNumberIconInput","multiplier","sign","makeTristateIconInput","impId","input","improvedId","makeMultistateIconInput","numStates","makeWrappedEnumIconInput","makeSpecOptionsEnumIconInput","makeRotationEnumIconInput","makeCustomRotationInput","rotation","makePetTypeInputConfig","includeLabel","InputHelpers.makeSpecOptionsEnumIconInput","PetType","PetNone","fromPetName","Bat","Bear","BirdOfPrey","Boar","CarrionBird","Cat","Chimaera","CoreHound","Crab","Crocolisk","Devilsaur","Dragonhawk","Gorilla","Hyena","Moth","NetherRay","Raptor","Ravager","Rhino","Scorpid","Serpent","Silithid","Spider","SpiritBeast","SporeBat","Tallstrider","Turtle","WarpStalker","Wasp","WindSerpent","Wolf","Worm","petCategories","categoryOrder","categoryClasses","HunterPetTalentsPicker","curCategory","getCategoryFromPlayer","curTalents","getPetTalentsFromPlayer","savedSets","defaultTalents","talentsContainer","pickers","category","talentsConfig","petTalentsConfig","pickerContainer","TalentsPicker","trees","protoToTalentString","options","petTalents","talentStringToProto","HunterPetTalents","pointsPerRow","maxPoints","savedTalentsManager","defaultBMTalents","petCategory","categoryIdx","indexOf","updateIsBM","getTalents","beastMastery","setMaxPoints","talentsChangeEmitter","petType","getPetTalentsConfig","cunningDefault","cobraReflexes","dive","boarsSpeed","mobility","spikedCollar","cornered","feedingFrenzy","wolverineBite","bullheaded","wildHunt","ferocityDefault","cullingTheHerd","spidersBite","rabid","callOfTheWild","charge","greatStamina","bloodOfTheRhino","guardDog","thunderstomp","graceOfTheMantis","taunt","roarOfSacrifice","cunningBMDefault","ferocityBMDefault","bloodthirsty","sharkAttack","newTalentsConfig","backgroundUrl","rowIdx","colIdx","spellIds","prereqLocation","IconPicker","rootAnchor","useImprovedIcons","improvedId2","levelContainer","improvedAnchor","improvedAnchor2","counterElem","isRightClick","getActionId","LogRunner","controlBar","simButton","logsDiv","runSimOnce","logs","isCastCompleted","lineElem","MultiIconPicker","dropdownRootElem","labelElem","pickerConfig","updateButtonImage","getMaxValue","categoryId","SettingsMenu","restoreDefaultsButton","ResultsViewer","pendingElem","hideAll","setPending","setContent","LaunchStatus","LaunchStatus2","simLaunchStatuses","Spec","SpecBalanceDruid","SpecElementalShaman","SpecEnhancementShaman","SpecFeralDruid","SpecFeralTankDruid","SpecHunter","SpecMage","SpecRogue","SpecRetributionPaladin","SpecProtectionPaladin","SpecHealingPriest","SpecShadowPriest","SpecSmitePriest","SpecWarlock","SpecWarrior","SpecProtectionWarrior","SpecDeathknight","SpecTankDeathknight","memeSpecs","Title","currentSpec","dropdownPanel","orderedLaunchedSpecs","naturalSpecOrder","specStr","gridTemplateRows","ceil","currentOption","makeOptionData","otherOptions","makeOptionElem","makeOption","isButton","raidSimIcon","raidSimSiteUrl","titleIcons","getSpecSiteUrl","specNames","classColors","specToClass","icon","labelDiv","simLabel","SimUI","simHTML","isWithinRaidSim","handleCrash","updateShowDamageMetrics","updateShowThreatMetrics","updateShowHealingMetrics","updateShowExperimental","warnings","warningsElem","warningsTippy","updateWarnings","statusStr","launchStatus","Unlaunched","Alpha","Beta","knownIssues","knownIssuesContainer","issue","interactive","resultsViewerElem","resultsViewer","titleElem","simActionsContainer","reportBug","addToolbarItem","downloadBinary","resp","versionInfo","outdated","catch","addAction","cssClass","actFn","iterationsPicker","button","simTabsContainer","simTabContentsContainer","topBar","contentId","replace","isFirstTab","newTab","newContent","activeWarnings","warning","getContent","addWarning","updateOn","getSettingsStorageKey","getStorageKey","getSavedEncounterStorageKey","runRaidSim","runRaidSimWithLogs","hash","hashCode","link","toLink","issues","total_count","html_url","base","maxBodyLength","issueBody","encodeURIComponent","lastIndexOf","fetchErr","len","charCodeAt","EpWeightsMenu","statsType","tableContainer","tableBody","querySelector","tableHeader","updateType","computeStatWeights","setSimProgress","prevEpIterations","prevEpSimResult","updateTable","colActionButtons","makeUpdateWeights","weightsFunc","previousSibling","setEpWeights","getPrevSimResult","dps","weights","epValues","tps","dtps","individualConfig","defaults","epWeights","showAllStatsContainer","menu","applyAlternatingColors","optimizeGemsButton","optimizeGems","completedSims","totalSims","completedIterations","totalIterations","StatMana","StatEnergy","StatRage","makeTableRow","stDevToConf90","weightsStdev","epValuesStdev","currentEpCell","epWeightsChangeEmitter","getEpWeights","childNodes","w","getGear","allGems","isJewelcrafting","hasProfession","Jewelcrafting","optimizedGear","optimizeGemsForWeights","setGear","unrestrictedGems","Gems.isUnrestrictedGem","bestGemForColor","bestGemForColorEP","bestGemForSocket","bestGemForSocketEP","bestGem","bestGemEP","findBestGems","asMap","socketBonusEPs","entries","itemSlot","socketColors","GemColorMeta","allSockets","itemSlotStr","numSockets","threeSocketCombos","permutations","calculateGearGemsEP","statsFromGems","jcGems","requiredProfession","bestJcGemForColor","bestJcGemForColorEP","bestJcGemForSocket","bestJcGemForSocketEP","bestJcGem","bestJcGemEP","bestGear","bestGearEP","socketCombo","ei","gemColor","curGear","hasActiveMetaGem","curGearEP","metaGem","getMetaGem","condition","Gems.getMetaGemCondition","isCompareColorCondition","getAllGems","colorCombos","getColorCombosToSatisfyCondition","colorCombo","isOneOfEach","Gems.PRIMARY_COLORS","GemColorPrismatic","Gems.SECONDARY_COLORS","secondaryColor","remainingColor","Gems.socketToMatchingColors","get","matchingColor","isTwoAndOne","oneColor","minRed","minYellow","minBlue","twoColor","Gems.gemColorMatchesSocket","partialCombo","isThreeOfAColor","threeColor","matchingColors","combinationsWithDups","gemList","Gems.GEM_COLORS","GEM_COLORS","Gems.gemMatchesSocket","Exporter","allowDownload","textElem","navigator","clipboard","writeText","downloadButton","downloadString","IndividualLinkExporter","IndividualJsonExporter","IndividualSimSettings","_Individual80UEPExporter","allStats","getEnumValues","linkNames","Individual80UEPExporter","StatStrength","StatAgility","StatStamina","StatIntellect","StatSpirit","StatSpellPower","StatMP5","StatSpellPenetration","StatArmorPenetration","StatRangedAttackPower","StatResilience","_IndividualPawnEPExporter","classNames","IndividualPawnEPExporter","Importer","includeFile","uploadInputId","replaceAll","htmlVal","descriptionElem","files","importButton","onImport","finishIndividualImport","charClass","race","equipmentSpec","talentsStr","glyphs","professions","dbEnchant","expectedEnchantIds","foundEnchantIds","missingEnchants","expectedId","expectedItemIds","foundItemIds","missingItems","setRace","setTalentsString","setGlyphs","setProfessions","close","IndividualJsonImporter","fromJsonString","Individual80UImporter","importJson","nameToClass","character","gameClass","ClassUnknown","nameToRace","Race","RaceUnknown","talentIds","talentJson","spellId","talentSpellIdsToTalentString","EquipmentSpec","itemJson","ItemSpec","gemJson","IndividualAddonImporter","nameToProfession","profData","prof","ProfessionUnknown","glyphsConfig","classGlyphsConfig","majorGlyphIDs","glyphNameToID","glyphName","majorGlyphs","minorGlyphIDs","minorGlyphs","Glyphs","major1","major2","major3","minor1","minor2","minor3","gearJson","glyphIDStr","AllStatsBuff","InputHelpers.makeMultiIconInput","makeTristateRaidBuffInput","makeBooleanRaidBuffInput","AllStatsPercentBuff","makeBooleanIndividualBuffInput","ArmorBuff","StaminaBuff","StrengthAndAgilityBuff","IntellectBuff","SpiritBuff","AttackPowerBuff","makeTristateIndividualBuffInput","AttackPowerPercentBuff","DamagePercentBuff","DamageReductionPercentBuff","HastePercentBuff","HealthBuff","MP5Buff","MeleeCritBuff","MeleeHasteBuff","ReplenishmentBuff","SpellCritBuff","SpellHasteBuff","withLabel","SpellPowerBuff","InputHelpers.makeMultistateIconInput","Bloodlust","RetributionAura","ShadowProtection","BraidedEterniumChain","makeBooleanPartyBuffInput","ChainOfTheTwilightOwl","HeroicPresence","EyeOfTheNight","Thorns","ManaTideTotem","makeMultistatePartyBuffInput","Innervate","makeMultistateIndividualBuffInput","PowerInfusion","FocusMagic","TricksOfTheTrade","UnholyFrenzy","RevitalizeRejuvination","makeMultistateMultiplierIndividualBuffInput","RevitalizeWildGrowth","MajorArmorDebuff","makeBooleanDebuffInput","MinorArmorDebuff","makeTristateDebuffInput","AttackPowerDebuff","BleedDebuff","CritDebuff","MeleeAttackSpeedDebuff","MeleeHitDebuff","PhysicalDamageDebuff","SpellCritDebuff","SpellHitDebuff","SpellDamageDebuff","HuntersMark","impId2","InputHelpers.makeQuadstateIconInput","makeQuadstateDebuffInput","JudgementOfWisdom","JudgementOfLight","ShatteringThrow","GiftOfArthas","ThermalSapper","makeBooleanConsumeInput","ExplosiveDecoy","SpicedMammothTreats","PetFood","PetFoodSpicedMammothTreats","InputHelpers.makeBooleanIconInput","InputHelpers.makeTristateIconInput","makePotionInputFactory","consumesFieldName","makeConsumeInputFactory","Potions","RunicHealingPotion","RunicManaPotion","IndestructiblePotion","PotionOfSpeed","PotionOfWildMagic","DestructionPotion","HastePotion","MightyRagePotion","SuperManaPotion","FelManaPotion","InsaneStrengthPotion","IronshieldPotion","HeroicPotion","makePotionsInput","makePrepopPotionsInput","makeConjuredInput","ConjuredHealthstone","makeFlasksInput","Flask","FlaskOfTheFrostWyrm","FlaskOfEndlessRage","FlaskOfPureMojo","FlaskOfStoneblood","LesserFlaskOfToughness","LesserFlaskOfResistance","FlaskOfBlindingLight","FlaskOfMightyRestoration","FlaskOfPureDeath","FlaskOfRelentlessAssault","FlaskOfSupremePower","FlaskOfFortification","FlaskOfChromaticWonder","battleElixir","BattleElixir","BattleElixirUnknown","guardianElixir","GuardianElixir","GuardianElixirUnknown","makeBattleElixirsInput","ElixirOfAccuracy","ElixirOfArmorPiercing","ElixirOfDeadlyStrikes","ElixirOfExpertise","ElixirOfLightningSpeed","ElixirOfMightyAgility","ElixirOfMightyStrength","GurusElixir","SpellpowerElixir","WrathElixir","AdeptsElixir","ElixirOfDemonslaying","ElixirOfMajorAgility","ElixirOfMajorFirePower","ElixirOfMajorFrostPower","ElixirOfMajorShadowPower","ElixirOfMajorStrength","ElixirOfMastery","ElixirOfTheMongoose","FelStrengthElixir","GreaterArcaneElixir","flask","FlaskUnknown","makeGuardianElixirsInput","ElixirOfMightyDefense","ElixirOfMightyFortitude","ElixirOfMightyMageblood","ElixirOfMightyThoughts","ElixirOfProtection","ElixirOfSpirit","ElixirOfDraenicWisdom","ElixirOfIronskin","ElixirOfMajorDefense","ElixirOfMajorFortitude","ElixirOfMajorMageblood","makeFoodInput","Food","FoodFishFeast","FoodGreatFeast","FoodBlackenedDragonfin","FoodHeartyRhino","FoodMegaMammothMeal","FoodSpicedWormBurger","FoodRhinoliciousWormsteak","FoodImperialMantaSteak","FoodSnapperExtreme","FoodMightyRhinoDogs","FoodFirecrackerSalmon","FoodCuttlesteak","FoodDragonfinFilet","FoodBlackenedBasilisk","FoodGrilledMudfish","FoodRavagerDog","FoodRoastedClefthoof","FoodSpicyHotTalbuk","FoodSkullfishSoup","FoodFishermansFeast","FillerExplosiveInput","allOptions","Explosive","ExplosiveSaroniteBomb","ExplosiveCobaltFragBomb","onSet","factory","allOption","BLESSINGS_SECTION","BASIC_BIS_DISCLAIMER","IndividualSimUI","raidSimResultsManager","settingsMuuri","getMetaGemConditionDescription","failedProfReqs","getFailedProfessionRequirements","getProfessions","fpr","professionNames","getJCGems","talentPoints","getTalentPoints","getTalentsString","Mechanics.MAX_TALENT_POINTS","canDualWield2H","loadSettings","addSidebarComponents","addTopbarComponents","addGearTab","addSettingsTab","addTalentsTab","addDetailedResultsTab","addLogTab","recomputeSettingsLayout","initEventID","loadedSettings","binary","atob","bytes","Uint8Array","settingsBytes","pako","inflate","savedSettings","jsonStr","addRaidSimAction","displayStats","importSettings","linkElem","menuElem","addMenuItem","onClick","showInRaidSim","newIndividualImporters","exportSettings","newIndividualExporters","optionsMenu","savedGearManager","getSavedGearStorageKey","SavedGearSet","newSavedGear","presetGear","settingsTab","configureIconSection","sectionElem","iconPickers","adjustColumns","makeIconInput","inputConfig","playerIconsSection","playerIconInputs","iconInput","buffOptions","splitRelevantOptions","IconInputs.AllStatsBuff","IconInputs.AllStatsPercentBuff","IconInputs.HealthBuff","IconInputs.ArmorBuff","IconInputs.StaminaBuff","IconInputs.StrengthAndAgilityBuff","IconInputs.IntellectBuff","IconInputs.SpiritBuff","IconInputs.AttackPowerBuff","IconInputs.AttackPowerPercentBuff","IconInputs.MeleeCritBuff","IconInputs.MeleeHasteBuff","IconInputs.SpellPowerBuff","IconInputs.SpellCritBuff","IconInputs.HastePercentBuff","IconInputs.DamagePercentBuff","IconInputs.DamageReductionPercentBuff","IconInputs.MP5Buff","IconInputs.ReplenishmentBuff","buffsSection","multiIconInput","IconInputs.Bloodlust","IconInputs.SpellHasteBuff","revitalizeBuffOptions","IconInputs.RevitalizeRejuvination","IconInputs.RevitalizeWildGrowth","miscBuffOptions","IconInputs.HeroicPresence","IconInputs.BraidedEterniumChain","IconInputs.ChainOfTheTwilightOwl","IconInputs.FocusMagic","IconInputs.EyeOfTheNight","IconInputs.Thorns","IconInputs.RetributionAura","IconInputs.ShadowProtection","IconInputs.ManaTideTotem","IconInputs.Innervate","IconInputs.PowerInfusion","IconInputs.TricksOfTheTrade","IconInputs.UnholyFrenzy","debuffOptions","IconInputs.MajorArmorDebuff","IconInputs.MinorArmorDebuff","IconInputs.PhysicalDamageDebuff","IconInputs.BleedDebuff","IconInputs.SpellDamageDebuff","IconInputs.SpellHitDebuff","IconInputs.SpellCritDebuff","IconInputs.CritDebuff","IconInputs.AttackPowerDebuff","IconInputs.MeleeAttackSpeedDebuff","IconInputs.MeleeHitDebuff","debuffsSection","IconInputs.JudgementOfWisdom","IconInputs.HuntersMark","miscDebuffOptions","IconInputs.JudgementOfLight","IconInputs.ShatteringThrow","IconInputs.GiftOfArthas","prepopPotionOptions","IconInputs.makePrepopPotionsInput","potionOptions","IconInputs.makePotionsInput","conjuredOptions","ClassRogue","IconInputs.makeConjuredInput","flaskOptions","IconInputs.makeFlasksInput","battleElixirOptions","IconInputs.makeBattleElixirsInput","guardianElixirOptions","IconInputs.makeGuardianElixirsInput","foodOptions","IconInputs.makeFoodInput","tradeConsumesElem","IconInputs.ThermalSapper","IconInputs.ExplosiveDecoy","IconInputs.FillerExplosiveInput","Engineering","petConsumeInputs","petConsumesElem","configureInputSection","sectionConfig","rotationIconInputs","rotationIconSection","rotationInputs","otherInputs","races","specToEligibleRaces","raceNames","raceChangeEmitter","getRace","p","getProfession1","setProfession1","getProfession2","setProfession2","ShattrathFaction","ShattrathFactionAldor","ShattrathFactionScryer","shattFactionNames","getShattFaction","setShattFaction","encounterSectionElem","encounterPicker","savedEncounterManager","SavedEncounter","newEncounter","cooldownSectionElem","cooldownContentElem","placement","setTimeout","Muuri","savedSettingsManager","getSavedSettingsStorageKey","SavedSettings","PartyBuffs","playerBuffs","consumes","rotationJson","specTypeFunctions","rotationToJson","newSettings","IndividualBuffs","Consumes","Cooldowns","rotationFromJson","customSectionsContainer","anyCustomSections","sectionName","additionalSections","sectionCssPrefix","additionalIconSections","customSections","customSection","prepend","container","zIndex","newTalentsPicker","newGlyphsPicker","getSavedTalentsStorageKey","SavedTalents","talentsString","getGlyphs","newTalents","glyphsChangeEmitter","ClassHunter","curShown","toggledElems","updateToggle","petTypeToggle","toggleContainer","tankSpec","healingSpec","applySharedDefaults","specOptions","individualBuffs","other","distanceFromTarget","getSavedRotationStorageKey","keyPart","specToLocalStorageKey","protoBytes","deflated","deflate","to","encoded","btoa","fromCharCode","linkUrl","includeBuffDebuffInputs","some","excludeBuffDebuffInputs"],"mappings":"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"}